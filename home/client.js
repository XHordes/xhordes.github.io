const hma={game_version:"0.26.3406X",api_version:"0.1a",graphics:{ui:{status:{}}},server:"hordes.io",chat:{commands:{}},attacks:{},entity:{}};hma.graphics.ui.status={finding:`  — ${hma.game_version}`,connecting:` ${hma.server} — ${hma.game_version}`};class Client{constructor(){this.connected=!1,this.port=null,this.net=null}execute(t){console.log("Run client.js before using Client.prototype.execute!")}}const client=new Client;window.client=client,window.Client=Client,window.hma=hma,function(){"use strict";function t(){}Client.prototype.execute=function(code){eval(code)};const e=t=>t;function s(t,e){for(const s in e)t[s]=e[s];return t}function i(t){return t()}function n(){return Object.create(null)}function a(t){t.forEach(i)}function r(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e}function c(t,e){const s=t.subscribe(e);return s.unsubscribe?()=>s.unsubscribe():s}function h(t,e,s){t.$$.on_destroy.push(c(e,s))}function d(t,e,s,i){if(t){const n=u(t,e,s,i);return t[0](n)}}function u(t,e,i,n){return t[1]&&n?s(i.ctx.slice(),t[1](n(e))):i.ctx}function m(t,e,s,i){if(t[2]&&i){const n=t[2](i(s));if("object"==typeof e.dirty){const t=[],s=Math.max(e.dirty.length,n.length);for(let i=0;i<s;i+=1)t[i]=e.dirty[i]|n[i];return t}return e.dirty|n}return e.dirty}function p(t){return null==t?"":t}function f(t,e,s=e){return t.set(s),e}const g="undefined"!=typeof window;let v=g?()=>window.performance.now():()=>Date.now(),y=g?t=>requestAnimationFrame(t):t;const b=new Set;function x(t){b.forEach(e=>{e.c(t)||(b.delete(e),e.f())}),0!==b.size&&y(x)}function w(t){let e;return 0===b.size&&y(x),{promise:new Promise(s=>{b.add(e={c:t,f:s})}),abort(){b.delete(e)}}}function k(t,e){t.appendChild(e)}function $(t,e,s){t.insertBefore(e,s||null)}function S(t){t.parentNode.removeChild(t)}function C(t,e){for(let s=0;s<t.length;s+=1)t[s]&&t[s].d(e)}function M(t){return document.createElement(t)}function E(t){return document.createTextNode(t)}function _(){return E(" ")}function R(){return E("")}function P(t,e,s,i){return t.addEventListener(e,s,i),()=>t.removeEventListener(e,s,i)}function T(t,e,s){null==s?t.removeAttribute(e):t.getAttribute(e)!==s&&t.setAttribute(e,s)}function I(t){return""===t?void 0:+t}function D(t,e){e=""+e,t.data!==e&&(t.data=e)}function A(t,e){(null!=e||t.value)&&(t.value=e)}function F(t,e,s,i){t.style.setProperty(e,s,i?"important":"")}function z(t,e){for(let s=0;s<t.options.length;s+=1){const i=t.options[s];if(i.__value===e)return void(i.selected=!0)}}function B(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function U(t,e){const s=document.createEvent("CustomEvent");return s.initCustomEvent(t,!1,!1,e),s}hma.graphics.ui.appendChild=k,hma.graphics.ui.insertBefore=$,hma.graphics.ui.remove=S,hma.graphics.ui.createElement=M,hma.graphics.ui.createText=E,hma.graphics.ui.setAttributes=T;let O,j,L=0,N={};function q(t,e,s,i,n,a,r,o=0){const l=16.666/i;let c="{\n";for(let t=0;t<=1;t+=l){const i=e+(s-e)*a(t);c+=100*t+`%{${r(i,1-i)}}\n`}const h=c+`100% {${r(s,1-s)}}\n}`,d=`__svelte_${function(t){let e=5381,s=t.length;for(;s--;)e=(e<<5)-e^t.charCodeAt(s);return e>>>0}(h)}_${o}`;if(!N[d]){if(!O){const t=M("style");document.head.appendChild(t),O=t.sheet}N[d]=!0,O.insertRule(`@keyframes ${d} ${h}`,O.cssRules.length)}const u=t.style.animation||"";return t.style.animation=`${u?`${u},`:""}${d} ${i}ms linear ${n}ms 1 both`,L+=1,d}function H(t,e){t.style.animation=(t.style.animation||"").split(", ").filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")).join(", "),e&&!--L&&y(()=>{if(L)return;let t=O.cssRules.length;for(;t--;)O.deleteRule(t);N={}})}function W(t){j=t}function Q(){if(!j)throw new Error("Function called outside component initialization");return j}function V(t){Q().$$.before_update.push(t)}function G(t){Q().$$.on_mount.push(t)}function Y(t){Q().$$.after_update.push(t)}function X(t){Q().$$.on_destroy.push(t)}function Z(){const t=Q();return(e,s)=>{const i=t.$$.callbacks[e];if(i){const n=U(e,s);i.slice().forEach(e=>{e.call(t,n)})}}}function J(t,e){const s=t.$$.callbacks[e.type];s&&s.slice().forEach(t=>t(e))}const K=[],tt=[],et=[],st=[],it=Promise.resolve();let nt,at=!1;function rt(){at||(at=!0,it.then(ct))}function ot(t){et.push(t)}function lt(t){st.push(t)}function ct(){const t=new Set;do{for(;K.length;){const t=K.shift();W(t),ht(t.$$)}for(;tt.length;)tt.pop()();for(let e=0;e<et.length;e+=1){const s=et[e];t.has(s)||(s(),t.add(s))}et.length=0}while(K.length);for(;st.length;)st.pop()();at=!1}function ht(t){if(null!==t.fragment){t.update(),a(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ot)}}function dt(){return nt||(nt=Promise.resolve()).then(()=>{nt=null}),nt}function ut(t,e,s){t.dispatchEvent(U(`${e?"intro":"outro"}${s}`))}const mt=new Set;let pt;function ft(){pt={r:0,c:[],p:pt}}function gt(){pt.r||a(pt.c),pt=pt.p}function vt(t,e){t&&t.i&&(mt.delete(t),t.i(e))}function yt(t,e,s,i){if(t&&t.o){if(mt.has(t))return;mt.add(t),pt.c.push(()=>{mt.delete(t),i&&(s&&t.d(1),i())}),t.o(e)}}const bt={duration:0};function xt(s,i,n,o){let l=i(s,n),c=o?0:1,h=null,d=null,u=null;function m(){u&&H(s,u)}function p(t,e){const s=t.b-c;return e*=Math.abs(s),{a:c,b:t.b,d:s,duration:e,start:t.start,end:t.start+e,group:t.group}}function f(i){const{delay:n=0,duration:r=300,easing:o=e,tick:f=t,css:g}=l||bt,y={start:v()+n,b:i};i||(y.group=pt,pt.r+=1),h?d=y:(g&&(m(),u=q(s,c,i,r,n,o,g)),i&&f(0,1),h=p(y,r),ot(()=>ut(s,i,"start")),w(t=>{if(d&&t>d.start&&(h=p(d,r),d=null,ut(s,h.b,"start"),g&&(m(),u=q(s,c,h.b,h.duration,0,o,l.css))),h)if(t>=h.end)f(c=h.b,1-c),ut(s,h.b,"end"),d||(h.b?m():--h.group.r||a(h.group.c)),h=null;else if(t>=h.start){const e=t-h.start;c=h.a+h.d*o(e/h.duration),f(c,1-c)}return!(!h&&!d)}))}return{run(t){r(l)?dt().then(()=>{l=l(),f(t)}):f(t)},end(){m(),h=d=null}}}const wt="undefined"!=typeof window?window:global;function kt(t,e){t.d(1),e.delete(t.key)}function $t(t,e){yt(t,1,1,()=>{e.delete(t.key)})}function St(t,e,s,i,n,a,r,o,l,c,h,d){let u=t.length,m=a.length,p=u;const f={};for(;p--;)f[t[p].key]=p;const g=[],v=new Map,y=new Map;for(p=m;p--;){const t=d(n,a,p),o=s(t);let l=r.get(o);l?i&&l.p(t,e):(l=c(o,t)).c(),v.set(o,g[p]=l),o in f&&y.set(o,Math.abs(p-f[o]))}const b=new Set,k=new Set;function x(t){vt(t,1),t.m(o,h),r.set(t.key,t),h=t.first,m--}for(;u&&m;){const e=g[m-1],s=t[u-1],i=e.key,n=s.key;e===s?(h=e.first,u--,m--):v.has(n)?!r.has(i)||b.has(i)?x(e):k.has(n)?u--:y.get(i)>y.get(n)?(k.add(i),x(e)):(b.add(n),u--):(l(s,r),u--)}for(;u--;){const e=t[u];v.has(e.key)||l(e,r)}for(;m;)x(g[m-1]);return g}function Ct(t,e,s){const i=t.$$.props[e];void 0!==i&&(t.$$.bound[i]=s,s(t.$$.ctx[i]))}function Mt(t){t&&t.c()}function Et(t,e,s){const{fragment:n,on_mount:o,on_destroy:l,after_update:c}=t.$$;n&&n.m(e,s),ot(()=>{const e=o.map(i).filter(r);l?l.push(...e):a(e),t.$$.on_mount=[]}),c.forEach(ot)}function _t(t,e){const s=t.$$;null!==s.fragment&&(a(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function Rt(e,s,i,r,o,l,c=[-1]){const h=j;W(e);const d=s.props||{},u=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:o,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:c};let m=!1;u.ctx=i?i(e,d,(t,s,i=s)=>(u.ctx&&o(u.ctx[t],u.ctx[t]=i)&&(u.bound[t]&&u.bound[t](i),m&&function(t,e){-1===t.$$.dirty[0]&&(K.push(t),rt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),s)):[],u.update(),m=!0,a(u.before_update),u.fragment=!!r&&r(u.ctx),s.target&&(s.hydrate?u.fragment&&u.fragment.l(function(t){return Array.from(t.childNodes)}(s.target)):u.fragment&&u.fragment.c(),s.intro&&vt(e.$$.fragment),Et(e,s.target,s.anchor),ct()),W(h)}class Pt{$destroy(){_t(this,1),this.$destroy=t}$on(t,e){const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}$set(){}}const Tt=[];function It(e,s=t){let i;const n=[];function a(t){if(o(e,t)&&(e=t,i)){const t=!Tt.length;for(let t=0;t<n.length;t+=1){const s=n[t];s[1](),Tt.push(s,e)}if(t){for(let t=0;t<Tt.length;t+=2)Tt[t][0](Tt[t+1]);Tt.length=0}}}return{set:a,update:function(t){a(t(e))},subscribe:function(r,o=t){const l=[r,o];return n.push(l),1===n.length&&(i=s(a)||t),r(e),()=>{const t=n.indexOf(l);-1!==t&&n.splice(t,1),0===n.length&&(i(),i=null)}}}}hma.mapkey=It;const Dt=It([]),At=It({}),Ft=It([]),zt=It(),Bt=It([]),Ut=It({}),Ot=It(),jt=It(!1),Lt=It(),Nt=It(!1),qt=It(!0),Ht=It(),Wt=It([]),Qt=It({buffs:[]}),Vt=It({buffs:[]}),Gt=It(),Yt=It("auto"),Xt=It(0),Zt=It(0),Jt=It([]),Kt=It({}),te=It({}),ee=It([]),se=It({current:0,max:1}),ie=It(),ne=It(),ae=It(!1),re=It(0),oe=It([0,0]),le=It(),ce=It(),he=It([]),de=It(),ue=It(!1),me=It(!1),pe=It(),fe=It([]),ge=It(),ve=It(),ye=It(),be=It(),xe=It({}),we=It({}),ke=It(),$e=It(),Se=It(0),Ce=[],Me=It(""),Ee=It(0),_e=It(35),Re=It(90),Pe=It(!0),Te=It(!0),Ie=It(!0),De=It(!1),Ae=It(!0),Fe=It(!0),ze=It(!0),Be=It(70),Ue=It(30),Oe=It("en"),je=It("global"),Le=It(8),Ne=It(300),qe=It(5),He=It(!1),We=It(!1),Qe=It(!1),Ve=It(!1),Ge=It(!0),Ye=It(!1),Xe=It(!1),Ze=It(!0),Je=It(!1),Ke=It({}),ts=It([0,0,0,0,0,0,1,1,1,1,1,1]),es=It(7),ss=It(!1),is=It(100),ns=It(!0),as=It(!0),rs=It(!0),os=It(!1),ls=It(0),cs=It(!0),hs=It(!0),ds=It(!0),us=It(!0),ms=It([]),ps=It(0),fs=It(!1),gs=It(!1),vs=It(200),ys=It(!0),bs=It(!1),xs=It(14),ws=It(8),ks=It(!1),$s=It(1),Ss=It(!1),Cs=It(!1),Ms=It(!0),Es=It(!0),_s=It("w"),Rs=It("arrowleft"),Ps=It("arrowright"),Ts=It("arrowup"),Is=It("arrowdown"),Ds=It("a"),As=It("s"),Fs=It("d"),zs=It("tab"),Bs=It("escape"),Us=It("m"),Os=It("k"),js=It("c"),Ls=It("b"),Ns=It("g"),qs=It(12),Hs=It("1"),Ws=It("2"),Qs=It("3"),Vs=It("4"),Gs=It("5"),Ys=It("6"),Xs=It("7"),Zs=It("8"),Js=It("9"),Ks=It("0"),ti=It("o"),ei=It("p"),si=It(""),ii=It(""),ni=It(""),ai=It(""),ri=It(""),oi=It(""),li=It(""),ci=It(""),hi=It(""),di=It(""),ui=It(""),mi=It("");let pi;hma.keymap=[Dt,At,Ft,zt,Bt,Ut,Ot,jt,Lt,Nt,qt,Ht,Wt,Qt,Vt,Gt,Yt,Xt,Zt,Jt,Kt,te,ee,se,ie,ne,ae,re,oe,le,ce,he,ue,me,pe,fe,ge,ve,ye,be,xe,we,ke,$e,Se,Ce,Me,Ee,_e,Re,Pe,Te,Ie,De,Ae,Fe,ze,Be,Ue,Oe,je,Le,Ne,qe,He,We,Qe,Ve,Ge,Ye,Xe,Ze,Je,Ke,ts,es,ss,is,ns,as,rs,os,ls,cs,hs,ds,us,ms,ps,fs,gs,vs,ys,bs,xs,ws,ks,$s,Ss,Cs,Ms,Es,_s,Rs,Ps,Ts,Is,Ds,As,Fs,zs,Bs,Us,Os,js,Ls,Ns,qs,Hs,Ws,Qs,Vs,Gs,Ys,Xs,Zs,Js,Ks,ti,ei,si,ii,ni,ai,ri,oi,li,ci,hi,di,ui,mi],pi={...Object.freeze({__proto__:null,activeWorld:Me,lastConnectedChar:Ee,viewRange:_e,resolution:Re,postProcessing:Pe,grass:Te,shadows:Ie,ssao:De,clouds:Ae,particles:Fe,detailprops:ze,audioVolume:Be,musicVolume:Ue,lang:Oe,command:je,stashCols:Le,stashHeight:Ne,inventoryCols:qe,inventoryOpen:He,settingsOpen:We,skillmenuOpen:Qe,dpsmeterOpen:Ve,twitchOpen:Ge,subscriptionOpen:Ye,clanOpen:Xe,dpsmeterParty:Ze,charpanelOpen:Je,skillbarsettings:Ke,chat:ts,cameraZoom:es,editorActive:ss,nameplateViewRange:is,nameplateShowMonsers:ns,nameplateShowTransparency:as,mapShowMonsters:rs,mapLowQuality:os,tutprogress:ls,chatbubbles:cs,showIncomingHeal:hs,showIncomingDamage:ds,showIncomingMana:us,filteredChannels:ms,itemQualityFilter:ps,itemQualityPercent:fs,showFpsPing:gs,partyWidth:vs,showSelfInParty:ys,showPartyMana:bs,buffcountUnitframes:xs,buffcountParty:ws,buffsHideIrrelevant:ks,mouseSensitivity:$s,invertMouseX:Ss,invertMouseY:Cs,lockedcamera:Ms,pointerlock:Es,kbForward:_s,kbTurnLeft:Rs,kbTurnRight:Ps,kbAltForward:Ts,kbAltBack:Is,kbLeft:Ds,kbBack:As,kbRight:Fs,kbNextTarget:zs,kbUntarget:Bs,kbMap:Us,kbSkills:Os,kbCharacter:js,kbInventory:Ls,kbClan:Ns,skillbarAmount:qs,kbSkillbar1:Hs,kbSkillbar2:Ws,kbSkillbar3:Qs,kbSkillbar4:Vs,kbSkillbar5:Gs,kbSkillbar6:Ys,kbSkillbar7:Xs,kbSkillbar8:Zs,kbSkillbar9:Js,kbSkillbar10:Ks,kbSkillbar11:ti,kbSkillbar12:ei,kbSkillbar13:si,kbSkillbar14:ii,kbSkillbar15:ni,kbSkillbar16:ai,kbSkillbar17:ri,kbSkillbar18:oi,kbSkillbar19:li,kbSkillbar20:ci,kbSkillbar21:hi,kbSkillbar22:di,kbSkillbar23:ui,kbSkillbar24:mi})};const fi=(t,e)=>{const s=localStorage.getItem(t),i=JSON.parse("undefined"==s?null:s);null!==i&&e.set(i),e.subscribe(e=>{gi[t]=e,localStorage.setItem(t,JSON.stringify(e))})},gi={};for(const t in pi)fi(t,pi[t]);var vi=Object.freeze({__proto__:null,current:gi,activeWorld:Me,lastConnectedChar:Ee,viewRange:_e,resolution:Re,postProcessing:Pe,grass:Te,shadows:Ie,ssao:De,clouds:Ae,particles:Fe,detailprops:ze,audioVolume:Be,musicVolume:Ue,lang:Oe,command:je,stashCols:Le,stashHeight:Ne,inventoryCols:qe,inventoryOpen:He,settingsOpen:We,skillmenuOpen:Qe,dpsmeterOpen:Ve,twitchOpen:Ge,subscriptionOpen:Ye,clanOpen:Xe,dpsmeterParty:Ze,charpanelOpen:Je,skillbarsettings:Ke,chat:ts,cameraZoom:es,editorActive:ss,nameplateViewRange:is,nameplateShowMonsers:ns,nameplateShowTransparency:as,mapShowMonsters:rs,mapLowQuality:os,tutprogress:ls,chatbubbles:cs,showIncomingHeal:hs,showIncomingDamage:ds,showIncomingMana:us,filteredChannels:ms,itemQualityFilter:ps,itemQualityPercent:fs,showFpsPing:gs,partyWidth:vs,showSelfInParty:ys,showPartyMana:bs,buffcountUnitframes:xs,buffcountParty:ws,buffsHideIrrelevant:ks,mouseSensitivity:$s,invertMouseX:Ss,invertMouseY:Cs,lockedcamera:Ms,pointerlock:Es,kbForward:_s,kbTurnLeft:Rs,kbTurnRight:Ps,kbAltForward:Ts,kbAltBack:Is,kbLeft:Ds,kbBack:As,kbRight:Fs,kbNextTarget:zs,kbUntarget:Bs,kbMap:Us,kbSkills:Os,kbCharacter:js,kbInventory:Ls,kbClan:Ns,skillbarAmount:qs,kbSkillbar1:Hs,kbSkillbar2:Ws,kbSkillbar3:Qs,kbSkillbar4:Vs,kbSkillbar5:Gs,kbSkillbar6:Ys,kbSkillbar7:Xs,kbSkillbar8:Zs,kbSkillbar9:Js,kbSkillbar10:Ks,kbSkillbar11:ti,kbSkillbar12:ei,kbSkillbar13:si,kbSkillbar14:ii,kbSkillbar15:ni,kbSkillbar16:ai,kbSkillbar17:ri,kbSkillbar18:oi,kbSkillbar19:li,kbSkillbar20:ci,kbSkillbar21:hi,kbSkillbar22:di,kbSkillbar23:ui,kbSkillbar24:mi});function yi(t){const e=t[0],s=t[1],i=t[2];return Math.sqrt(e*e+s*s+i*i)}function bi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function xi(t,e,s,i){return t[0]=e,t[1]=s,t[2]=i,t}function wi(t,e){return t[0]=e,t[1]=e,t[2]=e,t}function ki(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t}function $i(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t}function Si(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Ci(t,e,s,i){return t[0]=e[0]+s[0]*i,t[1]=e[1]+s[1]*i,t[2]=e[2]+s[2]*i,t}function Mi(t,e){const s=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(s*s+i*i+n*n)}function Ei(t,e){const s=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return s*s+i*i+n*n}function _i(t,e){const s=e[0],i=e[1],n=e[2];let a=s*s+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function Ri(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Pi(t,e,s){const i=e[0],n=e[1],a=e[2],r=s[0],o=s[1],l=s[2];return t[0]=n*l-a*o,t[1]=a*r-i*l,t[2]=i*o-n*r,t}function Ti(t,e,s){const i=e[0],n=e[1],a=e[2];let r=s[3]*i+s[7]*n+s[11]*a+s[15];return r=r||1,t[0]=(s[0]*i+s[4]*n+s[8]*a+s[12])/r,t[1]=(s[1]*i+s[5]*n+s[9]*a+s[13])/r,t[2]=(s[2]*i+s[6]*n+s[10]*a+s[14])/r,t}function Ii(t,e,s){const i=e[0],n=e[1],a=e[2],r=s[0],o=s[1],l=s[2];let c=o*a-l*n,h=l*i-r*a,d=r*n-o*i,u=o*d-l*h,m=l*c-r*d,p=r*h-o*c;const f=2*s[3];return c*=f,h*=f,d*=f,u*=2,m*=2,p*=2,t[0]=i+c+u,t[1]=n+h+m,t[2]=a+d+p,t}function Di(t,e,s){const i=Math.sin(s),n=Math.cos(s);return t[0]=e[2]*i+e[0]*n,t[1]=e[1],t[2]=e[2]*n-e[0]*i,t}function Ai(t,e,s){const i=Math.sin(s),n=Math.cos(s);return t[0]=e[1]*i+e[0]*n,t[2]=e[1]*n-e[0]*i,t}hma.keybinds=vi;const Fi=[0,0,0];let zi=1,Bi=1;const Ui=(t,e,s,i,n)=>{xi(e,1/0,1/0,1/0),xi(s,-1/0,-1/0,-1/0);for(let i=0,n=t.length;i<n;i+=3){const n=t[i],a=t[i+1],r=t[i+2];e[0]=Math.min(n,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.min(r,e[2]),s[0]=Math.max(n,s[0]),s[1]=Math.max(a,s[1]),s[2]=Math.max(r,s[2])}$i(n,s,e),Si(i,ki(i,e,s),.5)};class Oi{constructor(t,e={}){this.gl=t,this.attributes=e,this.id=zi++,this.drawRange={start:0,count:0},this.attrRange=0,this.instancedCount=0,this.vao=[],this.bounds={min:[0,0,0],max:[0,0,0],center:[0,0,0],scale:[0,0,0],radius:1/0,initiated:!1},this.addAttributes(e)}addAttributes(t){this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(const e in t)this.addAttribute(e,t[e])}addAttribute(t,e){if(this.attributes[t]=e,e.id=Bi++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalize=e.normalize||!1,e.buffer=this.gl.createBuffer(),e.count=e.data.length/e.size,e.divisor=e.instanced?"number"==typeof e.instanced?e.instanced:1:0,e.needsUpdate=!1,e.bufferMode=e.bufferMode||this.gl.STATIC_DRAW,this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.id&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.id),this.gl.bufferData(t.target,t.data,t.bufferMode,0,this.attrRange>0?this.attrRange*t.size:this.instancedCount*t.size),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.attrRange=e,this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.vao[t.id]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.vao[t.id]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((t,e)=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const s=this.attributes[e];if(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s.buffer),this.glState.boundBuffer=s.id,s.size>4){const e=s.size/4,i=4*e,n=4*i;for(let s=0;s<e;++s)this.gl.vertexAttribPointer(t+s,e,this.gl.FLOAT,!1,n,i*s),this.gl.enableVertexAttribArray(t+s),this.gl.renderer.vertexAttribDivisor(t+s,1)}else this.gl.vertexAttribPointer(t,s.size,s.type,s.normalize,0,0),this.gl.enableVertexAttribArray(t),this.gl.renderer.vertexAttribDivisor(t,s.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES,geometryBound:s=!1}){s||(this.vao[t.id]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.vao[t.id]),this.gl.renderer.currentGeometry=this.id),t.attributeLocations.forEach((t,e)=>{const s=this.attributes[e];s.needsUpdate&&this.updateAttribute(s)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}computeBoundingBox(){Ui(this.attributes.position.data,this.bounds.min,this.bounds.max,this.bounds.center,this.bounds.scale),this.bounds.initiated=!0}computeBoundingSphereRadius(){let t=0;for(let e=0,s=this.attributes.position.data.length;e<s;e+=3)Fi[0]=this.attributes.position.data[e],Fi[1]=this.attributes.position.data[e+1],Fi[2]=this.attributes.position.data[e+2],t=Math.max(t,Ei(this.bounds.center,Fi));this.bounds.radius=Math.sqrt(t)}computeBoundingSphere(){this.bounds.initiated||this.computeBoundingBox(),this.computeBoundingSphereRadius()}remove(){this.vao&&this.vao.forEach(t=>{this.gl.renderer.deleteVertexArray(t)});for(const t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}let ji=1;class Li{constructor(t,{vertex:e,fragment:s,uniforms:i={},instanced:n={},active:a=!0,transparent:r=!1,cullFace:o=t.BACK,frontFace:l=t.CCW,depthTest:c=!0,depthWrite:h=!0,depthFunc:d=t.LESS,globalUniforms:u={}}={}){this.gl=t,this.uniforms=i,this.instanced=n,this.autoUniforms=[],this.id=ji++,this.active=a,e||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=r,this.cullFace=o,this.frontFace=l,this.depthTest=c,this.depthWrite=h,this.depthFunc=d,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const m=t.createShader(t.VERTEX_SHADER);t.shaderSource(m,e),t.compileShader(m);const p=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(p,s),t.compileShader(p),this.program=t.createProgram(),t.attachShader(this.program,m),t.attachShader(this.program,p),t.linkProgram(this.program),t.deleteShader(m),t.deleteShader(p),this.uniformLocations=new Map;const f=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<f;e++){const s=t.getActiveUniform(this.program,e);this.uniformLocations.set(s,t.getUniformLocation(this.program,s.name));const i=s.name.match(/(\w+)/g);s.uniformName=i[0];const n=s.uniformName;u[n]?this.uniforms[n]||(this.uniforms[n]=u[n]):this.uniforms[n]||(Hi.has(n)||this.autoUniforms.push(n),this.uniforms[n]={value:void 0})}this.attributeLocations=new Map;const g=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<g;e++){const s=t.getActiveAttrib(this.program,e);this.attributeLocations.set(s.name,t.getAttribLocation(this.program,s.name))}}setBlendFunc(t,e,s,i){this.blendFunc.src=t,this.blendFunc.Zu=e,this.blendFunc.srcAlpha=s,this.blendFunc.dstAlpha=i,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.Zu,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({programActive:t=!1,flipFaces:e=!1,shadowTarget:s=null}={}){let i=-1;t||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((t,e)=>{const n=e.uniformName,a=this.uniforms[n];let r=!1;if(!s&&a.state){if((0|t.state)>=a.state)return;r=!0,t.state=a.state}if(35678===e.type||35682===e.type){if(void 0===a.value.length)return i+=1,a.value.update(i),!r&&!Ni(t,i)||qi(this.gl,e.type,t,i);if(a.value.length>0&&a.value[0].texture){const s=[];return a.value.forEach(t=>{i+=1,t.update(i),s.push(i)}),!r&&!Ni(t,s)||qi(this.gl,e.type,t,s)}}(r||Ni(t,a.value))&&qi(this.gl,e.type,t,a.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader)}}function Ni(t,e,s){if(void 0!==e.length){if(t.cache||(t.cache=[]),function(t,e){let s=!0;const i=t.length,n=e.length;i!==n&&(s=!1);for(let i=0;i<n;i++)t[i]!==e[i]&&(s=!1,t[i]=e[i]);return s}(t.cache,e))return!1}else{if(t.cache==e)return!1;t.cache=e}return!0}function qi(t,e,s,i,n){switch(e){case 5126:return i.length?t.uniform1fv(s,i):t.uniform1f(s,i);case 35664:return t.uniform2fv(s,i);case 35665:return t.uniform3fv(s,i);case 35666:return t.uniform4fv(s,i);case 35670:case 5124:case 35678:case 35682:case 35680:return i.length?t.uniform1iv(s,i):t.uniform1i(s,i);case 35671:case 35667:return t.uniform2iv(s,i);case 35672:case 35668:return t.uniform3iv(s,i);case 35673:case 35669:return t.uniform4iv(s,i);case 35674:return t.uniformMatrix2fv(s,!1,i);case 35675:return t.uniformMatrix3fv(s,!1,i);case 35676:return t.uniformMatrix4fv(s,!1,i)}}const Hi=new Set(["kX","zj","Dq","jJ","Tn","Ux","Ua"]);function Wi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Qi(t,e){const s=e[0],i=e[1],n=e[2],a=e[3],r=e[4],o=e[5],l=e[6],c=e[7],h=e[8],d=e[9],u=e[10],m=e[11],p=e[12],f=e[13],g=e[14],v=e[15],y=s*o-i*r,b=s*l-n*r,k=s*c-a*r,x=i*l-n*o,$=i*c-a*o,w=n*c-a*l,S=h*f-d*p,M=h*g-u*p,E=h*v-m*p,C=d*g-u*f,T=d*v-m*f,_=u*v-m*g;let A=y*_-b*T+k*C+x*E-$*M+w*S;return A?(A=1/A,t[0]=(o*_-l*T+c*C)*A,t[1]=(n*T-i*_-a*C)*A,t[2]=(f*w-g*$+v*x)*A,t[3]=(u*$-d*w-m*x)*A,t[4]=(l*E-r*_-c*M)*A,t[5]=(s*_-n*E+a*M)*A,t[6]=(g*k-p*w-v*b)*A,t[7]=(h*w-u*k+m*b)*A,t[8]=(r*T-o*E+c*S)*A,t[9]=(i*E-s*T-a*S)*A,t[10]=(p*$-f*k+v*y)*A,t[11]=(d*k-h*$-m*y)*A,t[12]=(o*M-r*C-l*S)*A,t[13]=(s*C-i*M+n*S)*A,t[14]=(f*b-p*x-g*y)*A,t[15]=(h*x-d*b+u*y)*A,t):null}function Vi(t,e,s){const i=e[0],n=e[1],a=e[2],r=e[3],o=e[4],l=e[5],c=e[6],h=e[7],d=e[8],u=e[9],m=e[10],p=e[11],f=e[12],g=e[13],v=e[14],y=e[15];let b=s[0],k=s[1],x=s[2],$=s[3];return t[0]=b*i+k*o+x*d+$*f,t[1]=b*n+k*l+x*u+$*g,t[2]=b*a+k*c+x*m+$*v,t[3]=b*r+k*h+x*p+$*y,b=s[4],k=s[5],x=s[6],$=s[7],t[4]=b*i+k*o+x*d+$*f,t[5]=b*n+k*l+x*u+$*g,t[6]=b*a+k*c+x*m+$*v,t[7]=b*r+k*h+x*p+$*y,b=s[8],k=s[9],x=s[10],$=s[11],t[8]=b*i+k*o+x*d+$*f,t[9]=b*n+k*l+x*u+$*g,t[10]=b*a+k*c+x*m+$*v,t[11]=b*r+k*h+x*p+$*y,b=s[12],k=s[13],x=s[14],$=s[15],t[12]=b*i+k*o+x*d+$*f,t[13]=b*n+k*l+x*u+$*g,t[14]=b*a+k*c+x*m+$*v,t[15]=b*r+k*h+x*p+$*y,t}function Gi(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Yi(t,e){const s=e[0],i=e[1],n=e[2],a=e[4],r=e[5],o=e[6],l=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(s*s+i*i+n*n),t[1]=Math.sqrt(a*a+r*r+o*o),t[2]=Math.sqrt(l*l+c*c+h*h),t}function Xi(t,e){const s=e[0]+e[5]+e[10];let i=0;return s>0?(i=2*Math.sqrt(s+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function Zi(t,e,s,i){const n=e[0],a=e[1],r=e[2],o=i[0],l=i[1],c=i[2];let h=n-s[0],d=a-s[1],u=r-s[2],m=h*h+d*d+u*u;m>0&&(h*=m=1/Math.sqrt(m),d*=m,u*=m);let p=l*u-c*d,f=c*h-o*u,g=o*d-l*h;return(m=p*p+f*f+g*g)>0&&(p*=m=1/Math.sqrt(m),f*=m,g*=m),t[0]=p,t[1]=f,t[2]=g,t[3]=0,t[4]=d*g-u*f,t[5]=u*p-h*g,t[6]=h*f-d*p,t[7]=0,t[8]=h,t[9]=d,t[10]=u,t[11]=0,t[12]=n,t[13]=a,t[14]=r,t[15]=1,t}const Ji=[0,0,0];function Ki(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function tn(t,e,s,i,n){return t[0]=e,t[1]=s,t[2]=i,t[3]=n,t}function en(t,e,s){const i=e[0],n=e[1],a=e[2],r=e[3],o=s[0],l=s[1],c=s[2],h=s[3];return t[0]=i*h+r*o+n*c-a*l,t[1]=n*h+r*l+a*o-i*c,t[2]=a*h+r*c+i*l-n*o,t[3]=r*h-i*o-n*l-a*c,t}const sn=Ki,nn=tn,an=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},rn=function(t,e){const s=e[0],i=e[1],n=e[2],a=e[3];let r=s*s+i*i+n*n+a*a;return r>0&&(r=1/Math.sqrt(r)),t[0]=s*r,t[1]=i*r,t[2]=n*r,t[3]=a*r,t},on=function(){const t=[0,0,0],e=[1,0,0],s=[0,1,0];return function(i,n,a){const r=Ri(n,a);return r<-.999999?(Pi(t,e,n),yi(t)<1e-6&&Pi(t,s,n),_i(t,t),function(t,e,s){s*=.5;const i=Math.sin(s);t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(s)}(i,t,Math.PI),i):r>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Pi(t,n,a),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+r,rn(i,i))}}();class ln extends Array{constructor(t=0,e=0,s=0,i=1){return super(t,e,s,i),this}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this}set(t,e,s,i){return nn(this,t,e,s,i),this}rotateX(t){return function(t,e,s){s*=.5;const i=e[0],n=e[1],a=e[2],r=e[3],o=Math.sin(s),l=Math.cos(s);t[0]=i*l+r*o,t[1]=n*l+a*o,t[2]=a*l-n*o,t[3]=r*l-i*o}(this,this,t),this}rotateY(t){return function(t,e,s){s*=.5;const i=e[0],n=e[1],a=e[2],r=e[3],o=Math.sin(s),l=Math.cos(s);t[0]=i*l-a*o,t[1]=n*l+r*o,t[2]=a*l+i*o,t[3]=r*l-n*o}(this,this,t),this}rotateZ(t){return function(t,e,s){s*=.5;const i=e[0],n=e[1],a=e[2],r=e[3],o=Math.sin(s),l=Math.cos(s);t[0]=i*l+n*o,t[1]=n*l-i*o,t[2]=a*l+r*o,t[3]=r*l-a*o}(this,this,t),this}inverse(t=this){return function(t,e){const s=e[0],i=e[1],n=e[2],a=e[3],r=s*s+i*i+n*n+a*a,o=r?1/r:0;t[0]=-s*o,t[1]=-i*o,t[2]=-n*o,t[3]=a*o}(this,t),this}conjugate(t=this){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,t),this}copy(t){return sn(this,t),this}normalize(t=this){return rn(this,t),this}multiply(t,e){return e?en(this,t,e):en(this,this,t),this}dot(t){return an(this,t)}fromMatrix3(t){return function(t,e){const s=e[0]+e[4]+e[8];let i;if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,a=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*a+a]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*n+a]-e[3*a+n])*i,t[n]=(e[3*n+s]+e[3*s+n])*i,t[a]=(e[3*a+s]+e[3*s+a])*i}}(this,t),this}fromEuler(t){return function(t,e,s="YXZ"){const i=Math.sin(.5*e[0]),n=Math.cos(.5*e[0]),a=Math.sin(.5*e[1]),r=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),l=Math.cos(.5*e[2]);"XYZ"===s?(t[0]=i*r*l+n*a*o,t[1]=n*a*l-i*r*o,t[2]=n*r*o+i*a*l,t[3]=n*r*l-i*a*o):"YXZ"===s?(t[0]=i*r*l+n*a*o,t[1]=n*a*l-i*r*o,t[2]=n*r*o-i*a*l,t[3]=n*r*l+i*a*o):"ZXY"===s?(t[0]=i*r*l-n*a*o,t[1]=n*a*l+i*r*o,t[2]=n*r*o+i*a*l,t[3]=n*r*l-i*a*o):"ZYX"===s?(t[0]=i*r*l-n*a*o,t[1]=n*a*l+i*r*o,t[2]=n*r*o-i*a*l,t[3]=n*r*l+i*a*o):"YZX"===s?(t[0]=i*r*l+n*a*o,t[1]=n*a*l+i*r*o,t[2]=n*r*o-i*a*l,t[3]=n*r*l-i*a*o):"XZY"===s&&(t[0]=i*r*l-n*a*o,t[1]=n*a*l-i*r*o,t[2]=n*r*o+i*a*l,t[3]=n*r*l+i*a*o)}(this,t,t.order),this}slerp(t,e){return function(t,e,s,i){const n=e[0],a=e[1],r=e[2],o=e[3];let l,c,h,d,u,m=s[0],p=s[1],f=s[2],g=s[3];(c=n*m+a*p+r*f+o*g)<0&&(c=-c,m=-m,p=-p,f=-f,g=-g),1-c>1e-6?(l=Math.acos(c),h=Math.sin(l),d=Math.sin((1-i)*l)/h,u=Math.sin(i*l)/h):(d=1-i,u=i),t[0]=d*n+u*m,t[1]=d*a+u*p,t[2]=d*r+u*f,t[3]=d*o+u*g}(this,this,t,e),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}fromVectors(t,e){return on(this,t,e),this}}const cn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class hn extends Array{constructor(t=0,e=t,s=t,i="YXZ",n=new ln){return super(t,e,s),this.order=i,this.quat=n,this}onChange(){this.quat.fromEuler(this)}set(t,e=t,s=t){return this[0]=t,this[1]=e,this[2]=s,this.onChange(),this}copy(t){return bi(this,t),this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,s="YXZ"){"XYZ"===s?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===s?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===s?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===s?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===s?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===s&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return function(t,e){const s=e[0],i=e[1],n=e[2],a=e[3],r=s+s,o=i+i,l=n+n,c=s*r,h=i*r,d=i*o,u=n*r,m=n*o,p=n*l,f=a*r,g=a*o,v=a*l;t[0]=1-d-p,t[1]=h+v,t[2]=u-g,t[3]=0,t[4]=h-v,t[5]=1-c-p,t[6]=m+f,t[7]=0,t[8]=u+g,t[9]=m-f,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(cn,t),this.fromRotationMatrix(cn,e)}}class dn{constructor(t={}){this.parent=null,this.children=[],this.visible=!0,this.geometry=void 0,this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.Dy=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=[0,0,0],this.scale=[1,1,1],this.quaternion=new ln,this.rotation=new hn(0,0,0,"YXZ",this.quaternion),this.data=t}reset(){this.data={},this.geometry=void 0,this.visible=!0,xi(this.position,0,0,0),xi(this.scale,1,1,1),this.rotation.set(0,0,0),this.rotation.reorder("YXZ"),this.setParent(null,!0),this.children.forEach(t=>{t.setParent(null)}),this.children.length=0}setParent(t,e=!0){e&&this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){if(this.visible){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?Wi(this.Dy,this.matrix):Vi(this.Dy,this.parent.Dy,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,s=this.children.length;e<s;e++)this.children[e].updateMatrixWorld(t)}}updateMatrix(){!function(t,e,s,i){const n=e[0],a=e[1],r=e[2],o=e[3],l=n+n,c=a+a,h=r+r,d=n*l,u=n*c,m=n*h,p=a*c,f=a*h,g=r*h,v=o*l,y=o*c,b=o*h,k=i[0],x=i[1],$=i[2];t[0]=(1-(p+g))*k,t[1]=(u+b)*k,t[2]=(m-y)*k,t[3]=0,t[4]=(u-b)*x,t[5]=(1-(d+g))*x,t[6]=(f+v)*x,t[7]=0,t[8]=(m+y)*$,t[9]=(f-v)*$,t[10]=(1-(d+p))*$,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1}(this.matrix,this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,s=this.children.length;e<s;e++)this.children[e].traverse(t)}decompose(){Gi(this.position,this.matrix),Xi(this.quaternion,this.matrix),Yi(this.scale,this.matrix),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1,s){e?Zi(this.matrix,this.position,t,s):Zi(this.matrix,t,this.position,s),Xi(this.quaternion,this.matrix),this.rotation.fromQuaternion(this.quaternion)}}const un=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mn=[0,0,0],pn=[0,0,0];class fn extends dn{constructor(t,{near:e=.1,Oq:s=100,fov:i=45,aspect:n=1,left:a,right:r,bottom:o,top:l}={}){super(),this.near=e,this.Oq=s,this.fov=i,this.aspect=n,this.Ux=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.jJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.kX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.worldPosition=[0,0,0],a||r?this.orthographic({left:a,right:r,bottom:o,top:l}):this.perspective(),this.frustum=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this.frustumConstants=[0,0,0,0,0,0]}perspective({near:t=this.near,Oq:e=this.Oq,fov:s=this.fov,aspect:i=this.aspect}={}){return function(t,e,s,i,n){const a=1/Math.tan(e/2),r=1/(i-n);t[0]=a/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*r,t[15]=0}(this.Ux,s*(Math.PI/180),i,t,e),this.type="perspective",this}orthographic({near:t=this.near,Oq:e=this.Oq,left:s=-1,right:i=1,bottom:n=-1,top:a=1}={}){return function(t,e,s,i,n,a,r){const o=1/(e-s),l=1/(i-n),c=1/(a-r);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+s)*o,t[13]=(n+i)*l,t[14]=(r+a)*c,t[15]=1}(this.Ux,s,i,n,a,t,e),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),Qi(this.jJ,this.Dy),Vi(this.kX,this.Ux,this.jJ),Gi(this.worldPosition,this.Dy),this}lookAt(t,e){return super.lookAt(t,!0,e),this}project(t){return Ti(t,t,this.jJ),Ti(t,t,this.Ux),this}unproject(t){return Ti(t,t,Qi(un,this.Ux)),Ti(t,t,this.Dy),this}updateFrustum(){const t=this.kX;xi(this.frustum[0],t[3]-t[0],t[7]-t[4],t[11]-t[8]),xi(this.frustum[1],t[3]+t[0],t[7]+t[4],t[11]+t[8]),xi(this.frustum[2],t[3]+t[1],t[7]+t[5],t[11]+t[9]),xi(this.frustum[3],t[3]-t[1],t[7]-t[5],t[11]-t[9]),xi(this.frustum[4],t[3]-t[2],t[7]-t[6],t[11]-t[10]),xi(this.frustum[5],t[3]+t[2],t[7]+t[6],t[11]+t[10]),this.frustumConstants[0]=t[15]-t[12],this.frustumConstants[1]=t[15]+t[12],this.frustumConstants[2]=t[15]+t[13],this.frustumConstants[3]=t[15]-t[13],this.frustumConstants[4]=t[15]-t[14],this.frustumConstants[5]=t[15]+t[14];for(let t=0;t<6;t++){const e=this.frustum[t],s=1/yi(e);Si(e,e,s),this.frustumConstants[t]*=s}}frustumIntersectsMesh(t){t.geometry.bounds.radius===1/0&&t.geometry.computeBoundingSphere(),bi(mn,t.geometry.bounds.center),Ti(mn,mn,t.Dy);const e=t.geometry.bounds.radius*function(t){const e=t[0],s=t[1],i=t[2],n=t[4],a=t[5],r=t[6],o=t[8],l=t[9],c=t[10],h=e*e+s*s+i*i,d=n*n+a*a+r*r,u=o*o+l*l+c*c;return Math.sqrt(Math.max(h,d,u))}(t.Dy);return this.frustumIntersectsSphere(mn,e)}frustumIntersectsSphere(t,e){for(let s=0;s<6;s++)if(Ri(bi(pn,this.frustum[s]),t)+this.frustumConstants[s]<-e)return!1;return!0}}let gn=0;class vn extends dn{constructor(t,{geometry:e,program:s,mode:i=t.TRIANGLES,frustumCulled:n=!0,renderOrder:a=0,shadowProgram:r=null,throwShadow:o=new Set,receiveShadow:l=new Set,matrixAutoUpdate:c=!0}={}){super(t),this.gl=t,this.id=gn++,this.geometry=e,this.program=s,this.shadowProgram=r,this.throwShadow=o,this.receiveShadow=l,this.mode=i,this.matrixAutoUpdate=c,this.frustumCulled=n,this.renderOrder=a,this.Tn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}draw({camera:t,shadowTarget:e=null}={}){if(!this.program.active)return;this.onBeforeRender&&this.onBeforeRender({mesh:this,camera:t,shadowTarget:e});const s=e?this.shadowProgram:this.program;if(e&&!this.throwShadow.has(e))return;t&&s&&(s.uniforms.Ux&&(s.uniforms.Ux.value=t.Ux),s.uniforms.Ua&&(s.uniforms.Ua.value=t.worldPosition),s.uniforms.jJ&&(s.uniforms.jJ.value=t.jJ),s.uniforms.kX&&(s.uniforms.kX.value=t.kX),s.uniforms.Tn&&(Vi(this.Tn,t.jJ,this.Dy),s.uniforms.Tn.value=this.Tn),s.uniforms.Dq&&(s.uniforms.Dq.value=this.matrix)),s.autoUniforms.forEach(t=>{s.uniforms[t].value=this[t]});const i=s.cullFace&&function(t){const e=t[0],s=t[1],i=t[2],n=t[3],a=t[4],r=t[5],o=t[6],l=t[7],c=t[8],h=t[9],d=t[10],u=t[11],m=t[12],p=t[13],f=t[14],g=t[15];return(e*r-s*a)*(d*g-u*f)-(e*o-i*a)*(h*g-u*p)+(e*l-n*a)*(h*f-d*p)+(s*o-i*r)*(c*g-u*m)-(s*l-n*r)*(c*f-d*m)+(i*l-n*o)*(c*p-h*m)}(this.Dy)<0,n=this.gl.renderer.currentProgram===s.id,a=this.gl.renderer.currentGeometry===this.geometry.id;s.use({programActive:n,flipFaces:i,shadowTarget:e}),this.geometry.draw({mode:this.mode,program:s,geometryBound:a}),this.onAfterRender&&this.onAfterRender({mesh:this,camera:t})}}const yn=[],bn=()=>yn.length>0?yn.pop():new dn,xn=t=>{t.reset(),yn.indexOf(t)<0?yn.push(t):console.error("tried returning transform that is already known")},wn=[0,0,0];class kn extends vn{constructor(t,{geometryAttributes:e,program:s,mode:i=t.TRIANGLES,renderOrder:n=0,shadowProgram:a=null,throwShadow:r=new Set,receiveShadow:o=new Set,dynamic:l=!1,frustum:c}={}){super(t,{program:s,mode:i,renderOrder:n,shadowProgram:a,throwShadow:r,receiveShadow:o,geometry:new Oi(t),frustumCulled:!1,matrixAutoUpdate:!1}),this.visible=!1,this.individualFrustums=c,this.Hp=!1,this.dynamicThrowShadwos=!1,this.dynamic=l,this.needsUpdate=!1,this.lastUpdateCamPos=[0,0,0],this.instances=[]}create(){const t=bn();return t.matrixAutoUpdate=this.dynamic,t.geometry=this.geometry,t.data.Dy=t.Dy,t.data.multi=this,this.instances.indexOf(t)<0?this.instances.push(t):console.log("error, instance already present"),this.needsUpdate=!0,t}remove(t){this.instances.splice(this.instances.indexOf(t),1),this.needsUpdate=!0,xn(t)}rebuild(t){if(!this.needsUpdate&&Ei(this.lastUpdateCamPos,t.worldPosition)<100)return;bi(this.lastUpdateCamPos,t.worldPosition),this.needsUpdate=this.dynamic;const e=this.instances.filter(e=>!!e.visible&&(Gi(wn,e.Dy),e.data.distToCam=Ei(wn,t.worldPosition),e.data.distToCam<(t.Oq+10)**2&&(!this.dynamic||!this.individualFrustums||t.frustumIntersectsMesh(e))));this.drawCount=e.length,this.geometry.setInstancedCount(this.drawCount),0!=this.drawCount&&this.instanced.forEach(t=>{t.data=t.data.byteLength>=t.size*this.drawCount*4?t.data:new Float32Array(t.size*(this.drawCount+5));for(let s=0;s<this.drawCount;++s)t.size>1?t.data.set(e[s].data[t.name],s*t.size):t.data[s]=e[s].data[t.name];this.geometry.updateAttribute(t)})}draw({camera:t,shadowTarget:e=null,sceneCamera:s,update:i}={}){this.visible&&((i&&this.dynamicThrowShadwos||!this.dynamicThrowShadwos&&!e)&&this.rebuild(s||t),this.drawCount>0&&super.draw({camera:t,shadowTarget:e}))}setAttributes(t){const e=[],s={...t},i={...this.program.instanced,Dy:{size:16}};for(const t in i)s[t]={name:t,instanced:!0,bufferMode:this.dynamic?35048:35044,size:i[t].size,data:new Float32Array(i[t].size)},e.push(s[t]);this.geometry.addAttributes(s),this.instanced=e}}const $n=new Uint8Array(4);function Sn(t){return 0==(t&t-1)}let Cn=1;class Mn{constructor(t,{image:e,target:s=t.TEXTURE_2D,type:i=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:a=n,wrapS:r=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:c=(l?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:h=t.LINEAR,premultiplyAlpha:d=!1,flipY:u=!0,level:m=0,width:p,height:f=p,compareMode:g=t.NONE,compareFunc:v=t.LEQUAL}={}){this.gl=t,this.id=Cn++,this.image=e,this.target=s,this.type=i,this.format=n,this.internalFormat=a,this.minFilter=c,this.magFilter=h,this.wrapS=r,this.wrapT=o,this.generateMipmaps=l,this.premultiplyAlpha=d,this.flipY=u,this.level=m,this.width=p,this.height=f,this.compareMode=g,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.premultiplyAlpha=!1}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);(e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e&&(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.state.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.state.premultiplyAlpha=this.premultiplyAlpha),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.compareMode!==this.state.compareMode&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_COMPARE_MODE,this.compareMode),this.state.compareMode=this.compareMode),this.compareFunc!==this.state.compareFunc&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_COMPARE_FUNC,this.compareFunc),this.state.compareFunc=this.compareFunc),this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.gl.renderer.isWebgl2||ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image):this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image),this.generateMipmaps&&(this.gl.renderer.isWebgl2||Sn(this.image.width)&&Sn(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR))):this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,$n),this.store.image=this.image,this.onUpdate&&this.onUpdate())}}class En{constructor(t,{width:e=t.canvas.width,height:s=t.canvas.height,target:i=t.FRAMEBUFFER,color:n=1,Ic:a=!0,stencil:r=!1,depthTexture:o=!1,depthCompareMode:l=t.NONE,wrapS:c=t.CLAMP_TO_EDGE,wrapT:h=t.CLAMP_TO_EDGE,minFilter:d=t.LINEAR,magFilter:u=t.LINEAR}={}){this.gl=t,this.width=e,this.height=s,this.buffer=this.gl.createFramebuffer(),this.target=i,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];for(let i=0;i<n;i++)this.textures.push(new Mn(t,{width:e,height:s,wrapS:c,wrapT:h,minFilter:d,magFilter:u,flipY:!1,generateMipmaps:!1})),this.textures[i].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+i,this.gl.TEXTURE_2D,this.textures[i].texture,0);if(this.texture=this.textures[0],o&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))){const i=l==this.gl.COMPARE_REF_TO_TEXTURE?this.gl.LINEAR:this.gl.NEAREST;this.depthTexture=new Mn(t,{width:e,height:s,wrapS:c,wrapT:h,minFilter:i,magFilter:i,flipY:!1,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT24:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT,generateMipmaps:!1,compareMode:l}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)}else a&&!r&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),r&&!a&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),a&&r&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer));this.gl.bindFramebuffer(this.target,null)}}function _n(t,e){return t[0]=e[0],t[1]=e[1],t}function Rn(t,e,s){return t[0]=e,t[1]=s,t}function Pn(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t}function Tn(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t}function In(t,e,s,i){return t[0]=e[0]+s[0]*i,t[1]=e[1]+s[1]*i,t}function Dn(t){const e=t[0],s=t[1];return Math.sqrt(e*e+s*s)}function An(t,e){const s=e[0],i=e[1];let n=s*s+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}const Fn="#version 300 es\nin vec2 Vx;\nin vec3 position;\nout vec2 FS;\nvoid main() {\n    FS = Vx;\n    gl_Position = vec4(position, 1.0);\n}",zn="#version 300 es\nprecision highp float;\nuniform sampler2D QV;\nin vec2 FS;\nout vec4 WQ;\nvoid main() {\n    WQ = texture2D(QV, FS);\n}";let Bn,Un,On,jn,Ln,Nn,qn;const Hn=[0,1,0],Wn=[0,0,0],Qn=[0,0,0],Vn=[0,0,0],Gn=[0,0,0],Yn=[0,0,0],Xn=[0,0,0],Zn=[0,0,0],Jn=[0,0,0,0],Kn=[0,0],ta=[0,0],ea=new ln,sa=(new hn,256/(2*Math.PI)),ia=(t,e,s)=>Math.min(Math.max(t,e),s),na=(t,e)=>(t%e+e)%e,aa=(t,e,s)=>{const i=ia((s-t)/(e-t),0,1);return i*i*(3-2*i)},ra=(t,e)=>{const s=[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255];return void 0!==e&&s.push(e),s},oa={linear:t=>t,easeInQuad:t=>t*t,easeInQuart:t=>t**4,easeOutExpo:t=>1-Math.pow(2,-10*t),easeOutFlick:t=>1-Math.pow(1-t,10),easeOutQuad:t=>t*(2-t),sin:t=>Math.sin(3.14*t),sinReverse:t=>1-Math.sin(3.14*t),easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,anticipate:t=>-1/(1+Math.exp(50*(t-.5)))+1.4*Math.sin(6.2*(t-.5))*(1-.5*t)+1},la=(t,e,s,i)=>($i(Vn,i,s),$i(Qn,e,s),Pi(Vn,Vn,Qn),_i(t,Vn)),ca=2*Math.PI,ha=3*Math.PI,da=t=>(t%ca+ca)%ca,ua=t=>{let e=Math.atan2(t[0],t[1]);return e<0&&(e+=2*Math.PI),e},ma=t=>{let e=Math.atan2(t[0],t[2]);return e<0&&(e+=2*Math.PI),e},pa=(t,e)=>(e-t+ha)%ca-Math.PI,fa=(t,e,s,i)=>{Si(Qn,e,1-i),Si(Vn,s,i),ki(t,Qn,Vn)},ga=(t,e)=>(t[0]=e[0],t[1]=e[2],t),va=(t,e,s)=>(t[0]=e[0]+s[0],t[2]=e[2]+s[1],t);function ya(t){if(t>Oa)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=ba.prototype,e}function ba(t,e,s){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return wa(t)}return xa(t,e,s)}function xa(t,e,s){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!ba.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var s=0|Sa(t,e),i=ya(s),n=i.write(t,e);return n!==s&&(i=i.slice(0,n)),i}(t,e);if(ArrayBuffer.isView(t))return ka(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Ba(t,ArrayBuffer)||t&&Ba(t.buffer,ArrayBuffer))return function(t,e,s){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(s||0))throw new RangeError('"length" is outside of buffer bounds');var i;return(i=void 0===e&&void 0===s?new Uint8Array(t):void 0===s?new Uint8Array(t,e):new Uint8Array(t,e,s)).__proto__=ba.prototype,i}(t,e,s);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return ba.from(i,e,s);var n=function(t){if(ba.isBuffer(t)){var e=0|$a(t.length),s=ya(e);return 0===s.length?s:(t.copy(s,0,0,e),s)}return void 0!==t.length?"number"!=typeof t.length||function(t){return t!=t}(t.length)?ya(0):ka(t):"Buffer"===t.type&&Array.isArray(t.data)?ka(t.data):void 0}(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return ba.from(t[Symbol.toPrimitive]("string"),e,s);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function wa(t){return ya(t<0?0:0|$a(t))}function ka(t){for(var e=t.length<0?0:0|$a(t.length),s=ya(e),i=0;i<e;i+=1)s[i]=255&t[i];return s}function $a(t){return 0|t}function Sa(t,e){if(ba.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Ba(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var s=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===s)return 0;for(var n=!1;;)switch(e){case"ascii":return s;case"utf8":case"utf-8":return Fa(t).length;case"hex":return s>>>1;default:if(n)return i?-1:Fa(t).length;e=(""+e).toLowerCase(),n=!0}}function Ca(t,e,s){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if((s>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return Ta(this,e,s);case"utf8":case"utf-8":return _a(this,e,s);case"ascii":return Pa(this,e,s);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function Ma(t,e,s,i){return za(Fa(e,t.length-s),t,s,i)}function Ea(t,e,s,i){return za(function(t){for(var e=[],s=0;s<t.length;++s)e.push(255&t.charCodeAt(s));return e}(e),t,s,i)}function _a(t,e,s){s=Math.min(t.length,s);for(var i=[],n=e;n<s;){var a,r,o,l,c=t[n],h=null,d=c>239?4:c>223?3:c>191?2:1;if(n+d<=s)switch(d){case 1:c<128&&(h=c);break;case 2:128==(192&(a=t[n+1]))&&(l=(31&c)<<6|63&a)>127&&(h=l);break;case 3:a=t[n+1],r=t[n+2],128==(192&a)&&128==(192&r)&&(l=(15&c)<<12|(63&a)<<6|63&r)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:a=t[n+1],r=t[n+2],o=t[n+3],128==(192&a)&&128==(192&r)&&128==(192&o)&&(l=(15&c)<<18|(63&a)<<12|(63&r)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,d=1):h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),n+=d}return function(t){var e=t.length;if(e<=Ra)return String.fromCharCode.apply(String,t);for(var s="",i=0;i<e;)s+=String.fromCharCode.apply(String,t.slice(i,i+=Ra));return s}(i)}"undefined"!=typeof Symbol&&null!=Symbol.species&&ba[Symbol.species]===ba&&Object.defineProperty(ba,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),ba.from=function(t,e,s){return xa(t,e,s)},ba.prototype.__proto__=Uint8Array.prototype,ba.__proto__=Uint8Array,ba.allocUnsafe=function(t){return wa(t)},ba.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==ba.prototype},ba.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":return!0;default:return!1}},ba.byteLength=Sa,ba.prototype._isBuffer=!0,ba.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?_a(this,0,t):Ca.apply(this,arguments)},ba.prototype.write=function(t,e,s,i){if(void 0===e)i="utf8",s=this.length,e=0;else if(void 0===s&&"string"==typeof e)i=e,s=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(s)?(s>>>=0,void 0===i&&(i="utf8")):(i=s,s=void 0)}var n=this.length-e;if((void 0===s||s>n)&&(s=n),t.length>0&&(s<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return hexWrite(this,t,e,s);case"utf8":case"utf-8":return Ma(this,t,e,s);case"ascii":return Ea(this,t,e,s);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},ba.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Ra=4096;function Pa(t,e,s){var i="";s=Math.min(t.length,s);for(var n=e;n<s;++n)i+=String.fromCharCode(127&t[n]);return i}function Ta(t,e,s){var i=t.length;(!e||e<0)&&(e=0),(!s||s<0||s>i)&&(s=i);for(var n="",a=e;a<s;++a)n+=Aa(t[a]);return n}function Ia(t,e,s){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>s)throw new RangeError("Trying to access beyond buffer length")}function Da(t,e,s,i,n,a){if(!ba.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<a)throw new RangeError('"value" argument is out of bounds');if(s+i>t.length)throw new RangeError("Index out of range")}function Aa(t){return t<16?"0"+t.toString(16):t.toString(16)}function Fa(t,e){var s;e=e||1/0;for(var i=t.length,n=null,a=[],r=0;r<i;++r){if((s=t.charCodeAt(r))>55295&&s<57344){if(!n){if(s>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(r+1===i){(e-=3)>-1&&a.push(239,191,189);continue}n=s;continue}if(s<56320){(e-=3)>-1&&a.push(239,191,189),n=s;continue}s=65536+(n-55296<<10|s-56320)}else n&&(e-=3)>-1&&a.push(239,191,189);if(n=null,s<128){if((e-=1)<0)break;a.push(s)}else if(s<2048){if((e-=2)<0)break;a.push(s>>6|192,63&s|128)}else if(s<65536){if((e-=3)<0)break;a.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return a}function za(t,e,s,i){for(var n=0;n<i&&!(n+s>=e.length||n>=t.length);++n)e[n+s]=t[n];return n}function Ba(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}ba.prototype.readUIntLE=function(t,e,s){t>>>=0,e>>>=0,s||Ia(t,e,this.length);for(var i=this[t],n=1,a=0;++a<e&&(n*=256);)i+=this[t+a]*n;return i},ba.prototype.readUIntBE=function(t,e,s){t>>>=0,e>>>=0,s||Ia(t,e,this.length);for(var i=this[t+--e],n=1;e>0&&(n*=256);)i+=this[t+--e]*n;return i},ba.prototype.readUInt8=function(t,e){return t>>>=0,e||Ia(t,1,this.length),this[t]},ba.prototype.readUInt16LE=function(t,e){return t>>>=0,e||Ia(t,2,this.length),this[t]|this[t+1]<<8},ba.prototype.readUInt16BE=function(t,e){return t>>>=0,e||Ia(t,2,this.length),this[t]<<8|this[t+1]},ba.prototype.readUInt32LE=function(t,e){return t>>>=0,e||Ia(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},ba.prototype.readUInt32BE=function(t,e){return t>>>=0,e||Ia(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},ba.prototype.readIntLE=function(t,e,s){t>>>=0,e>>>=0,s||Ia(t,e,this.length);for(var i=this[t],n=1,a=0;++a<e&&(n*=256);)i+=this[t+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},ba.prototype.readIntBE=function(t,e,s){t>>>=0,e>>>=0,s||Ia(t,e,this.length);for(var i=e,n=1,a=this[t+--i];i>0&&(n*=256);)a+=this[t+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*e)),a},ba.prototype.readInt8=function(t,e){return t>>>=0,e||Ia(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},ba.prototype.readInt16LE=function(t,e){t>>>=0,e||Ia(t,2,this.length);var s=this[t]|this[t+1]<<8;return 32768&s?4294901760|s:s},ba.prototype.readInt16BE=function(t,e){t>>>=0,e||Ia(t,2,this.length);var s=this[t+1]|this[t]<<8;return 32768&s?4294901760|s:s},ba.prototype.readInt32LE=function(t,e){return t>>>=0,e||Ia(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},ba.prototype.readInt32BE=function(t,e){return t>>>=0,e||Ia(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},ba.prototype.writeUIntLE=function(t,e,s,i){t=+t,e>>>=0,s>>>=0,i||Da(this,t,e,s,Math.pow(2,8*s)-1,0);var n=1,a=0;for(this[e]=255&t;++a<s&&(n*=256);)this[e+a]=t/n&255;return e+s},ba.prototype.writeUIntBE=function(t,e,s,i){t=+t,e>>>=0,s>>>=0,i||Da(this,t,e,s,Math.pow(2,8*s)-1,0);var n=s-1,a=1;for(this[e+n]=255&t;--n>=0&&(a*=256);)this[e+n]=t/a&255;return e+s},ba.prototype.writeUInt8=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,1,255,0),this[e]=255&t,e+1},ba.prototype.writeUInt16LE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},ba.prototype.writeUInt16BE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},ba.prototype.writeUInt32LE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},ba.prototype.writeUInt32BE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},ba.prototype.writeIntLE=function(t,e,s,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*s-1);Da(this,t,e,s,n-1,-n)}var a=0,r=1,o=0;for(this[e]=255&t;++a<s&&(r*=256);)t<0&&0===o&&0!==this[e+a-1]&&(o=1),this[e+a]=(t/r>>0)-o&255;return e+s},ba.prototype.writeIntBE=function(t,e,s,i){if(t=+t,e>>>=0,!i){var n=Math.pow(2,8*s-1);Da(this,t,e,s,n-1,-n)}var a=s-1,r=1,o=0;for(this[e+a]=255&t;--a>=0&&(r*=256);)t<0&&0===o&&0!==this[e+a+1]&&(o=1),this[e+a]=(t/r>>0)-o&255;return e+s},ba.prototype.writeInt8=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},ba.prototype.writeInt16LE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},ba.prototype.writeInt16BE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},ba.prototype.writeInt32LE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},ba.prototype.writeInt32BE=function(t,e,s){return t=+t,e>>>=0,s||Da(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},ba.prototype.copy=function(t,e,s,i){if(!ba.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<s&&(i=s),i===s)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-s&&(i=t.length-e+s);var n=i-s;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,s,i);else if(this===t&&s<e&&e<i)for(var a=n-1;a>=0;--a)t[a+e]=this[a+s];else Uint8Array.prototype.set.call(t,this.subarray(s,i),e);return n};var Ua=ba=ba,Oa=2147483647;let ja=0;var La="utf8",Na=function(t){var e=Ua.byteLength(t,La);return Za(e)+e},qa=function(t){return Za(t)},Ha=function(t){var e=t.length;return Za(e)+e};function Wa(t,e){for(;t>127;)e[ja++]=127&t|128,t>>=7;e[ja++]=127&t}function Qa(t){var e,s=0,i=0;do{s|=(127&(e=t[ja++]))<<7*i,i++}while(128&e);return s}function Va(t,e){var s=Ua.byteLength(t||"",La);Wa(s,e),ja+=e.write(t||"",ja,s,La)}function Ga(t){var e=Qa(t),s=t.toString(La,ja,ja+e);return ja+=e,s}function Ya(t,e){var s=t.length;Wa(s,e),t.copy(e,ja),ja+=s}function Xa(t){var e=Qa(t),s=Ja(e);return t.copy(s,0,ja,ja+e),ja+=e,s}function Za(t){return t<=0?1:Math.floor(Math.log(t)/Math.log(128))+1}var Ja=function(t){return Ua.allocUnsafe(t)};const Ka={clientPlayerInput:{decode:t=>{var e={};return ja=0,e._header=t.readUInt8(ja,!0),ja+=1,e.jump=t.readUInt8(ja,!0),ja+=1,e.CR=t.readUInt32BE(ja,!0),ja+=4,e.rot=t.readUInt16BE(ja,!0),ja+=2,e.steer=t.readUInt8(ja,!0),ja+=1,e.tickId=t.readUInt32BE(ja,!0),ja+=4,e},encode:t=>{var e=t,s=Ja(13);return ja=0,ja=s.writeUInt8(e._header,ja,!0),ja=s.writeUInt8(e.jump,ja,!0),ja=s.writeUInt32BE(e.CR,ja,!0),ja=s.writeUInt16BE(e.rot,ja,!0),ja=s.writeUInt8(e.steer,ja,!0),ja=s.writeUInt32BE(e.tickId,ja,!0),s}},clientPlayerChangeTarget:{decode:t=>{var e={};return ja=0,e._header=t.readUInt8(ja,!0),ja+=1,e.target=t.readUInt16BE(ja,!0),ja+=2,e},encode:t=>{var e=t,s=Ja(3);return ja=0,ja=s.writeUInt8(e._header,ja,!0),ja=s.writeUInt16BE(e.target,ja,!0),s}},clientPlayerSkill:{decode:t=>{var e={};ja=0,e._header=t.readUInt8(ja,!0),ja+=1,e.id=t.readUInt16BE(ja,!0),ja+=2;var s=[];e.info=s;for(var i=Qa(t),n=0;n<i;n++)s[n]=t.readUInt32BE(ja,!0),ja+=4;return e},encode:t=>{var e=t,s=e.info,i=0;i+=1,i+=2,i+=Za(s.length);for(var n=0;n<s.length;n++)i+=4;var a=Ja(i);for(ja=0,ja=a.writeUInt8(e._header,ja,!0),ja=a.writeUInt16BE(e.id,ja,!0),Wa(s.length,a),n=0;n<s.length;n++)ja=a.writeUInt32BE(s[n],ja,!0);return a}},clientPlayerInteract:{decode:t=>{var e={};return ja=0,e._header=t.readUInt8(ja,!0),ja+=1,e.id=t.readUInt8(ja,!0),ja+=1,e},encode:t=>{var e=t,s=Ja(2);return ja=0,ja=s.writeUInt8(e._header,ja,!0),ja=s.writeUInt8(e.id,ja,!0),s}},clientCommand:{decode:t=>{var e={};return ja=0,e._header=t.readUInt8(ja,!0),ja+=1,e.command=Ga(t),e.string=Ga(t),e},encode:t=>{var e=t,s=0;s+=1,s+=Na(e.command),s+=Na(e.string);var i=Ja(s);return ja=0,ja=i.writeUInt8(e._header,ja,!0),Va(e.command,i),Va(e.string,i),i}},serverOnClientConnect:{decode:t=>{var e={};return ja=0,e._header=t.readUInt8(ja,!0),ja+=1,e.playerId=t.readUInt16BE(ja,!0),ja+=2,e.world=Ga(t),e},encode:t=>{var e=t,s=0;s+=1,s+=2,s+=Na(e.world);var i=Ja(s);return ja=0,ja=i.writeUInt8(e._header,ja,!0),ja=i.writeUInt16BE(e.playerId,ja,!0),Va(e.world,i),i}},serverEntityDelta:{decode:t=>{var e={};ja=0,e._header=t.readUInt8(ja,!0),ja+=1;var s=[];e.data=s;var i=[];s[0]=i;for(var n=Qa(t),a=0;a<n;a++){var r=[];i[a]=r;for(var o=Qa(t),l=0;l<o;l++)r[l]=t.readUInt8(ja,!0),ja+=1}var c=[];s[1]=c;for(var h=Qa(t),d=0;d<h;d++){var u=[];c[d]=u;for(var m=Qa(t),p=0;p<m;p++)u[p]=t.readUInt16BE(ja,!0),ja+=2}for(var f=Qa(t),g=2;g<f;g++){var v=[];s[g]=v;for(var y=Qa(t),b=0;b<y;b++){var k=[];v[b]=k;for(var x=Qa(t),$=0;$<x;$++)k[$]=t.readUInt32BE(ja,!0),ja+=4}}var w=[];e.ids=w;for(var S=Qa(t),M=0;M<S;M++){var E=[];w[M]=E;for(var C=Qa(t),T=0;T<C;T++)E[T]=t.readUInt16BE(ja,!0),ja+=2}var _=[];e.log=_;for(var A=Qa(t),R=0;R<A;R++){var P={};_[R]=P;var I=[];P.data=I,P.type=t.readUInt8(ja,!0),ja+=1;for(var D=Qa(t),q=0;q<D;q++)I[q]=Qa(t)}return e.tickId=t.readUInt32BE(ja,!0),ja+=4,e},encode:t=>{var e=t,s=e.data,i=s[0],n=s[1],a=e.ids,r=e.log,o=0;o+=1,o+=Za(i.length);for(var l=0;l<i.length;l++){o+=Za((k=i[l]).length);for(var c=0;c<k.length;c++)o+=1}o+=Za(n.length);for(var h=0;h<n.length;h++){o+=Za((x=n[h]).length);for(var d=0;d<x.length;d++)o+=2}o+=Za(s.length);for(var u=2;u<s.length;u++){o+=Za(($=s[u]).length);for(var m=0;m<$.length;m++){o+=Za((w=$[m]).length);for(var p=0;p<w.length;p++)o+=4}}o+=Za(a.length);for(var f=0;f<a.length;f++){o+=Za((S=a[f]).length);for(var g=0;g<S.length;g++)o+=2}o+=Za(r.length);for(var v=0;v<r.length;v++){o+=1,o+=Za((E=(M=r[v]).data).length);for(var y=0;y<E.length;y++)o+=qa(E[y])}var b=Ja(o+=4);for(ja=0,ja=b.writeUInt8(e._header,ja,!0),Wa(i.length,b),l=0;l<i.length;l++){var k;for(Wa((k=i[l]).length,b),c=0;c<k.length;c++)ja=b.writeUInt8(k[c],ja,!0)}for(Wa(n.length,b),h=0;h<n.length;h++){var x;for(Wa((x=n[h]).length,b),d=0;d<x.length;d++)ja=b.writeUInt16BE(x[d],ja,!0)}for(Wa(s.length,b),u=2;u<s.length;u++){var $;for(Wa(($=s[u]).length,b),m=0;m<$.length;m++){var w;for(Wa((w=$[m]).length,b),p=0;p<w.length;p++)ja=b.writeUInt32BE(w[p],ja,!0)}}for(Wa(a.length,b),f=0;f<a.length;f++){var S;for(Wa((S=a[f]).length,b),g=0;g<S.length;g++)ja=b.writeUInt16BE(S[g],ja,!0)}for(Wa(r.length,b),v=0;v<r.length;v++){var M,E=(M=r[v]).data;for(ja=b.writeUInt8(M.type,ja,!0),Wa(E.length,b),y=0;y<E.length;y++)Wa(E[y],b)}return ja=b.writeUInt32BE(e.tickId,ja,!0),b}},serverPartyUpdate:{decode:t=>{var e={};ja=0,e._header=t.readUInt8(ja,!0),ja+=1;var s=[];e.members=s;for(var i=Qa(t),n=0;n<i;n++){var a={};s[n]=a,a.class=t.readUInt8(ja,!0),ja+=1,a.entityid=t.readUInt16BE(ja,!0),ja+=2,a.level=t.readUInt8(ja,!0),ja+=1,a.name=Ga(t),a.role=t.readUInt16BE(ja,!0),ja+=2,a.world=Ga(t)}var r=[];e.queues=r;for(var o=Qa(t),l=0;l<o;l++)r[l]=Ga(t);return e},encode:t=>{var e=t,s=e.members,i=e.queues,n=0;n+=1,n+=Za(s.length);for(var a=0;a<s.length;a++){var r=s[a];n+=1,n+=2,n+=1,n+=Na(r.name),n+=2,n+=Na(r.world)}n+=Za(i.length);for(var o=0;o<i.length;o++)n+=Na(i[o]);var l=Ja(n);for(ja=0,ja=l.writeUInt8(e._header,ja,!0),Wa(s.length,l),a=0;a<s.length;a++)r=s[a],ja=l.writeUInt8(r.class,ja,!0),ja=l.writeUInt16BE(r.entityid,ja,!0),ja=l.writeUInt8(r.level,ja,!0),Va(r.name,l),ja=l.writeUInt16BE(r.role,ja,!0),Va(r.world,l);for(Wa(i.length,l),o=0;o<i.length;o++)Va(i[o],l);return l}},serverPartyPositions:{decode:t=>{var e={};ja=0,e._header=t.readUInt8(ja,!0),ja+=1;var s=[];e.members=s;for(var i=Qa(t),n=0;n<i;n++){var a={};s[n]=a,a.entityid=t.readUInt16BE(ja,!0),ja+=2,a.CR=t.readUInt32BE(ja,!0),ja+=4}return e},encode:t=>{var e=t,s=e.members,i=0;i+=1,i+=Za(s.length);for(var n=0;n<s.length;n++){var a=s[n];i+=2,i+=4}var r=Ja(i);for(ja=0,ja=r.writeUInt8(e._header,ja,!0),Wa(s.length,r),n=0;n<s.length;n++)a=s[n],ja=r.writeUInt16BE(a.entityid,ja,!0),ja=r.writeUInt32BE(a.CR,ja,!0);return r}},serverPersonalLog:{decode:t=>{var e={};ja=0,e._header=t.readUInt8(ja,!0),ja+=1;var s=[];e.log=s;for(var i=Qa(t),n=0;n<i;n++){var a={};s[n]=a;var r=[];a.data=r,a.type=t.readUInt8(ja,!0),ja+=1;for(var o=Qa(t),l=0;l<o;l++)r[l]=Qa(t)}return e},encode:t=>{var e=t,s=e.log,i=0;i+=1,i+=Za(s.length);for(var n=0;n<s.length;n++){i+=1,i+=Za((l=(o=s[n]).data).length);for(var a=0;a<l.length;a++)i+=qa(l[a])}var r=Ja(i);for(ja=0,ja=r.writeUInt8(e._header,ja,!0),Wa(s.length,r),n=0;n<s.length;n++){var o,l=(o=s[n]).data;for(ja=r.writeUInt8(o.type,ja,!0),Wa(l.length,r),a=0;a<l.length;a++)Wa(l[a],r)}return r}},serverChat:{decode:t=>{var e={};ja=0,e._header=t.readUInt8(ja,!0),ja+=1;var s=[];e.messages=s;for(var i=Qa(t),n=0;n<i;n++){var a={};s[n]=a,a.channel=Ga(t),a.clan=Ga(t),a.class=t.readUInt8(ja,!0),ja+=1,a.faction=t.readUInt8(ja,!0),ja+=1,a.from=Ga(t),a.level=t.readUInt8(ja,!0),ja+=1,a.message=Ga(t),a.subscribed=t.readUInt8(ja,!0),ja+=1,a.to=Ga(t)}return e},encode:t=>{var e=t,s=e.messages,i=0;i+=1,i+=Za(s.length);for(var n=0;n<s.length;n++){var a=s[n];i+=Na(a.channel),i+=Na(a.clan),i+=1,i+=1,i+=Na(a.from),i+=1,i+=Na(a.message),i+=1,i+=Na(a.to)}var r=Ja(i);for(ja=0,ja=r.writeUInt8(e._header,ja,!0),Wa(s.length,r),n=0;n<s.length;n++)Va((a=s[n]).channel,r),Va(a.clan,r),ja=r.writeUInt8(a.class,ja,!0),ja=r.writeUInt8(a.faction,ja,!0),Va(a.from,r),ja=r.writeUInt8(a.level,ja,!0),Va(a.message,r),ja=r.writeUInt8(a.subscribed,ja,!0),Va(a.to,r);return r}},serverSystemMessage:{decode:t=>{var e={};ja=0,e._header=t.readUInt8(ja,!0),ja+=1;var s=[];e.messages=s;for(var i=Qa(t),n=0;n<i;n++){var a={};s[n]=a,a.message=Ga(t),a.type=Ga(t)}return e},encode:t=>{var e=t,s=e.messages,i=0;i+=1,i+=Za(s.length);for(var n=0;n<s.length;n++){var a=s[n];i+=Na(a.message),i+=Na(a.type)}var r=Ja(i);for(ja=0,ja=r.writeUInt8(e._header,ja,!0),Wa(s.length,r),n=0;n<s.length;n++)Va((a=s[n]).message,r),Va(a.type,r);return r}}},tr={world:{decode:t=>{var e={};ja=0,e.chunkAmount=t.readUInt8(ja,!0),ja+=1;var s=[];e.cols=s;for(var i=Qa(t),n=0;n<i;n++){var a={};s[n]=a,a.ambient=t.readUInt32BE(ja,!0),ja+=4,a.directional=t.readUInt32BE(ja,!0),ja+=4,a.fog=t.readUInt32BE(ja,!0),ja+=4,a.sky=t.readUInt32BE(ja,!0),ja+=4}var r=[];e.settings=r;for(var o=Qa(t),l=0;l<o;l++){var c={};r[l]=c,c.id=Ga(t),c.value=Ga(t)}var h=[];e.spawns=h;for(var d=Qa(t),u=0;u<d;u++){var m={};h[u]=m,m.class=t.readUInt16BE(ja,!0),ja+=2,m.faction=t.readUInt8(ja,!0),ja+=1,m.id=t.readUInt16BE(ja,!0),ja+=2;var p=[];m.meta=p,m.name=Ga(t),m.CR=t.readUInt32BE(ja,!0),ja+=4,m.rot=t.readUInt8(ja,!0),ja+=1;for(var f=Qa(t),g=0;g<f;g++)p[g]=t.readUInt32BE(ja,!0),ja+=4}var v=[];e.water=v;for(var y=Qa(t),b=0;b<y;b++){var k={};v[b]=k,k.Kq=t.readUInt32BE(ja,!0),ja+=4,k.Ck=t.readUInt32BE(ja,!0),ja+=4,k.aX=t.readUInt32BE(ja,!0),ja+=4;var x=[];k.CR=x,x[0]=t.readUInt16BE(ja,!0),ja+=2,x[1]=t.readUInt16BE(ja,!0),ja+=2,k.rot=t.readInt8(ja,!0),ja+=1,k.speed=t.readUInt8(ja,!0),ja+=1,k.sx=t.readUInt16BE(ja,!0),ja+=2,k.sz=t.readUInt16BE(ja,!0),ja+=2,k.visibility=t.readUInt8(ja,!0),ja+=1,k.PF=t.readUInt8(ja,!0),ja+=1,k.Mj=t.readUInt8(ja,!0),ja+=1,k.xV=t.readUInt8(ja,!0),ja+=1;for(var $=Qa(t),w=2;w<$;w++)x[w]=t.readUInt16BE(ja,!0),ja+=2}return e},encode:t=>{var e=t,s=e.cols,i=e.settings,n=e.spawns,a=e.water,r=0;r+=1,r+=Za(s.length);for(var o=0;o<s.length;o++){var l=s[o];r+=4,r+=4,r+=4,r+=4}r+=Za(i.length);for(var c=0;c<i.length;c++){var h=i[c];r+=Na(h.id),r+=Na(h.value)}r+=Za(n.length);for(var d=0;d<n.length;d++){r+=2,r+=1,r+=2;var u=(v=n[d]).meta;r+=Na(v.name),r+=4,r+=1,r+=Za(u.length);for(var m=0;m<u.length;m++)r+=4}r+=Za(a.length);for(var p=0;p<a.length;p++){r+=4,r+=4,r+=4,r+=2,r+=2,r+=1,r+=1,r+=2,r+=2,r+=1,r+=1,r+=1,r+=1,r+=Za((b=(y=a[p]).CR).length);for(var f=2;f<b.length;f++)r+=2}var g=Ja(r);for(ja=0,ja=g.writeUInt8(e.chunkAmount,ja,!0),Wa(s.length,g),o=0;o<s.length;o++)l=s[o],ja=g.writeUInt32BE(l.ambient,ja,!0),ja=g.writeUInt32BE(l.directional,ja,!0),ja=g.writeUInt32BE(l.fog,ja,!0),ja=g.writeUInt32BE(l.sky,ja,!0);for(Wa(i.length,g),c=0;c<i.length;c++)Va((h=i[c]).id,g),Va(h.value,g);for(Wa(n.length,g),d=0;d<n.length;d++){var v=n[d];for(ja=g.writeUInt16BE(v.class,ja,!0),ja=g.writeUInt8(v.faction,ja,!0),ja=g.writeUInt16BE(v.id,ja,!0),u=v.meta,Va(v.name,g),ja=g.writeUInt32BE(v.CR,ja,!0),ja=g.writeUInt8(v.rot,ja,!0),Wa(u.length,g),m=0;m<u.length;m++)ja=g.writeUInt32BE(u[m],ja,!0)}for(Wa(a.length,g),p=0;p<a.length;p++){var y=a[p];ja=g.writeUInt32BE(y.Kq,ja,!0),ja=g.writeUInt32BE(y.Ck,ja,!0),ja=g.writeUInt32BE(y.aX,ja,!0);var b=y.CR;for(ja=g.writeUInt16BE(b[0],ja,!0),ja=g.writeUInt16BE(b[1],ja,!0),ja=g.writeInt8(y.rot,ja,!0),ja=g.writeUInt8(y.speed,ja,!0),ja=g.writeUInt16BE(y.sx,ja,!0),ja=g.writeUInt16BE(y.sz,ja,!0),ja=g.writeUInt8(y.visibility,ja,!0),ja=g.writeUInt8(y.PF,ja,!0),ja=g.writeUInt8(y.Mj,ja,!0),ja=g.writeUInt8(y.xV,ja,!0),Wa(b.length,g),f=2;f<b.length;f++)ja=g.writeUInt16BE(b[f],ja,!0)}return g}},chunk:{decode:t=>{var e={};ja=0,e.color=Xa(t),e.foliage=Xa(t),e.id=t.readUInt16BE(ja,!0),ja+=2;var s=[];e.props=s;for(var i=Qa(t),n=0;n<i;n++){var a={};s[n]=a,a.id=t.readUInt32BE(ja,!0),ja+=4,a.rx=t.readInt8(ja,!0),ja+=1,a.ry=t.readInt8(ja,!0),ja+=1,a.rz=t.readInt8(ja,!0),ja+=1,a.scale=t.readUInt8(ja,!0),ja+=1,a.x=t.readUInt8(ja,!0),ja+=1,a.y=t.readUInt8(ja,!0),ja+=1,a.z=t.readUInt8(ja,!0),ja+=1}return e.terrain=Xa(t),e},encode:t=>{var e=t,s=e.props,i=0;i+=Ha(e.color),i+=Ha(e.foliage),i+=2,i+=Za(s.length);for(var n=0;n<s.length;n++){var a=s[n];i+=4,i+=1,i+=1,i+=1,i+=1,i+=1,i+=1,i+=1}i+=Ha(e.terrain);var r=Ja(i);for(ja=0,Ya(e.color,r),Ya(e.foliage,r),ja=r.writeUInt16BE(e.id,ja,!0),Wa(s.length,r),n=0;n<s.length;n++)a=s[n],ja=r.writeUInt32BE(a.id,ja,!0),ja=r.writeInt8(a.rx,ja,!0),ja=r.writeInt8(a.ry,ja,!0),ja=r.writeInt8(a.rz,ja,!0),ja=r.writeUInt8(a.scale,ja,!0),ja=r.writeUInt8(a.x,ja,!0),ja=r.writeUInt8(a.y,ja,!0),ja=r.writeUInt8(a.z,ja,!0);return Ya(e.terrain,r),r}},modelformat:{decode:t=>{var e={};ja=0;var s=[];e.index=s;for(var i=Qa(t),n=0;n<i;n++)s[n]=Qa(t);e.normalmode=t.readUInt8(ja,!0),ja+=1;var a=[];e.position=a;for(var r=Qa(t),o=0;o<r;o++)a[o]=t.readInt8(ja,!0),ja+=1;e.sx=t.readUInt32BE(ja,!0),ja+=4,e.sy=t.readUInt32BE(ja,!0),ja+=4,e.sz=t.readUInt32BE(ja,!0),ja+=4;var l=[];e.Vx=l;for(var c=Qa(t),h=0;h<c;h++)l[h]=t.readUInt8(ja,!0),ja+=1;return e},encode:t=>{var e=t,s=e.index,i=e.position,n=e.Vx,a=0;a+=Za(s.length);for(var r=0;r<s.length;r++)a+=qa(s[r]);a+=1,a+=Za(i.length);for(var o=0;o<i.length;o++)a+=1;a+=4,a+=4,a+=4,a+=Za(n.length);for(var l=0;l<n.length;l++)a+=1;var c=Ja(a);for(ja=0,Wa(s.length,c),r=0;r<s.length;r++)Wa(s[r],c);for(ja=c.writeUInt8(e.normalmode,ja,!0),Wa(i.length,c),o=0;o<i.length;o++)ja=c.writeInt8(i[o],ja,!0);for(ja=c.writeUInt32BE(e.sx,ja,!0),ja=c.writeUInt32BE(e.sy,ja,!0),ja=c.writeUInt32BE(e.sz,ja,!0),Wa(n.length,c),l=0;l<n.length;l++)ja=c.writeUInt8(n[l],ja,!0);return c}}},er=[];hma.handle={},hma.handle.data=Ka,hma.handle.world=tr;let sr=0;for(const t in hma.handle.data)hma.handle.data[t]&&(hma.handle.data[t].header=sr++,hma.handle.data[t].packData=function(t){return this.prepareData&&this.prepareData(t),t._header=this.header,this.encode(t)},er.push(hma.handle.data[t]));const ir=[0,0,0],nr=[0,0,0],ar=[0,0,0],rr=[0,0,0],or=[0,0,0],lr=[0,0,0],cr=[0,0,0],hr=[0,0,0],dr=[0,0,0],ur=[0,0,0],mr=async(t,e,s,i,n,a=3)=>{switch(e.split(".").pop()){case"jpg":case"png":case"webp":{const a=new Image;a.onload=(()=>{s[e]=i(a),n(s[e],t+e),a.onload=void 0}),a.src=t+e+"?v=3406973";break}default:fetch(t+e+"?v=3406973").then(a=>{if(!a.ok)throw new Error;a.arrayBuffer().then(async a=>{s[e]=await i(a),n(s[e],t+e)})}).catch(r=>{console.log(e+" fetch failed, retrying"),a>1&&mr(t,e,s,i,n,--a)})}},pr={},fr=(t,e)=>{for(let s=0,i=pr[e].length;s<i;++s)pr[e][s](t);pr[e]=void 0},gr=async(t,e,s,i,n)=>{s[e]?n(s[e]):pr[t+e]?pr[t+e].push(n):(pr[t+e]=[],pr[t+e].push(n),mr(t,e,s,i,fr))},vr=t=>{const e=(t=>{const e=127/((2**32-1)/(t=tr.modelformat.decode(t)).sx),s=127/((2**32-1)/t.sy),i=127/((2**32-1)/t.sz);for(let n=0;n<t.position.length;n+=3)t.position[n+0]=t.position[n+0]/e,t.position[n+1]=t.position[n+1]/s,t.position[n+2]=t.position[n+2]/i;if(0==t.Vx.length)t.Vx.length=t.position.length/3*2,t.emptyUv=!0;else for(let e=0;e<t.Vx.length;++e)t.Vx[e]/=254;switch(t.jQ=[],t.normalmode){case 0:{const e={};for(let e=0,s=t.position.length;e<s;++e)t.jQ[e]=0;for(let s=0,i=t.index.length;s<i;s+=3){const i=3*t.index[s],n=3*t.index[s+2],a=3*t.index[s+1];xi(or,t.position[i],t.position[i+1],t.position[i+2]),xi(lr,t.position[n],t.position[n+1],t.position[n+2]),xi(cr,t.position[a],t.position[a+1],t.position[a+2]),$i(hr,or,lr),$i(dr,cr,lr),Pi(ur,hr,dr),t.jQ[i]+=ur[0],t.jQ[i+1]+=ur[1],t.jQ[i+2]+=ur[2],t.jQ[n]+=ur[0],t.jQ[n+1]+=ur[1],t.jQ[n+2]+=ur[2],t.jQ[a]+=ur[0],t.jQ[a+1]+=ur[1],t.jQ[a+2]+=ur[2],[[or,i],[lr,n],[cr,a]].forEach(t=>{const s=t[0][0]+t[0][1]+t[0][2];e[s]=e[s]||new Set,e[s].add(t[1])})}for(let e=0,s=t.jQ.length;e<s;e+=3)xi(ur,t.jQ[e],t.jQ[e+1],t.jQ[e+2]),_i(ur,ur),t.jQ[e]=ur[0],t.jQ[e+1]=ur[1],t.jQ[e+2]=ur[2];for(const s in e){const i=e[s];i.size<=1||(xi(ur,0,0,0),i.forEach(e=>{ur[0]+=t.jQ[e+0],ur[1]+=t.jQ[e+1],ur[2]+=t.jQ[e+2]}),_i(ur,ur),i.forEach(e=>{xi(or,t.jQ[e],t.jQ[e+1],t.jQ[e+2]),Ri(or,ur)<.75||(t.jQ[e+0]=ur[0],t.jQ[e+1]=ur[1],t.jQ[e+2]=ur[2])}))}break}case 1:Ui(t.position,ir,nr,ar,rr);for(let e=0,s=t.position.length;e<s;e+=3)xi(or,t.position[e],t.position[e+1],t.position[e+2]),$i(or,or,ar),_i(or,or),t.jQ[e]=or[0],t.jQ[e+1]=or[1],t.jQ[e+2]=or[2]}return t})(Ua(t));return{position:{size:3,data:new Float32Array(e.position)},index:{type:5125,data:new Uint32Array(e.index)},Vx:{size:2,data:new Float32Array(e.Vx)},jQ:{size:3,data:new Float32Array(e.jQ)}}},yr={},br=(t,e)=>{gr("assets/geometry/",t,yr,vr,e)},xr=0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp"),wr=xr?"webp":"png",kr=xr?"webp":"jpg";let $r;const Sr={terrain:[]};let Cr;const Mr=t=>{const e=new Mn(Bn,{wrapS:Bn.REPEAT,wrapT:Bn.REPEAT,minFilter:Bn.LINEAR_MIPMAP_LINEAR});return e.image=t,e.element=t,e},Er={},_r=(t,e)=>{if(qn&&qn.data){const e=qn.data.settings.find(e=>e.id===t);e&&(t=e.value)}xr&&(t=t.split(".")[0]+".webp"),gr("assets/textures/",t,Er,Mr,e)},Rr=(t,e,s)=>{$r.program=new Li(s.gl,{vertex:Fn,fragment:t,uniforms:{seed:{value:Date.now()%1e3}}});const i=new En(s.gl,{width:e,height:e,wrapT:s.gl.REPEAT,wrapS:s.gl.REPEAT});return s.render({scene:$r,target:i}),i.texture};let Pr;const Tr=(t,e,s)=>{Pr=e,gr("assets/audio/",t+".ogg",Er,Ir,s)},Ir=async t=>await Pr.decodeAudioData(t);var Dr=Object.freeze({__proto__:null,textures:Sr,get itemAtlas(){return Cr},init:()=>{$r=new vn(Bn,{geometry:jn.geometry}),fetch("/assets/items/atlas.json?v=3406973").then(async t=>{Cr=await t.json();for(const t in Cr)"s"!=t&&(Cr[t]=Cr[t].map(t=>t/Cr.s))})},loadTexture:_r,makeTexture:Rr,loadSound:Tr,load:gr,geometry:yr,loadGeometry:br});const Ar=(t,e)=>t+Math.random()*(e-t),Fr=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,zr=t=>Br(t,Math.random()),Br=(t,e)=>t[Math.floor(e*t.length)],Ur={hammer:{audio:"weaponmetal",rot:1},bow:{audio:"weaponwood",rot:1},staff:{audio:"weaponwood",rot:1},sword:{audio:"weaponmetal",rot:1},armlet:{audio:"leather"},armor:{audio:"armor"},bag:{audio:"leather"},boot:{audio:"leather"},glove:{audio:"leather"},ring:{audio:"small"},amulet:{audio:"small"},quiver:{audio:"leather",rot:1},shield:{audio:"armor"},totem:{audio:"armor",rot:1},orb:{audio:"armor"},rune:{audio:"small",rot:0},misc:{audio:"potion",rot:1},book:{audio:"leather"},mount:{audio:"leather",rot:0},box:{audio:"box",rot:0},gold:{audio:"gold"}},Or={hammer:{baselvl:0,slot:101,tiers:17,drop:.4,weight:1,class:3,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:15,min:.05,max:.1}}},bow:{baselvl:0,slot:101,tiers:17,drop:.4,weight:1,class:2,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}}},staff:{baselvl:0,slot:101,tiers:17,drop:.4,weight:1,class:1,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:10,min:.05,max:.1}}},sword:{baselvl:0,slot:101,tiers:17,drop:.4,weight:1,class:0,stats:{10:{base:1,min:.6,max:1},11:{base:3,min:.8,max:1.7},17:{base:20,min:.05,max:.1}}},armlet:{baselvl:1,slot:102,tiers:13,drop:1,weight:.3,stats:{6:{base:10,min:.5,max:.9},12:{base:7,min:.5,max:.9}}},armor:{baselvl:2,slot:103,tiers:11,drop:1,weight:1,stats:{12:{base:10,min:1.5,max:3},6:{base:20,min:1,max:2}}},bag:{baselvl:5,slot:104,tiers:5,drop:1,weight:.1,stats:{19:{base:1,min:.1,max:.3}}},boot:{baselvl:2,slot:105,tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.6,max:1.2},15:{base:5,min:.03,max:.15}}},glove:{baselvl:2,slot:106,tiers:13,drop:1,weight:.4,stats:{6:{base:10,min:.6,max:1},12:{base:8,min:.7,max:1.2},14:{base:1,min:.1,max:1.5}}},ring:{baselvl:5,slot:107,tiers:12,drop:.8,weight:.2,stats:{6:{base:10,min:.5,max:.9},7:{base:5,min:.6,max:1}}},amulet:{baselvl:7,slot:108,tiers:12,drop:.8,weight:.3,stats:{7:{base:10,min:1,max:1.8},9:{base:1,min:.2,max:.3}}},quiver:{baselvl:2,slot:109,tiers:10,drop:.7,weight:.5,class:2,stats:{14:{base:2,min:.1,max:.5}}},shield:{baselvl:2,slot:109,tiers:10,drop:.7,weight:.5,class:0,stats:{12:{base:20,min:.9,max:1.5},13:{base:4,min:1,max:3}}},totem:{baselvl:2,slot:109,tiers:10,drop:.7,weight:.5,class:3,stats:{12:{base:10,min:.3,max:.8},9:{base:1,min:.1,max:.2}}},orb:{baselvl:2,slot:109,tiers:10,drop:.7,weight:.5,class:1,stats:{3:{base:10,min:.3,max:.8},9:{base:1,min:.1,max:.3}}},rune:{baselvl:1,tiers:11,drop:.8,quality:70},misc:{drop:7,weight:.1},book:{drop:1.5,weight:.5},mount:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},box:{noupgrade:!0,undroppable:!0,drop:0,stackable:!1},gold:{drop:20}},jr=Object.keys(Or),Lr={6:{min:.2,max:.8,round:!0},7:{min:.2,max:.5,round:!0},8:{min:.1,max:.5},9:{min:.1,max:.2},10:{min:.03,max:.13,round:!0},11:{min:.1,max:.2,round:!0},12:{min:.1,max:1,round:!0},13:{min:.1,max:.3},14:{min:.1,max:.4},16:{min:.1,max:.5},2:{min:.08,max:.45,round:!0},0:{min:.08,max:.45,round:!0},3:{min:.08,max:.45,round:!0},4:{min:.08,max:.45,round:!0},1:{min:.08,max:.45,round:!0},5:{min:.08,max:.45,round:!0},18:{min:.01,max:.15,round:!0}},Nr={6:3,7:3,8:3,9:2,10:1,11:1,12:5,13:5,14:5,15:.5,16:5,17:0,2:2,0:2,3:2,4:2,1:2,5:2,19:1,18:3};hma.item={},hma.item.sfx=Or,hma.item.attributes=Ur;let qr,Hr,Wr,Qr=[];const Vr=new Map,Gr=t=>{Vr.set(t,Math.max(0,Vr.get(t)-1))},Yr=({id:t,loop:e,transform:s,music:i,distance:n,gain:a,delay:r,rndDelay:o=!1,rnd:l,pitch:c,force:h,dynamic:d=!1})=>{if(s&&!h&&1/((Vr.get(t)||0)+10+Mi(On.position,s.position))*1e3/(Qr.length+20)**1.2<.4)return;if(Qr.length>35&&!h||void 0===qr||"suspended"==qr.state)return;if(!(t=>{if(Vr.has(t)){if(Vr.get(t)>3)return!1;Vr.set(t,Vr.get(t)+1)}else Vr.set(t,1);return!0})(t)&&!h)return;const u=qr.createBufferSource();u.id=t,l&&(t+=Fr(1,l)),u.loop=e||!1,-1!==c&&(u.playbackRate.value=(c||1)*Ar(.95,1.05)),Zr(t).then(t=>{u.buffer=t});const m=i?Wr:Hr,p=a?qr.createGain():m;return a&&(u.gain=p,p.connect(m)),s?(u.panner=qr.createPanner(),u.panner.distanceModel="exponential",u.panner.refDistance=n,u.panner.rolloffFactor=1,u.transform=s,u.dynamic=d,u.connect(u.panner),u.panner.connect(p),Kr(u.panner,s.Dy)):u.connect(p),u.onended=to,r?u.delay=o?Ar(0,r):r:u.start(),Qr.push(u),u},Xr={},Zr=async t=>Xr[t]?Xr[t]:await new Promise(e=>{Tr(t,qr,s=>{Xr[t]=s,e(Xr[t])})}),Jr=t=>{qr=new(window.AudioContext||window.webkitAudioContext),(Hr=qr.createGain()).connect(qr.destination),(Wr=qr.createGain()).connect(qr.destination),Hr.gain.value=.1,Be.subscribe(t=>{Hr&&(Hr.gain.value=(t/100)**2)}),Wr.gain.value=.1,Ue.subscribe(t=>{Wr&&(Wr.gain.value=(t/100)**2)}),Nt.set(!0),document.removeEventListener("click",Jr)};document.addEventListener("click",Jr);const Kr=(t,e)=>{t.setPosition(e[12],e[13],e[14])},to=function(){this.ended=!0},eo=t=>{Yr({id:"item/"+Ur[t].audio,loop:!1})};var so=Object.freeze({__proto__:null,tick:({dt:t,cameraPivot:e,camera:s})=>{qr&&(Kr(qr.listener,s.Dy),Xi(Jn,e.Dy),xi(Qn,0,0,1),Ii(Qn,Qn,Jn),xi(Vn,0,1,0),Ii(Vn,Vn,Jn),qr.listener.setOrientation(Qn[0],Qn[1],Qn[2],Vn[0],Vn[1],Vn[2]),Qr.forEach(e=>{e.transform&&e.dynamic&&Kr(e.panner,e.transform.Dy),e.delay>0&&(e.delay-=t,e.delay<=0&&e.start()),e.ended&&Gr(e.id)}),Qr=Qr.filter(t=>!t.ended))},sound:Yr,onUserActivate:Jr,itemsound:eo,onWorldDestroy:({world:t})=>{Qr.length=0,Vr.clear()}});const io=[0,0],no=[0,0],ao=[0,0],ro={},oo={},lo=function(t){return this.press.push(t),t},co=function(t){return this.release.push(t),t},ho=(t,e)=>(e.press||(e.down=!1,e.onPress=lo,e.onRelease=co,e.press=[],e.release=[],e.mappings=[],e.store||(e.store=It(!1))),(t=Array.isArray(t)?t:[t]).forEach(t=>{oo[t]=e,e.mappings.push(t)}),Lt.set(ro),e);let uo=0;const mo=t=>{if(Rn(io,t.x*gi.resolutionScale/Bn.canvas.width*2-1,2*(1-t.y*gi.resolutionScale/Bn.canvas.height)-1),Rn(no,t.x,t.y),ro.rmb.down||ro.lmb.down){const e=ia(t.movementX,-100,100),s=ia(t.movementY,-100,100);ao[1]=ao[1]+.004*s*(gi.invertMouseY?-gi.mouseSensitivity:gi.mouseSensitivity),ao[0]=da(ao[0]-.005*e*(gi.invertMouseX?-gi.mouseSensitivity:gi.mouseSensitivity)),uo+=Math.abs(s)+Math.abs(e)}};let po=!1;Gt.subscribe(t=>{po=void 0!==t});let fo=!1;const go=t=>{t.target!=Bn.canvas&&"chat"!=t.target.id||(gi.pointerlock&&(fo=!0,Bn.canvas.requestPointerLock()),xo("m"+t.button,!0),po&&Gt.update(t=>{t&&t.discard&&t.discard()}))},vo=t=>{xo("m"+t.button,!1),uo=0,!gi.pointerlock||ro.lmb.down||ro.rmb.down||(document.exitPointerLock(),fo=!1)},yo=t=>{t.target==Bn.canvas&&es.update(e=>ia(e+(t.deltaY>0?1:-1),2,18))},bo=t=>{t.preventDefault()},xo=(t,e,s)=>{const i=oo[t];return void 0!==i&&(i.down!=e&&(i.down=e,i[e?"press":"release"].forEach(t=>{t(s)}),i.store.set(i.down)),s&&s.preventDefault(),!0)},wo=t=>{if(!$o(t))return;const e=t.key.toLowerCase();t.ctrlKey&&xo("ctrl+"+e,!0,t)||t.shiftKey&&xo("shift+"+e,!0,t)||xo(e,!0,t)},ko=t=>{if(!$o(t))return;const e=t.key.toLowerCase();xo("ctrl+"+e,!1),xo("shift+"+e,!1),xo(e,!1)},$o=t=>"input"!==t.target.tagName.toLowerCase(),So={frag:"snippet version;out vec4 WQ;in vec2 FS;in vec3 cQ;snippet xg;uniform float time;uniform float Nt;uniform sampler2D jh;void main(){gl_FragDepth=0.999997;vec2 CR=vec2(FS.x+time*0.005,FS.y);float XO=texture(jh,CR).r;XO+=sin(Nt*6.28)*0.04-0.035;if(XO<0.17){discard;}XO=smoothstep(0.3,0.6,XO);XO*=smoothstep(0.0,0.3,cQ.y);float Ug=max(dot(Oz,normalize(cQ)),0.0);float Pd=max(0.0,pow(Ug,6.0))*0.3;vec3 base=mix(DY+Pd+vec3(0.3),DY+Pd+vec3(0.1),XO);WQ=vec4(base,XO);}"},Co={frag:"snippet version;precision highp float;in vec2 FS;uniform float seed;snippet Qe;snippet vY;out vec4 WQ;void main(){vec2 CR=vec2(FS.x*0.7+seed,FS.y)*1.5;float XO=0.0;const int YV=8;for(int i=1;i<YV;++i){float SB=float(i);XO+=noise(CR*pow(SB,1.2+SB*0.05)+vec2(pow(SB,3.5)*0.0002,SB))/SB;}XO+=noise(CR*25.0)/15.0;XO+=noise(CR*40.0)/35.0;XO=XO/(float(YV)-5.0)*0.8+0.05;XO-=pow(max(0.0,abs(FS.x-0.5)),5.0)*18.0;WQ.rgb+=XO;}"},Mo={frag:"snippet version;out vec4 WQ;snippet xg;uniform sampler2D pG;uniform float time;in vec2 FS;in vec4 LX;void main(){snippet qZ;vec4 result=texture(pG,FS);if(result.a<0.25)discard;result.rgb=mix(result.rgb*uN,result.rgb*1.1,smoothstep(-0.7,0.7,sin(time*6.0+LX.x)));snippet Ay;WQ=result;}",vert:"snippet version;snippet xg;in vec2 Vx;in vec3 position;in vec3 jQ;in mat4 Dy;in vec4 DJ;in vec4 ZV;uniform mat4 kX;out vec4 LX;out vec2 FS;void main(){LX=ZV;Xr=Dy*vec4(position,1.0);FS=DJ.zw-Vx*DJ.xy;snippet YL;gl_Position=kX*Dy*vec4(position,1.0);}"},Eo={frag:"snippet version;snippet xg;uniform sampler2D jx;in vec3 qf;in float YJ;out vec4 WQ;in vec3 zb;uniform float time;in vec2 qE;void main(){snippet qZ;vec2 Vx=vec2(gl_PointCoord.x,gl_PointCoord.y)+vec2(cos(time*0.5+zb.x*0.2)*sin(time*4.0+zb.z*0.5)*(1.0-gl_PointCoord.y)*0.08,0.0);Vx.x=clamp(Vx.x,0.,1.)*0.25;Vx.y=1.0-clamp(Vx.y,0.,1.)*0.25;Vx+=qE;vec4 result=texture(jx,Vx);if(result.a<max(0.3,0.6-Cp*0.003))discard;float fj=YJ*(0.9+sin(zb.x*0.5)*0.05+cos(zb.z*0.3)*0.05);result.rgb=result.rgb*qf+result.rgb*cG*fj+result.rgb*uN;snippet Ay;WQ=result;}",vert:"snippet version;precision highp sampler2DShadow;snippet xg;snippet Vr;snippet shadowsEnabled;uniform mat4 jJ;uniform mat4 Ux;uniform mat4 zj;uniform sampler2DShadow LG;uniform vec2 resolution;in vec4 position;in float info;out vec3 zb;out vec2 qE;out float YJ;snippet Wl;void main(){float id=1.0;qE=vec2(fract(info*0.25),-floor(info/4.0)*0.25);if(shadowsEnabled==1){vec4 KK=Wl(zj*vec4(position.xyz,1));vec3 qn=(KK.xyz/KK.w)*0.5+0.5;YJ=texture(LG,qn);}else{YJ=1.0;}YJ*=0.65;zb=position.xyz;vec4 Xr=jJ*vec4(position.xyz,1);vec3 fj=vec3(0.0);for(int i=0;i<Fm;++i){vec3 WV=uT[i]-zb.xyz;float Hs=hY[i].w-dot(WV,WV);if(Hs>0.0){Hs/=(hY[i].w);Hs=Hs*Hs;fj+=max(0.2,dot(normalize(WV),vec3(0.0,1.0,0.0)))*hY[i].rgb*Hs;;}}qf=fj*0.65;Cp=length(Xr.xyz);if(Cp>min(100.0,rJ*0.6)){gl_PointSize=0.;gl_Position.w=0.0;}else{gl_PointSize=resolution[1]/(Cp)*position.w;}gl_Position=Ux*Xr;}"},_o={frag:"snippet version;precision highp sampler2DShadow;snippet xg;snippet shadowsEnabled;uniform sampler2DShadow LG;uniform int Hp;in vec3 qf;in vec4 Ku;in vec3 ZC;in vec3 jM;out vec4 WQ;\n#define RECIPROCAL_PI 0.31830988618\n#define LOG2 1.442695\n#define PI 3.14159265359\nvoid main(){snippet qZ;float EY=(float(gl_FrontFacing)*2.0-1.0);float Zg=1.0;if(shadowsEnabled==1&&Hp==1&&jM.x>0.0&&jM.x<1.0&&jM.z>0.0&&jM.z<1.0){Zg=texture(LG,jM+vec3(0.0,0.0,-0.001*EY));}vec3 PN=reflect(Oz,ZC);float Hz=max(0.0,dot(normalize(Ua-Xr.xyz),-PN));Hz=pow(Hz*max(0.0,min(1.0,Ku[3]*2.0))*1.5,5.0);vec3 pG=Ku.rgb;vec3 ambient=uN*PI;ambient*=RECIPROCAL_PI*pG;float Lx=clamp(dot(ZC*EY,Oz),0.0,1.0);vec3 directional=PI*qf+(Lx*(PI*cG)+Hz)*Zg;directional*=RECIPROCAL_PI*pG;vec3 Ij=Ku.rgb*max(Ku[3]*0.5-0.5,-Ku[3]);vec4 result=vec4(directional+ambient+Ij,1.0);snippet Ay;WQ=result;}",vert:"snippet version;snippet Vr;snippet xg;snippet shadowsEnabled;in vec3 position;in vec3 jQ;in vec4 color;in mat4 Dy;uniform mat4 kX;uniform mat4 zj;out vec4 Ku;out vec3 ZC;out vec3 jM;snippet Wl;void main(){ZC=normalize(mat3(Dy)*jQ);Xr=Dy*vec4(position,1.0);Ku=color;snippet YL;snippet JF;if(shadowsEnabled==1){vec4 fQ=Wl(zj*Xr);jM=(fQ.xyz/fQ.w)*0.5+0.5;}gl_Position=kX*Xr;}"},Ro={frag:"snippet version;in vec4 Ku;out vec4 WQ;void main(){WQ=Ku;WQ.a=1.0;}",vert:"snippet version;in vec3 position;in vec4 color;in mat4 Dy;uniform mat4 kX;out vec4 Ku;void main(){Ku=color;gl_Position=kX*Dy*vec4(position,1.0);;}"},Po={frag:"snippet version;precision highp sampler2DShadow;snippet xg;snippet shadowsEnabled;in vec3 qf;uniform sampler2D pG;uniform sampler2DShadow LG;uniform int Hp;in vec3 ZC;in vec3 jM;in vec2 FS;out vec4 WQ;void main(){snippet qZ;vec4 result=texture(pG,FS);if(result.a<0.5)discard;float EY=(float(gl_FrontFacing)*2.0-1.0);float Rn=max(dot(ZC*EY,Oz),0.0);if(shadowsEnabled==1&&Hp==1&&Rn>0.0&&jM.x>0.0&&jM.x<1.0&&jM.z>0.0&&jM.z<1.0){float Gd=texture(LG,jM+vec3(0.0,0.0,-0.001*EY));Rn*=Gd;}result.rgb=result.rgb*qf+result.rgb*cG*Rn+result.rgb*uN;snippet Ay;WQ=result;}",vert:"snippet version;snippet Vr;snippet xg;snippet shadowsEnabled;in vec2 Vx;in vec3 position;in vec3 jQ;in mat4 Dy;uniform mat4 kX;uniform mat4 zj;out vec3 ZC;out vec2 FS;out vec3 jM;snippet Wl;void main(){ZC=normalize(mat3(Dy)*jQ);FS=Vx;Xr=Dy*vec4(position,1.0);snippet YL;snippet JF;if(shadowsEnabled==1){vec4 fQ=Wl(zj*Xr);jM=(fQ.xyz/fQ.w)*0.5+0.5;}gl_Position=kX*Xr;}"},To={vert:"snippet version;snippet Vr;snippet xg;snippet shadowsEnabled;in vec2 Vx;in vec3 position;in vec3 jQ;in float Pw;in mat4 Dy;uniform mat4 kX;uniform mat4 zj;out vec3 ZC;out vec2 FS;out vec3 jM;snippet Wl;void main(){ZC=normalize(mat3(Dy)*jQ);FS=Vx*Pw;Xr=Dy*vec4(position,1.0);snippet YL;snippet JF;if(shadowsEnabled==1){vec4 fQ=Wl(zj*Xr);jM=(fQ.xyz/fQ.w)*0.5+0.5;}gl_Position=kX*Xr;}"},Io={frag:"snippet version;uniform sampler2D aH;in vec4 rF;in vec2 qE;in float Iq;out vec4 WQ;void main(){float Kv=0.5;vec2 Vx=vec2(-0.1+gl_PointCoord.x*1.2,-0.1+gl_PointCoord.y*1.2);if(Iq!=0.0){Vx=vec2(cos(Iq)*(Vx.x-Kv)+sin(Iq)*(Vx.y-Kv)+Kv,cos(Iq)*(Vx.y-Kv)-sin(Iq)*(Vx.x-Kv)+Kv);}Vx.x=clamp(Vx.x,0.,1.)*0.125;Vx.y=1.0-clamp(Vx.y,0.,1.)*0.125;vec4 result=texture(aH,Vx+qE);result*=rF;if(result.a<0.01){discard;}WQ=result;WQ.rgb*=WQ.a;WQ.a*=0.33;}",vert:"snippet version;in vec3 CR;uniform mat4 jJ;uniform mat4 Ux;uniform vec2 resolution;in vec4 info;in vec4 ZR;in vec4 Aj;in vec4 Ss;out vec4 rF;out float Iq;out vec2 qE;void main(){float id=round(mix(info[2],info[3],info[0]));qE=vec2(fract(id*0.125),-floor(id/8.0)*0.125);rF=mix(Aj,Ss,info[0]);Iq=mix(ZR[2],ZR[3],info[0]);vec4 Xr=jJ*vec4(CR,1);gl_PointSize=(resolution[1]*mix(ZR[0],ZR[1],info[0]))/length(Xr.xyz);gl_Position=Ux*Xr;}"},Do={frag:"snippet version;precision highp float;uniform sampler2D vk;uniform vec2 resolution;in vec2 FS;out vec4 WQ;\n#define texTop(t, p) texture(t, p, 0.0)\n#define texOff(t, p, o, r) texture(t, p + (o * r), 0.0)\nvec4 FxaaPixelShader(vec2 CR,sampler2D tex,vec2 fxaaQualityRcpFrame,float fxaaQualitySubpix,float fxaaQualityEdgeThreshold,float fxaaQualityEdgeThresholdMin){vec2 NH;NH.x=CR.x;NH.y=CR.y;vec4 AZ=texTop(tex,NH);\n#define lumaM AZ.y\nfloat Nv=texOff(tex,NH,vec2(0.0,1.0),fxaaQualityRcpFrame.xy).y;float Vl=texOff(tex,NH,vec2(1.0,0.0),fxaaQualityRcpFrame.xy).y;float lQ=texOff(tex,NH,vec2(0.0,-1.0),fxaaQualityRcpFrame.xy).y;float DU=texOff(tex,NH,vec2(-1.0,0.0),fxaaQualityRcpFrame.xy).y;float MX=max(Nv,lumaM);float Bh=min(Nv,lumaM);float Dn=max(Vl,MX);float GJ=min(Vl,Bh);float Jv=max(lQ,DU);float cH=min(lQ,DU);float rangeMax=max(Jv,Dn);float rangeMin=min(cH,GJ);float qv=rangeMax*fxaaQualityEdgeThreshold;float range=rangeMax-rangeMin;float Oy=max(fxaaQualityEdgeThresholdMin,qv);bool earlyExit=range<Oy;if(earlyExit)return AZ;float MW=texOff(tex,NH,vec2(-1.0,-1.0),fxaaQualityRcpFrame.xy).y;float Wp=texOff(tex,NH,vec2(1.0,1.0),fxaaQualityRcpFrame.xy).y;float hR=texOff(tex,NH,vec2(1.0,-1.0),fxaaQualityRcpFrame.xy).y;float gL=texOff(tex,NH,vec2(-1.0,1.0),fxaaQualityRcpFrame.xy).y;float PQ=lQ+Nv;float Tt=DU+Vl;float YM=1.0/range;float Hf=PQ+Tt;float YG=(-2.0*lumaM)+PQ;float tj=(-2.0*lumaM)+Tt;float GF=hR+Wp;float TN=MW+hR;float Kz=(-2.0*Vl)+GF;float QQ=(-2.0*lQ)+TN;float jg=MW+gL;float TK=gL+Wp;float EI=(abs(YG)*2.0)+abs(Kz);float Qg=(abs(tj)*2.0)+abs(QQ);float iD=(-2.0*DU)+jg;float UK=(-2.0*Nv)+TK;float GX=abs(iD)+EI;float WU=abs(UK)+Qg;float Rz=jg+GF;float Gv=fxaaQualityRcpFrame.x;bool horzSpan=GX>=WU;float Vy=Hf*2.0+Rz;if(!horzSpan)lQ=DU;if(!horzSpan)Nv=Vl;if(horzSpan)Gv=fxaaQualityRcpFrame.y;float aC=(Vy*(1.0/12.0))-lumaM;float Yx=lQ-lumaM;float Ks=Nv-lumaM;float DV=lQ+lumaM;float pJ=Nv+lumaM;bool pairN=abs(Yx)>=abs(Ks);float Zp=max(abs(Yx),abs(Ks));if(pairN)Gv=-Gv;float IX=clamp(abs(aC)*YM,0.0,1.0);vec2 zt;zt.x=NH.x;zt.y=NH.y;vec2 Ff;Ff.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;Ff.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)zt.x+=Gv*0.5;if(horzSpan)zt.y+=Gv*0.5;vec2 fG;fG.x=zt.x-Ff.x;fG.y=zt.y-Ff.y;vec2 Yu;Yu.x=zt.x+Ff.x;Yu.y=zt.y+Ff.y;float Lt=((-2.0)*IX)+3.0;float RY=texTop(tex,fG).y;float nX=IX*IX;float Iy=texTop(tex,Yu).y;if(!pairN)DV=pJ;float Ft=Zp*1.0/4.0;float Zw=lumaM-DV*0.5;float Ct=Lt*nX;bool lumaMLTZero=Zw<0.0;RY-=DV*0.5;Iy-=DV*0.5;bool doneN=abs(RY)>=Ft;bool doneP=abs(Iy)>=Ft;if(!doneN)fG.x-=Ff.x*1.5;if(!doneN)fG.y-=Ff.y*1.5;bool doneNP=(!doneN)||(!doneP);if(!doneP)Yu.x+=Ff.x*1.5;if(!doneP)Yu.y+=Ff.y*1.5;if(doneNP){if(!doneN)RY=texTop(tex,fG.xy).y;if(!doneP)Iy=texTop(tex,Yu.xy).y;if(!doneN)RY=RY-DV*0.5;if(!doneP)Iy=Iy-DV*0.5;doneN=abs(RY)>=Ft;doneP=abs(Iy)>=Ft;if(!doneN)fG.x-=Ff.x*2.0;if(!doneN)fG.y-=Ff.y*2.0;doneNP=(!doneN)||(!doneP);if(!doneP)Yu.x+=Ff.x*2.0;if(!doneP)Yu.y+=Ff.y*2.0;if(doneNP){if(!doneN)RY=texTop(tex,fG.xy).y;if(!doneP)Iy=texTop(tex,Yu.xy).y;if(!doneN)RY=RY-DV*0.5;if(!doneP)Iy=Iy-DV*0.5;doneN=abs(RY)>=Ft;doneP=abs(Iy)>=Ft;if(!doneN)fG.x-=Ff.x*4.0;if(!doneN)fG.y-=Ff.y*4.0;doneNP=(!doneN)||(!doneP);if(!doneP)Yu.x+=Ff.x*4.0;if(!doneP)Yu.y+=Ff.y*4.0;if(doneNP){if(!doneN)RY=texTop(tex,fG.xy).y;if(!doneP)Iy=texTop(tex,Yu.xy).y;if(!doneN)RY=RY-DV*0.5;if(!doneP)Iy=Iy-DV*0.5;doneN=abs(RY)>=Ft;doneP=abs(Iy)>=Ft;if(!doneN)fG.x-=Ff.x*12.0;if(!doneN)fG.y-=Ff.y*12.0;doneNP=(!doneN)||(!doneP);if(!doneP)Yu.x+=Ff.x*12.0;if(!doneP)Yu.y+=Ff.y*12.0;}}}float kU=NH.x-fG.x;float Lr=Yu.x-NH.x;if(!horzSpan)kU=NH.y-fG.y;if(!horzSpan)Lr=Yu.y-NH.y;bool goodSpanN=(RY<0.0)!=lumaMLTZero;float Ew=(Lr+kU);bool goodSpanP=(Iy<0.0)!=lumaMLTZero;float Mx=1.0/Ew;bool directionN=kU<Lr;float Zu=min(kU,Lr);bool goodSpan=directionN ? goodSpanN : goodSpanP;float Pq=Ct*Ct;float UJ=(Zu*(-Mx))+0.5;float JP=Pq*fxaaQualitySubpix;float Xj=goodSpan ? UJ : 0.0;float Dt=max(Xj,JP);if(!horzSpan)NH.x+=Dt*Gv;if(horzSpan)NH.y+=Dt*Gv;return vec4(texTop(tex,NH).xyz,lumaM);}void main(){vec4 Jm=FxaaPixelShader(FS,vk,1.0/resolution,0.5,0.2,0.0833);WQ=Jm;}"},Ao={frag:"snippet version;precision highp float;uniform sampler2D QV;uniform sampler2D vk;uniform sampler2D Cq;uniform vec3 uN;uniform vec2 resolution;uniform float vH;uniform float rJ;in vec2 FS;out vec4 WQ;const int Hw=16;const float cX=float(Hw);const vec3 JK[Hw]=vec3[](vec3(0.5381,0.1856,-0.4319),vec3(0.1379,0.2486,0.4430),vec3(0.3371,0.5679,-0.0057),vec3(-0.6999,-0.0451,-0.0019),vec3(0.0689,-0.1598,-0.8547),vec3(0.0560,0.0069,-0.1843),vec3(-0.0146,0.1402,0.0762),vec3(0.0100,-0.1924,-0.0344),vec3(-0.3577,-0.5301,-0.4358),vec3(-0.3169,0.1063,0.0158),vec3(0.0103,-0.5869,0.0046),vec3(-0.0897,-0.4940,0.3287),vec3(0.7119,-0.0154,-0.0918),vec3(-0.0533,0.0596,-0.5411),vec3(0.0352,-0.0631,0.5460),vec3(-0.4776,0.2847,-0.0271));float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}const float Pp=0.03;const float Qn=0.0000005;const float radius=0.004;const vec2 hA=vec2(0.0,0.001);const vec2 vQ=vec2(0.001,0.0);vec3 normal_from_depth(float Ic,vec2 texcoords){float Ip=texture(Cq,texcoords+hA).r;float rZ=texture(Cq,texcoords+vQ).r;vec3 p1=vec3(hA,Ip-Ic);vec3 p2=vec3(vQ,rZ-Ic);vec3 jQ=cross(p1,p2);jQ.z=-jQ.z;return normalize(jQ);}void main(){float Ic=texture(Cq,FS).r;vec3 CR=vec3(FS.xy,Ic);vec3 jQ=normal_from_depth(Ic,FS);float Oq=rJ;float Qj=(2.0*0.1*Oq)/(Oq+0.1-Ic*(Oq-0.1))/Oq;float IW=radius/Qj;float vG=0.0;vec3 Rv=normalize(vec3(rand(FS.xy),rand(FS.yx),rand(FS.xy*1.5)));for(int i=0;i<Hw;i++){vec3 YD=IW*reflect(JK[i],Rv);vec3 UE=CR+sign(dot(YD,jQ))*YD;float WH=texture(Cq,clamp(UE.xy,0.0,1.0)).r;float Ul=Ic-WH;vG+=step(Qn,Ul)*(1.0-smoothstep(Qn,Pp,Ul));}vG*=(1.0-smoothstep(0.6,1.0,Qj));vG*=(1.0/cX);vG=pow(vG,1.7);float ZI=clamp(0.1+1.0-vG,0.0,1.0);WQ=vec4(mix(uN*0.2,vec3(1.0),ZI),1.0);}"},Fo={frag:"snippet version;precision highp float;uniform sampler2D QV;uniform sampler2D vk;uniform vec2 resolution;in vec2 FS;uniform int step;float weight[5]=float[5](0.227027,0.1945946,0.1216216,0.054054,0.016216);out vec4 WQ;void main(){vec2 Ws=2.0/resolution;vec3 result=vec3(1.0);if(step==0){result=texture(QV,FS).rgb*weight[0];for(int i=1;i<5;++i){result+=texture(QV,FS+vec2(Ws.x*float(i),0.0)).rgb*weight[i];result+=texture(QV,FS-vec2(Ws.x*float(i),0.0)).rgb*weight[i];}}else{result=texture(QV,FS).rgb*weight[0];for(int i=1;i<5;++i){result+=texture(QV,FS+vec2(0.0,Ws.y*float(i))).rgb*weight[i];result+=texture(QV,FS-vec2(0.0,Ws.y*float(i))).rgb*weight[i];}}if(step==1){result=result*texture(vk,FS).rgb;}WQ=vec4(result,1.0);}"},zo={frag:"snippet version;uniform vec4 Aj;uniform vec4 Ss;uniform vec3 offset;in vec2 FS;out vec4 WQ;void main(){float Tf=min(1.,max(0.,FS.x+offset.x));WQ=mix(Aj,Ss,abs(sin(Tf*3.141*offset.z))*offset.y);WQ.a*=sin(FS.y*3.14);if(WQ.a<0.01){discard;}WQ.rgb*=WQ.a;WQ.a*=0.33;}",vert:"snippet version;in vec3 position;in vec2 Vx;out vec2 FS;uniform mat4 kX;void main(){FS=Vx;gl_Position=kX*vec4(position,1.0);}"},Bo={frag:"snippet version;void main(){}",vert:"snippet version;in vec3 position;in vec2 Vx;in mat4 Dy;uniform mat4 kX;out vec2 FS;snippet Wl;void main(){FS=Vx;gl_Position=Wl(kX*Dy*vec4(position,1.0));}"},Uo={frag:"snippet version;in vec2 FS;uniform sampler2D pG;void main(){if(texture(pG,FS).a<0.5)discard;}"},Oo={frag:"snippet version;uniform sampler2D Tb[8];in vec4 Zn;in vec4 QC;in vec2 FS;uniform int KD;float height;float count;snippet zn;void computeColor(vec4 color,float value,vec4 info){float jz=(color.r+color.g+color.b)/3.0;height+=pow(smoothstep(info[1],info[2],jz)*value,2.5);count+=value;}void main(){height=0.0;if(KD==1){if(Zn[0]>0.0)computeColor(texture(Tb[0],FS*tinf0[0]),Zn[0],tinf0);if(Zn[1]>0.0)computeColor(texture(Tb[1],FS*tinf1[0]),Zn[1],tinf1);if(Zn[2]>0.0)computeColor(texture(Tb[2],FS*tinf2[0]),Zn[2],tinf2);if(Zn[3]>0.0)computeColor(texture(Tb[3],FS*tinf3[0]),Zn[3],tinf3);if(QC[0]>0.0)computeColor(texture(Tb[4],FS*tinf4[0]),QC[0],tinf4);if(QC[1]>0.0)computeColor(texture(Tb[5],FS*tinf5[0]),QC[1],tinf5);if(QC[2]>0.0)computeColor(texture(Tb[6],FS*tinf6[0]),QC[2],tinf6);if(QC[3]>0.0)computeColor(texture(Tb[7],FS*tinf7[0]),QC[3],tinf7);height/=count;}gl_FragDepth=gl_FragCoord.z-height*0.003;}",vert:"snippet version;in vec3 position;in vec2 Vx;in vec4 Ds;in vec4 zk;uniform mat4 Tn;uniform mat4 Ux;out vec2 FS;out vec4 Zn;out vec4 QC;out vec3 PV;snippet Wl;void main(){Zn=Ds;QC=zk;FS=Vx*16.0;gl_Position=Wl(Ux*Tn*vec4(position,1.0));}"},jo={frag:"snippet version;uniform vec4 color;out vec4 WQ;void main(){WQ=color;}",vert:"snippet version;in vec3 position;in vec2 Vx;in vec3 jQ;out vec2 FS;out vec3 ZC;out vec3 cQ;uniform mat4 Tn;uniform mat4 Ux;void main(){FS=Vx;ZC=jQ;cQ=position;gl_Position=Ux*Tn*vec4(position,1.0);}"},Lo={frag:"snippet version;precision highp sampler2DShadow;snippet xg;snippet shadowsEnabled;uniform sampler2DShadow LG;uniform int Hp;uniform vec4 color;in vec3 ZC;in vec3 jM;out vec4 WQ;void main(){snippet qZ;vec4 result=color;float EY=(float(gl_FrontFacing)*2.0-1.0);float Rn=max(dot(ZC*EY,Oz),0.0);if(shadowsEnabled==1&&Hp==1&&Rn>0.0&&jM.x>0.0&&jM.x<1.0&&jM.z>0.0&&jM.z<1.0){float Gd=texture(LG,jM+vec3(0.0,0.0,-0.001*EY));Rn*=Gd;}result.rgb=result.rgb*cG*Rn+result.rgb*uN;snippet Ay;WQ=result;}",vert:"snippet version;in vec3 position;in vec3 jQ;snippet xg;snippet shadowsEnabled;out vec3 ZC;out vec2 FS;out vec3 jM;snippet Wl;uniform mat4 Dq;uniform mat4 kX;uniform mat4 zj;void main(){ZC=jQ;vec4 Xr=Dq*vec4(position,1.0);snippet YL;if(shadowsEnabled==1){vec4 fQ=Wl(zj*Xr);jM=(fQ.xyz/fQ.w)*0.5+0.5;}gl_Position=kX*Xr;}"},No={frag:"snippet version;uniform sampler2D pG;in vec2 FS;in vec3 ZC;out vec4 WQ;void main(){vec4 Jm=texture(pG,FS);vec3 jQ=normalize(ZC);vec3 fj=normalize(vec3(1.0,1.0,0.3));float iN=dot(jQ,fj)*0.5;WQ=Jm;if(WQ.a<0.2)discard;WQ.rgb*=vec3(0.5)+iN;}",vert:"snippet version;in vec2 Vx;in vec3 position;in vec3 jQ;uniform mat4 Tn;uniform mat4 Ux;out vec2 FS;out vec3 ZC;void main(){FS=Vx;ZC=jQ;gl_Position=Ux*Tn*vec4(position,1.0);}"},qo={frag:"snippet version;snippet xg;uniform float Nt;uniform sampler2D SV;in vec2 FS;in vec3 cQ;out vec4 WQ;void main(){gl_FragDepth=0.999999;vec3 result=vec3(0.0);float Ug=dot(Oz,normalize(cQ));float Pd=pow((1.0+Ug)*0.5,3.0);vec3 hZ=uG;vec3 Fj=DY;float c=pow(max(0.0,min(1.0,(1.0-(0.5+cQ.y))*2.0)),3.0);float Zz=0.0;if(c<0.85){Zz=smoothstep(0.85-Pd*0.8,0.85,c);}else{Zz=1.0-smoothstep(0.85,1.0,c);}c=pow(c,(1.0-Pd)*3.0);Fj+=cG*Zz*0.4*Pd;hZ=mix(uG*0.8,hZ,Pd);result=mix(hZ,Fj,c);float WZ=1.0-sin(Nt*6.28)+0.02;float ja=max(0.0,min(1.0,cQ.y*5.0))*0.4;result+=texture(SV,vec2(Oz.x*0.5-FS.x,FS.y)).rgb*WZ*ja;WQ=vec4(result,1.0);}",vert:"snippet version;in vec3 position;in vec2 Vx;uniform mat4 Tn;uniform mat4 Ux;out vec2 FS;out vec3 cQ;void main(){FS=Vx;cQ=position;gl_Position=Ux*Tn*vec4(cQ,1.0);}"},Ho={frag:"snippet version;precision highp float;in vec2 FS;uniform float seed;float stars(in vec2 Vx,float scale){Vx*=scale;vec2 s=floor(Vx),f=fract(Vx),p;float k=3.,d;p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);return smoothstep(0.,k,sin(f.x+f.y)*0.003);}snippet Qe;snippet vY;out vec4 WQ;void main(){vec2 CR=vec2(FS.x+seed,FS.y);float n=stars(FS,10.0);n+=stars(FS,20.0)*0.5;n+=stars(FS,30.0)*0.2;n*=noise(FS*20.0);vec2 Jo=vec2(FS.x*3.0+5.0,FS.y*5.0);float Aq=noise(Jo)*0.9;Aq+=noise(Jo*1.5)*0.5;Aq+=noise(Jo*2.9)*0.25;Aq*=noise(Jo*0.3)*0.1;Aq*=1.0-distance(vec2(0.5),FS)*2.0;WQ.rgb+=n*4.0+Aq*2.5;}"},Wo={frag:"snippet version;snippet xg;uniform float Nt;in vec2 FS;out vec4 WQ;void main(){gl_FragDepth=0.999998;float height=max(0.0,min(1.0,abs(sin(Nt*6.282))+FS.y*0.1-0.15));float Dm=min(1.0,pow((1.0-height*height),100.0));float circle=0.5-length(vec2(0.5,0.5)-FS);float alpha=smoothstep(0.0,1.0,circle)*2.0;alpha+=smoothstep(0.4,0.45,circle);WQ.rgba=vec4(mix(vec3(1.0),DY,Dm),alpha);}"},Qo={frag:"snippet version;precision highp sampler2DShadow;in vec3 ZC;in vec3 Hc;in vec3 cQ;in vec3 PV;uniform vec4 pP;snippet xg;snippet shadowsEnabled;snippet zn;in vec3 qf;in vec2 FS;uniform sampler2D Tb[8];in vec4 Zn;in vec4 QC;vec4 result;float detail;uniform sampler2DShadow LG;in vec3 jM;void computeColor(vec4 color,float value,vec4 info){float jz=max(max(color.x,color.y),color.z);color.a=pow(smoothstep(info[1],info[2],jz)*value,2.5);detail+=info[3]*color.a;color.rgb=color.rgb*min(1.0,value*0.5+0.7)*color.a;result+=color;}out vec4 WQ;void main(){snippet qZ;if(Zn[0]>0.0)computeColor(texture(Tb[0],FS*tinf0[0]),Zn[0],tinf0);if(Zn[1]>0.0)computeColor(texture(Tb[1],FS*tinf1[0]),Zn[1],tinf1);if(Zn[2]>0.0)computeColor(texture(Tb[2],FS*tinf2[0]),Zn[2],tinf2);if(Zn[3]>0.0)computeColor(texture(Tb[3],FS*tinf3[0]),Zn[3],tinf3);if(QC[0]>0.0)computeColor(texture(Tb[4],FS*tinf4[0]),QC[0],tinf4);if(QC[1]>0.0)computeColor(texture(Tb[5],FS*tinf5[0]),QC[1],tinf5);if(QC[2]>0.0)computeColor(texture(Tb[6],FS*tinf6[0]),QC[2],tinf6);if(QC[3]>0.0)computeColor(texture(Tb[7],FS*tinf7[0]),QC[3],tinf7);result.rgb/=result.a*0.85;detail/=result.a;result.a=1.0;float Rn=dot(ZC,Oz);float Pt=0.0;if(Rn>0.0){if(shadowsEnabled==1&&jM.x>0.0&&jM.x<1.0&&jM.y>0.0&&jM.y<1.0){float Gd=texture(LG,jM);Rn=min(clamp(Rn,0.0,1.0),Gd);}vec3 PN=reflect(-Oz,ZC);float jw=max(dot(PN,Hc),0.0);Pt=pow(jw,8.5)*2.0;}float Ya=length(result.rgb)*3.0*detail;float Dj=pow((Ya-0.5),3.0)*0.5+0.2;float qt=pow((Ya-0.5)*Rn,3.0)*1.2;if(Ya>1.2){qt*=1.3;Dj*=1.3;}Pt*=qt;vec3 TD=result.rgb*cG*Rn*0.65;vec3 ZD=result.rgb*uN;result.rgb=ZD+TD+vec3(Pt)*0.15+qf*Dj;float JC=distance(cQ.xz,PV.xz);result.rgb=mix(result.rgb,pP.rgb,pP.a*((JC<PV.y ? JC/PV.y : 0.0)*0.5+max(0.,(0.11-abs(PV.y-JC))/0.1)));snippet Ay;WQ=result;}",vert:"snippet version;snippet xg;snippet Vr;snippet Wl;snippet shadowsEnabled;in vec3 position;in vec3 jQ;in vec2 Vx;in vec4 Ds;in vec4 zk;uniform mat4 Dq;uniform mat4 kX;uniform mat4 zj;uniform vec3 oZ;out vec3 QW;out vec3 ZC;out vec3 cQ;out vec2 FS;out vec4 fQ;out vec3 jM;out vec4 Zn;out vec4 QC;out vec3 Hc;out vec3 PV;void main(){PV.xz=oZ.xz-(Dq*vec4(0.0,0.0,0.0,1.0)).xz;PV.y=oZ.y;cQ=position;ZC=jQ;Zn=Ds;QC=zk;FS=Vx*16.0;Xr=Dq*vec4(position,1.0);snippet JF;snippet YL;Hc=-normalize(Xr.xyz-Ua);if(shadowsEnabled==1){vec4 KK=Wl(zj*(Xr));jM=(KK.xyz/KK.w)*0.5+0.5;}gl_Position=kX*Xr;}"},Vo={frag:"snippet version;in vec3 cQ;in vec3 PV;out vec4 WQ;void main(){float JC=distance(cQ.xz,PV.xz);if(JC>PV.y){WQ.rgba=vec4(0.0,0.0,0.0,1.0);}else{WQ.rgba=mix(vec4(0.0,1.0,0.0,1.0),vec4(0.0,0.0,0.0,1.0),JC/PV.y);}}",vert:"snippet version;in vec3 position;in vec3 jQ;uniform mat4 Dq;uniform mat4 Tn;uniform mat4 Ux;uniform vec3 oZ;out vec3 cQ;out vec3 PV;void main(){PV.xz=oZ.xz-(Dq*vec4(0.0,0.0,0.0,1.0)).xz;PV.y=oZ.y;cQ=position;gl_Position=Ux*Tn*vec4(position+jQ*0.001,1.0);}"},Go={frag:"snippet version;snippet xg;snippet shadowsEnabled;uniform float time;uniform mat4 TW;uniform float visibility;uniform float speed;uniform vec3 Ck;uniform vec3 aX;uniform vec3 Kq;uniform sampler2D GA;uniform sampler2D bX;uniform sampler2D TJ;in vec2 FS;in vec3 ZC;out vec4 WQ;snippet Wl;float getWaterDepth(vec2 CR,float z){return texture(GA,CR).r-z;}void main(){snippet qZ;ivec2 hJ=textureSize(GA,0);float Ud=1.0/float(hJ.x);vec4 xh=Wl(TW*Xr);vec3 Dd=(xh.xyz/xh.w)*0.5+0.5;float Ic=1.0;if(shadowsEnabled==1){if(Dd.x>0.0&&Dd.x<1.0&&Dd.y>0.0&&Dd.y<1.0){float uZ=Dd.z;float Nf=Ud*0.5;float Uo=getWaterDepth(Dd.xy+vec2(-Nf,-Nf),Dd.z);float WY=getWaterDepth(Dd.xy+vec2(Nf,-Nf),Dd.z);float XC=getWaterDepth(Dd.xy+vec2(-Nf,Nf),Dd.z);float Jp=getWaterDepth(Dd.xy+vec2(Nf,Nf),Dd.z);float zJ=mod(Dd.x-Nf,Ud)/Ud;float Mt=mod(Dd.y-Nf,Ud)/Ud;Ic=mix(mix(Uo,WY,zJ),mix(XC,Jp,zJ),Mt);}else{Ic=1.0;}Ic*=50.0;}float speed=speed*0.01;float MT=0.0;vec3 jQ=normalize(ZC);vec2 dir=normalize(ZC.xz);float Rg=1.0;for(int i=0;i<2;++i){float Fw=1.0/3.0*float(i);float t=mod(time*0.2+Fw,1.0)*3.141;float xb=speed+0.2;vec2 shift=vec2(xb*dir.y*t+Fw,xb*dir.x*t+Fw);float curve=abs(sin(t));MT+=texture(bX,FS.yx*0.5+shift).r*curve;Rg+=((sin((FS.x+shift.y)*10.0)+cos((FS.y+shift.x)*10.0))*curve*(0.2+xb*0.6));}float zm=visibility/100.0;vec4 Pm=texture(TJ,FS.yx+time*speed*2.0+MT*0.1);vec4 eQ=vec4(Ck,0.0);vec4 xu=vec4(Ck,0.9);vec4 HF=vec4(mix(Ck,aX,0.9)*0.8,0.5)+speed*0.1;vec4 cg=vec4(aX,0.4)+Pm*0.05;vec4 Ie=vec4(mix(aX,Kq,0.5),0.8-zm*0.4)+Pm*0.08;vec4 qW=vec4(Kq,1.4-zm*0.8)+Pm*0.12;float Xg=0.03+0.01*MT;float HW=Xg+0.02+speed*0.05+0.03*MT+Rg*0.02;float Wm=HW+(0.05+speed*0.5*MT+Rg*0.05)*zm;float KN=Wm+(0.2+speed*0.2-MT*0.1)*zm;float Lc=KN+(0.2)*zm;vec4 result=vec4(0.0);if(Ic<Xg){result=mix(eQ,xu,smoothstep(0.0,Xg,Ic));}else if(Ic<HW){result=mix(xu,HF,smoothstep(Xg,HW,Ic));}else if(Ic<Wm){result=mix(HF,cg,smoothstep(HW+(Wm-HW)*0.3,Wm,Ic));}else if(Ic<KN){result=mix(cg,Ie,smoothstep(Wm+(KN-Wm)*0.4,KN,Ic));}else{result=mix(Ie,qW,smoothstep(Lc,1.0,Ic));}result.rgb+=(abs(jQ.x)+abs(jQ.z))*0.5-0.2;float Rn=max(dot(Oz,jQ),0.0);float Hz=0.0;vec3 PN=reflect(-Oz,jQ);vec3 VT=-normalize(Xr.xyz-Ua);float jw=max(dot(PN,VT),0.0);Hz=min(1.0,max(0.0,pow(jw,10.0)))*0.6;result.rgb=result.rgb*cG*Rn+result.rgb*uN+Hz*cG;snippet Ay;WQ=result;}",vert:"snippet version;snippet xg;uniform mat4 Dq;uniform mat4 kX;uniform float time;uniform int PF;uniform float Mj;uniform float xV;uniform float speed;in vec3 position;in vec3 jQ;in vec2 Vx;out vec3 ZC;out vec2 FS;out vec3 Oe;void main(){vec4 CR=vec4(position,1.0);if(PF==0){if(CR.x<=-0.5)CR.x-=10.0;if(CR.z<=-0.5)CR.z-=10.0;if(CR.x>=0.5)CR.x+=10.0;if(CR.z>=0.5)CR.z+=10.0;}Xr=Dq*CR;Xr.y+=cos(Xr.z*xV*0.005)*sin(Xr.x*0.1+Xr.z*xV*0.008+time*speed*0.1)*Mj*0.03;snippet YL;FS=Xr.xz/2.0;ZC=vec3(0.01,0.8,0.002)*6.5;gl_Position=kX*Xr;}"};var Yo=Object.freeze({__proto__:null,clouds:So,cloudsTex:Co,drop:Mo,foliage:Eo,multimeshFlat:_o,multimeshSimple:Ro,multimeshTextured:Po,multimeshTileable:To,particles:Io,post:Do,ssao:Ao,ssaoBlur:Fo,ribbon:zo,shadowInstanced:Bo,shadowInstancedAlpha:Uo,shadowTerrain:Oo,simple:jo,simpleShaded:Lo,simpleTextured:No,sky:qo,skyStarTex:Ho,sun:Wo,terrain:Qo,terrainDebug:Vo,water:Go});hma.graphics.shaders=Yo;const Xo={version:"#version 300 es\n    precision highp float;\n    precision highp int;\n  ",xg:"\n    uniform vec3 uN;\n    uniform vec3 Oz;\n    uniform vec3 cG;\n    uniform vec3 uG;\n    uniform vec3 DY;\n    uniform float vH;\n    uniform float rJ;\n    uniform vec3 Ua;\n    out float Cp; // V\n    out vec4 Xr; // V\n    in float Cp; // F\n    in vec4 Xr; // F\n  ",shadowsEnabled:`\n    const int shadowsEnabled = ${gi.shadows?1:0};\n  `,Vr:"\n    uniform vec4 hY[16];\n    uniform vec3 uT[16];\n    uniform int Fm;\n    out vec3 qf;\n  ",JF:"\n    vec3 fj = vec3(0.0);\n    for(int i = 0; i < Fm; ++i){\n      vec3 WV = uT[i] - Xr.xyz;\n      float Hs = hY[i].w-dot(WV,WV);\n      if(Hs > 0.0){\n        Hs /= (hY[i].w);\n        Hs = Hs*Hs;\n        fj += max(0.0,dot(normalize(WV), ZC)) * hY[i].rgb*Hs;\n      } \n    }\n    qf = fj;\n  ",YL:"\n    Cp = length(Ua - Xr.xyz);\n  ",qZ:"\n    float fogValue = Cp;\n    if(fogValue > rJ){\n      float fogFade = rJ*0.1;\n      float fogPatt = 0.5 - sin(Xr.x*2.0)*0.25+sin(Xr.y*2.0)*0.25;\n      if(fogValue + fogPatt*fogFade  >= rJ+fogFade) discard;\n    } ",Ay:"\n    result.rgb = mix(result.rgb, DY, smoothstep(vH, rJ, fogValue));",Wl:"\n    vec4 Wl(vec4 CR){\n      CR.x = 2.0 / (1.0+exp(-10.0*CR.x)) - 1.0;\n      CR.y = 2.0 / (1.0+exp(-10.0*CR.y)) - 1.0;\n      return CR;\n    }",Qe:"\n    vec2 hash( vec2 p ) {\n    p = vec2(dot(p,vec2(127.1,311.7)), dot(p,vec2(269.5,183.3)));\n    return -1.0 + 2.0*fract(sin(p)*43758.5453123);\n  }",vY:"float noise( in vec2 p ) {\n    const float K1 = 0.366025404; // (sqrt(3)-1)/2;\n    const float K2 = 0.211324865; // (3-sqrt(3))/6;\n    vec2 i = floor(p + (p.x+p.y)*K1); \n    vec2 a = p - i + (i.x+i.y)*K2;\n    vec2 o = (a.x>a.y) ? vec2(1.0,0.0) : vec2(0.0,1.0);\n    vec2 b = a - o + K2;\n    vec2 c = a - 1.0 + 2.0*K2;\n    vec3 h = max(0.5-vec3(dot(a,a), dot(b,b), dot(c,c) ), 0.0 );\n    vec3 n =h*h*h*vec3( dot(a,hash(i+0.0)), dot(b,hash(i+o)), dot(c,hash(i+1.0)));\n    float d = dot(n, vec3(70.0));\n    return smoothstep(-1.0,1.0,d);\n  }",zn:Array(8).fill(0).map((t,e)=>`uniform vec4 tinf${e};`).join("")},Zo=(t,e)=>t.replace(/snippet (\w+);/g,(t,s)=>{let i=Xo[s].split("\n");return(i=i.filter(t=>!(0==e&&t.indexOf("// F")>-1||1==e&&t.indexOf("// V")>-1))).join("\n")});let Jo=0,Ko=0;const tl=[0,0,0];let el=!1;const sl={},il={},nl=[0,0,0],al={},rl=t=>{el=t},ol=t=>{bi(nl,t)};var ll=Object.freeze({__proto__:null,get needUpdate(){return el},targets:sl,targetSets:il,size:1024,cameras:al,init:()=>{al.LG=new fn(Bn),al.water=new fn(Bn),Nn.addChild(al.LG),Nn.addChild(al.water),sl.shadowStatic=new En(Bn,{width:1024,height:1024,color:0,depthTexture:!0,depthCompareMode:Bn.COMPARE_REF_TO_TEXTURE}),sl.LG=new En(Bn,{width:1024,height:1024,color:0,depthTexture:!0,depthCompareMode:Bn.COMPARE_REF_TO_TEXTURE}),sl.water=new En(Bn,{width:1024,height:1024,color:0,depthTexture:!0});for(const t in sl)il[t]=new Set([sl[t]])},tick:({dt:t,viewRange:e,world:s,camera:i})=>{const n=i.Oq;if(Jo!=n){Jo=n,el=!0;for(const t in al)al[t].orthographic({near:.1,Oq:"LG"==t?2*n:200,left:-n,right:n,bottom:-n,top:n}),al[t].updateMatrixWorld()}(el||s.time-Ko>10||Mi(i.worldPosition,tl)>15)&&(bi(al.LG.position,nl),Si(al.LG.position,al.LG.position,n),al.LG.lookAt(Wn,Hn),ki(al.LG.position,al.LG.position,i.worldPosition),xi(al.water.position,1e-4,100,0),al.water.lookAt(Wn,Hn),ki(al.water.position,al.water.position,i.worldPosition),al.water.position[1]=200,bi(tl,i.worldPosition),el=!0,Ko=s.time)},setNeedUpdate:rl,setDirectional:ol});let cl={};const hl=(t,e)=>{t.value!==t.cache&&(t.state++,t.cache=t.value)},dl=(t,e)=>{t.value&&(t.value.length?t.value:[t.value]).forEach(s=>{s.id!==e.state.textureUnits[s.textureUnit]&&t.state++})},ul=(t,e)=>{t.cache&&function(t,e){return t[0]===e[0]&&t[1]===e[1]}(t.value,t.cache)||(t.state++,t.cache?_n(t.cache,t.value):t.cache=t.value.slice())},ml=(t,e)=>{t.cache&&function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}(t.value,t.cache)||(t.state++,t.cache?bi(t.cache,t.value):t.cache=t.value.slice())},pl=(t,e)=>{t.cache&&function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}(t.value,t.cache)||(t.state++,t.cache?Ki(t.cache,t.value):t.cache=t.value.slice())},fl=(t,e)=>{t.cache&&function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}(t.value,t.cache)||(t.state++,t.cache?Wi(t.cache,t.value):t.cache=t.value.slice())},gl={},vl=t=>{cl.kX.state++,gl.shadowTerrain.frontFace=t.CW,gl.shadowTerrain.uniforms.KD.value=0},yl=t=>{cl.kX.state++,gl.shadowTerrain.frontFace=t.CCW,gl.shadowTerrain.uniforms.KD.value=1},bl=t=>{cl.zj.state++,cl.kX.state++},xl=t=>{cl.TW.state++};var wl=Object.freeze({__proto__:null,shaders:gl,tick:({dt:t,world:e,renderer:s})=>{(({dt:t,world:e,renderer:s})=>{cl.time.value=e.smoothtime%600;for(const t in cl){const e=cl[t];null!==e.c&&e.c(e,s)}})({dt:t,world:e,renderer:s})},init:()=>{if((()=>{cl={resolution:{c:ul,value:[0,0]},time:{c:hl,value:0},Nt:{c:hl,value:0},uN:{c:ml,value:[0,0,0]},uG:{c:ml,value:[0,0,0]},Oz:{c:ml,value:[0,0,0]},cG:{c:ml,value:[0,0,0]},vH:{c:hl,value:0},rJ:{c:hl,value:0},DY:{c:ml,value:[0,0,0]},Ua:{c:ml,value:Un.worldPosition},zj:{c:fl,value:al.LG.kX},LG:{c:dl,value:sl.LG.depthTexture},TW:{c:fl,value:al.water.kX},GA:{c:dl,value:sl.water.depthTexture},bX:{c:dl},TJ:{c:dl},hY:{c:null,value:[0,0,0,0]},uT:{c:null,value:[0,0,0]},Fm:{c:hl,value:0},aH:{c:dl},jx:{c:dl},Tb:{c:dl,value:Sr.terrain},Ux:{c:fl,value:Un.Ux},kX:{c:fl,value:Un.kX},SV:{c:dl},jh:{c:dl},oZ:{c:ml,value:[0,0,0]},pP:{c:pl,value:[0,1,0,1]},movieMode:{c:hl,value:0}};for(let t=0;t<8;++t)cl["tinf"+t]={c:null,value:[0,0,0,0]};for(const t in cl)cl[t].state=1})(),(t=>{for(const e in t)t[e].vert&&(t[e].vert=Zo(t[e].vert,0)),t[e].frag&&(t[e].frag=Zo(t[e].frag,1))})(Yo),gi.ssao){jn.addPass({fragment:Ao.frag,globalUniforms:cl});for(let t=0;t<2;++t)jn.addPass({fragment:Fo.frag,uniforms:{step:{value:t}},globalUniforms:cl,postDraw:0==t?void 0:()=>{Bn.bindFramebuffer(Bn.READ_FRAMEBUFFER,jn.ping.buffer),Bn.bindFramebuffer(Bn.DRAW_FRAMEBUFFER,jn.original.buffer),Bn.blitFramebuffer(0,0,jn.pong.width,jn.pong.height,0,0,jn.pong.width,jn.pong.height,Bn.COLOR_BUFFER_BIT,Bn.NEAREST)}})}jn.addPass({fragment:Do.frag,globalUniforms:cl}),gl.foliage=new Li(Bn,{vertex:Eo.vert,fragment:Eo.frag,cullFace:null,active:!1,globalUniforms:cl}),gl.multimeshFlat=new Li(Bn,{vertex:_o.vert,fragment:_o.frag,instanced:{color:{size:4}},globalUniforms:cl}),gl.multimeshTextured=new Li(Bn,{vertex:Po.vert,fragment:Po.frag,globalUniforms:cl}),gl.multimeshTileable=new Li(Bn,{vertex:To.vert,fragment:Po.frag,instanced:{Pw:{size:1}},globalUniforms:cl}),gl.multimeshSimple=new Li(Bn,{vertex:Ro.vert,fragment:Ro.frag,instanced:{color:{size:4}},globalUniforms:cl}),gl.drop=new Li(Bn,{vertex:Mo.vert,fragment:Mo.frag,instanced:{DJ:{size:4},ZV:{size:4}},globalUniforms:cl}),gl.terrain=new Li(Bn,{vertex:Qo.vert,fragment:Qo.frag,globalUniforms:cl,autoUniforms:["pG"]}),gl.sun=new Li(Bn,{vertex:jo.vert,fragment:Wo.frag,transparent:!0,globalUniforms:cl}),gl.clouds=new Li(Bn,{vertex:jo.vert,fragment:So.frag,transparent:!0,frontFace:Bn.CW,globalUniforms:cl}),gl.water=new Li(Bn,{vertex:Go.vert,fragment:Go.frag,transparent:!0,active:!1,globalUniforms:cl}),gl.sky=new Li(Bn,{vertex:qo.vert,fragment:qo.frag,cullFace:null,depthTest:!0,globalUniforms:cl}),gl.shadowInstancedAlpha=new Li(Bn,{vertex:Bo.vert,fragment:Uo.frag,autoUniforms:["pG"],globalUniforms:cl}),gl.shadowInstanced=new Li(Bn,{vertex:Bo.vert,fragment:Bo.frag,globalUniforms:cl}),gl.shadowTerrain=new Li(Bn,{vertex:Oo.vert,fragment:Oo.frag,globalUniforms:cl,uniforms:{KD:{value:1}}}),gl.particles=new Li(Bn,{vertex:Io.vert,fragment:Io.frag,active:!1,transparent:!0,depthWrite:!1,globalUniforms:cl}),gl.ribbon=new Li(Bn,{vertex:zo.vert,fragment:zo.frag,transparent:!0,cullFace:null,depthWrite:!1,globalUniforms:cl})},onBeforeShadow:vl,onBeforeWater:yl,onAfterShadow:bl,onAfterWater:xl});let kl;var $l=Object.freeze({__proto__:null,get mesh(){return kl},init:()=>{wi((kl=new vn(Bn,{program:gl.sky})).scale,40),kl.setParent(Nn),kl.visible=!1,kl.renderOrder=6e3,kl.frustumCulled=!1,br("hordes.io/engine/dome.ho",t=>{const e=new Oi(Bn,t);kl.geometry=e;const s=Rr(Ho.frag,1024,Ln);gl.sky.uniforms.SV.value=s,gl.sky.uniforms.SV.state++,kl.visible=!0})},tick:({camera:t,cameraPivot:e})=>{e.updateMatrixWorld(),kl.position[0]=.998*t.Dy[12],kl.position[1]=.998*t.Dy[13],kl.position[2]=.998*t.Dy[14]}});let Sl,Cl;var Ml=Object.freeze({__proto__:null,get mesh(){return Sl},get geometry(){return Cl},init:()=>{gi.clouds&&br("hordes.io/engine/dome.ho",t=>{Cl=new Oi(Bn,t),(Sl=new vn(Bn,{geometry:Cl,program:gl.clouds})).position[1]=0,Sl.offset=0,wi(Sl.scale,.2),Sl.scale[1]*=.3,Sl.renderOrder=4e3,Sl.frustumCulled=!1,Sl.matrixAutoUpdate=!1,Sl.updateMatrix(),Sl.setParent(kl);const e=Rr(Co.frag,1024,Ln);gl.clouds.uniforms.jh.value=e,gl.clouds.uniforms.jh.state++})}});const El=[];let _l,Rl,Pl;const Tl=({Jm:t,size:e},s,i)=>(s||((s=new dn).remove=!1,El.push(s)),s.Dy=i,s.val=[...t,e],s);var Il=Object.freeze({__proto__:null,Dj:El,init:()=>{Rl=cl.hY,_l=cl.uT,Pl=cl.Fm},tick:({dt:t})=>{El.sort((t,e)=>t.camDistance-e.camDistance);for(let t=0,e=El.length;t<e;++t){const s=El[t];if(s.remove)El.splice(t,1),--t,--e;else if(t<16){const e=4*t,i=3*t;_l.value[i]=s.Dy[12],_l.value[i+1]=s.Dy[13],_l.value[i+2]=s.Dy[14],Rl.value[e]=s.val[0],Rl.value[e+1]=s.val[1],Rl.value[e+2]=s.val[2],Rl.value[e+3]=s.val[3]*(1-s.distanceFactor)}}_l.state++,Rl.state++,Pl.value=Math.min(16,El.length)},createLight:Tl,destroy:({chunk:t,gl:e,scene:s})=>{for(let t=0;t<El.length;++t)El[t].remove=!0},onWorldDestroy:({world:t})=>{El.length=0}});class Dl{constructor(t=0,e=0){this.reset(t,e)}done(t){return t>this.end}fraction(t){return ia(1-(this.end-t)/(this.end-this.start),0,1)}remaining(t){return this.end-t}passed(t){return t-this.start}reset(t,e=this.duration){return this.start=t,this.end=t+e,this.duration=e,!0}set(t,e){return this.start=t,this.end=e,this.duration=this.end-this.start,!0}}const Al=[],Fl=new Uint32Array(66);for(let t=0,e=0;t<66;t+=6,e+=2)Fl[t+0]=e,Fl[t+1]=e+1,Fl[t+2]=e+3,Fl[t+3]=e,Fl[t+4]=e+3,Fl[t+5]=e+2;const zl=new Map,Bl=t=>{const e=zl.get(t.steps||10);let s;return(s=e&&0!==e.length?e.pop():new Ol(t)).reset(t),Al.push(s),s},Ul=t=>{t.mesh.setParent(null)};class Ol{constructor(t){this.maxSteps=t.steps||10,this.stepTimer=new Dl(0,1),this.timer=new Dl(0,1),this.lines=this.maxSteps+1,this.Vx=new Float32Array(4*this.lines),this.positions=new Float32Array(6*this.lines),this.geometry=new Oi(Bn,{position:{size:3,data:this.positions},Vx:{size:2,data:this.Vx},index:{type:Bn.UNSIGNED_INT,data:Fl.subarray(0,6*this.maxSteps)}}),this.mesh=new vn(Bn,{frustumCulled:!1,geometry:this.geometry,matrixAutoUpdate:!1,program:gl.ribbon}),this.mesh.offset=[0,this.maxSteps,1]}reset(t){if(this.stepTimer.reset(0,t.interval||.5),this.timer.reset(qn.time,t.timer||1),this.currentStep=0,this.permanent=t.permanent||!1,this.a=t.a,this.b=t.b,this.mesh.offset[2]=t.repeat||.5,this.remove=!1,this.timeoutSteps=0,t.uvTop=t.uvTop||1,t.uvBot=t.uvBot||0,this.uvTop!==t.uvTop||this.uvBot!==t.uvBot){for(let e=0,s=0;e<this.lines;++e,s+=4)this.Vx[s]=e/this.maxSteps,this.Vx[s+2]=e/this.maxSteps,this.Vx[s+1]=t.uvTop,this.Vx[s+3]=t.uvBot;this.uvTop=t.uvTop,this.uvBot=t.uvBot,this.geometry.updateAttribute(this.geometry.attributes.Vx)}this.geometry.drawRange.count=0,this.mesh.Aj=this.Aj=t.Aj,this.mesh.Ss=this.Ss=t.Ss,this.mesh.setParent(Nn),this.parent=t.parent||Nn}tick(t){if(this.timer.done(qn.time)&&!this.permanent)return void(this.remove=!0);if(null!==this.parent){if(this.mesh.visible=this.parent.visible&&(!this.parent.parent||this.parent.parent.visible),!this.mesh.visible||this.parent.worldMatrixNeedsUpdate)return;this.mesh.visible&&0==this.timeoutSteps&&(this.positions.set(Ti(Qn,this.a,this.parent.Dy),0),this.positions.set(Ti(Qn,this.b,this.parent.Dy),3))}this.stepTimer.done(qn.time)&&(this.stepTimer.reset(qn.time),this.step()),this.geometry.updateAttribute(this.geometry.attributes.position);const e=this.stepTimer.fraction(qn.time);this.mesh.offset[0]=e/(this.maxSteps+1)+(this.permanent?0:this.timer.fraction(qn.time)),this.currentStep<this.maxSteps?this.mesh.offset[1]=this.maxSteps/(this.currentStep+e):this.mesh.offset[1]=1}step(){this.currentStep=Math.min(this.maxSteps,this.currentStep+1),this.positions.copyWithin(6,0),this.geometry.drawRange.count=6*this.currentStep,this.timeoutSteps>0&&(this.timeoutSteps--,0==this.timeoutSteps&&(this.remove=!0))}destroy(){this.parent=null,this.mesh.setParent(null),this.mesh.geometry.remove(),this.mesh=void 0,this.geometry=void 0}onCache(){this.mesh.setParent(null),this.mesh.visible=!1}}var jl=Object.freeze({__proto__:null,add:Bl,tick:({dt:t})=>{for(let e=0;e<Al.length;e++)if(Al[e].tick(t),Al[e].remove){const t=Al.splice(e--,1)[0];zl.has(t.maxSteps)||zl.set(t.maxSteps,[]),zl.get(t.maxSteps).push(t),t.onCache()}},onWorldDestroy:({world:t})=>{Al.forEach(Ul),zl.forEach(t=>{t.forEach(Ul)}),zl.clear(),Al.length=0}});const Ll={},Nl=(t,e)=>{const s=[];for(let i=0;i<t;++i){const t=e();t.idStart=t.idStart||0,t.Ss=t.Ss||t.Aj,t.scaleStart=t.scaleStart||1,t.rotaStart=t.rotaStart||0,t.idEnd=void 0!==t.idEnd?t.idEnd:t.idStart,t.scaleEnd=void 0!==t.scaleEnd?t.scaleEnd:t.scaleStart,t.rotaEnd=void 0!==t.rotaEnd?t.rotaEnd:t.rotaStart,t.friction=t.friction||0,t.acc=t.acc||[0,0,0],t.Dm=t.Dm||oa.linear,s.push(t)}return s};Ll.dust=Nl(3,()=>({idStart:2,rotaStart:3*Math.random(),rotaEnd:3*-Math.random(),Aj:[Ar(.4,.5),Ar(.4,.5),Ar(.4,.5),2],Ss:[Ar(.4,.5),Ar(.4,.5),Ar(.4,.5),2],scaleStart:.7+.5*Math.random(),scaleEnd:0,friction:.1,duration:350})),Ll.floaterGreen=Nl(5,()=>({Dm:oa.sinReverse,idStart:6,Aj:[Ar(.5,.8),Ar(1.5,2),Ar(.5,.8),2.5],Ss:[Ar(0,.2),Ar(.8,.9),Ar(.1,.2),0],scaleStart:1,scaleEnd:.5,duration:15e3})),Ll.totemfloater=Nl(1,()=>({Dm:oa.sinReverse,idStart:6,Aj:[Ar(.5,.8),Ar(1.5,2),Ar(.5,.8),2.5],Ss:[Ar(0,.2),Ar(.8,.9),Ar(.1,.2),0],scaleStart:2,scaleEnd:2,duration:2e3})),Ll.floaterRed=Nl(5,()=>({Dm:oa.sinReverse,idStart:0,Aj:[Ar(1.5,2),Ar(.5,.7),Ar(.3,.6),2.5],Ss:[Ar(0,.2),Ar(.2,.5),Ar(.2,.2),0],scaleStart:.15,scaleEnd:.04,duration:15e3})),Ll.fire=Nl(12,()=>{const t=Ar(0,.5);return{Dm:oa.sinReverse,idStart:0,idEnd:0,Aj:[1,.2+2*t,t,1],Ss:[.4,.1,0,0],scaleStart:1-t,scaleEnd:.3-t,rotaStart:Ar(-2,2),rotaEnd:Ar(-2,2),acc:[0,Ar(1,3),0],duration:Ar(1e3,1e3)}}),Ll.torchfire=Nl(5,()=>{const t=Ar(0,.4);return{Dm:oa.sinReverse,idStart:0,idEnd:0,Aj:[1,.2+2*t,t,1],Ss:[.4,.1,0,0],scaleStart:.8-1.5*t,scaleEnd:.5-t,rotaStart:Ar(-2,0),rotaEnd:Ar(0,2),acc:[0,Ar(5,7),0],duration:Ar(500,600)}}),Ll.mystical=Nl(3,()=>({Dm:oa.easeOutQuad,idStart:1,Aj:[.1,1,1,1],Ss:[0,.1,.9,0],scaleStart:0,scaleEnd:1.4,rotaStart:0,rotaEnd:2,duration:Ar(400,600)})),Ll.meleeFlash=Nl(3,()=>({Dm:oa.sinReverse,idStart:3,rotaStart:Ar(0,3),Aj:[1,1,1,.5],Ss:[1,1,1,0],scaleStart:1.5+.3*Ar(0,3),scaleEnd:.5+.3*Ar(0,3),duration:200})),Ll.meleePhys=Nl(3,()=>{const t=Ar(0,1);return{idStart:2,Aj:[1,.4,.1,.7],Ss:[1,0,0,0],scaleStart:.5-.2*t,scaleEnd:0,friction:.05+.2*t,acc:[0,-20,0],duration:250}}),Ll.blood=Nl(3,()=>({idStart:2,Aj:[Ar(.2,.25),0,Ar(0,.05),3],Ss:[Ar(.2,.25),0,Ar(0,.05),2],scaleStart:.5-.2*Ar(0,1),scaleEnd:0,acc:[0,-20,0],duration:1e3})),Ll.bloodFloat=Nl(3,()=>({idStart:2,Aj:[Ar(.2,.25),0,Ar(0,.05),3],Ss:[Ar(.2,.25),0,Ar(0,.05),2],scaleStart:.5,scaleEnd:0,duration:500})),Ll.meleeFlashBig=Nl(3,()=>({Dm:oa.sinReverse,idStart:3,rotaStart:Ar(0,3),Aj:[2,1,1,.5],Ss:[1,.8,.8,0],scaleStart:3+.3*Ar(0,3),scaleEnd:.5+.3*Ar(0,3),duration:200})),Ll.blockCircle=Nl(1,()=>({idStart:8,Aj:[1,1,1.5,2],Ss:[0,0,1,-1],scaleStart:0,scaleEnd:10,duration:250})),Ll.blockFlick=Nl(3,()=>({idStart:2,rotaStart:Ar(0,3),Aj:[1,1,1.5,2],Ss:[0,.3,1,-1],scaleStart:.25,scaleEnd:.1,duration:400})),Ll.healHolySoft=Nl(3,()=>({Dm:oa.sinReverse,idStart:4,Aj:[1,2,1,3],Ss:[.8,1,.7,0],scaleStart:Ar(1.8,3.2),scaleEnd:Ar(1,2),acc:[0,Ar(.3,1.5),0],duration:1e3})),Ll.healNatureBlink=Nl(3,()=>({Dm:oa.sinReverse,idStart:6,rotaStart:Ar(0,3),rotaEnd:Ar(0,3),Aj:[1,2,.6,.8],Ss:[.8,.7,.7,0],scaleStart:Ar(.8,1.5),scaleEnd:0,acc:[0,Ar(1.5,3),0],duration:600})),Ll.healHolySparkle=Nl(3,()=>({Dm:oa.sinReverse,idStart:6,rotaStart:Ar(0,3),rotaEnd:Ar(0,3),Aj:[2,2,1,.8],Ss:[.8,.7,.7,0],scaleStart:Ar(1,2),scaleEnd:0,acc:[0,Ar(.3,1.5),0],duration:1e3})),Ll.blockBuffShield=Nl(1,()=>({idStart:9,Aj:[.1,1.3,1,.8],Ss:[.1,.8,1,.3],scaleStart:.5,scaleEnd:.4,duration:500})),Ll.holyShield=Nl(1,()=>({idStart:9,Aj:[1.2,1,0,1.5],Ss:[1,.8,0,.9],scaleStart:.5,scaleEnd:.4,duration:200})),Ll.blockBuffFocus=Nl(1,()=>({idStart:8,Aj:[1,1,1.5,1],Ss:[0,0,1,0],scaleStart:10,scaleEnd:0,duration:400})),Ll.blockBuffEnrage=Nl(3,()=>({idStart:1,Aj:[.3,0,.05,3],Ss:[.2,0,.05,0],acc:[0,1,0],scaleStart:.4,scaleEnd:.2,duration:1e3,rotaStart:Ar(0,3)})),Ll.crescentStrike=Nl(1,()=>({idStart:0,Aj:[1.5,.7,.4,2],Ss:[1,.5,.5,0],scaleStart:.5,scaleEnd:.3,duration:500,friction:.1})),Ll.levelUp=Nl(1,()=>({Dm:oa.sinReverse,idStart:6,Aj:[2,2,1,.8],Ss:[.8,.7,.7,0],scaleStart:1.5,scaleEnd:0,friction:.03,duration:1e3})),Ll.iceBig=Nl(5,()=>({Dm:oa.sinReverse,idStart:0,Aj:[Ar(.18,.21),Ar(.6,.7),Ar(1.4,1.5),2],Ss:[.8,.9,1,0],scaleStart:.4,scaleEnd:.3,rotaStart:Ar(0,6),friction:.1,acc:[Ar(-1,1),Ar(-1,1),Ar(-1,1)],duration:Ar(200,300)})),Ll.snowflake=Nl(3,()=>({idStart:0,Aj:[.9,1,1.3,2],Ss:[.9,1,1.1,0],scaleStart:.5,scaleEnd:.2,rotaStart:Ar(0,3),friction:.1,duration:Ar(800,1e3)})),Ll.frostflake=Nl(3,()=>({idStart:0,Aj:[.1,.3,1.3,3],Ss:[.1,.3,1,1],scaleStart:.7,scaleEnd:0,rotaStart:Ar(0,3),friction:.05,duration:Ar(600,800)})),Ll.preciseArrow=Nl(3,()=>({idStart:0,Aj:[1,1,1,2],Ss:[1,1,1,0],scaleStart:.2,scaleEnd:.1,rotaStart:Ar(0,3),duration:Ar(300,400)})),Ll.healNatureBig=Nl(3,()=>({Dm:oa.sinReverse,idStart:10,Aj:[.2,1.5,.5,1.5],Ss:[.3,.9,1,0],scaleStart:.7,scaleEnd:.2,acc:[Ar(-.5,.5),1.5,Ar(-.5,.5)],rotaStart:Ar(0,3),duration:Ar(600,800),friction:.02})),Ll.healNatureSparkle=Nl(3,()=>({Dm:oa.sinReverse,idStart:0,Aj:[1.5,1.5,.4,2],Ss:[1.7,1.5,.4,0],scaleStart:.12,scaleEnd:.05,acc:[Ar(-.5,.5),2,Ar(-.5,.5)],rotaStart:Ar(0,3),duration:Ar(600,800)})),Ll.invigorateBuff=Nl(1,()=>({idStart:11,Aj:[0,1,1.5,1],Ss:[0,.7,1.5,.7],scaleStart:.8,scaleEnd:.7,duration:300})),Ll.hypothermicBuff=Nl(1,()=>({idStart:7,Aj:[.4,.9,2.5,2.5],Ss:[.5,.8,1.5,.9],scaleStart:.7,scaleEnd:.5,duration:500})),Ll.manaGain=Nl(3,()=>({Dm:oa.sinReverse,idStart:6,rotaStart:Ar(0,3),rotaEnd:Ar(0,3),Aj:[.2,.6,2,2],Ss:[.1,.4,1,1],scaleStart:Ar(1,2),scaleEnd:.5,acc:[0,Ar(.5,3),0],duration:800})),Ll.iceglare=Nl(1,()=>({idStart:6,Aj:[.4,.5,1,3],Ss:[.4,.5,1,3],scaleStart:2,scaleEnd:3,duration:800})),Ll.skulls=Nl(6,()=>({Dm:oa.sinReverse,idStart:12,rotaStart:Ar(-.2,.2),rotaEnd:Ar(-.2,.2),Aj:[Ar(.4,.6),Ar(.2,.5),Ar(.1,.2),1],Ss:[Ar(.3,.6),Ar(1,1.3),Ar(.1,.2),.6],scaleStart:Ar(.4,.6),scaleEnd:0,acc:[Ar(-.5,.5),Ar(-2,-1),Ar(-.5,.5)],friction:.05,duration:1e3})),Ll.decay=Nl(6,()=>({idStart:12,rotaStart:0,rotaEnd:0,Aj:[.5,.3,.1,2],Ss:[.5,1,.1,0],scaleStart:1,scaleEnd:1,duration:800})),Ll.mimir=Nl(3,()=>({idStart:6,Aj:[.2,.6,3,2],Ss:[.1,.4,1.2,1],scaleStart:Ar(1,2),scaleEnd:.5,duration:800})),Ll.icenova=Nl(3,()=>({idStart:0,Aj:[.2,.3,1.5,1.5],Ss:[.5,.4,1,0],scaleStart:.3,scaleEnd:1.4,rotaStart:Ar(0,3),friction:.1,duration:Ar(300,400)})),Ll.iceFlash=Nl(1,()=>({idStart:8,Aj:[.8,.8,1.5,2],Ss:[.5,.5,1,-1],scaleStart:0,scaleEnd:10,duration:350})),Ll.icicle=Nl(3,()=>({idStart:1,Aj:[1,1,1.5,1.5],Ss:[.2,.2,1.3,.5],scaleStart:.8,scaleEnd:0,rotaStart:Ar(0,9),duration:Ar(400,500),friction:.01})),Ll.courage=Nl(1,()=>({idStart:13,Aj:[.5,1.5,1.5,2],Ss:[.2,1.4,1.3,1],scaleStart:.8,duration:400})),Ll.courageFlash=Nl(1,()=>({idStart:13,Aj:[.5,1.5,1.5,2],Ss:[0,0,1,0],scaleStart:0,scaleEnd:15,duration:800})),Ll.warcry=Nl(1,()=>({idStart:14,Aj:[1,.3,.2,3],Ss:[1,.2,.1,2],scaleStart:.8,duration:400})),Ll.warcryFlash=Nl(1,()=>({idStart:14,Aj:[1,.3,.2,3],Ss:[1,0,0,0],scaleStart:0,scaleEnd:15,duration:800})),Ll.enchant=Nl(4,()=>({idStart:5,Aj:[1,.3,.2,Ar(2,3)],Ss:[1,.2,.1,2],scaleStart:Ar(1.5,1.8),scaleEnd:1.3,rotaStart:Ar(0,3),rotaEnd:0,duration:500})),Ll.shadowglow=Nl(3,()=>({idStart:1,Aj:[.5,1,.6,1.5],Ss:[.2,1.5,.2,0],scaleStart:.5,scaleEnd:.8,acc:[Ar(-1,1),Ar(-1,1),Ar(-1,1)],rotaStart:Ar(-1,1),rotaEnd:Ar(-1,1),duration:500})),Ll.enchantFlash=Nl(1,()=>({idStart:8,Aj:[1,.2,.05,1.5],Ss:[1,.5,.4,.5],scaleStart:10,scaleEnd:0,duration:500})),Ll.arcticaura=Nl(2,()=>({idStart:5,Aj:[0,.3,1,Ar(2,3)],Ss:[0,0,1,1],scaleStart:Ar(3,4),scaleEnd:3,rotaStart:Ar(0,3),rotaEnd:0,duration:500})),Ll.arcticFlash=Nl(1,()=>({idStart:7,Aj:[.3,.5,1.5,1.5],Ss:[0,.5,1,.5],scaleStart:10,scaleEnd:0,duration:500})),Ll.temporal=Nl(1,()=>({idStart:5,Aj:[1.2,1.2,0,1.5],Ss:[1,1,0,.9],scaleStart:1,scaleEnd:.8,duration:200})),Ll.temporalFlash=Nl(1,()=>({idStart:8,Aj:[1,1,0,1],Ss:[1,1,0,.5],scaleStart:5,scaleEnd:0,duration:200})),Ll.pathfindFlash=Nl(1,()=>({idStart:8,Aj:[1,1,.9,1],Ss:[1,.5,.5,.2],scaleStart:0,scaleEnd:6,duration:200})),Ll.canine=Nl(1,()=>({idStart:15,Aj:[1.5,.5,.1,2],Ss:[1.3,.3,.2,1],scaleStart:.6,scaleEnd:.5,duration:200})),Ll.canineFlash=Nl(1,()=>({idStart:15,Aj:[1.5,.5,.1,2],Ss:[1.3,.3,.2,0],scaleStart:0,scaleEnd:10,duration:400})),Ll.etherglow=Nl(1,()=>({Dm:oa.sinReverse,idStart:5,Aj:[.4,1,2,.9],Ss:[.2,.9,1,0],scaleStart:1.2,scaleEnd:.5,acc:[0,2,0],rotaStart:0,rotaEnd:0,duration:900})),Ll.poison=Nl(6,()=>({Dm:oa.sinReverse,idStart:17,idEnd:21,rotaStart:Ar(-.2,.2),rotaEnd:Ar(-.2,.2),Aj:[Ar(0,.6),2,Ar(0,.1),1],Ss:[1.5,1,0,0],scaleStart:Ar(.6,.8),scaleEnd:.5,acc:[Ar(-.5,.5),Ar(1,3),Ar(-.5,.5)],friction:.05,duration:1e3})),Ll.poisonSoft=Nl(4,()=>({Dm:oa.sinReverse,idStart:16,Aj:[Ar(0,1),2,0,1],Ss:[Ar(0,1),1,.2,0],scaleStart:Ar(1.8,3.2),scaleEnd:Ar(1,2),duration:1500})),Ll.decaySoft=Nl(4,()=>({Dm:oa.sinReverse,idStart:16,Aj:[Ar(.5,1),.8,0,1.5],Ss:[Ar(.5,.8),Ar(.8,1.1),.2,0],scaleStart:Ar(1.8,3.2),scaleEnd:Ar(1,2),duration:1500})),Ll.teleportSparkle=Nl(3,()=>({Dm:oa.sinReverse,idStart:6,Aj:[Ar(.5,1),.6,Ar(1,2),Ar(.5,1.5)],Ss:[.5,.3,1.3,0],scaleStart:Ar(2,4),scaleEnd:Ar(.5,1.5),duration:400})),Ll.teleportFlash=Nl(1,()=>({idStart:8,Aj:[.8,.6,2,2],Ss:[.5,.3,1.3,-1],scaleStart:8,scaleEnd:0,duration:150})),Ll.precisesparcle=Nl(5,()=>({Dm:oa.sinReverse,idStart:6,Aj:[Ar(1,2),Ar(.9,1.2),Ar(.5,.8),Ar(1.5,2.5)],Ss:[1,.5,.3,0],scaleStart:Ar(2,4),scaleEnd:Ar(.4,.7),duration:200,rotaStart:Ar(0,3),rotaEnd:Ar(-3,0)})),Ll.stun=Nl(1,()=>({idStart:6,Aj:[1.2,1.2,.2,1.2],Ss:[1.2,1.2,.2,.9],scaleStart:1.7,scaleEnd:1.8,duration:500})),Ll.daze=Nl(1,()=>({idStart:6,Aj:[.2,1.2,1.2,1.2],Ss:[.2,1.2,1.2,.9],scaleStart:1.2,scaleEnd:1,duration:500})),Ll.chargeFlash=Nl(1,()=>({idStart:8,Aj:[2,1.5,.3,1.5],Ss:[1,.5,.3,.2],scaleStart:0,scaleEnd:5,duration:250})),Ll.tauntFlash=Nl(1,()=>({idStart:8,Aj:[2,1,.8,1.2],Ss:[1.5,.2,.3,.2],scaleStart:8,scaleEnd:0,duration:350})),Ll.tauntsparkle=Nl(4,()=>({Dm:oa.sinReverse,idStart:6,Aj:[Ar(2,3),Ar(.9,1.2),Ar(.2,.1),Ar(1.5,2.5)],Ss:[1,.9,.8,0],scaleStart:Ar(2,2.5),scaleEnd:Ar(1,1.5),duration:800,friction:.08,rotaStart:Ar(0,3)})),Ll.transformationAura=Nl(5,()=>({Dm:oa.sinReverse,idStart:8,Aj:[Ar(.5,.9),.5,Ar(2,3),0],Ss:[Ar(.5,.9),.5,Ar(1,2),2],scaleStart:2,scaleEnd:0,duration:250})),Ll.transformSoft=Nl(5,()=>({Dm:oa.sinReverse,idStart:16,Aj:[Ar(.5,.8),.5,Ar(2,3),2],Ss:[Ar(.5,.8),.5,Ar(1,2),0],scaleStart:Ar(2.5,4.2),scaleEnd:Ar(1,2),duration:800,rotaStart:Ar(0,5)})),Ll.snipe=Nl(1,()=>({idStart:6,Aj:[2.6,2,1.5,1],Ss:[2.6,2,1.5,1],scaleStart:3,scaleEnd:0,friction:.15,duration:300})),Ll.summonFlash=Nl(1,()=>({idStart:8,Aj:[1.5,.6,2,2],Ss:[.8,.1,1.3,-1],scaleStart:0,scaleEnd:12,duration:1600})),Ll.summonSparkle=Nl(3,()=>({Dm:oa.sinReverse,idStart:6,rotaStart:Ar(0,3),rotaEnd:Ar(0,3),Aj:[.9,.5,2,2],Ss:[.5,.1,1.5,1],scaleStart:Ar(1,2),scaleEnd:.5,acc:[0,Ar(.5,3),0],friction:.02,duration:1600}));const ql=performance,Hl=()=>ql.now(),Wl=[];let Ql,Vl;const Gl=[],Yl=t=>{t>0?(Ql.visible=!0,Vl.setDrawRange(0,t),Vl.updateAttribute(Vl.attributes.CR),Vl.updateAttribute(Vl.attributes.info),Vl.updateAttribute(Vl.attributes.ZR),Vl.updateAttribute(Vl.attributes.Aj),Vl.updateAttribute(Vl.attributes.Ss)):Ql.visible=!1},Xl=()=>{let t=0;for(let e=0;e<Wl.length;++e){const s=Wl[e];s.distance<1&&(Vl.attributes.CR.data.set(s.CR,3*t),Vl.attributes.info.data.set([s.info.Dm(s.Tf),0,s.info.idStart,s.info.idEnd],4*t),Vl.attributes.ZR.data.set([s.info.scaleStart,s.info.scaleEnd,s.info.rotaStart,s.info.rotaEnd],4*t),Vl.attributes.Aj.data.set(s.info.Aj,4*t),Vl.attributes.Ss.data.set(s.info.Ss,4*t),t++)}return t},Zl=(t,e,s=0,i=0,n=0,a=0,r=0,o=0,l=!1)=>{let c=Gl.pop();if(!c){if(l){let t=Wl.length-1;for(;t>=0&&Wl[t].forced;)--t;t>=0&&(c=Wl.splice(t,1)[0])}if(!c)return}return xi(c.vel,a,r,o),xi(c.CR,s,i,n),e&&Ti(c.CR,c.CR,e),c.info=zr(t),c.start=l?-1:Hl(),c.end=c.start+c.info.duration,c.forced=l,Wl.push(c),c},Jl=()=>{Vl=new Oi(Bn,{CR:{size:3,data:new Float32Array(3e3)},info:{size:4,data:new Float32Array(4e3)},ZR:{size:4,data:new Float32Array(4e3)},Aj:{size:4,data:new Float32Array(4e3)},Ss:{size:4,data:new Float32Array(4e3)}}),(Ql=new vn(Bn,{mode:Bn.POINTS,matrixAutoUpdate:!1,geometry:Vl,program:gl.particles})).frustumCulled=!1,Vl.type="particle",Nn.addChild(Ql),_r("particles.png",t=>{gl.particles.uniforms.aH.value=t,gl.particles.uniforms.aH.state++,gl.particles.active=!0,Ql.renderOrder=7e3})},Kl=(t,e)=>t.distance<e.distance?1:-1,tc=(t,e)=>(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14])/(e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]);var ec=Object.freeze({__proto__:null,init:()=>{Jl(),gl.ribbon.setBlendFunc(Bn.ONE,Bn.ONE_MINUS_SRC_ALPHA),gl.particles.setBlendFunc(Bn.ONE,Bn.ONE_MINUS_SRC_ALPHA);for(let t=0;t<1e3;++t)Gl.push({CR:[-0,-0,-0],vel:[-0,-0,-0],info:Ll.dust[0],distance:0,Tf:0,start:0,end:1.01,forced:!1})},tick:({dt:t,camera:e})=>{((t,e,s)=>{for(let e=Wl.length-1;e>=0;--e){const s=Wl[e];s.start<0||s.end>t||(Wl.splice(e,1),Gl.push(s))}Wl.forEach(i=>{Ci(i.vel,i.vel,i.info.acc,e),Ci(i.CR,i.CR,i.vel,e),i.info.friction>0&&Si(i.vel,i.vel,1-i.info.friction),i.distance=tc(i.CR,s.kX),i.Tf=i.start<0?.5*(Math.sin(t/i.info.duration)+1):(t-i.start)/i.info.duration}),Wl.sort(Kl)})(Hl(),t,e),(()=>{const t=Xl();Yl(t)})()},createParticle:Zl});const sc={},ic=({geo:t,tex:e,program:s,ts:i,rs:n,mode:a,dynamic:r,cull:o,permanent:l,frustum:c=!0,visible:h=!0})=>{const d=t+(e||0)+s.id+(i?1:0)+(n?1:0)+(r?1:0)+(c?1:0)+(void 0!==o?o:1029)+(void 0!==a?a:999);let u,m,p=0;for(;!u;)sc[m=d+p]?sc[m].instances.length<3e3?u=sc[m]:++p:u=nc({geo:t,tex:e,program:s,ts:i,rs:n,mode:a,dynamic:r,hash:m,cull:o,permanent:l,frustum:c,visible:h});return u.create()},nc=({geo:t,tex:e,program:s,ts:i,rs:n,mode:a,dynamic:r,hash:o,cull:l,permanent:c,frustum:h,visible:d})=>{const u=sc[o]=new kn(Bn,{program:s,mode:void 0!==a?a:Bn.TRIANGLES,shadowProgram:gi.shadows&&i?e?gl.shadowInstancedAlpha:gl.shadowInstanced:void 0,throwShadow:gi.shadows&&i?r?il.LG:il.shadowStatic:void 0,receiveShadow:gi.shadows&&n?il.LG:void 0,dynamic:r,frustum:h});return u.permanent=c,u.onBeforeRender=ac,u.cullFace=void 0!==l?l:1029,u.Hp=gi.shadows&&n?1:0,u.dynamicThrowShadwos=gi.shadows&&r&&i,u.setParent(Nn),br(t,t=>{u.setAttributes(t),e?_r(e,t=>{u.pG=t,u.visible=d,u.renderOrder=0+(u.program.id+1)*(t.id+1)*(u.Hp+1)}):(u.renderOrder=0+(u.program.id+1)*(u.Hp+1),u.visible=d)}),u},ac=({mesh:t,camera:e,shadowTarget:s})=>{s||(t.program.cullFace=t.cullFace)},rc=[],oc=[0,0,0],lc=(t,e,s)=>{if(void 0===e&&((e=bn()).data={fraction:gc,particle:hc,localize:kc,creature:void 0,transform:e,time:-0,timeout:-0,accumulator:-0,frame:0,remove:!1,info:void 0,tick:void 0,invisibilified:!1,camDistance:-0,distanceFactor:-0,lod:0,sound:void 0,ribbon:void 0,buff:void 0,fj:void 0},rc.push(e)),e.data.time=void 0!==t.time?t.time:0,e.data.timeout=void 0!==t.timeout?t.timeout:0,e.data.accumulator=0,e.data.frame=0,e.data.remove=!1,e.data.info=t,e.data.tick=t.tick,e.data.invisibilified=!1,s&&e.setParent(s),void 0!==e.data.info.fj?mc(e):e.data.fj&&pc(e),void 0!==e.data.info.sound?dc(e):e.data.sound&&uc(e),void 0!==e.data.info.ribbon?vc(e):yc(e),void 0!==e.data.info.mesh?bc(e):xc(e),void 0!==e.data.info.particles){e.data.particles=[];for(let t=0;t<e.data.info.particles.amount;++t){const t=e.data.particle(e.data.info.particles.info,0,0,0,0,0,0,!0);t&&e.data.particles.push(t)}}return e},cc=t=>{void 0!==t.data.fj&&pc(t),void 0!==t.data.sound&&uc(t),void 0!==t.data.particles&&fc(t),void 0!==t.data.ribbon&&yc(t),void 0!==t.data.mesh&&xc(t),null!==t.parent&&t.setParent(null)},hc=function(t,e=0,s=0,i=0,n=0,a=0,r=0,o=!1){if(o||gi.particles)return Zl(t,this.transform.Dy,e,s,i,n,a,r,o)},dc=t=>{void 0!==t.data.sound&&t.data.sound.stop(),t.data.sound=Yr({id:t.data.info.sound.id,loop:t.data.info.sound.loop,dynamic:t.data.info.sound.dynamic,transform:t.data.info.sound.parent?t.parent:t,distance:t.data.info.sound.distance})},uc=t=>{t.data.sound.stop(),t.data.sound=void 0},mc=t=>{void 0!==t.data.fj&&pc(t),t.data.fj=Tl(t.data.info.fj,t.data.fj,t.Dy),t.data.fj.setParent(t)},pc=t=>{t.data.fj.setParent(null),t.data.fj.remove=!0,t.data.fj=void 0},fc=t=>{t.data.particles.forEach(t=>{t.start=1,t.end=1}),t.data.particles=void 0},gc=function(t,e,s=this.time){return s>=t&&s-e<=t},vc=t=>{void 0!==t.data.ribbon&&(t.data.ribbon.remove=!0),t.data.ribbon=Bl({parent:t,...t.data.info.ribbon})},yc=t=>{void 0!==t.data.ribbon&&(t.data.ribbon.timeoutSteps=Math.max(1,t.data.ribbon.currentStep),t.data.ribbon.parent=null,t.data.ribbon=void 0)},bc=t=>{void 0!==t.data.mesh&&xc(t),t.data.mesh=ic({geo:t.data.info.mesh.id||"hordes.io/engine/cube.ho",program:gl.multimeshFlat,ts:!0,rs:!0,dynamic:!0}),t.data.mesh.data.color=t.data.info.mesh.color,void 0!==t.data.info.mesh.scale&&bi(t.data.mesh.scale,t.data.info.mesh.scale),void 0!==t.data.info.mesh.CR&&bi(t.data.mesh.position,t.data.info.mesh.CR),void 0!==t.data.info.mesh.rot&&t.data.mesh.rotation.copy(t.data.info.mesh.rot),t.data.mesh.setParent(t)},xc=t=>{void 0!==t.data.mesh&&(t.data.mesh.data.multi.remove(t.data.mesh),t.data.mesh.setParent(null),t.data.mesh=void 0)},wc=t=>xi(t.CR,0,0,0);function kc(t,e=0,s=0,i=0,n=0,a=0,r=0){const o=this.transform.position,l=this.transform.parent.scale,c=this.transform.parent.position;t[0]=(o[0]+e)*l[0]+c[0]+n,t[1]=(o[1]+s)*l[1]+c[1]+a,t[2]=(o[2]+i)*l[2]+c[2]+r}var $c=Object.freeze({__proto__:null,effects:rc,tick:({dt:t,camera:e,viewRange:s})=>{const i=Hl();let n=rc.length;for(;n--;){const a=rc[n],r=a.data;r.remove||r.timeout>0&&r.time>r.timeout?(cc(a),rc.splice(n,1),xn(a)):(Gi(oc,a.Dy),r.camDistance=Math.max(0,Mi(oc,e.worldPosition)-10),r.distanceFactor=r.camDistance/(.25*s),r.lod=Math.max(0,1-r.distanceFactor),r.time+=t,r.accumulator+=t,r.distanceFactor<1||!r.info.permanent?(r.info.sound&&void 0===r.sound&&(r.info.sound.loop||0===r.info.sound.frame)&&dc(a),r.info.fj&&void 0===r.fj&&mc(a),void 0!==r.fj&&(r.fj.camDistance=r.camDistance,r.fj.distanceFactor=r.distanceFactor),void 0!==r.tick&&(0===r.frame||r.time>=0&&(void 0!==r.particles||r.accumulator>=Math.min(1,.2*r.distanceFactor)))&&(!a.visible||null!=a.parent&&!a.parent.visible?r.invisibilified||(void 0!==r.particles&&r.particles.forEach(wc),r.mesh&&(r.mesh.visible=!1),r.invisibilified=!0):(r.invisibilified&&(r.mesh&&(r.mesh.visible=!0),r.invisibilified=!1),r.tick(i,r.accumulator),r.accumulator=0,r.frame++))):(void 0!==r.sound&&r.sound.loop&&uc(a),void 0!==r.fj&&pc(a)))}},createEffect:lc,onWorldDestroy:({world:t})=>{for(let t=0;t<rc.length;++t)rc[t].data.remove=!0},zeroParticle:wc});const Sc=[];let Cc,Mc;const Ec={color:[0,0,0]},_c={color:[0,0,0]},Rc={color:[0,0,0],dir:[0,0,0]},Pc={near:10,Oq:100,color:[0,0,0]};let Tc;const Ic=t=>{let e=t.daytime;e=e<.85?.5*aa(0,.85,e):.5+.5*aa(.85,1,e),cl.Nt.value=e;let s,i,n=.5;e<.05?(s=1,i=0,n=aa(0,.05,e)):e<.4?(s=0,i=0):e<.5?(s=0,i=1,n=aa(.4,.5,e)):e<.6?(s=1,i=2,n=aa(.5,.6,e)):e<.9?(s=2,i=2):(s=2,i=1,n=aa(.9,1,e)),fa(Rc.color,Sc[s].directional,Sc[i].directional,n),fa(Pc.color,Sc[s].fog,Sc[i].fog,n),fa(Ec.color,Sc[s].ambient,Sc[i].ambient,n),fa(_c.color,Sc[s].sky,Sc[i].sky,n)};Nt.subscribe(t=>{t&&Ac()});const Dc=t=>{if(!Cc||!Mc)return;const e=cl.Nt.value;let s,i,n=.5;e<.1?(s=Cc,i=Mc,n=.5*aa(0,.1,e)+.5):e<.4?(s=Cc,i=Mc,n=-1):e<.6?(s=Mc,i=Cc,n=aa(.4,.6,e)):e<.9?(s=Mc,i=Cc,n=-1):(s=Cc,i=Mc,n=.5*aa(.9,1,e)),n>=0?(s.gain.gain.value=1-n,i.gain.gain.value=n):(s.gain.gain.value=0,i.gain.gain.value=1)},Ac=()=>{Mc&&Mc.stop(),Cc&&Cc.stop(),Mc=Yr({id:"day",loop:!0,gain:!0}),Cc=Yr({id:"night",loop:!0,gain:!0})};var Fc=Object.freeze({__proto__:null,ambient:Ec,sky:_c,directional:Rc,fog:Pc,init:()=>{cl.vH.value=Pc.near,cl.rJ.value=Pc.Oq,cl.DY.value=Pc.color,cl.uG.value=_c.color,cl.uN.value=Ec.color,cl.cG.value=Rc.color,cl.Oz.value=Rc.dir,xi(Rc.dir,1.5,2.5,0),_i(Rc.dir,Rc.dir),ol(Rc.dir)},tick:({dt:t,world:e,viewRange:s,camera:i})=>{e.data&&Ic(e),e.data&&Dc();let n=s+10;Tc!=n&&(cl.vH.value=5,cl.rJ.value=n,Tc=n)},onWorldParse:({world:t,first:e})=>{t.data.cols.forEach((t,e)=>{Sc[e]={fog:ra(t.fog),directional:ra(t.directional),ambient:ra(t.ambient),sky:ra(t.sky)}}),Ac()},createWorldSounds:Ac});let zc=1;const Bc=t=>{(zc=t%2147483647)<=0&&(zc+=2147483646)},Uc=()=>((()=>zc=16807*zc%2147483647)()-1)/2147483647,Oc=(t,e)=>t*e/255,jc=(t,e)=>Math.round(t/e*65535),Lc=(t,e)=>t*e/65535,Nc=(t,e)=>t*e/4294967295,qc=t=>t[0]<<4|15&t[1],Hc=t=>[t>>>4,15&t],Wc=(t,e)=>{const s=e/65535;return(t[0]/s<<16|t[1]/s&65535)>>>0},Qc=(t,e)=>{const s=e/65535;return[(t>>>16)*s,(65535&t)*s]},Vc=t=>{const e=Math.floor(t%8);t/=8;const s=Math.floor(t%8);t/=8;const i=Math.floor(t%10);t/=10;const n=Math.floor(t%10);return t/=10,{col3:e,col2:s,col1:i,val1:Math.floor(t),val2:n}},Gc=t=>{const e=Math.floor(t%16);return t/=16,{type:Math.floor(t%16),value:e}},Yc=256/(2*Math.PI),Xc=(t,e,s)=>(e.id=s.id,xi(e.CR,s.x/4,0,s.z/4),e.CR[1]=Math.round(t.getHeight(e.CR[0],e.CR[2]))-10+s.y/8,e.rot.set(s.rx/Yc,s.ry/Yc,s.rz/Yc),e.scale=s.scale/16,e),Zc=(t,e)=>(t.id=e.id,t.meta=e.meta,t.class=e.class,t.faction=e.faction,t.name=e.name,t.CR=Qc(e.CR,768),t.rot=Oc(e.rot,2*Math.PI),t),Jc=(t,e)=>{t.geometry.foliage||(t.geometry.foliage=new Oi(e,{info:{size:1,data:new Float32Array(1)},position:{size:4,data:new Float32Array(4)}})),t.meshes.foliage||(t.meshes.foliage=new vn(e,{mode:e.POINTS,matrixAutoUpdate:!1,receiveShadow:il.LG,geometry:t.geometry.foliage,program:gl.foliage}),t.meshes.foliage.renderOrder=1e3,t.meshes.terrain.addChild(t.meshes.foliage),t.meshes.foliage.updateMatrix())};var Kc=Object.freeze({__proto__:null,init:()=>{},rebuild:({chunk:t,gl:e,info:s})=>{if(gi.grass&&s.foliage){const s=[];for(let e=0;e<64;++e)for(let i=0;i<64;++i){const n=i+64*e,a=Gc(t.data.foliage.readUInt8(n));Bc(n**2);for(let n=0;n<Math.min(Math.round(a.value/8),2);++n){const n=[i-.7+1.4*Uc(),0,e-.7+1.4*Uc(),.4+(1.5*Uc()+.2)*a.value/15];if(n[0]<0||n[0]>=64||n[2]<0||n[2]>=64)continue;n[1]=t.getHeight(n[0],n[2])+.5*n[3];const r={CR:n,info:[a.type]};n[0]+=t.origin[0],n[2]+=t.origin[2],s.push(r)}}const i=s.length;if(!(i>0))return;Jc(t,e);const n=t.geometry.foliage;let a,r;n.attributes.position.data.byteLength==4*i*4?(a=n.attributes.position.data,r=n.attributes.info.data):(a=new Float32Array(4*i),n.attributes.position.data=a,r=new Float32Array(1*i),n.attributes.info.data=r),s.forEach((t,e)=>{a.set(t.CR,4*e),r.set(t.info,1*e)}),n.setDrawRange(0,i),n.updateAttribute(n.attributes.position),n.updateAttribute(n.attributes.info),n.bounds=t.geometry.terrain.bounds}},destroy:({chunk:t,gl:e,scene:s})=>{t.geometry.foliage&&t.geometry.foliage.remove()},onWorldParse:({world:t,first:e})=>{const s=t.data.settings.find(t=>"foliagetex"===t.id);s&&_r("foliage/"+s.value+".png",t=>{gl.foliage.active=!0,gl.foliage.uniforms.jx.value=t})}});const th=[],eh=(t,e,s,i)=>{const n=qn.entity(t);if(n&&s.fx.effectMissile){const t={targetid:e,timer:i,effect:lc(s.fx.effectMissile),start:ki([0,0,0],Di(Qn,[0,0,n.shape.radius],n.rot),n.CR)};th.push(t)}},sh=(t,e,s,i)=>{if(s.fx.effectMissile){const n={timer:i,start:t,path:e,effect:lc(s.fx.effectMissile)};th.push(n)}};var ih=Object.freeze({__proto__:null,addMissileTargeted:eh,addMissileFree:sh,tick:({dt:t,world:e})=>{th.forEach((t,s)=>{const i=e.entity(t.targetid);if(t.targetid>0&&!i||t.timer.done(e.smoothtime))return th.splice(s,1),void(t.effect.data.remove=!0);let n=t.path;n||(n=$i([0,0,0],i.visualPosition,t.start)),Ci(t.effect.position,t.start,n,t.timer.fraction(e.smoothtime));const a=e.getHeight(t.effect.position[0],t.effect.position[2])+(i?.3:.7);a>t.effect.position[1]&&(t.effect.position[1]=a),i&&t.effect.lookAt(i.visualPosition,!1,Hn),i&&t.timer.passed(e.smoothtime)>.1&&(bi(t.start,t.effect.position),t.timer.start=e.smoothtime),t.effect.updateMatrixWorld()})},onWorldDestroy:({world:t})=>{th.forEach(t=>{t.effect.data.remove=!0}),th.length=0}});let nh=void 0,ah=[];const rh=new Dl(0,1),oh=t=>rh.reset(t.smoothtime,Fr(1,2));var lh=Object.freeze({__proto__:null,tick:({world:t})=>{ah&&(nh?nh.ended&&(oh(t),nh=void 0):rh.done(t.smoothtime)&&(0===rh.start?oh(t):nh=Yr({id:"music/"+zr(ah),pitch:-1,music:!0})))},onWorldParse:({world:t,first:e})=>{e&&nh&&(nh.stop(),nh=void 0);const s=t.getSetting("music");void 0!==s&&(ah=s.split(","))}});let ch;var hh=Object.freeze({__proto__:null,get mesh(){return ch},init:()=>{wi((ch=new vn(Bn,{program:gl.sun})).scale,.25),ch.setParent(kl),ch.visible=!1,br("hordes.io/engine/plane.ho",t=>{const e=new Oi(Bn,t);ch.geometry=e,ch.visible=!0})},tick:({dt:t,world:e,camera:s,cameraPivot:i})=>{bi(ch.position,Rc.dir),Si(ch.position,ch.position,.45),ch.lookAt(Wn,!1,Hn)}});const dh={beigerocks:[.8,.31,.6,.48],beigesand:[.8,.54,.73,.43],bluegrass:[1.3,.29,.68,.6],browndirt:[.8,.2,.54,.65],cobblestone:[1.5,.23,.75,.45],darkrocks:[.8,.17,.49,.51],driedmud:[.8,.48,.76,.22],greengrass:[1.3,.22,.52,.71],greyrock:[.8,.24,.47,.57],mossysandstone:[.8,.21,.76,.45],muddyrocks:[.8,.21,.48,.73],orangesand:[.8,.65,.86,.35],purplefungus:[.8,.21,.44,.53],purplerock:[.8,.15,.4,.36],sedimentary:[.8,.33,.59,.42],mossygrass:[1,.22,.52,.6]},uh=[0,0,0],mh=[0,0,0],ph=[0,0,0],fh=[0,0,0],gh=[0,0,0],vh=[0,0,0],yh=(t,e,s,i)=>{s==i.col1?t[e]=.5+i.val1/8*.5:s==i.col2?t[e]=.5-i.val1/8*.5:s==i.col3?t[e]=(.5-i.val1/8*.5)*(i.val2/8)*.5:t[e]=0},bh={min:[0,0,0],max:[64,64,64],center:[32,32,32],scale:[64,64,64],radius:60,initiated:!0},xh=(t,e,s)=>{if(t.geometry.terrain||(t.geometry.terrain=new Oi(e,wh(e,64)),Object.assign(t.geometry.terrain.bounds,bh)),!t.meshes.terrain){const i=t.meshes.terrain=new vn(e,{matrixAutoUpdate:!1,shadowProgram:gl.shadowTerrain,throwShadow:new Set([...il.shadowStatic,...il.water]),receiveShadow:il.LG,geometry:t.geometry.terrain,program:gl.terrain});i.frustumCulled=!0,bi(i.position,t.origin),s.addChild(i),i.renderOrder=2e3,i.updateMatrix(),i.updateMatrixWorld()}},wh=(t,e)=>{const s=(e+1)**2,i=e**2,n=new Float32Array(3*s),a=new Float32Array(3*s),r=new Float32Array(2*s),o=new Uint32Array(6*i);let l=0;for(let t=0,s=0;t<=e;++t)for(let i=0;i<=e;++i,++s){if(n[3*s+0]=i,n[3*s+2]=t,r[2*s]=i/e,r[2*s+1]=t/e,i===e||t===e)continue;const a=i+t*(e+1),c=i+(t+1)*(e+1),h=i+(t+1)*(e+1)+1,d=i+t*(e+1)+1;o[6*l]=a,o[6*l+1]=c,o[6*l+2]=d,o[6*l+3]=c,o[6*l+4]=h,o[6*l+5]=d,++l}return{position:{size:3,data:n},jQ:{size:3,data:a},Vx:{size:2,data:r},index:{type:t.UNSIGNED_INT,data:o},Ds:{size:4,data:new Float32Array(4*s)},zk:{size:4,data:new Float32Array(4*s)}}};var kh=Object.freeze({__proto__:null,rebuild:({chunk:t,gl:e,scene:s,info:i})=>{xh(t,e,s);const n=t.geometry.terrain;if(i.heightmap){const e=n.attributes.position.data,s=n.attributes.jQ.data,i=n.attributes.index.data;for(let s=0;s<65;++s)for(let i=0;i<65;++i)e[3*(i+65*s)+1]=t.getHeight(i,s);for(let t=0,e=s.length;t<e;++t)s[t]=0;for(let t=0,n=i.length;t<n;t+=3){const n=3*i[t],a=3*i[t+2],r=3*i[t+1];xi(uh,e[n],e[n+1],e[n+2]),xi(mh,e[a],e[a+1],e[a+2]),xi(ph,e[r],e[r+1],e[r+2]),$i(fh,uh,mh),$i(gh,ph,mh),Pi(vh,fh,gh),s[n]+=vh[0],s[n+1]+=vh[1],s[n+2]+=vh[2],s[a]+=vh[0],s[a+1]+=vh[1],s[a+2]+=vh[2],s[r]+=vh[0],s[r+1]+=vh[1],s[r+2]+=vh[2]}for(let t=0,e=s.length;t<e;t+=3)xi(vh,s[t],s[t+1],s[t+2]),_i(vh,vh),s.set(vh,t);n.updateAttribute(n.attributes.position),n.updateAttribute(n.attributes.jQ)}if(i.texture){const e=n.attributes.Ds.data,s=n.attributes.zk.data;for(let i=0;i<65;++i)for(let n=0;n<65;++n){const a=n+65*i;let r;if(64==i||64==n){const e=t.getNeighborChunk(n,i);if(e&&e.deserialized)r=Vc(e.data.color.readUInt16BE(2*(n%64+i%64*64)));else{const e=Math.min(n,63),s=Math.min(i,63);r=Vc(t.data.color.readUInt16BE(2*(e+64*s)))}}else r=Vc(t.data.color.readUInt16BE(2*(n+64*i)));for(let t=0;t<4;++t)yh(e,4*a+t,t,r),yh(s,4*a+t,t+4,r)}n.updateAttribute(n.attributes.Ds),n.updateAttribute(n.attributes.zk)}},createTerrainGeometry:wh,destroy:({chunk:t,gl:e,scene:s})=>{t.geometry.terrain&&t.geometry.terrain.remove(),t.meshes.terrain&&s.removeChild(t.meshes.terrain)},onWorldParse:({world:t,first:e})=>{const s=t.data.settings.find(t=>"terraintex"===t.id);s&&s.value.split(",").forEach((t,e)=>{_r("terrain/"+t+".jpg",s=>{Sr.terrain[e]=s;const i=cl["tinf"+e];Ki(i.value,dh[t]),i.state++})})}});const $h=[],Sh=[],Ch=(t,e)=>{const s=e**2,i=new Float32Array(3*(e+1)**2),n=new Uint32Array(6*s),a=1/e;let r=0;for(let t=0,s=0;t<=e;++t)for(let o=0;o<=e;++o,++s){if(i[3*s+0]=a*o-.5,i[3*s+2]=a*t-.5,o===e||t===e)continue;const l=o+t*(e+1),c=o+(t+1)*(e+1),h=o+(t+1)*(e+1)+1,d=o+t*(e+1)+1;n[6*r]=l,n[6*r+1]=c,n[6*r+2]=d,n[6*r+3]=c,n[6*r+4]=h,n[6*r+5]=d,++r}return{position:{size:3,data:i},index:{type:t.UNSIGNED_INT,data:n}}};var Mh=Object.freeze({__proto__:null,meshes:Sh,init:()=>{$h[0]=new Oi(Bn,Ch(Bn,64)),$h[1]=new Oi(Bn,Ch(Bn,8)),$h[2]=new Oi(Bn,Ch(Bn,1)),_r("water.jpg",t=>{gl.water.uniforms.bX.value=t,_r("water2.jpg",t=>{gl.water.active=!0,gl.water.uniforms.TJ.value=t})})},onWorldParse:({world:t,first:e})=>{for(let e=0;e<t.data.water.length;++e){let s=Sh[e];const i=t.data.water[e];s||(Sh[e]=s=new vn(Bn,{matrixAutoUpdate:!1,program:gl.water,receiveShadow:il.water}),Nn.addChild(s)),s.data=i,s.geometry=$h[i.PF],s.PF=i.PF,s.speed=i.speed,s.Mj=i.Mj,s.xV=i.xV,s.visibility=i.visibility,s.Ck=ra(i.Ck),s.aX=ra(i.aX),s.Kq=ra(i.Kq),s.renderOrder=5e3;const n=64*t.chunkAmount;0==i.PF?(xi(s.position,.5*n,i.CR[1]/10,.5*n),xi(s.scale,2*n,1,2*n),s.rotation.set(0,0,0)):(xi(s.position,i.CR[0],i.CR[1]/10,i.CR[2]),xi(s.scale,i.sx,1,i.sz),s.rotation.set(0,i.rot/sa,0)),s.position[0]=ia(0,n,s.position[0]),s.position[2]=ia(0,n,s.position[2]),s.updateMatrix()}},onWorldDestroy:({world:t})=>{Sh.forEach(t=>{t.setParent(null)}),Sh.length=0},createWaterGeometry:Ch});let Eh=gi.resolution/100;const _h=new class{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:s=150,dpr:i=1,alpha:n=!1,Ic:a=!0,stencil:r=!1,antialias:o=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:c=!1,powerPreference:h="default",autoClear:d=!0,webgl:u=2,resolution:m=1}={}){const p={alpha:n,Ic:a,stencil:r,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h};this.dpr=i,this.alpha=n,this.color=!0,this.Ic=a,this.stencil=r,this.premultipliedAlpha=l,this.autoClear=d,2===u&&(this.gl=t.getContext("webgl2",p)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",p)||t.getContext("experimental-webgl",p)),this.canvas2dElement=document.createElement("canvas"),this.canvas2dContext=this.canvas2dElement.getContext("2d",{}),this.gl.renderer=this,this.setSize(e,s,m),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.state={},this.state.blendFunc={src:this.gl.ONE,Zu:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.extensions={},this.isWebgl2||(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture")),this.vertexAttribDivisor=this.gl.renderer.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.gl.renderer.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.gl.renderer.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.gl.renderer.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.gl.renderer.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.gl.renderer.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES")}setSize(t,e,s){this.width=Math.round(t*s),this.height=Math.round(e*s),this.gl.canvas.width=this.width*this.dpr,this.gl.canvas.height=this.height*this.dpr,this.canvas2dElement.width=t*this.dpr,this.canvas2dElement.height=e*this.dpr}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,s,i){this.state.blendFunc.src===t&&this.state.blendFunc.Zu===e&&this.state.blendFunc.srcAlpha===s&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=t,this.state.blendFunc.Zu=e,this.state.blendFunc.srcAlpha=s,this.state.blendFunc.dstAlpha=i,void 0!==s?this.gl.blendFuncSeparate(t,e,s,i):this.gl.blendFunc(t,e))}setBlendEquation(t,e){this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,s){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t][s].bind(this.extensions[t]):this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:s,sort:i,shadowTarget:n}){let a=[];e&&s&&e.updateFrustum();const r=[];if(t.traverse(t=>{if(!t.visible)return!0;if(t.draw&&(!n||t.receiveShadow.has(n)||t.throwShadow.has(n))){if(s&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t))return!0;if(t.group){if(r.indexOf(t.group)>=0)return;r.push(t.group)}a.push(t)}}),i){const t=[],s=[],i=[];for(let n=0,r=a.length;n<r;++n){const r=a[n];r.program.transparent?r.program.depthTest?s.push(r):i.push(r):t.push(r),r.zDepth=0,0===r.renderOrder&&r.program.depthTest&&e&&(Gi(Ji,r.Dy),Ti(Ji,Ji,e.kX),r.zDepth=Ji[2])}t.sort(this.sortOpaque),s.sort(this.sortTransparent),i.sort(this.sortUI),a=t.concat(s,i)}return a}render({scene:t,camera:e,target:s=null,update:i=!0,sort:n=!0,frustumCull:a=!0,shadowTarget:r=!1,sceneCamera:o,clear:l=!0}){r&&(s=r),null===s?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),l&&this.autoClear&&(!this.Ic||s&&s.Ic||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.Ic?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0)),this.canvas2dContext.clearRect(0,0,this.canvas2dElement.width,this.canvas2dElement.height)),i&&t.needsFullUpdate&&(t.updateMatrixWorld(),t.needsFullUpdate=!1),e&&null===e.parent&&e.updateMatrixWorld();const c=this.getRenderList({scene:t,camera:e,frustumCull:a,sort:n,shadowTarget:r});for(let t=0,s=c.length;t<s;++t)c[t].draw({camera:e,shadowTarget:r,sceneCamera:o,update:i})}}({width:window.innerWidth,height:window.innerHeight,resolution:Eh,antialias:!1,powerPreference:"high-performance"});_h.isWebgl2||(alert("WebGL2 problem found."),window.location.href="/technical"),hma.graphics.Canvas=_h;const Rh=hma.graphics.Canvas.gl,Ph=new fn(Rh,{fov:80,near:.1,Oq:500}),Th=new dn,Ih=new dn,Dh=new class{constructor(t,{width:e,height:s,dpr:i,wrapS:n=t.CLAMP_TO_EDGE,wrapT:a=t.CLAMP_TO_EDGE,minFilter:r=t.LINEAR,magFilter:o=t.LINEAR,resolution:l=1}={}){this.gl=t,this.options={wrapS:n,wrapT:a,minFilter:r,magFilter:o},this.passes=[],this.geometry=new Oi(t,{position:{size:3,data:new Float32Array([-1,-1,0,3,-1,0,-1,3,0])},Vx:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),this.resize({width:e,height:s,dpr:i,resolution:l})}addPass({vertex:t=Fn,fragment:e=zn,uniforms:s={},textureUniform:i="QV",enabled:n=!0,globalUniforms:a,postDraw:r}={}){s[i]={value:this.target.texture},s.vk={value:this.original.texture},s.Cq={value:this.original.depthTexture};const o=new Li(this.gl,{vertex:t,fragment:e,uniforms:s,globalUniforms:a}),l={mesh:new vn(this.gl,{geometry:this.geometry,program:o}),program:o,uniforms:s,enabled:n,textureUniform:i,postDraw:r};return this.passes.push(l),l}resize({width:t,height:e,dpr:s,resolution:i=1}={}){s&&(this.dpr=s),t&&(this.width=t*i,this.height=e*i),s=this.dpr||this.gl.renderer.dpr,t=(this.width||this.gl.renderer.width)*s,e=(this.height||this.gl.renderer.height)*s,this.options.width=t,this.options.height=e,this.target=new En(this.gl,{depthTexture:!0,...this.options}),this.original=new En(this.gl,{depthTexture:!0,...this.options}),this.ping=new En(this.gl,this.options),this.pong=new En(this.gl,this.options),this.passes.forEach(t=>{t.uniforms.vk={value:this.original.texture},t.uniforms.Cq={value:this.original.depthTexture}})}render({scene:t,camera:e,target:s=null,update:i=!0,sort:n=!0,frustumCull:a=!0}){const r=this.passes.filter(t=>t.enabled);this.gl.renderer.render({scene:t,camera:e,target:r.length?this.original:s,update:i,sort:n,frustumCull:a}),r.forEach((t,e)=>{t.mesh.program.uniforms[t.textureUniform].value=e?e%2?this.ping.texture:this.pong.texture:this.target.texture,this.gl.renderer.render({scene:t.mesh,target:e==r.length-1?s:e%2?this.pong:this.ping}),t.postDraw&&t.postDraw()})}}(Rh,{width:window.innerWidth,height:window.innerHeight,resolution:Eh});let Ah=100,Fh=Ah**2;const zh=[Dr,ll,wl,Fc,Ml,kh,Mh,Kc,ih,$c,ec,Il,jl,$l,hh,so,lh],Bh=()=>{Ih.matrixAutoUpdate=!1,Ih.addChild(Th),Th.addChild(Ph),Th.setParent(null),xi(Ph.position,0,1,-1),Ph.lookAt(Hn,Hn),((t,e,s,i,n,a,r)=>{Bn=Rh,Un=Ph,On=Th,jn=Dh,Ln=_h,Nn=Ih})(),zh.forEach(t=>{t.init&&t.init()}),zh.splice(2,1),zh.push(wl),Rh.clearColor(0,0,0,1),hma.graphics.Canvas.canvas2dElement.className="l-canvas",hma.graphics.Canvas.gl.canvas.className="l-canvas",Rh.canvas.style.pointerEvents="all",window.addEventListener("resize",Uh,!1),hma.graphics.Canvas.resize=Uh,Uh(null,!0)};_e.subscribe(t=>{Fh=(Ah=t**2/10)**2,Ph.Oq=Ah+10,Ph.perspective()}),qt.subscribe(t=>{});const Uh=(t,e)=>{e||(hma.graphics.Canvas.setSize(window.innerWidth,window.innerHeight,Eh),Dh.resize({width:window.innerWidth,height:window.innerHeight,dpr:1,resolution:Eh})),Ph.aspect=Rh.canvas.width/Rh.canvas.height,Ph.perspective(),((t,e)=>{Rn(cl.resolution.value,t,e),cl.resolution.state++})(Rh.canvas.width,Rh.canvas.height)};Re.subscribe(t=>{const e=t/100,s=Eh!==e;Eh=e,gi.resolutionScale=e,s&&Uh(null,!1)});const Oh=({world:t,first:e})=>{zh.forEach(s=>{s.onWorldParse&&s.onWorldParse({world:t,first:e})})},jh=({world:t})=>{zh.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy({world:t})}),(()=>{for(const t in sc)void 0===sc[t]||sc[t].permanent||(sc[t].setParent(null),sc[t]=void 0)})()},Lh=(t,e)=>{zh.forEach(s=>{s.rebuild&&s.rebuild({chunk:t,gl:Rh,scene:Ih,info:e})}),(e.heightmap||e.texture)&&rl(!0)},Nh=t=>{zh.forEach(e=>{e.destroy&&e.destroy({chunk:t,gl:Rh,scene:Ih})})};let qh;Oe.subscribe(async t=>{await fetch(`/assets/loc/${t}.json?v=3406973`).then(async t=>{qh=await t.json(),jt.set(!0)})});const Hh=(t,e)=>qh.items[t]["book"==t?Math.floor(e/5):e],Wh=(t,e)=>Hh(t,e).name+("book"==t?" Lv. "+(e%5+1):""),Qh=(t,e)=>Hh(t,e).description;function Vh(e){let s;return{c(){(s=M("div")).innerHTML='<div class="bounce1 svelte-twvoek"></div><div class="bounce2 svelte-twvoek"></div><div class="bounce3 svelte-twvoek"></div>',T(s,"class","spinner svelte-twvoek")},m(t,e){$(t,s,e)},p:t,i:t,o:t,d(t){t&&S(s)}}}class Gh extends Pt{constructor(t){super(),Rt(this,t,null,Vh,l,{})}}function Yh(t,{delay:s=0,duration:i=400,easing:n=e}){const a=+getComputedStyle(t).opacity;return{delay:s,duration:i,easing:n,css:t=>`opacity: ${t*a}`}}let Xh=.03,Zh=.03;const Jh=t=>{Xh=(5*Xh+ia((qn.tickId-t)*qn.timestep-(1/30+.006),.001,1))/6};let Kh=.016;const td=t=>{Kh=(10*Kh+t)/11};let ed=.016,sd=0;const id=t=>{ed=t},nd=new Dl(0,.05);var ad=Object.freeze({__proto__:null,parseLatencyPacket:Jh,parseFrameDelta:td,parseBandwidth:id,tick:t=>{gi.showFpsPing&&nd.done(qn.time)&&(Zh=(20*Zh+Xh)/21,sd=(10*sd+ed)/11,nd.reset(qn.time),oe.update(t=>(t[0]=ia(1e3*Zh>>0,1,999),t[1]=(1e3/Kh).toFixed(1),t[2]=(sd/1e3).toFixed(1),t)))},onWorldEnter:t=>{nd.reset(t.time)}});let rd,od=0,ld=0;const cd={open:[],close:[]};for(const t in hma.handle.data)cd[hma.handle.data[t].header]=[];const hd=t=>{},dd=t=>{console.log("connection opened"),od=1,window.client.connected=!0;for(let e=0,s=cd.open.length;e<s;++e)cd.open[e](t)},ud=t=>{console.log("connection closed:",t.reason,t.code),od=0,window.client.connected=!1;for(let e=0,s=cd.close.length;e<s;++e)cd.close[e](t)},md=t=>{yd(t.data.byteLength);const e=(t=>{if(0!==t.length)return er[t.readUInt8(0,!1)]})(t=Ua(t.data)),s=e&&cd[e.header];if(s)for(let e=0,i=s.length;e<i;++e)s[e](t)},pd=(t,e)=>{cd[t].push(e)},fd=t=>{window.client.connected&&void 0!==rd&&1===od&&rd.send(t)},_ud=t=>{console.log("connection closed:",t.reason,t.code),od=0,window.client.connected=!1;for(let e=0,s=cd.close.length;e<s;++e)cd.close[e](t)};Client.prototype.connect=dd,Client.prototype.disconnect=_ud;let gd=0,vd=0;const yd=t=>{const e=Hl();vd+=t,e-gd>250&&(ld=4*vd,vd=0,gd=e,id(ld))};function bd(t){let e,s,i,n,a,r,o=(t[1]||"")+"";const l=new Gh({});let c="askReconnect"===t[0]&&xd(t);return{c(){e=M("div"),Mt(l.$$.fragment),c&&c.c(),s=M("h5"),i=E(o),n=E(hma.graphics.ui.status.finding),T(s,"class","version textgrey svelte-qe246z"),T(e,"class","l-ui container svelte-qe246z")},m(t,a){$(t,e,a),Et(l,e,null),c&&c.m(e,null),k(e,s),k(s,i),k(s,n),r=!0},p(t,n){"askReconnect"===t[0]?c?c.p(t,n):((c=xd(t)).c(),c.m(e,s)):c&&(c.d(1),c=null),(!r||2&n)&&o!==(o=(t[1]||"")+"")&&D(i,o)},i(t){r||(vt(l.$$.fragment,t),ot(()=>{a||(a=xt(e,Yh,{},!0)),a.run(1)}),r=!0)},o(t){yt(l.$$.fragment,t),a||(a=xt(e,Yh,{},!1)),a.run(0),r=!1},d(t){t&&S(e),_t(l),c&&c.d(),t&&a&&a.end()}}}function xd(e){let s,i;return{c(){(s=M("div")).textContent="Reconnect",T(s,"class","btn primary reconnect svelte-qe246z"),i=P(s,"click",e[2])},m(t,e){$(t,s,e)},p:t,d(t){t&&S(s),i()}}}function wd(t){let e,s,i=t[0]&&bd(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),vt(i,1)):((i=bd(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function kd(t,e,s){let i,n;h(t,Ee,t=>s(3,i=t)),h(t,Me,t=>s(1,n=t)),V(()=>{"autoReconnect"==r&&(document.hidden?(s(0,r=!0),setTimeout(()=>{s(0,r="autoReconnect")},1e3)):setTimeout(a,1e3))});const a=async()=>{Me.update(t=>!1),s(0,r=!0);try{if(!i)throw null;const t=await fetch("api/user/join",{method:"POST",body:JSON.stringify({id:i})}),e=await t.json();if(!e.world)throw f(Ee,i=0),null;Me.set(e.world)}catch(t){window.location.href="/"}};let{active:r}=e;return t.$set=(t=>{"active"in t&&s(0,r=t.active)}),[r,n,a]}class $d extends Pt{constructor(t){super(),Rt(this,t,kd,wd,o,{active:0})}}function Sd(e){let s;return{c(){F(s=M("div"),"cursor",e[1])},m(t,i){$(t,s,i),e[2](s)},p(t,[e]){2&e&&F(s,"cursor",t[1])},i:t,o:t,d(t){t&&S(s),e[2](null)}}}function Cd(t,e,s){let i,n;return h(t,Yt,t=>s(1,i=t)),G(()=>{n.appendChild(hma.graphics.Canvas.gl.canvas),n.appendChild(hma.graphics.Canvas.canvas2dElement)}),[n,i,function(t){tt[t?"unshift":"push"](()=>{s(0,n=t)})}]}class Md extends Pt{constructor(t){super(),Rt(this,t,Cd,Sd,o,{})}}function Ed(t){let e,s,i,n,a;return{c(){e=M("div"),T(s=M("img"),"class",i=p(t[2].css)+" svelte-120o2pb"),s.src!==(n=t[2].img)&&T(s,"src",n),T(e,"class",a="container border "+t[2].border+" svelte-120o2pb"),F(e,"top",t[1]+"px"),F(e,"left",t[0]+"px")},m(t,i){$(t,e,i),k(e,s)},p(t,r){4&r&&i!==(i=p(t[2].css)+" svelte-120o2pb")&&T(s,"class",i),4&r&&s.src!==(n=t[2].img)&&T(s,"src",n),4&r&&a!==(a="container border "+t[2].border+" svelte-120o2pb")&&T(e,"class",a),2&r&&F(e,"top",t[1]+"px"),1&r&&F(e,"left",t[0]+"px")},d(t){t&&S(e)}}}function _d(e){let s,i=e[2]&&e[0]&&e[1]&&Ed(e);return{c(){i&&i.c(),s=R()},m(t,e){i&&i.m(t,e),$(t,s,e)},p(t,[e]){t[2]&&t[0]&&t[1]?i?i.p(t,e):((i=Ed(t)).c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},i:t,o:t,d(t){i&&i.d(t),t&&S(s)}}}function Rd(t,e,s){let i,n,a;h(t,Gt,t=>s(2,i=t));const r=t=>{(i||n||a)&&(i?(s(0,n=t.clientX-10),s(1,a=t.clientY-10)):(s(0,n=0),s(1,a=0)))};return G(()=>{document.addEventListener("mousemove",r,!1)}),X(()=>{document.removeEventListener("mousemove",r)}),[n,a,i]}class Pd extends Pt{constructor(t){super(),Rt(this,t,Rd,_d,o,{})}}function Td(t,e,s){const i=t.slice();return i[6]=e[s],i}function Id(t){let e,s=t[2].opts,i=[];for(let e=0;e<s.length;e+=1)i[e]=Fd(Td(t,s,e));let n=null;return s.length||(n=Dd()).c(),{c(){e=M("div");for(let t=0;t<i.length;t+=1)i[t].c();T(e,"class","panel context border grey"),F(e,"left",t[2].x+"px"),F(e,"top",t[2].y+"px")},m(s,a){$(s,e,a);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n&&n.m(e,null),t[5](e)},p(t,a){if(5&a){let n;for(s=t[2].opts,n=0;n<s.length;n+=1){const r=Td(t,s,n);i[n]?i[n].p(r,a):(i[n]=Fd(r),i[n].c(),i[n].m(e,null))}for(;n<i.length;n+=1)i[n].d(1);i.length=s.length}s.length?n&&(n.d(1),n=null):n||((n=Dd()).c(),n.m(e,null)),4&a&&F(e,"left",t[2].x+"px"),4&a&&F(e,"top",t[2].y+"px")},d(s){s&&S(e),C(i,s),n&&n.d(),t[5](null)}}}function Dd(t){let e;return{c(){(e=M("div")).textContent="No options",T(e,"class","choice disabled")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Ad(t){let e,s,i;return{c(){e=M("img"),i=_(),T(e,"class","svgicon"),e.src!==(s="/assets/ui/icons/"+t[6].icon+".svg?v=3406973")&&T(e,"src",s)},m(t,s){$(t,e,s),$(t,i,s)},p(t,i){4&i&&e.src!==(s="/assets/ui/icons/"+t[6].icon+".svg?v=3406973")&&T(e,"src",s)},d(t){t&&S(e),t&&S(i)}}}function Fd(t){let e,s,i,n,a=t[6].name+"",r=t[6].icon&&Ad(t);function o(...e){return t[4](t[6],...e)}return{c(){e=M("div"),r&&r.c(),s=E(a),T(e,"class",i="choice "+(t[6].css||"")),n=P(e,"click",o)},m(t,i){$(t,e,i),r&&r.m(e,null),k(e,s)},p(n,o){(t=n)[6].icon?r?r.p(t,o):((r=Ad(t)).c(),r.m(e,s)):r&&(r.d(1),r=null),4&o&&a!==(a=t[6].name+"")&&D(s,a),4&o&&i!==(i="choice "+(t[6].css||""))&&T(e,"class",i)},d(t){t&&S(e),r&&r.d(),n()}}}function zd(e){let s,i=e[2]&&Id(e);return{c(){i&&i.c(),s=R()},m(t,e){i&&i.m(t,e),$(t,s,e)},p(t,[e]){t[2]?i?i.p(t,e):((i=Id(t)).c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},i:t,o:t,d(t){i&&i.d(t),t&&S(s)}}}function Bd(t,e,s){let i,n;h(t,zt,t=>s(2,i=t));const a=t=>{t.target!=n&&t.target.parentNode!=n&&i&&zt.set(void 0)},r=t=>{t.fun(),zt.set(void 0)};return G(()=>{document.addEventListener("pointerdown",a,!1)}),X(()=>{document.removeEventListener("pointerdown",a)}),[r,n,i,a,t=>r(t),function(t){tt[t?"unshift":"push"](()=>{s(1,n=t)})}]}class Ud extends Pt{constructor(t){super(),Rt(this,t,Bd,zd,o,{opt:0})}get opt(){return this.$$.ctx[0]}}const Od=(t,e="")=>{fd(hma.handle.data.clientCommand.packData({command:t,string:e+""}))},jd={partyleave:{},partyinvite:{a:1},partycreate:{},global:{a:1,chat:!0},party:{a:1,chat:!0},clan:{a:1,chat:!0},faction:{a:1,chat:!0}},Ld={itemmove:{a:2},itemdrop:{a:1},itemuse:{a:1},itemauctionpost:{a:2},itemauctionfind:{a:6},itemauctionbuy:{a:1},itemauctioncancel:{a:1},itemstash:{a:1},itemunstash:{a:1},itemsplithalf:{a:1},itemsplitone:{a:1},goldunstash:{a:1},goldstash:{a:1},itemtradersell:{a:1},itemtraderbuy:{a:1},itemblacksmithupgrade:{a:1},statincrease:{a:2},skillremove:{a:1},respawn:{},startqueue:{a:1},stopqueue:{a:1},partyaccept:{a:1},partydecline:{a:1},partykick:{a:1},partylink:{},partysetrole:{a:2},summonaccept:{a:1},whisper:{a:2,chat:!0},...jd},Nd=[0,0,1,1,2,3],qd=(t,e)=>"book"+(void 0!==e?e:"")+Nd[t%5],Hd=(t,e,s)=>`/assets/items/${t}/${"book"==t?qd(e,s):t+e}.${wr}?v=3406973`,Wd=t=>`/assets/ui/skills/${t}.${kr}?v=3406973`,Qd=t=>`/assets/ui/slotbg/${t}.${wr}?v=3406973`,Vd=t=>`/assets/ui/classes/${t}.${wr}?v=3406973`,Gd=t=>`/assets/ui/factions/${t}.${wr}?v=3406973`;function Yd(t){let e,s;return{c(){T(e=M("img"),"class","icon svelte-erbdzy"),e.src!==(s="/assets/ui/icons/gem.svg?v=3406973")&&T(e,"src","/assets/ui/icons/gem.svg?v=3406973")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Xd(e){let s,i,n,a,r,o,l,c,h=e[4]&&Yd();return{c(){s=M("span"),h&&h.c(),i=M("img"),a=E(e[1]),r=_(),o=M("span"),l=E(e[0]),T(i,"class","icon svelte-erbdzy"),i.src!==(n=Vd(e[2]))&&T(i,"src",n),T(s,"class","textwhite"),T(o,"class",c="name textf"+e[3]+" svelte-erbdzy")},m(t,e){$(t,s,e),h&&h.m(s,null),k(s,i),k(s,a),k(s,r),$(t,o,e),k(o,l)},p(t,[e]){t[4]?h||((h=Yd()).c(),h.m(s,i)):h&&(h.d(1),h=null),4&e&&i.src!==(n=Vd(t[2]))&&T(i,"src",n),2&e&&D(a,t[1]),1&e&&D(l,t[0]),8&e&&c!==(c="name textf"+t[3]+" svelte-erbdzy")&&T(o,"class",c)},i:t,o:t,d(t){t&&S(s),h&&h.d(),t&&S(o)}}}function Zd(t,e,s){let{name:i}=e,{level:n}=e,{pclass:a}=e,{faction:r}=e,{sub:o=!1}=e;return t.$set=(t=>{"name"in t&&s(0,i=t.name),"level"in t&&s(1,n=t.level),"pclass"in t&&s(2,a=t.pclass),"faction"in t&&s(3,r=t.faction),"sub"in t&&s(4,o=t.sub)}),[i,n,a,r,o]}hma.chat.commands.list=Ld,hma.chat.commands.pack=Od,hma.chat.channels=jd;class Jd extends Pt{constructor(t){super(),Rt(this,t,Zd,Xd,o,{name:0,level:1,pclass:2,faction:3,sub:4})}}const Kd=(t,e,s,i)=>{window.gtag&&window.gtag("event",t,{event_category:e,event_label:s,value:i})},tu=[30,60,130,260,470,700,1030,1500,2100,2900,3900,5400,7200,9600,12600,17400,23700,31900,42600,58300,78900,106e3,14e4,184e3,247e3,33e4,43e4,56e4,73e4,96e4,125e4,162e4,209e4,268e4,4e6,62e5,97e5,15e6,229e5,325e5,451e5,615e5,827e5,11e7,1203e5],eu=t=>tu[ia(t,1,45)-1],su=Object.keys({onBlock:0,statsStatic:0,statsConvert:0,statsOverride:0,onInterval:0,multiplyIncomingHeal:0,multiplyIncomingDamage:0,addIncomingHeal:0,addIncomingDamage:0,addIncomingCrit:0,afterDamageEnemy:0,beforeDamageEnemy:0,movementOverride:0,incapacitated:0,breakOnCast:0,instantCast:0,onCast:0});class iu{constructor(t){this.id=t.id,this.intervalDuration=t.intervalDuration,this.maxStacks=t.maxStacks,this.passive=t.passive||!1,this.custom=t.custom,this.diminish=t.diminish||!1,this.type=t.type||0,this.tags=t.tags||new Set,su.forEach(e=>{this[e]=t[e]})}onSet(t,e,s){this.tags.forEach(e=>{s.tags.get(e).add(t)}),su.forEach(e=>{this[e]&&s[e].add(t)})}onRemove(t,e,s){this.tags.forEach(e=>{s.tags.get(e).delete(t)}),su.forEach(e=>{this[e]&&s[e].delete(t)})}}class nu extends iu{constructor(t){super(t),this.icon=t.icon||"skills/0",this.visualIncapacitation=t.visualIncapacitation,this.fx=t.fx||{}}}var au=new nu({id:61,passive:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(40+20*t.level)),e.addStat(24,Math.round(200+200*t.level))}});const ru={black:ra(0,0),white:ra(16777215,0),deadgrey:ra(3355443,0),teal:ra(3384995,0),magicblue:ra(3362252,0),paleskin:ra(14267315,0),darkskin:ra(8411481,0),slimegreen:ra(2542694,0),mushgreen:ra(2077529,0),linen:ra(13408614,0),woodbrown:ra(4859433,0),woodbrown2:ra(10250315,0),tealsteel:ra(3358797,.5),darksteel:ra(3355443,.5),greysteel:ra(5066061,.5),blacksteel:ra(988178,.5),leather:ra(4337198,0),emerald:ra(22866,-.1),gold:ra(16751616,1),paper:ra(15129011,0),richpurple:ra(7484623,0),fireorange:ra(14715686,-.7),archergreen:ra(10471258,0),warbrown:ra(15172191,0),bronze:ra(9258571,.5),silver:ra(11527136,.8),shamanblue:ra(3687924,0),mageblue:ra(6607340,0),bone:ra(14535066,.2),bone2:ra(11836267,.2),ice:ra(14610164,-.2),vanguard:ra(2848511,0),bloodlust:ra(14289947,0),pink:ra(16711935,0),warden:ra(14755623,0),evilred:ra(13239043,0),ruby:ra(15733030,1),moss:ra(2925637,.2),rock:ra(5006687,.4),death:ra(3750201,.8)},ou=[ru.woodbrown,ru.bronze,ru.greysteel,ru.silver,ru.gold],lu=t=>t>=90?["purp","epic"]:t>=70?["blue","rare"]:t>=50?["green","uncommon"]:["white","common"],cu=function(t,e,s){e%10==0&&t.particle(s,Ar(-20,20),Ar(-20,0),Ar(-20,10),0,.3,0)},hu={cityAmbience:{permanent:!0,fj:{Jm:[.6,.3,.1],size:5e3}},mysticAmbience:{permanent:!0,fj:{Jm:[0,.6,0],size:5e3},tick:function(t){cu(this,this.frame,Ll.floaterGreen)}},evilAmbience:{permanent:!0,fj:{Jm:[.6,0,0],size:5e3},tick:function(t){cu(this,this.frame,Ll.floaterRed)}},oceanAmbience:{permanent:!0,sound:{loop:!0,parent:!0,id:"ambient_ocean",distance:100}},campfire:{permanent:!0,fj:{dynamic:!0,Jm:[2.5,1.8,.3]},sound:{loop:!0,parent:!0,id:"fireloop",distance:12},tick:function(t,e){if(this.time>.1/this.transform.parent.scale[1]**2){this.time=0;const t=Ar(0,.4),e=this.particle(Ll.fire,Ar(-t,t),Ar(-.8,-.2),Ar(-t,t));e&&xi(e.vel,0,.6*this.transform.parent.scale[1]-t,0)}this.fj.val[3]=30+Math.sin(t/600)*Math.sin(t/50)*5}},torch:{permanent:!0,fj:{dynamic:!0,Jm:[1,.8,.4,500]}},mystical01:{permanent:!0,fj:{Jm:[.1,1.4,2],size:400,dynamic:!0},sound:{loop:!0,parent:!0,id:"mysticalSound",distance:14},tick:function(t,e){this.frame%3==0&&this.particle(Ll.mystical,0,0,0),ki(this.transform.position,this.origin,[3*Math.sin(t/600),1*Math.sin(t/400),3*Math.cos(t/600)]),this.transform.rotation[1]=t/600,this.transform.updateMatrixWorld(!0)}},meleeFlash:{time:-.3,timeout:1,fj:{Jm:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=.8*Math.sin(8*Math.max(0,Math.min(.39,2*this.time-.2)));if(tn(this.fj.val,s,s,s,100),this.fraction(.2,e)){for(let t=0;t<3*this.lod;++t)this.particle(Ll.meleeFlash,Ar(-.1,.1),.5,0);this.creature.transform.addPushBack(this.dir,4)}}},meleePhys:{time:-.3,timeout:1,tick:function(t,e){if(this.fraction(.2,e)){Yr({transform:this.transform,delay:.1,id:"impact_flesh",rnd:3,distance:5});for(let t=0;t<4*this.lod;++t){const t=Ar(0,1);xi(Qn,Ar(5*-t,5*t),10,Ar(5*-t,5*t)),Ci(Qn,Qn,this.dir,-8),this.particle(Ll.meleePhys,Ar(-.1,.1),.5,Ar(-.1,.1),Qn[0],Qn[1],Qn[2])}}}},meleeSlash:{time:-.4,timeout:.01,tick:function(t,e){if(0===this.frame){this.creature.transform.addPushBack(this.dir,4);for(let t=0;t<8*this.lod;++t){const t=Ar(0,1);xi(Qn,Ar(3*-t,3*t),Ar(0,10),Ar(3*-t,3*t)),Ci(Qn,Qn,this.dir,-2),this.particle(Ll.blood,Ar(-.2,.2),0,Ar(-.2,.2),Qn[0],Qn[1],Qn[2])}}}},arrowImpact:{timeout:1,fj:{Jm:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=.8*Math.sin(8*Math.max(0,Math.min(.39,2*this.time-.2)));if(tn(this.fj.val,s,s,s,100),this.fraction(.2,e)){for(let t=0;t<3*this.lod;++t)this.particle(Ll.meleeFlash,Ar(-.1,.1),.5,0);this.creature.transform.addPushBack(this.dir,4)}}},arrowPreciseImpact:{timeout:1,fj:{Jm:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=.8*Math.sin(8*Math.max(0,Math.min(.39,2*this.time-.2)));if(tn(this.fj.val,s,s,s,100),this.fraction(.2,e)){for(let t=0;t<3*this.lod;++t)this.particle(Ll.meleeFlashBig,Ar(-.1,.1),.5,0);this.creature.transform.addPushBack(this.dir,4)}}},physBlock:{time:-.3,timeout:.5,fj:{Jm:[1,1,1],size:0,dynamic:!0},tick:function(t,e){const s=this.time>.2?8*Math.max(0,.5-this.time):0;if(tn(this.fj.val,s,s,s,500),this.fraction(0,e)&&Yr({delay:.2,distance:5,id:"block",transform:this.transform}),this.fraction(.2,e)){this.particle(Ll.blockCircle);for(let t=0;t<5*this.lod;++t)this.particle(Ll.blockFlick,0,0,0,Ar(-20,20),Ar(5,10),Ar(-20,20));this.creature.transform.addPushBack(this.dir,4)}}},potionConsume:{timeout:2,tick:function(t,e){this.frame%20==0&&(this.particle(Ll.healHolySoft,0,.5,0,Ar(-1,1),Ar(.1,.3),Ar(-1,1)),this.particle(Ll.healHolySparkle,Ar(-1,1),Ar(.1,.3),Ar(-.9,.9)))}},blockBuff:{particles:{amount:4,info:Ll.blockBuffShield},tick:function(t,e){this.fraction(.1,e)&&this.particle(Ll.blockBuffFocus),this.particles.forEach((e,s)=>{const i=1.55*s+t/500;this.localize(e.CR,1.3*Math.sin(i),0,1.3*Math.cos(i))})}},iceBlockBuff:{mesh:{id:"character/spike.ho",color:[.7,1,1,-.5],scale:[.4,.4,.2],CR:[1.3,0,0],rot:[.5*Math.PI,0,0]},particles:{amount:1,info:Ll.iceglare},tick:function(t,e){const s=t/400;this.transform.rotation.set(0,-s,0),this.particles.forEach((t,e)=>{this.localize(t.CR,1.3*Math.cos(s-this.transform.parent.rotation[1]),0,1.3*Math.sin(s-this.transform.parent.rotation[1]))})}},healOnBlockBuff:{particles:{amount:1,info:Ll.holyShield},tick:function(t,e){0!==this.particles.length&&this.localize(this.particles[0].CR,0,.5,0,0,.5+.05*Math.sin(t/200))}},blockEnrageBuff:{tick:function(t,e){this.time>.5/Math.min(10,this.buff.stacks)&&(this.time=0,this.particle(Ll.blockBuffEnrage,Ar(-1,1),0,Ar(-1,1)))}},temperBuff:{tick:function(t,e){0===this.frame&&Yr({distance:5,id:"warrior/temperbuff",transform:this.transform.parent,dynamic:!0}),this.particle(Ll.dust,Ar(-1,1),0,Ar(-1,1))}},temperBoostBuff:{ribbon:{steps:3,interval:.5,timer:3,permanent:!0,a:[0,.5,-.5],b:[0,-.5,-.5],Aj:[1,.2,.1,.8],Ss:[1,.2,.1,0]},tick:function(t,e){0===this.frame&&(this.particle(Ll.iceFlash),Yr({distance:7,id:"warrior/temperboostbuff",transform:this.transform.parent,dynamic:!0}),du(this,7,30,Ll.dust)),this.frame%10==0&&this.particle(Ll.blockFlick,Ar(-1,1),0,Ar(-1,1))}},crescentStrike:{fj:{Jm:[1,1,1],size:0,dynamic:!0},timeout:.5,tick:function(t,e){this.fraction(.1,e)&&this.transform.parent.weapon&&(this.transform.setParent(this.transform.parent.weapon),this.transform.position[1]=.8);const s=Math.sin(this.time*Math.PI*.5);if(tn(this.fj.val,.9*s,0,0,300),this.fraction(.01,e,this.time%.1)){const t=this.particle(Ll.crescentStrike,Ar(-1,1),Ar(.1,.3),Ar(-1,1));t&&Di(t.vel,[-5,0,0],this.creature.transform.rotation[1]+this.creature.transform.chest.rotation[1])}}},levelUp:{fj:{Jm:[1,1,1],size:0,dynamic:!0},timeout:2,sound:{distance:5,id:"levelup",parent:!0},tick:function(t,e){const s=2*Math.sin(this.time*Math.PI*.5);tn(this.fj.val,.9*s,s,.7*s,200),this.fraction(.1,e)&&du(this,8,5,Ll.levelUp)}},icebolt:{ribbon:{steps:3,interval:.4,timer:15,a:[-.2,0,0],b:[.2,0,0],Aj:[1,1,2.5,1.5],Ss:[0,.2,1,0]},mesh:{id:"character/spike.ho",color:[1.5,1.5,2,-.3],scale:[.4,.4,.4],CR:[0,0,0]},tick:function(t,e){this.frame%1==0&&(this.particle(Ll.iceBig,Ar(-.15,.15),Ar(-.15,.15),0),Math.random()<.4&&this.particle(Ll.snowflake,Ar(-.3,.3),Ar(-.3,.3),0))}},icicle:{fj:{Jm:[.2,.5,1.5],size:100,dynamic:!0},mesh:{id:"rocks/rock_02.ho",color:[1.5,2,1.5,-.3],scale:[.8,.8,.8],CR:[0,0,0]},tick:function(t,e){0===this.frame&&Yr({distance:5,id:"mage/iciclecast",transform:this.transform,dynamic:!0}),this.transform.rotation.set(0,t/150,0),this.transform.updateMatrixWorld(!0),this.frame%2==0&&du(this,5,10,Ll.icicle,void 0,this.transform.rotation[1])}},icecast:{tick:function(t,e){this.frame%5==0&&this.particle(Ll.iceBig,Ar(-.2,.2),Ar(-.2,.2),Ar(-.2,.2))}},iceimpact:{timeout:.001,tick:function(t,e){if(0===this.frame){for(let t=0;t<20*this.lod;++t){const t=this.particle(Ll.snowflake,Ar(-.4,.4),Ar(-.4,.4),Ar(-.4,.4)),e=Ar(8,10);t&&xi(t.vel,Ar(-e,e)-10*this.dir[0],Ar(-5,e)-10*this.dir[1],Ar(-e,e)-10*this.dir[2])}Yr({distance:5,id:"mage/iceimpact1",transform:this.transform}),this.creature.transform.addPushBack(this.dir,4)}}},icicleImpact:{timeout:.001,tick:function(t,e){if(0===this.frame){for(let t=0;t<20*this.lod;++t){const t=this.particle(Ar(0,1)<.5?Ll.iceBig:Ll.snowflake,Ar(-.4,.4),Ar(-.4,.4),Ar(-.4,.4)),e=Ar(5,10);t&&Ci(t.vel,[Ar(-e,e),Ar(0,3),Ar(-e,e)],this.dir,-1)}Yr({distance:8,id:"mage/iciclehit",rnd:2,transform:this.transform}),this.creature.transform.addPushBack(this.dir,8)}}},arrow:{ribbon:{steps:3,interval:.2,timer:15,a:[-.07,0,-.6],b:[.07,0,-.6],Aj:[1,1,1,2],Ss:[1,1,1,0]},mesh:{id:"character/arrow.ho",color:ru.woodbrown,scale:[.35,.35,.35]}},precisearrow:{ribbon:{steps:3,interval:.2,timer:15,a:[-.15,0,-.7],b:[.15,0,-.7],Aj:[1,1,.5,2],Ss:[1,1,.5,0]},mesh:{id:"character/arrow.ho",color:ru.white,scale:[.6,.6,.6]},tick:function(t,e){this.particle(Ll.precisesparcle)}},swiftarrow:{ribbon:{steps:3,interval:.2,timer:15,a:[-.06,0,-.7],b:[.06,0,-.7],Aj:[.3,.7,1,2],Ss:[.3,.7,1,0]},mesh:{color:ru.ice,id:"character/arrow.ho",scale:[.4,.4,.4]},tick:function(t,e){this.frame%2==0&&this.particle(Ll.teleportSparkle)}},naturecast:{tick:function(t,e){this.frame%10==0&&(this.particle(Ll.healNatureBig,Ar(-.5,.5),Ar(-.5,.5),Ar(-.5,.5)),Math.random()<.4&&this.particle(Ll.healNatureSparkle,Ar(-.7,.7),Ar(-.3,.7),Ar(-.7,.7)))}},natureHealOneshot:{timeout:1,tick:function(t,e){this.fraction(.01,e)&&(Yr({distance:3,id:"shaman/mendImpact",transform:this.transform.parent}),du(this,5,5,Ll.healNatureBig)),this.fraction(.05,e,this.time%(.05*this.time+.05))&&(this.particle(Ll.healNatureBig,Ar(-1,1),Ar(.1,.3),Ar(-1,1)),this.particle(Ll.healNatureSparkle,Ar(-1,1),Ar(.1,.3),Ar(-1,1)))}},revitalize:{ribbon:{steps:10,interval:.06,timer:5,permanent:!0,a:[1,0,0],b:[1.5,0,0],repeat:1,Aj:[.1,1,.8,0],Ss:[.3,1,.5,1.1]},sound:{distance:2,id:"shaman/revitalizeBuff",parent:!0},tick:function(t,e){this.transform.rotation.set(.6*Math.cos(t/200),t/130,.6*Math.sin(t/243)),this.frame%10==0&&(this.particle(Ll.healNatureBig,Ar(.9,1.6),Ar(-.1,.1),Ar(-.1,.1)),Math.random()<.4&&this.particle(Ll.healNatureSparkle,Ar(.9,1.6),Ar(-.1,.1),Ar(-.1,.1)))}},serpentBuff:{tick:function(t,e){0===this.frame&&this.particle(Ll.serpentBuffFocus),this.frame%3==0&&this.particle(Ll.serpentBuff,Math.sin(t/300),.3*Math.sin(t/100),Math.cos(t/300))}},bleedDebuff:{particles:{amount:3,info:Ll.bloodFloat},tick:function(t,e){this.particles.forEach((e,s)=>{const i=2*s+t/1e3;this.localize(e.CR,Math.sin(i),.3,Math.cos(i))})}},invigorateBuff:{particles:{amount:1,info:Ll.invigorateBuff},tick:function(t,e){this.particles.length>0&&this.localize(this.particles[0].CR,0,.5,0,0,.5+.1*Math.sin(t/100))}},hypothermicBuff:{particles:{amount:1,info:Ll.hypothermicBuff},tick:function(t,e){0===this.frame&&this.particle(Ll.iceFlash),this.particles.length>0&&this.localize(this.particles[0].CR,0,.5,0,0,.5+.1*Math.sin(t/100))}},gainMana:{timeout:.3,tick:function(t,e){this.frame%3==0&&this.particle(Ll.manaGain,Ar(-1,1),Ar(.1,.3),Ar(-.9,.9))}},gainHealth:{timeout:.3,tick:function(t,e){this.frame%3==0&&this.particle(Ll.healHolySparkle,Ar(-1,1),Ar(.1,.3),Ar(-.9,.9))}},decay:{particles:{amount:1,info:Ll.decay},sound:{distance:5,id:"shaman/decayOnBuff",parent:!0},tick:function(t,e){this.frame%7==0&&this.particle(Ar(0,1)<.5?Ll.decaySoft:Ll.skulls,Ar(-1,1),Ar(-.3,.5),Ar(-1,1)),0!==this.particles.length&&this.localize(this.particles[0].CR,0,0,0,0,1)}},decayImpact:{timeout:.001,tick:function(t,e){0===this.frame&&(du(this,5,5,Ll.skulls),Yr({distance:5,id:"shaman/decayHit",transform:this.transform}),this.creature.transform.addPushBack(this.dir,4))}},poisonImpact:{timeout:.001,tick:function(t,e){0===this.frame&&(du(this,5,5,Ll.poison),Yr({distance:5,id:"shaman/decayHit",transform:this.transform}),this.creature.transform.addPushBack(this.dir,4))}},manaBuff:{particles:{amount:3,info:Ll.mimir},tick:function(t,e){0===this.frame&&du(this,5,5,Ll.manaGain),this.particles.forEach((e,s)=>{const i=t/600+.3*Math.sin(s+t/300);this.localize(e.CR,1.2*Math.sin(i),.2*Math.sin(3*i),1.2*Math.cos(i),0,.2)})}},courageBuff:{particles:{amount:1,info:Ll.courage},tick:function(t,e){0===this.frame&&this.particle(Ll.courageFlash),this.particles.length>0&&this.localize(this.particles[0].CR,.9*Math.sin(qn.smoothtime),.3,.9*Math.cos(qn.smoothtime))}},warcryBuff:{particles:{amount:1,info:Ll.warcry},tick:function(t,e){if(0===this.frame&&this.particle(Ll.warcryFlash),this.particles.length>0){const t=qn.smoothtime+3;this.localize(this.particles[0].CR,.9*Math.sin(t),.3,.9*Math.cos(t))}}},icenova:{timeout:.001,tick:function(t,e){0===this.frame&&(this.particle(Ll.iceFlash),du(this,15,20,Ll.icenova),du(this,12,20,Ll.snowflake),Yr({delay:.1,distance:5,id:"mage/icenovacast",transform:this.transform.parent}))}},icenovaroot:{mesh:{id:"hordes.io/engine/dome.ho",color:ru.ice,scale:[2,2,2],CR:[0,-.9,0]},tick:function(t,e){0===this.frame&&(du(this,8,15,Ll.snowflake),Yr({delay:Ar(.2,.4),distance:5,id:"mage/icenovafreeze",transform:this.transform.parent}))}},deepfrozen:{mesh:{id:"character/spike.ho",color:ru.ice,scale:[1.5,1.5,.7],CR:[0,-.5,0],rot:[1.54,0,0]},tick:function(t,e){0===this.frame&&(du(this,8,10,Ll.frostflake),Yr({delay:Ar(.2,.4),distance:5,id:"mage/deepfreezebuff",transform:this.transform.parent}))}},frozen:{tick:function(t,e){0===this.frame&&(du(this,5,6,Ll.frostflake),Yr({delay:Ar(.2,.4),distance:5,id:"mage/icenovafreeze",transform:this.transform.parent}))}},enchantment:{particles:{amount:4,info:Ll.enchant},tick:function(t,e){0===this.frame&&this.particle(Ll.enchantFlash),this.transform.parent.hands&&this.transform.parent.hands[0].visible?this.particles.forEach((t,e)=>{Gi(t.CR,this.transform.parent.hands[e%2].Dy);const s=.7*e+qn.smoothtime;t.CR[0]+=.15*Math.sin(s),t.CR[2]+=.15*Math.cos(s)}):this.particles.forEach(wc)}},arcticaura:{particles:{amount:2,info:Ll.arcticaura},tick:function(t,e){0===this.frame&&this.particle(Ll.arcticFlash),this.particles.forEach((t,e)=>{t.Tf=Math.sin(qn.smoothtime);const s=3*e+qn.smoothtime;this.localize(t.CR,.15*Math.sin(s),.5,.15*Math.cos(s))})}},pathfinding:{ribbon:{steps:5,interval:.25,timer:5,permanent:!0,a:[0,.5,-.5],b:[0,-.5,-.5],Aj:[1,1,1,.8],Ss:[1,1,1,0]},tick:function(t,e){this.frame%5==0&&this.frame<20&&this.particle(Ll.pathfindFlash),0===this.frame&&(this.ribbon.parent=this.transform.parent.chest||this.transform.parent)}},temporaldilation:{particles:{amount:2,info:Ll.temporal},tick:function(t,e){this.frame%5==0&&this.frame<20&&this.particle(Ll.temporalFlash),this.particles.forEach((t,e)=>{t.Tf=Math.sin(qn.smoothtime);const s=3*e+3*qn.smoothtime;this.localize(t.CR,Math.sin(s),.2,Math.cos(s))})}},caninehowl:{particles:{amount:1,info:Ll.canine},tick:function(t,e){0===this.frame&&this.particle(Ll.canineFlash),0!==this.particles.length&&this.localize(this.particles[0].CR,0,0,0,0,.6)}},poisonarrows:{sound:{distance:5,id:"shaman/decayOnBuff",parent:!0},tick:function(t,e){this.frame%7==0&&this.particle(Ar(0,1)<.5?Ll.poisonSoft:Ll.poison,Ar(-1,1),Ar(-.3,.5),Ar(-1,1))}},healingtotem:{fj:{Jm:[.8,1.5,.5],size:300,dynamic:!0},mesh:{id:"misc/misc_palisade_solo.ho",color:ru.woodbrown,scale:[.4,.6,.4],CR:[0,-.8,0]},tick:function(t,e){if(this.frame%10==0&&this.particle(Ll.healHolySoft,Ar(-5,5),Ar(.1,.3),Ar(-5,5)),this.frame%5){const e=t/300,s=this.particle(Ll.totemfloater,10*Math.cos(e),1,10*Math.sin(e));s&&(s.CR[1]=qn.getHeight(s.CR[0],s.CR[2])+1)}}},gainHealthTotem:{timeout:.1,tick:function(t,e){this.frame%3==0&&this.particle(Ll.healNatureBlink,Ar(-.8,.8),Ar(.1,.3),Ar(-.8,.8))}},teleport:{timeout:.001,tick:function(t,e){if(0===this.frame){this.particle(Ll.teleportFlash);for(let t=0;t<3;++t)this.particle(Ll.teleportSparkle,Ar(-.6,.6),1,Ar(-.6,.6));Yr({delay:.1,distance:5,id:"mage/teleportcast",transform:this.transform.parent})}}},stunned:{sound:{loop:!1,parent:!0,id:"stundebuff",distance:10},particles:{amount:3,info:Ll.stun},tick:function(t,e){this.particles.forEach((e,s)=>{const i=2*s+t/250;this.localize(e.CR,1.2*Math.sin(i),.2,1.2*Math.cos(i),0,.2,0)})}},dazed:{sound:{loop:!1,parent:!0,id:"stundebuff",distance:10},particles:{amount:3,info:Ll.daze},tick:function(t,e){this.particles.forEach((e,s)=>{const i=2*s+t/350;this.localize(e.CR,.8*Math.sin(i),.2,.8*Math.cos(i),0,.2,0)})}},charge:{sound:{loop:!1,parent:!0,id:"warrior/chargecast",distance:9},ribbon:{steps:5,interval:.25,timer:5,permanent:!0,a:[-.5,0,-.5],b:[.5,0,-.5],Aj:[2,1.5,.5,1.2],Ss:[2,.8,1,0]},tick:function(t,e){this.frame%5==0&&this.particle(Ll.chargeFlash)}},taunt:{timeout:.8,tick:function(t,e){if(this.frame%10==0&&this.particle(Ll.tauntFlash),0===this.frame){for(let t=0;t<2*Math.PI;t+=ca/10){const e=Math.sin(t),s=Math.cos(t);Zl(Ll.tauntsparkle,void 0,this.transform.parent.position[0]+10*e,this.transform.parent.position[1],this.transform.parent.position[2]+10*s,-50*e,0,-50*s,!1)}Yr({delay:.05,distance:8,id:"warrior/tauntcast",transform:this.transform.parent})}}},transformation:{tick:function(t,e){if(0===this.frame){this.particle(Ll.teleportFlash);for(let t=0;t<8;++t)this.particle(Ll.teleportSparkle,0,0,0,Ar(-5,5),Ar(-5,5),Ar(-5,5))}this.frame%20==0&&(this.particle(Ll.transformationAura,0,0,this.transform.parent.entity?1.5*this.transform.parent.entity.steer[1]:0),this.particle(Ll.transformSoft,0,0,3*this.transform.parent.entity.steer[1]))}},snipe:{sound:{loop:!1,parent:!0,id:"archer/snipeCast",delay:.2,distance:7},particles:{amount:1,info:Ll.snipe},tick:function(t,e){0!==this.particles.length&&(this.frame%3==0&&this.time<.3&&this.particle(Ll.dust,Ar(-.3,.3),Ar(-.3,.3),0),this.transform.parent.hands&&this.transform.parent.hands[1].visible?Gi(this.particles[0].CR,this.transform.parent.hands[1].Dy):wc(this.particles[0]))}},etherwyrm:{tick:function(t,e){this.frame%7==0&&this.particle(Ll.etherglow,Ar(-.8,.8),Ar(-.3,.5),Ar(-.8,.8))}},shadowwyrm:{tick:function(t,e){this.frame%7==0&&this.particle(Ll.shadowglow,Ar(-1,1),Ar(-.3,.5),Ar(-1,1))}},burning:{tick:function(t,e){this.frame%4==0&&this.particle(Ll.fire,Ar(-1,1),Ar(-.3,.5),Ar(-1,1))}},postsummon:{sound:{loop:!1,parent:!0,id:"magic/summonaccept",delay:.05,distance:7},tick:function(t,e){0===this.frame&&(this.particle(Ll.summonFlash,0,0,0),du(this,10,8,Ll.summonSparkle)),this.frame%10==0&&this.particle(Ll.summonSparkle,Ar(-.3,.3),Ar(-.3,.5),Ar(-.3,.3))}},purplecast:{tick:function(t,e){this.frame%10==0&&this.particle(Ll.summonSparkle,Ar(-.2,.2),Ar(-.2,.2),Ar(-.2,.2))}}},du=(t,e,s,i,n=[0,0,0],a=0)=>{for(let r=0;r<2*Math.PI;r+=ca/e)t.particle(i,n[0],n[1],n[2],Math.sin(r+a)*s,0,Math.cos(r+a)*s)};var uu=new nu({id:42,icon:"skills/2",fx:{stick:hu.blockBuff,startSound:{id:"warrior/buffBlock",distance:5}},statsStatic:(t,e)=>{e.addStat(13,300+40*t.level)},onBlock:(t,e)=>({id:43,mode:5,stacks:1,duration:8,caster:e.id,target:e.id,refresh:!0,level:t.level})}),mu=new nu({id:43,maxStacks:8,icon:"skills/buffBlock",fx:{stick:hu.blockEnrageBuff},statsStatic:(t,e)=>{e.addStat(23,t.stacks*(2*t.level+2))}}),pu=new nu({id:71,incapacitated:!0,icon:"skills/33",fx:{stick:hu.charge,endSound:{id:"warrior/chargeimpact",distance:10}},statsOverride:(t,e)=>{e.stat.set(15,250)},movementOverride:(t,e,s,i,n)=>{}}),fu=new nu({id:60,icon:"skills/20",fx:{stick:hu.courageBuff,startSound:{id:"warrior/couragecast",distance:5}},diminish:!0,statsStatic:(t,e)=>{e.addStat(12,Math.round(t.level**1.2*15*t.diminishFactor))}}),gu=new nu({id:57,passive:!0,icon:"skills/17",custom:[[t=>93+32*t,"% as additional damage over 10 seconds"]],afterDamageEnemy:{3:(t,e,s)=>{}}}),vu=new nu({id:58,type:1,tags:new Set([1]),maxStacks:3,icon:"skills/18",fx:{effectDirImpact:[hu.meleeSlash],stick:hu.bleedDebuff,color:[.7,.1,.1,.5]},intervalDuration:1.5,onInterval:(t,e,s)=>({id:18,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,noDaze:!0,type:1})}),yu=new nu({id:56,icon:"skills/17",fx:{stick:hu.healOnBlockBuff,stickOffset:.5,startSound:{id:"warrior/healOnBlockCast",distance:5}},onBlock:(t,e)=>({id:17,mode:2,caster:t.caster,target:e.id,heal:7+14*t.level})}),bu=new nu({id:45,passive:!0,icon:"skills/8",statsConvert:[[0,.3,10],[0,.3,11],[0,.1,8]]}),xu=new nu({id:73,incapacitated:!0,type:1,visualIncapacitation:!0,icon:"skills/34",fx:{stick:hu.stunned,stickOffset:.5},statsOverride:(t,e)=>{e.stat.get(15)>30&&e.stat.set(15,30)},movementOverride:(t,e,s,i,n)=>{}}),wu=new nu({id:90,maxStacks:3,icon:"skills/temperBoostBuff",fx:{stick:hu.temperBoostBuff,color:[.2,.2,.25,.95],norefresh:!0},statsStatic:(t,e)=>{e.addStat(15,20)}}),ku=new nu({id:89,maxStacks:3,tags:new Set([3,4]),icon:"skills/41",fx:{stick:hu.temperBuff,color:[.1,.1,.1,.92],norefresh:!0},statsStatic:(t,e)=>{e.addStat(25,25*t.stacks)},intervalDuration:.5,onInterval:(t,e,s)=>!0}),$u=new nu({id:59,icon:"skills/19",fx:{stick:hu.warcryBuff,startSound:{id:"warrior/warcrycast",distance:5}},diminish:!0,statsStatic:(t,e)=>{e.addStat(10,Math.round(3*t.level*t.diminishFactor)),e.addStat(11,Math.round(4*t.level*t.diminishFactor))}});class Su extends dn{constructor(t){super(),this.sounds=t.sounds||{},this.entity=t.entity,this.cycleOne=Math.random(),this.cycleRad=Ar(0,1),this.cycleSin=0,this.speed=1,this.meshes=[],this.lastFlags=0,this.deathTimer=new Dl(0,3),this.hurtSoundTimer=new Dl(0,5),this.idleSoundTimer=new Dl(qn.time+Ar(0,20),20),this.pushBack=[0,0],this.pushBackVel=[0,0],this.pushBackOffset=[0,0],this.cDist=0,this.animQueue=[],this.currentAnim=void 0,this.walking=!0,this.falling=!1,this.tickTimer=new Dl(0,1),this.needsColorUpdate=!1,this.colors=new Set,this.hasDied=!1,this.effects=[]}cycle(t){return 0==t?this.cycleSin:Math.sin(this.cycleRad+2*t*Math.PI)}checkCycleReset(t){t!=this.lastFlags&&(this.cycleOne=0),this.lastFlags=t}addPushBack(t,e){this.cDist<50&&(this.pushBackVel[0]-=t[0]*e/this.entity.size,this.pushBackVel[1]-=t[2]*e/this.entity.size)}tickPushBack(t,e,s){this.cDist<50&&(In(this.pushBackVel,this.pushBackVel,this.pushBack,1500*-t/this.entity.size),Tn(this.pushBackVel,this.pushBackVel,.7),In(this.pushBack,this.pushBack,this.pushBackVel,t),function(t,e,s){const i=Math.sin(s),n=Math.cos(s);t[0]=e[1]*i+e[0]*n,t[1]=e[1]*n-e[0]*i}(this.pushBackOffset,this.pushBack,-this.entity.rot))}updateVisibility(){const t=void 0!==this.entity.mount?1/0:Math.min(120,.7*Un.Oq);return this.cDist=Mi(this.position,Un.worldPosition),this.cDist<t&&Un.frustumIntersectsSphere(this.entity.visualPosition,this.scale[1])?(this.meshes.forEach(e=>{e.visible=void 0!==e.geometry&&(!e.parent||e.parent.visible)&&(!e.geometry.bounds.initiated||this.cDist/(e.geometry.bounds.radius*e.data.lod*this.entity.size)<t)}),this.visible=!0,!0):(this.visible&&(this.visible=!1,this.meshes.forEach(t=>t.visible=!1)),!1)}tick(t,e,s){this.updateVisibility()&&(this.needsColorUpdate&&this.colorUpdate(),void 0===this.entity.stats||this.entity.stats.alive?(this.cycleOne=(this.cycleOne+this.speed*t)%1,this.cycleRad=this.cycleOne*Math.PI*2,this.cycleSin=Math.sin(this.cycleRad),this.tickAnimations(t),void 0!==this.sounds.idle&&this.idleSoundTimer.done(e)&&Math.random()<.08&&(this.playSound(this.sounds.idle),this.idleSoundTimer.reset(s.time)),this.falling=this.falling&&!this.entity.onGround||!this.falling&&!this.onGround&&Math.abs(this.entity.vel[1])>6,this.walking=0!=this.entity.steer[0]||0!=this.entity.steer[1],this.tickParts(t,e,s)):this.tickDeath(t,e,s),this.tickOverrides(t,e,s),this.updateMatrixWorld(!0))}tickAnimations(t){if(this.currentAnim=this.animQueue[0],this.currentAnim){const e=this.currentAnim.time;this.currentAnim.time+=this.animQueue.length*t,this.currentAnim.sounds&&this.currentAnim.sounds.forEach(t=>{e<t.delay&&this.currentAnim.time>t.delay&&Yr({loop:!1,transform:this,...t})}),this.currentAnim.fract=this.currentAnim.time/this.currentAnim.duration,this.currentAnim.time>this.currentAnim.duration&&(this.currentAnim.fract=1,this.currentAnim.loop||this.currentAnim.stop||this.animQueue.shift(),this.currentAnim.loop&&(this.currentAnim.time-=this.currentAnim.duration)),this.currentAnim.anticipate=oa.anticipate(this.currentAnim.fract)}}fraction(t,e,s=this.cycleOne){return s>=t&&s-this.speed*e<t}mesh(t,e,s,i,n){const a=ic({geo:e||"hordes.io/engine/cube.ho",program:n||gl.multimeshFlat,ts:!0,rs:!1,dynamic:!0,frustum:!1,...i});return a.data.lod=1,a.visible=!1,void 0!==s&&this.changeMeshBaseColor(a,s),null!==t&&a.setParent(t||this),this.meshes.push(a),a}removeMesh(t,e){t.setParent(null),t.data.multi.remove(t),e&&this.meshes.splice(this.meshes.indexOf(t),1)}onRemove(){this.meshes.forEach(t=>{this.removeMesh(t,!1)}),this.meshes.length=0,this.effects.forEach(t=>{t.data.remove=!0}),this.setParent(null)}anim(t){this.visible&&(this.animQueue.push({id:t.id,duration:t.dur,time:0,fract:0,sounds:t.sounds,stop:t.stop||!1,loop:t.loop||!1}),this.animQueue.length>5&&this.animQueue.shift())}clearAnims(){this.animQueue.length=0}playSound(t,e=5){Yr({loop:!1,transform:this,delay:.2,distance:e+this.scale[1],force:this.scale[1]>2,pitch:this.getScaleFactor(),...t})}onHurt(t){this.sounds.hurt&&(t>.2||this.hurtSoundTimer.done(qn.time))&&(this.playSound(this.sounds.hurt),this.hurtSoundTimer.reset(qn.time))}onEffort(){this.sounds.effort&&Ar(0,1)<.3&&this.playSound(this.sounds.effort)}onAggro(){this.sounds.aggro&&(this.playSound(this.sounds.aggro),this.idleSoundTimer.reset(qn.time))}onDeath(){this.hasDied=!0,this.sounds.death&&this.playSound(this.sounds.death,8),this.eyes&&(this.removeMesh(this.eyes,!0),this.eyes=void 0),this.addColor(ru.death),this.deathTimer.reset(qn.time);let t=this.meshes.length;for(;t--;){const e=this.meshes[t];e.data.deathSize=(e.geometry.bounds.initiated?e.geometry.bounds.radius:1)*(e.scale[0]+e.scale[1]+e.scale[2])/3,!e.visible||e.parent&&!e.parent.visible||e.data.deathSize<.5?(this.removeMesh(e,!1),this.meshes.splice(t,1)):(e.setParent(null),Gi(e.position,e.Dy),Yi(e.scale,e.Dy),Xi(e.rotation,e.Dy),e.data.deathVel=[Ar(-.5,.5),1,Ar(-.5,.5)])}}tickDeath(t,e,s){this.meshes.forEach(i=>{if(!i.visible||void 0===i.data.deathVel)return;if(this.deathTimer.done(e))return void this.removeMesh(i,!0);const n=i.data.deathVel,a=i.data.deathSize;Ci(i.position,i.position,n,t),Si(n,n,1-3*t);const r=s.getHeight(i.position[0],i.position[2])+.5*a;n[1]<0&&i.position[1]<r?n[1]<-1?(n[1]=.7*Math.abs(n[1]),n[0]+=Ar(-1,1)/a,n[2]+=Ar(-1,1)/a):n[1]=-.5:n[1]-=50*t,Pi(Qn,n,Hn),Ci(i.rotation,i.rotation,Qn,5*-t),i.rotation.onChange(),i.updateMatrixWorld(!0)})}getScaleFactor(){return 1/(.7+.3*this.scale[1])}getTopAbsolute(){return this.entity.height*this.entity.size*.5}tickFixed(t,e,s){}tickOverrides(t,e,s){}setCrown(){}setHeadgear(){}setCape(){}addColor(t){this.colors.add(t),this.needsColorUpdate=!0}removeColor(t){this.colors.delete(t),this.needsColorUpdate=!0}colorUpdate(){this.needsColorUpdate=!1,this.meshes.forEach(t=>this.updateMeshColor(t))}changeMeshBaseColor(t,e){t.data.basecolor=e,void 0!==!t.data.color&&(t.data.color=[0,0,0,0]),this.updateMeshColor(t)}updateMeshColor(t){const e=t.data.color;Ki(e,t.data.basecolor),this.colors.forEach(t=>{const s=t[3],i=1-s;e[0]=e[0]*i+t[0]*s,e[1]=e[1]*i+t[1]*s,e[2]=e[2]*i+t[2]*s})}}const Cu={melee:{delay:.3,distance:5,rnd:3,id:"melee/sword"},hurt:{id:"humanoid/hurt",rnd:7},death:{id:"humanoid/death",rnd:2},effort:{id:"humanoid/effort",rnd:7}};class Mu extends Su{constructor(t){t.sounds||(t.sounds=Cu),super(t),this.chest=this.mesh(this,null,t.Jm,null,t.shader),this.chest.data.lod=3,this.hands=[],this.legs=[];for(let e=0;e<2;++e){const e=this.mesh(this.chest,"character/hand.ho",this.chest.data.color,null,t.shader);e.data.lod=2;const s=this.mesh(this,"character/boot.ho",ru.greysteel,null,t.shader);xi(s.scale,.4,.4,.4),s.data.lod=.6,this.legs.push(s),this.hands.push(e)}this.eyes=this.mesh(this.chest,"character/eyes.ho",t.colEyes||ru.black,null,gl.multimeshSimple),this.eyes.data.lod=1.5,this.eyesBlink=0,xi(this.eyes.position,0,-.05,.52),this.hasJustJumped=!1,this.hasJustLanded=!0,this.hasJustStopped=!0,this.flip=0,this.capeswing=!0,this.cape=void 0,this.headgear=void 0,this.movementPushback=[0,0,0],this.movementPushbackVel=[0,0,0]}tickFixed(t,e,s){super.tickFixed(t,e,s),this.tickPushBack(t,e,s)}tickPushBack(t,e,s){super.tickPushBack(t,e,s),this.chest.visible&&this.cDist<25&&0===this.entity.constructor.type&&(Ci(this.movementPushback,this.movementPushback,this.movementPushbackVel,60*t),Ci(this.movementPushbackVel,this.movementPushbackVel,this.movementPushbackVel,-20*t),Ci(this.movementPushbackVel,this.movementPushbackVel,this.movementPushback,-10*t),this.movementPushbackVel[2]+=.01*this.entity.steer[1],this.movementPushbackVel[0]-=.01*this.entity.steer[0])}tickParts(t,e,s){this.walking=void 0===this.entity.mount&&this.walking,this.checkCycleReset(this.falling<<1|(!this.falling&&this.walking)<<2),this.calculateCycleSpeed(),this.updateChest(),this.updateHands(),this.updateLegs(),this.updateEyes(t),this.tickWalkSounds(t),this.tickLandingSounds(),this.tickEquipment(t,e,s)}tickOverrides(t,e,s){this.chest.visible&&this.entity.buffs.incapacitated.size>0&&Array.from(this.entity.buffs.incapacitated).some(t=>t.logic.visualIncapacitation)&&(this.chest.rotation[0]+=.3*(Math.sin(2.2*e)+.3*Math.sin(2.1*e))+1,this.chest.rotation[1]+=.3*(Math.sin(2.1*e)+.6*Math.sin(2*e)),this.chest.rotation[2]+=.3*(Math.sin(.8*e)+.5*Math.sin(2.3*e)),this.chest.rotation.onChange(),this.hands.forEach(t=>t.position[1]-=.2))}tickEquipment(t,e,s){const i=this.hands[0];if(i.visible&&(void 0!==this.weapon&&(this.sheathed||(this.entity.mount?this.sheathe(!0):!this.entity.target||this.walking||this.falling?(i.rotation[0]+=.5,i.rotation.onChange(),i.position[1]-=.2,i.position[0]-=.1):(i.rotation[0]+=1,i.rotation[2]+=.6,i.rotation.onChange(),i.position[2]-=.3,i.position[1]-=.2,i.position[0]-=.1,this.legs[0].position[0]-=.05,this.legs[1].position[0]+=.05,this.legs[0].position[2]-=.2,this.chest.position[1]+=.05*Math.sin(3*e)-.05,this.chest.rotation[1]-=.05*Math.cos(3*e),this.chest.rotation.onChange()))),this.currentAnim)){const t=oa.easeInOutCubic(this.currentAnim.fract),e=-Math.sin(7.5*t-1.5),s=-Math.sin(6.28*t),n=-Math.sin(3.14*t),a=oa.easeOutExpo(-n);switch(Si(i.rotation,i.rotation,1-a),this.currentAnim.id){case 0:if(void 0!==this.weapon)this.sheathe(!1),i.rotation[0]+=1.7*n,i.rotation[1]+=1.5*a,i.rotation[2]+=e*a+.5*a,i.rotation.onChange(),i.position[2]-=n-t*a,i.position[1]+=Math.sin(13*t+3)*a*.5,i.position[0]+=(1.5*t-.5)*a,this.chest.rotation[1]+=1.5*s,this.chest.rotation.onChange();else{const e=Math.cos(6.28*t);this.chest.position[2]+=(.3+.2*Math.sin(6.28*t-3.14))*a,this.chest.rotation[0]+=.5*Math.sin(3.28*t)*a,this.chest.rotation.onChange(),this.hands.forEach((s,i)=>{s.visible&&(Si(s.position,s.position,1-a),s.position[2]+=(1-.5*e)*a,s.position[1]+=Math.sin(6.28*t)*(t>.5?.7:1),s.position[0]+=(i?.5+.2*n:-.5-.2*n)*a,s.rotation.set(0,1.5,0))})}break;case 1:this.sheathe(!1),i.rotation[0]-=1.7*n,i.rotation[1]+=1.5*a-a,i.rotation[2]+=e*a+.5*a,i.rotation.onChange(),i.position[2]+=a,i.position[0]-=.5*a,this.chest.rotation[1]-=1.5*s-.5*a,this.chest.rotation.onChange();break;case 4:this.sheathe(!1),i.rotation[0]+=1.7*n,i.rotation[1]-=1.5*n,i.rotation.onChange(),i.position[0]-=.5*a,this.chest.rotation[1]=2*t*Math.PI+3*a,this.chest.rotation.onChange();break;case 3:this.sheathe(!0),this.chest.rotation.set(n,0,0),xi(i.position,-.3,0,.7)}}this.tickShield(),this.tickCape(t)}tickShield(){const t=this.hands[1];void 0!==this.shield&&t.visible&&(!this.entity.target||this.walking||this.falling?(t.rotation[2]-=.1,t.rotation.onChange(),t.position[1]+=.1):(t.rotation[2]-=.2,t.rotation[1]-=1,t.rotation.onChange(),t.position[1]+=.1,t.position[2]+=.4))}tickCape(t){void 0!==this.cape&&this.cape.visible&&this.capeswing&&((this.entity.steer[1]>0||this.falling)&&(this.capeoffset+=.5*yi(this.entity.vel)*t),this.capeoffset*=1-3*t,this.cape.rotation.set(Math.max(0,this.capeoffset),0,0))}tickWalkSounds(t){(this.cDist<20||this.scale[1]>2)&&!this.falling&&this.walking&&(this.fraction(.2,t)||this.fraction(.7,t))&&Yr({id:(this.scale[1]>2||this.chest.scale[1])>2?"step_giant":"step_grass",rnd:3,loop:!1,transform:this,distance:Math.min(1+3*this.scale[1],10),force:this.scale[1]>2})}tickLandingSounds(){this.hasJustJumped&&this.entity.onGround&&(this.cDist<20&&(0==this.entity.vel[1]||this.entity.vel[1]<-4)&&(Yr({id:"land_grass",loop:!1,transform:this,distance:3}),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.15,this.eyesBlink=.3),this.hasJustLanded=!0,this.hasJustJumped=!1,this.flip=0),this.hasJustLanded&&!this.entity.onGround&&(this.entity.vel[1]>5&&(Yr({id:"jump_grass",loop:!1,transform:this,distance:3}),Math.random()<.5&&(this.flip=this.entity.steer[1]),this.movementPushbackVel[2]=.05,this.movementPushbackVel[1]=-.1,this.eyesBlink=.3,Ar(0,1)<.2&&this.onEffort()),this.hasJustJumped=!0,this.hasJustLanded=!1)}updateEyes(t){this.eyes.visible&&(this.eyesBlink>0?this.eyesBlink-=t:Math.random()<.006&&(this.eyesBlink=.1),xi(this.eyes.scale,1,this.eyesBlink>0?.1:1,.1))}updateLegs(){this.legs.forEach((t,e)=>{if(t.visible)if(this.entity.mount)this.entity.mount.mountLegs(t,e);else{if(this.currentAnim&&10===this.currentAnim.id)return void(t.visible=!1);const s=ua(this.entity.steer);if(this.falling)if(0==this.flip){const i=.1*Math.max(-1,Math.min(0,.2*this.entity.vel[1])),n=e?.3*this.cycle(0)-i:.3*this.cycle(.5)+i;xi(Qn,e?.3-i:-.3+i,-.65,n),Di(t.position,Qn,0),t.rotation.set(-n,s,0)}else xi(t.position,e?.3:-.3,-.3,0),t.rotation.set(0,0,0);else{if(this.walking){const i=this.entity.steer[1]<0?.4:.6,n=this.cycle(0)*i*1.3;xi(Qn,e?.3:-.3,Math.max(0,.6*Math.cos(this.cycleRad+(e?0:Math.PI)))-.55,this.cycle(e?0:.5)*i),Di(t.position,Qn,s),t.rotation.set(e?-n:n,s,0)}else t.rotation.set(0,e?.1:-.1,0),xi(t.position,e?.45:-.45,-.65,0);this.currentAnim&&(5!=this.currentAnim.id&&6!=this.currentAnim.id||xi(t.position,e?.4:-.55,-.65,e?.2:-.3))}}})}updateChest(){if(this.chest.visible){this.falling&&void 0===this.entity.mount?(this.rotation[0]=this.cycleRad*this.flip,xi(this.chest.position,0,0!=this.flip?.3:.5,0)):(this.walking?xi(this.chest.position,0,.1*Math.cos(2*this.cycleRad)+.4,0):xi(this.chest.position,0,void 0===this.entity.mount?.1*this.cycle(0)+.4:.4,0),this.rotation[0]=0),this.chest.rotation.set(5*-this.pushBack[1]+this.movementPushback[2],0,5*this.pushBack[0]-this.movementPushback[0]),va(this.chest.position,this.chest.position,this.pushBackOffset),Ci(this.chest.position,this.chest.position,this.movementPushback,1);const t=.5*-this.movementPushback[1];if(xi(this.chest.scale,1+t,1-t,1+t),this.currentAnim)if(5!=this.currentAnim.id&&6!=this.currentAnim.id||(this.chest.rotation[1]-=.3+.05*this.cycle(.2),this.chest.rotation[0]+=.3+.02*this.cycle(.4),this.chest.rotation.onChange(),this.chest.position[1]-=.1+.05*this.cycle(.6),this.chest.position[0]-=.05),6==this.currentAnim.id)this.chest.rotation[1]*=1-this.currentAnim.anticipate,this.chest.rotation.onChange();else if(10==this.currentAnim.id)xi(this.chest.position,0,.2+.5*Math.sin(this.currentAnim.fract*Math.PI),0),this.chest.rotation[0]+=this.currentAnim.fract*ca,this.chest.rotation[1]+=ua(this.entity.steer),this.chest.rotation.onChange();else if(9==this.currentAnim.id){const t=oa.easeOutQuad(ia(2*this.currentAnim.fract,0,1));this.chest.rotation[0]-=.3*t,this.chest.rotation[1]-=.2*t,this.chest.rotation[2]-=.2*t,this.chest.rotation.onChange()}}}updateHands(){this.hands.forEach((t,e)=>{if(t.visible){if(this.falling&&void 0===this.entity.mount)xi(t.position,e?.6:-.6,-ia(this.entity.vel[1],-5,5)/20,0),t.position[0]+=(e?1:-1)*Math.sin(3.1*t.position[1]+.8)*.3,t.rotation.set(0,e?Math.PI:0,-.3-t.position[1]);else if(this.walking){const s=this.cycle(0),i=this.entity.steer[1]<0?.3:.5,n=Math.sin(2*this.cycleRad+5);t.rotation.set(0,s*i*1.3+(e?Math.PI:0),0),xi(t.position,(e?.7:-.7)+n*(e?-.2:.2),s*(e?.3:-.3)-.2,.2+s*i*(e?-1.5:1.5)),t.position[0]=e?Math.max(.5,t.position[0]):Math.min(-.5,t.position[0])}else if(this.entity.mount)t.rotation.set(0,e?-1.3+Math.PI:1.3,.3),xi(t.position,e?.3:-.3,-.5,.7);else{const s=this.cycle(0);t.rotation.set(0,(e?-.43+Math.PI:.43)+.15*s*(e?1:-1),.3),xi(t.position,e?.7:-.7,.08*s-.3,.15-.1*s)}if(this.currentAnim)if(5==this.currentAnim.id||6==this.currentAnim.id)0==e?(t.position[0]-=.2,t.position[1]-=.2,6==this.currentAnim.id&&(Si(t.position,t.position,1-this.currentAnim.fract),t.position[0]+=.3*-this.currentAnim.fract,t.position[2]+=.6*this.currentAnim.anticipate)):(t.position[0]-=.4,t.position[2]+=.5-.2*this.cycle(.3),t.rotation[1]+=.6+.2*this.cycle(.4),t.rotation[0]-=.8,t.rotation.onChange(),6==this.currentAnim.id&&(Si(t.position,t.position,1-this.currentAnim.fract),t.position[0]+=.3*this.currentAnim.fract,t.position[2]+=this.currentAnim.fract));else if(9===this.currentAnim.id){const s=oa.easeOutQuad(ia(2*this.currentAnim.fract,0,1));this.shoulders&&this.shoulders[0].visible&&this.shoulders[0].rotation&&(bi(t.rotation,this.shoulders[0].rotation),t.rotation.onChange()),0==e?(t.position[2]=.2,t.position[1]=s,t.position[0]=.1*s-.6):(t.position[2]=.5,t.position[0]=.6-.3*s,t.position[1]=1.2*s)}this.shoulders&&this.shoulders[e].visible&&(this.shoulders[e].lookAt(t.position,!1,Hn),Si(this.shoulders[e].rotation,this.shoulders[e].rotation,.5),this.shoulders[e].rotation[1]-=e?.8:-.8,this.shoulders[e].rotation[2]-=e?.5:-.5,this.shoulders[e].rotation.onChange())}})}calculateCycleSpeed(){this.falling?this.speed=1.5:this.walking?this.speed=this.entity.speed*(-1===this.entity.steer[1]?1.3:1)*.45/(.4+.6*this.entity.size):this.speed=.5}sheathe(t){this.sheathed!==t&&(this.sheathed=t,void 0!==this.weapon&&(this.weapon.setParent(t?this.chest:this.hands[0]),this.sheathed?bi(this.weapon.position,this.sheathedWeaponPos):bi(this.weapon.position,this.unsheathedWeaponPos)),this.shield&&(this.shield.setParent(t?this.chest:this.hands[1]),this.sheathed?(xi(this.shield.position,0,-.2,-.65),this.shield.rotation.set(0,-1.57,0)):(xi(this.shield.position,-.2,0,0),this.shield.rotation.set(0,0,0))))}setShoulders(t,e=1){this.shoulders||(this.shoulders=[this.mesh(this.chest),this.mesh(this.chest)]),this.shoulders.forEach((s,i)=>{s.data.lod=.6,xi(s.position,i?.5:-.5,-.1,-.05),xi(s.scale,.6*e,.5*e,.5*e),this.changeMeshBaseColor(s,t)})}setCape(t,e){this.hasDied||!1===t?this.hasDied||void 0===this.cape||(this.removeMesh(this.cape,!0),this.cape=void 0):(this.capeoffset=0,void 0===this.cape&&(this.cape=this.mesh(this.chest,"character/cape.ho"),xi(this.cape.position,0,.2,-.55),this.cape.data.lod=.6),xi(this.cape.scale,e,e,e),this.changeMeshBaseColor(this.cape,t))}setHeadgear(t){this.hasDied||!1===t?this.hasDied||void 0===this.headgear||(this.removeMesh(this.headgear,!0),this.headgear=void 0):(void 0===this.headgear&&(this.headgear=this.mesh(this.chest,"character/headgear.ho"),this.headgear.data.lod=.5),this.changeMeshBaseColor(this.headgear,t))}setCrown(t){this.hasDied||!1===t?this.hasDied||void 0===this.crown||(this.removeMesh(this.crown,!0),this.crown=void 0):(void 0===this.crown&&(this.crown=this.mesh(this.chest,"character/crown.ho"),this.crown.position[1]=.8),this.changeMeshBaseColor(this.crown,t))}}const Eu={death:{id:"undead/death",rnd:2},hurt:{id:"undead/hurt",rnd:3},melee:{delay:.2,distance:4,id:"undead/attack",rnd:3},aggro:{id:"undead/aggro",rnd:2},idle:{id:"undead/idle",rnd:6}};Client.prototype.attacks={},Client.prototype.attacks.undead=Eu;class _u extends Mu{constructor(t){t.colPrim=t.colPrim||ru.emerald,t.colSec=t.colSec||ru.bone2,t.sounds=Eu,super({Jm:t.colPrim,colEyes:ru.evilred,...t}),this.meat=this.mesh(this.chest,null,t.colSec),xi(this.meat.position,.2,.2,-.2),xi(this.meat.scale,.7,.7,.7),this.meat.data.lod=.7,this.setShoulders(t.colSec,.5),this.legs.forEach((e,s)=>{xi(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,s?t.colPrim:t.colSec)}),this.hands.forEach((e,s)=>this.changeMeshBaseColor(e,s?t.colSec:t.colPrim))}tickEquipment(t,e,s){void 0!==this.currentAnim&&0!==this.currentAnim.id||this.hands.forEach((t,e)=>{xi(t.position,e?.5:-.5,e?.1:-.1,1),t.rotation.set(0,1.5,0)}),super.tickEquipment()}tickParts(t,e,s){super.tickParts(t,e,s),this.chest.rotation[0]+=.1*(Math.sin(1.8*e)*Math.cos(2*e)*.3+.3*Math.sin(1.4*e))+.2,this.chest.rotation[1]+=.1*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),this.chest.rotation[2]+=.1*(Math.sin(.4*e)+.5*Math.sin(1.9*e)),this.chest.rotation.onChange(),this.legs.forEach((t,s)=>{t.rotation[1]+=.3*Math.sin(.2*e-s),t.rotation.onChange()})}}var Ru=new nu({id:75,type:1,tags:new Set([7]),incapacitated:!0,icon:"skills/37",fx:{visual:_u,stick:hu.transformation,startSound:{id:"shaman/spiritAnimalCast",distance:5,dynamic:!0},endSound:{id:"buffEnd",distance:5,dynamic:!0}},statsStatic:(t,e)=>{e.maxStat(25,30+7*t.level),e.maxStat(26,20+3*t.level)}}),Pu=new nu({id:68,icon:"skills/28",fx:{stick:hu.caninehowl,stickOffset:.5,startSound:{id:"shaman/caninehowlcast",distance:5}},diminish:!0,statsStatic:(t,e)=>{e.addStat(16,Math.round((100+60*t.level)*t.diminishFactor))}}),Tu=new nu({id:51,type:1,tags:new Set([3,1]),icon:"skills/12",fx:{stick:hu.decay,stickOffset:.5,color:[.5,.4,.05,.3]},statsStatic:(t,e)=>{e.maxStat(25,20+3*t.level)},intervalDuration:1.5,onInterval:(t,e,s)=>({id:12,mode:1,caster:t.caster,target:e.id,dmg:3+s.stats.getDamageRoll()*(.5+.1*t.level),type:1,noDaze:!0})}),Iu=new nu({id:52,icon:"skills/13",fx:{stick:hu.manaBuff,startSound:{id:"shaman/manaBuffCast",distance:5}},intervalDuration:.5,custom:[[t=>40+30*t,"MP recovered"]],onInterval:(t,e,s)=>{}}),Du=new nu({id:44,maxStacks:3,icon:"skills/7",fx:{stick:hu.revitalize},intervalDuration:1,multiplyIncomingHeal:{6:t=>1+.25*t.stacks,7:t=>1+.3*(t.stacks-1)},onInterval:(t,e,s)=>({id:7,mode:2,caster:t.caster,target:e.id,heal:6+s.stats.getDamageRoll()*(.045+.035*t.level)})}),Au=new nu({id:48,passive:!0,icon:"skills/8",statsConvert:[[4,.4,10],[4,.4,11]]});const Fu={death:{id:"blob/death"},hurt:{id:"blob/hurt",rnd:1},melee:{delay:.3,distance:3,id:"blob/attack",rnd:2},aggro:{id:"blob/aggro",rnd:1},idle:{id:"blob/idle",rnd:2}};hma.attacks.blob=Fu;class zu extends Su{constructor(t){t.sounds=Fu,super(t),this.chest=this.mesh(this,t.meshHead||null,t.colPrim||ru.slimegreen),this.blobs=[];for(let e=0;e<2;++e){const s=this.mesh(null,t.meshHead||null,(0==e?t.colSec:t.colPrim)||this.chest.data.color);s.data.lod=.25*(3-e),this.blobs.push(s)}this.eyes=this.mesh(this.chest,t.meshEyes||"character/eyes.ho",t.colEyes||ru.black,null,gl.multimeshSimple),this.eyesBlink=0,this.eyes.data.lod=1.8,xi(this.eyes.position,0,-.05,.52)}tickFixed(t,e,s){this.tickPushBack(t,e,s)}tickParts(t,e,s){this.checkCycleReset(this.falling<<1|(!this.falling&&this.walking)<<2),this.walking?this.speed=this.entity.speed/this.entity.size*.2:this.speed=.5;const i=this.cycle(.5);if(xi(this.chest.scale,.1*i+1,1+.1*this.cycleSin,.1*i+1),xi(this.chest.position,0,.1*this.cycleSin-.1,0),this.chest.rotation.set(5*-this.pushBack[1],0,5*this.pushBack[0]),va(this.chest.position,this.chest.position,this.pushBackOffset),this.eyes.visible&&(this.eyesBlink>0?this.eyesBlink-=t:Math.random()<.006&&(this.eyesBlink=.1),xi(this.eyes.scale,1,this.eyesBlink>0?.1:1,1)),this.currentAnim){const t=oa.easeOutExpo(this.currentAnim.fract**3);switch(this.currentAnim.id){case 0:this.chest.position[2]+=Math.sin(6.28*t-3.14)}}this.blobs.forEach((e,i)=>{if(!e.visible)return;const n=0==i?this:this.blobs[i-1];$i(Qn,n.position,e.position),xi(Gn,0,0,.7*-n.scale[0]),Di(Vn,Gn,n.rotation[1]),ki(Qn,Qn,Vn);const a=yi(Qn);a>30*this.entity.size?bi(e.position,this.entity.CR):Ci(e.position,e.position,Qn,Math.max(0,Math.min(.5,20*t*(a-.7*e.scale[1])))),e.rotation.set(0,ma($i(Qn,n.position,e.position)),0),wi(e.scale,.3*(3-i)*(.8+.1*this.cycle(.3*i))*this.scale[0]),e.position[1]=Math.max(s.getHeight(e.position[0],e.position[2])+.5*e.scale[1],e.position[1]-2.5*t),e.updateMatrixWorld()})}mountPosition(t){Ti(t,[0,.6,-.13],this.chest.Dy)}mountLegs(t,e){t.rotation.set(-1.5,e?.2:-.2,e?.4:-.4),xi(t.position,e?.6:-.6,0,.6)}}var Bu=new nu({id:74,breakOnCast:!0,icon:"skills/36",fx:{visual:zu,stick:hu.transformation,startSound:{id:"shaman/spiritAnimalCast",distance:5,dynamic:!0},endSound:{id:"buffEnd",distance:5,dynamic:!0}},statsStatic:(t,e)=>{e.addStat(15,40+5*t.level)}}),Uu=new nu({id:66,passive:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round(30+20*t.level))}}),Ou=new nu({id:50,icon:"skills/11",fx:{stick:hu.invigorateBuff,stickOffset:.5,startSound:{id:"archer/invigoratebuff",distance:4},endSound:{id:"buffEnd",distance:3}},custom:[[t=>10+5*t,"% increased damage"]]}),ju=new nu({id:67,icon:"skills/27",fx:{stick:hu.pathfinding,startSound:{id:"archer/pathfindcast",distance:5}},diminish:!0,statsStatic:(t,e)=>{e.addStat(15,Math.round((20+7*t.level)*t.diminishFactor))}}),Lu=new nu({id:69,passive:!0,icon:"skills/29",custom:[[t=>60+15*t,"% per stack as additional damage over 10 seconds"]],afterDamageEnemy:{9:(t,e,s)=>{}}}),Nu=new nu({id:70,type:1,maxStacks:3,tags:new Set([3,1]),icon:"skills/29",fx:{stick:hu.poisonarrows,color:[.1,1,.3,.3]},statsStatic:(t,e)=>{e.maxStat(25,30)},intervalDuration:1.5,onInterval:(t,e,s)=>({id:29,mode:1,caster:t.caster,target:e.id,dmg:t.level*t.stacks,type:1,noDaze:!0})}),qu=new nu({id:80,maxStacks:4,icon:"skills/31",instantCast:new Set([31]),beforeDamageEnemy:{31:(t,e,s,i)=>{}}}),Hu=new nu({id:49,passive:!0,icon:"skills/10",custom:[[t=>2+1*t," Jumps"],[t=>35+5*t,"% damage per Jump"]],afterDamageEnemy:{9:(t,e,s)=>{}}}),Wu=new nu({id:76,icon:"skills/38",fx:{stick:hu.snipe},statsStatic:(t,e)=>{e.addStat(15,30)},instantCast:new Set([9]),onCast:{9:(t,e)=>{}}}),Qu=new nu({id:81,passive:!0,incapacitated:!0,statsOverride:(t,e)=>{e.stat.set(15,400)},movementOverride:(t,e,s,i,n)=>{0===i.steer[0]&&0===i.steer[1]&&i.setSteer([0,1])}}),Vu=new nu({id:47,passive:!0,icon:"skills/8",statsConvert:[[2,.4,10],[2,.4,11]]}),Gu=new nu({id:65,icon:"skills/25",fx:{stick:hu.temporaldilation,startSound:{id:"archer/timedilationcast",distance:5}},diminish:!0,statsStatic:(t,e)=>{e.addStat(16,Math.round((20+20*t.level)*t.diminishFactor))}}),Yu=new nu({id:62,icon:"skills/22",fx:{stick:hu.arcticaura,startSound:{id:"mage/arcticauracast",distance:5}},diminish:!0,statsStatic:(t,e)=>{e.addStat(14,Math.round((8+7*t.level)*t.diminishFactor))}}),Xu=new nu({id:86,type:1,tags:new Set([6]),incapacitated:!0,icon:"skills/deepFrozen",fx:{stick:hu.deepfrozen,color:[.1,.9,.8,.9]},statsStatic:(t,e)=>{e.maxStat(25,100)},multiplyIncomingDamage:{4:t=>1.5,15:t=>1.5}}),Zu=new nu({id:64,icon:"skills/24",fx:{stick:hu.enchantment,startSound:{id:"mage/enchantcast",distance:5}},diminish:!0,statsStatic:(t,e)=>{e.addStat(10,Math.round(3+2*t.level*t.diminishFactor)),e.addStat(11,Math.round(3+4*t.level*t.diminishFactor))}}),Ju=new nu({id:53,type:1,tags:new Set([4]),icon:"skills/14",fx:{stick:hu.icenovaroot,color:[.7,.7,1,.4]},statsStatic:(t,e)=>{e.maxStat(25,100)},addIncomingCrit:{4:t=>5+5*t.level,15:t=>10+5*t.level},intervalDuration:1.5,onInterval:(t,e,s)=>({id:14,mode:1,caster:t.caster,target:e.id,dmg:s.stats.getDamageRoll()*(.5+.4*t.level)*.2,type:1,noDaze:!0})}),Ku=new nu({id:84,type:1,tags:new Set([3]),maxStacks:3,icon:"skills/frozenBuff",fx:{stick:hu.frozen,color:[.1,.1,.8,.5]},statsStatic:(t,e)=>{e.maxStat(25,20)}}),tm=new nu({id:55,icon:"skills/16",fx:{stick:hu.hypothermicBuff,stickOffset:.5,startSound:{id:"mage/hypothermicCast",distance:4},endSound:{id:"buffEnd",distance:3}},statsStatic:(t,e)=>{e.addStat(16,200+40*t.level),e.addStat(23,18+4*t.level)}}),em=new nu({id:85,passive:!0,afterDamageEnemy:{4:(t,e,s)=>{const i=e.buffs.casters.get(t.caster);if(i){if(i.get(86))return;const n=i.get(84);if(n&&n.stacks>2)return n.remove=!0,void add({id:86,mode:4,stacks:1,caster:s.caster,target:e.id,duration:5,level:t.level})}add({id:84,mode:5,stacks:1,caster:s.caster,target:e.id,refresh:!0,duration:7,level:t.level})}}}),sm=new nu({id:63,icon:"skills/23",fx:{stickOffset:.15,stick:hu.iceBlockBuff}}),im=new nu({id:54,passive:!0}),nm=new nu({id:46,passive:!0,icon:"skills/8",statsConvert:[[3,.4,10],[3,.4,11]]}),am=new nu({id:78,type:1,icon:"skills/dazedBuff",fx:{stick:hu.dazed,stickOffset:.5},statsStatic:(t,e)=>{e.maxStat(25,35)}});const rm={death:{id:"blob/death"},hurt:{id:"blob/hurt",rnd:1},melee:{delay:.3,distance:3,id:"blob/attack",rnd:2},aggro:{id:"blob/aggro",rnd:1},idle:{id:"blob/idle",rnd:2}};class om extends Su{constructor(t){t.sounds=rm,super(t),this.chest=this.mesh(this,t.meshHead||null,t.colPrim||ru.greysteel),xi(this.chest.scale,.6,.6,.6),this.chest2=this.mesh(this.chest,t.meshBack||null,t.colSec||ru.woodbrown),xi(this.chest2.scale,1.2,1.2,1.4),xi(this.chest2.position,0,.1,-1),this.eyes=this.mesh(this.chest,t.meshEyes||"monsterparts/spiderEyes.ho",t.colEyes||ru.greysteel,null,gl.multimeshSimple),xi(this.eyes.position,0,-.05,.52),xi(this.eyes.scale,.6,.6,.6),this.legs=[],this.legsize=t.legsize||1;for(let e=0;e<2;++e){const e=this.mesh(this,"monsterparts/crawlerLegs.ho",t.colSec||ru.woodbrown,null,t.shader);e.data.lod=1.5,this.legs.push(e)}this.chestOffset=t.chestOffset||0}tickFixed(t,e,s){this.tickPushBack(t,e,s)}tickParts(t,e,s){if(this.walking&&!this.falling){this.speed=this.entity.speed*(-1===this.entity.steer[1]?-1.2:1)*.8/(.4+.6*this.entity.size+this.legsize);const e=Math.cos(this.cycleRad);this.legs[0].rotation.set(0,.2*this.cycleSin,.2*this.cycleSin),xi(this.legs[0].position,0,.3*Math.abs(e)+.2,0),this.legs[1].rotation.set(0,Math.PI+.2*e,.2*e),xi(this.legs[1].position,0,.3*Math.abs(this.cycleSin),0),wi(this.legs[0].scale,this.legsize),wi(this.legs[1].scale,this.legsize),xi(this.chest.position,.01*this.cycle(.3),.02*this.cycleSin+this.chestOffset,0),xi(this.chest.rotation,0,.01*this.cycleSin,.01*Math.sin(2*this.cycleRad)),this.entity.target>0&&Math.random()<.3&&this.fraction(.1,t)&&Yr({id:"crawler/crawlerMove",loop:!1,transform:this,distance:Math.min(1+3*this.scale[1],10),force:this.scale[1]>2})}else if(this.speed=.5,this.currentAnim){const t=oa.easeOutExpo(this.currentAnim.fract**3);switch(this.currentAnim.id){case 0:{const e=Math.sin(6.28*t-3.14);xi(this.chest.position,0,Math.max(0,-e)+this.chestOffset,.5*e),this.legs.forEach((t,s)=>{const i=0==s?1:-1,n=1==s?Math.PI:0;t.rotation.set(i*Math.min(e,0),n+.1*e*i,0),xi(t.position,0,Math.max(0,-e),.5*e),xi(t.scale,this.legsize,this.legsize*(1+.2*e),this.legsize)});break}}}else xi(this.chest.position,0,.1*this.cycle(-.1)+this.chestOffset,0),this.legs.forEach((t,e)=>{const s=this.cycle(0==e?0:.5);t.rotation.set(0,1==e?Math.PI:0,this.falling?.4:0),xi(t.position,0,.1*s,0),xi(t.scale,(this.falling?.6:1)*this.legsize,this.legsize*(1+.2*s),this.legsize)});this.chest.rotation.set(this.chest.rotation[0]-5*this.pushBack[1],this.chest.rotation[1],this.chest.rotation[2]+5*this.pushBack[0])}mountPosition(t){Ti(t,[0,.8,-1],this.chest.Dy)}mountLegs(t,e){t.rotation.set(-.9,e?.2:-.2,e?.4:-.4),xi(t.position,e?.6:-.6,-.4,.5)}}const lm=t=>{wi(t.chest.scale,.8),wi(t.chest2.scale,1.1),xi(t.chest2.position,0,.2,-.8),t.chest2.rotation.set(0,3.14,0),xi(t.eyes.position,0,-.2,.8),wi(t.eyes.scale,.6)},cm=[[30,1e4,50,zu,{}],[30,2e4,50,om,{}],[30,5e4,80,om,{colEyes:ra(11332842,0),colPrim:ra(4772165,-.2),colSec:ra(1351204,-.2)}],[30,5e4,80,om,{colEyes:ra(16751284,0),colPrim:ra(15737892,.5),colSec:ra(15737892,.5)}],[30,5e4,95,om,{colEyes:ra(14292553,0),colPrim:ra(4075311,.1),colSec:ra(1970198,.1),legsize:.5,post:t=>{wi(t.chest.scale,.8)}}],[30,5e4,90,om,{colEyes:ra(2029122,0),colPrim:ra(2565674,.3),colSec:ra(2236197,.3),legsize:1.4,post:t=>{xi(t.chest.scale,.6,.6,1),t.chest2.rotation.set(.5,0,0)}}],[30,5e4,80,zu,{colEyes:ra(12825266,0),colPrim:ra(11313312,.1),colSec:ra(8221555,.1),meshHead:"rocks/rock_02.ho",post:t=>xi(t.eyes.position,0,0,.75)}],[30,5e4,90,zu,{colEyes:ra(15880973,0),colPrim:ru.fireorange,colSec:ru.fireorange,meshHead:"rocks/rock_02.ho",post:t=>{xi(t.eyes.position,0,0,.75);const e=lc(hu.burning,void 0,t);e&&t.effects.push(e)}}],[30,5e4,95,zu,{colEyes:ra(12451327,0),colPrim:ra(3950066,-.4),colSec:ra(3525854,-.4),meshHead:"monsterparts/wyrmhead.ho",meshEyes:"monsterparts/wyrmEyes.ho",post:t=>{const e=lc(hu.etherwyrm,void 0,t.blobs[0]);e&&t.effects.push(e)}}],[30,5e4,95,zu,{colEyes:ra(2747996,0),colPrim:ra(1907231,.4),colSec:ra(2293580,-.8),meshHead:"monsterparts/wyrmhead.ho",meshEyes:"monsterparts/wyrmEyes.ho",post:t=>{const e=lc(hu.shadowwyrm,void 0,t.blobs[0]);e&&t.effects.push(e)}}],[30,5e4,80,om,{colEyes:ra(16758891,0),colPrim:ra(15448667,.1),colSec:ra(11370036,.1),legsize:.6,meshHead:"monsterparts/wyrmhead.ho",meshBack:"monsterparts/wyrmhead.ho",meshEyes:"monsterparts/wyrmEyes.ho",chestOffset:.5,post:lm}],[30,5e4,95,om,{colEyes:ra(16777215,0),colPrim:ru.darksteel,colSec:ru.gold,legsize:.6,meshHead:"monsterparts/wyrmhead.ho",meshBack:"monsterparts/wyrmhead.ho",meshEyes:"monsterparts/wyrmEyes.ho",chestOffset:.5,post:lm}],[30,5e4,95,om,{colEyes:ra(16750598,0),colPrim:ra(13177876,-.6),colSec:ra(16721931,-.7),legsize:1.1,meshHead:"misc/misc_bones_skull.ho",meshBack:"monsterparts/wyrmhead.ho",meshEyes:"monsterparts/wyrmEyes.ho",post:t=>{wi(t.chest2.scale,.7),xi(t.eyes.position,0,-.1,.55),wi(t.eyes.scale,.6);const e=lc(hu.burning,void 0,t);e&&t.effects.push(e)}}],[30,5e4,85,zu,{colEyes:ru.fireorange,colPrim:ru.darksteel,colSec:ru.fireorange}],[30,5e4,95,zu,{colEyes:ru.ice,colPrim:ra(3980543,-.6),colSec:ru.ice,post:t=>{const e=lc(hu.arcticaura,void 0,t.blobs[1]);e&&(t.effects.push(e),e.position[1]=-.5)}}]].map(t=>({level:t[0],goldValue:t[1],quality:t[2],visual:t[3],visualData:t[4]}));var hm=new nu({id:77,breakOnCast:!0,icon:"skills/39",fx:{mount:t=>cm[t.data[0]].visual,mountVisualData:t=>cm[t.data[0]].visualData,startSound:{id:"shaman/spiritAnimalCast",distance:5,dynamic:!0},endSound:{id:"buffEnd",distance:5,dynamic:!0}},statsStatic:(t,e)=>{e.addStat(15,60)}}),dm=new nu({id:88,icon:"skills/postsummon",fx:{stick:hu.postsummon},diminish:!0,statsStatic:(t,e)=>{e.addStat(15,20)}}),um=["potionhp","potionMp"].map((t,e)=>new nu({id:[82,83][e],maxStacks:1,icon:"skills/"+t,intervalDuration:.5,onInterval:(t,s,i)=>({id:100,mode:[2,3][e],caster:t.caster,target:s.id,heal:t.level,nocrit:!0})})),mm=new nu({id:79,passive:!0,statsStatic:(t,e)=>{e.addStat(15,100),e.addStat(12,1e4)}}),pm=new nu({id:72,type:1,incapacitated:!0,visualIncapacitation:!0,icon:"skills/stunBuff",fx:{stick:hu.stunned,stickOffset:.5},movementOverride:(t,e,s,i,n)=>{}});const fm={postsummon:dm,suddendeath:new nu({id:87,maxStacks:99,icon:"skills/suddenDeath",statsStatic:(t,e)=>{e.maxStat(26,t.stacks)}}),hppotion:um[0],mppotion:um[1],stun:pm,mount:hm,daze:am,resetting:mm},gm={temperBoostBuff:wu,temperBuff:ku,tauntDebuff:xu,chargeBuff:pu,warcryBuff:$u,courageBuff:fu,armorreinforcementBuff:au,crescentBleedDebuff:vu,crescentBleedBuff:gu,healOnBlockBuff:yu,blockBuff:uu,blockBuffEnrage:mu,specializationWarrior:bu},vm={agonizeDebuff:Ru,spiritanimalBuff:Bu,caninehowlBuff:Pu,manaBuff:Iu,revitalizeBuff:Du,specializationShaman:Au,decayBuff:Tu},ym={deepFrozenBuff:Xu,iceboltBuff:em,frozenBuff:Ku,enchantmentBuff:Zu,arcticauraBuff:Yu,iceshieldBuff:sm,icicleBuff:im,frostnovaBuff:Ju,specializationMage:nm,hypothermicBuff:tm},bm={snipeMoveBuff:Qu,preciseshotBuff:qu,snipeBuff:Wu,poisonarrowsBuff:Lu,poisonarrowsDebuff:Nu,temporaldilationBuff:Gu,pathfindingBuff:ju,cranialpuncturesBuff:Uu,specializationArcher:Vu,serpentArrowsBuff:Hu,invigorateBuff:Ou},xm=new Map;[fm,gm,vm,ym,bm].forEach(t=>{for(const e in t)xm.set(t[e].id,t[e])});class wm{constructor(t){this.entity=t,this.buffs=new Map,this.casters=new Map,su.forEach(t=>{this[t]=new Set}),this.tags=new Map;for(let t=0;t<8;++t)this.tags.set(t,new Set)}tick(t,e,s){}setBuff(t,e,s,i,n,a){s<=0&&console.error("buff with zero or less stacks");const r=this.buffs.get(t)||this.buffs.set(t,new Map).get(t),o=r.get(e)||{};return o.caster=e,o.id=t,o.level=a,o.stacks=s,o.logic=xm.get(t),o.diminish=0,o.diminishFactor=0,o.timer=new Dl(i,n),void 0!==o.logic.intervalDuration&&(o.interval=new Dl(i,o.logic.intervalDuration)),r.set(e,o),o.logic.onSet(o,e,this),(this.casters.get(e)||this.casters.set(e,new Map).get(e)).set(t,o),o.logic.diminish&&this.updateDiminish(t),o}removeBuff(t,e){const s=this.buffs.get(t);if(s){const i=s.get(e);if(i){i.logic.onRemove(i,e,this),s.delete(e),0===s.size&&this.buffs.delete(t);const n=this.casters.get(e);return n.delete(t),0===n.size&&this.casters.delete(e),i.logic.diminish&&this.updateDiminish(t),i}}}updateDiminish(t){const e=this.buffs.get(t);e&&e.forEach((t,s)=>{t.diminish=e.size,t.diminishFactor=4/(3+e.size)})}clear(t){this.buffs.forEach((e,s)=>{e.forEach((e,i)=>{e.logic.passive==t&&this.removeBuff(s,i)})})}clearTempBuffs(){this.clear(!1)}clearPassiveBuffs(){this.clear(!0)}onDeath(){this.clearTempBuffs()}}class km extends wm{constructor(t){super(t)}setBuff(t,e,s,i,n,a,r,o){const l=super.setBuff(t,e,s,i,n,a);l.data=o,this.entity.uiFrameDirty=!0,void 0===l.fx||1!==r||l.logic.fx.norefresh||(this.removeBuffEffect(l),l.logic.fx.startSound&&Yr({...l.logic.fx.startSound,transform:this.entity.transform})),!l.fx&&this.entity.transform&&l.diminish<2&&(l.fx={},l.logic.fx.visual&&this.entity.transform.constructor!==l.logic.fx.visual&&this.changeEntityVisual(l.logic.fx.visual),l.logic.fx.mount&&this.changeEntityMount(l.logic.fx.mount(l),l.logic.fx.mountVisualData(l)),l.logic.fx.stick&&(l.fx.stick=lc(l.logic.fx.stick,void 0,this.entity.transform),l.logic.fx.stickOffset&&(l.fx.stick.position[1]+=this.entity.height*l.logic.fx.stickOffset/.7),0===r&&(l.fx.stick.data.time=Math.max(0,l.timer.passed(qn.time)),l.fx.stick.data.frame=Math.floor(l.fx.stick.time/.016)),l.fx.stick.data.buff=l),l.logic.fx.color&&this.entity.transform.addColor(l.logic.fx.color))}removeBuff(t,e){const s=super.removeBuff(t,e);s&&(this.entity.uiFrameDirty=!0,this.removeBuffEffect(s),s.logic.fx.endSound&&Yr({...s.logic.fx.endSound,transform:this.entity.transform}))}removeBuffEffect(t){if(void 0!==t.fx){if(t.diminish>1){const e=this.buffs.get(t.id).values();let s=e.next().value;s===t&&(s=e.next().value),s.fx=t.fx,t.fx.stick&&(t.fx.stick.data.buff=s)}else t.fx.stick&&(t.fx.stick.data.remove=!0,t.fx.stick.setParent(null),t.fx.stick=void 0),t.logic.fx.visual&&this.entity.transform.constructor===t.logic.fx.visual&&this.changeEntityVisual(),t.logic.fx.mount&&this.changeEntityMount(),t.logic.fx.color&&this.entity.transform.removeColor(t.logic.fx.color);t.fx=void 0}}changeEntityVisual(t){const e=this.entity.transform;this.entity.remakeTransform(t),this.entity.transform.animQueue=e.animQueue,this.buffs.forEach(t=>{t.forEach(t=>{t.fx&&void 0!==t.fx.stick&&t.fx.stick.setParent(this.entity.transform)})})}changeEntityMount(t,e){this.entity.mount&&(this.entity.mount.onRemove(),this.entity.mount=void 0),t&&(this.entity.mount=new t({entity:this.entity,...e}),void 0!==e.post&&e.post(this.entity.mount))}}class $m{constructor(t,e){this.data=t,this.bounds=e,this.gl=0,this.gr=0,this.gu=0,this.gd=0,this.l=0,this.r=0,this.t=0,this.b=0,this.u=0,this.d=0}update(t,e,s,i,n){return this.CR=t,this.rot=e,this.aabb(),this}onRemove(){}}class Sm extends $m{constructor(t,e,s,i,n,a){super(t,e),this.update(i,n,a)}static get type(){return 1}get type(){return this.constructor.type}aabb(){this.l=ia(this.CR[0]-this.radius,0,this.bounds),this.r=ia(this.CR[0]+this.radius,0,this.bounds),this.t=ia(this.CR[1]+.5*this.height,0,this.bounds),this.b=ia(this.CR[1]-.5*this.height,0,this.bounds),this.u=ia(this.CR[2]-this.radius,0,this.bounds),this.d=ia(this.CR[2]+this.radius,0,this.bounds)}update(t,e,s){return this.height=s,this.radius=e,super.update(t,0,e,s,e)}}class Cm extends $m{constructor(t,e,s,i,n,a,r){super(t,e),this.update(i,s,n,a,r)}static get type(){return 16}get type(){return this.constructor.type}aabb(){const t=Math.abs(Math.sin(this.rot)),e=Math.abs(Math.cos(this.rot)),s=t*this.Ic+e*this.width,i=t*this.width+e*this.Ic;this.l=ia(this.CR[0]-.5*s,0,this.bounds),this.r=ia(this.CR[0]+.5*s,0,this.bounds),this.t=this.CR[1]+.5*this.height,this.b=this.CR[1]-.5*this.height,this.u=ia(this.CR[2]-.5*i,0,this.bounds),this.d=ia(this.CR[2]+.5*i,0,this.bounds),this.local=Di([0,0,0],this.CR,-this.rot),this.ll=this.local[0]-.5*this.width,this.lr=this.local[0]+.5*this.width,this.lu=this.local[2]-.5*this.Ic,this.ld=this.local[2]+.5*this.Ic}update(t,e,s,i,n){return this.width=s,this.height=i,this.Ic=n,super.update(t,e,s,i,n)}}const Mm={posXZ:{type:2},rot:{type:1},steer:{type:0},jump:{type:0},entityType:{type:0}},Em={},_m={};let Rm=0;for(const t in Mm)_m[Rm]=Mm[t].type,Em[t]=Rm++;class Pm{constructor(t){this.rot=0,this.CR=[0,0,0],this.size=t.size,this.name=t.name}async init(t){this.name=t.name||""}preFixed(t,e,s){}tickFixed(t,e,s){}postFixed(t,e,s){}preDelta(t,e,s){}tickDelta(t,e,s){}postDelta(t,e,s){}onRemove(){}setXZPos(t){this.CR[0]=t[0],this.CR[2]=t[1]}setRot(t){this.rot=da(t)}compareDelta(t,e,s){let i=!1;for(const[n,a]of t)e.get(n)!==a?(e.set(n,a),i=!0):s&&t.delete(n);return i}parseDelta(t,e,s){switch(t){case Em.posXZ:this.setXZPos(Qc(e,768));break;case Em.rot:this.setRot(Lc(e,ca));break;case Em.steer:{const t=Hc(e);this.setSteer([t[0]-1,t[1]-1]);break}case Em.jump:this.setJump(e)}}onTarget(t){return!0}setName(t){this.name=t}clampWorldPos(){qn.clampV3(this.CR),this.CR[1]=Math.max(this.CR[1],this.getWorldYBody(qn,this.CR[0],this.CR[2]))}getWorldYBody(t,e,s){return t.getHeight(e,s)}distanceV2(t){return Pn(Kn,t,ga(ta,this.CR)),Dn(Kn)}distanceV3(t){return $i(Qn,t,this.CR),yi(Qn)}squaredDistanceV2(t){return Pn(Kn,t,ga(ta,this.CR)),function(t){const e=t[0],s=t[1];return e*e+s*s}(Kn)}squaredDistance(t){return $i(Qn,t,this.CR),function(t){const e=t[0],s=t[1],i=t[2];return e*e+s*s+i*i}(Qn)}rotationToV2(t){return Pn(Kn,t,ga(ta,this.CR)),An(Kn,Kn),ua(Kn)}rotationToV3(t){return $i(Qn,t,this.CR),_i(Qn,Qn),ma(Qn)}}class Tm extends Pm{constructor(t){super(t),this.hudPos=[0,0,0],this.netDeletion=new Dl(0,0)}onRemove(){this.transform&&this.transform.onRemove()}}const Im=(t,e)=>"function"==typeof t?t(e):t;class Dm{constructor(t){this.id=t.id,this.name=t.name,this.cd=void 0!==t.cd?t.cd:1,this.cost=t.cost||{},this.targetMode=t.targetMode,this.onCast=t.onCast,this.onPermanent=t.onPermanent,this.range=t.range,this.auto=t.auto||!1,this.engineOnly=t.engineOnly||!1,this.minlevel=t.minlevel,this.class=t.class,this.castLen=t.castLen,this.gcd=void 0!==t.gcd?t.gcd:1,this.custom=t.custom,this.skilllevels=Math.min(5,t.skilllevels||5),this.goldValue=t.goldValue||0,this.noReward=t.noReward,this.outOfCombat=t.outOfCombat,this.pvpBoundsAdd=t.pvpBoundsAdd||0,this.ignoreGcd=t.ignoreGcd||!1,this.disablingBuffs=t.disablingBuffs||[],this.skillpoints=void 0!==t.skillpoints?t.skillpoints:1}can(t,e,s=0){if(this.outOfCombat&&!t.stats.combatTimer.done(qn.time))return 11;if(this.cost.resources&&!this.cost.resources.reduce((s,i)=>s&&t.stats.getResource(i[0])>=Im(i[1],e),!0))return 5;if(1!==this.targetMode){let e=qn.getEntityById(s);const i=void 0===e||e.stats.alive,n=void 0===e?-1:t.hostility(e);if(4096===this.targetMode){if((-1===n||0===n)&&i)return 3;if(!t.canCombatInteract(e))return 13}else if(256===this.targetMode){if((-1===n||0!==n)&&i)return 4}else if(16===this.targetMode)e=t;else if(17===this.targetMode&&(void 0===e||e===t))return 3;if(void 0!==e&&!e.stats.alive)return 10;if(e&&s!==t.id&&e!==t&&!t.combatRangeCheck(e,this.range))return 6}return this.disablingBuffs.some(e=>t.buffs.tags.get(e).size>0)?12:0}}class Am extends Dm{constructor(t){super(t),this.fx=t.fx||{},this.autoSkillbar=!1!==t.autoSkillBar}}var Fm=new Am({id:41,targetMode:16,minlevel:25,cd:30,skilllevels:1,gcd:0,cost:{resources:[[7,t=>3+5*t]]},onCast:(t,e,s)=>{}});const zm=(t,e,s)=>({id:t,minlevel:s,engineOnly:!1,cd:0,autoSkillBar:!1,onPermanent:(t,s)=>({id:e,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:s})}),Bm=(t,e,s,i,n,a,r)=>({id:t,targetMode:16,minlevel:s,cd:n,cost:{resources:a},fx:r,onCast:(t,s,n)=>({id:e,mode:4,stacks:1,duration:i,caster:t.id,target:t.id,aoe:{faction:!0,party:!0,circleRadius:30},level:s})}),Um=(t,e,s,i,n,a,r,o=5,l)=>({id:t,targetMode:256,range:25,minlevel:s,cd:n,castLen:i,cost:{resources:r},fx:l,onCast:(t,s,i)=>({id:e,mode:o,stacks:1,caster:t.id,target:i,refresh:!0,duration:a,level:s})}),Om=(t,e,s=0,i=!0,n="Use Item",a,r)=>({name:n,id:t,targetMode:16,cd:e,gcd:0,ignoreGcd:!0,castLen:s,engineOnly:!0,outOfCombat:a,fx:r});var jm=new Am(zm(21,61,1)),Lm=new Am({id:2,targetMode:16,minlevel:5,cd:30,gcd:0,cost:{resources:[[7,t=>3+5*t]]},onCast:(t,e,s)=>({id:42,mode:4,stacks:1,duration:9,caster:t.id,target:t.id,level:e})});const Nm=t=>.7+.2*t;var qm=new Am({id:33,targetMode:17,skilllevels:1,minlevel:11,cd:15,range:25,disablingBuffs:[4],cost:{resources:[[7,t=>12]]},custom:[[Nm,"s stunned at min range"],[t=>Nm(t)+2,"s stunned at max range"]],onCast:(t,e,s)=>{}}),Hm=new Am(Bm(20,60,15,300,150,[[7,t=>8*t]])),Wm=new Am({id:18,cd:0,minlevel:8,autoSkillBar:!1,fx:{effectDirImpact:[hu.meleeSlash],impactSound:{distance:5,id:"warrior/bleedImpact",rndDelay:!0,delay:.3}},onPermanent:(t,e)=>({id:57,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:e})}),Qm=new Am({id:3,targetMode:1,minlevel:3,cd:6,cost:{resources:[[7,t=>2+2*t]]},fx:{animCast:{id:4,dur:.8,sounds:[{delay:.1,distance:6,id:"warrior/crescent"}]},impactSound:t=>({delay:.1+.3*Math.random(),distance:4,id:"warrior/crescent_hit"}),effectDirImpact:[hu.meleeSlash,hu.meleeFlash],effectCast:[hu.crescentStrike],weaponRibbon:{steps:10,interval:.02,timer:1,a:[.3,1,0],b:[-.3,0,0],uvTop:.5,Aj:[2,.5,.5,3],Ss:[1,0,0,0]}},onCast:(t,e,s)=>({id:3,mode:0,caster:t.id,dmg:t.stats.getDamageRoll()*(1+.17*e),type:1,aoe:{faction:!1,circleRadius:5}})}),Vm=new Am({id:17,targetMode:16,minlevel:21,cd:25,gcd:0,cost:{resources:[[7,t=>8*t]]},fx:{effectTarget:[hu.gainHealth]},onCast:(t,e,s)=>({id:56,mode:4,stacks:1,duration:10,caster:t.id,target:t.id,level:e})}),Gm=new Am({id:1,targetMode:4096,minlevel:1,cd:1,range:1,cost:{resources:[[7,t=>1+1*t]]},fx:{animCast:{id:1,dur:.8,sounds:[{delay:.1,distance:4,id:"woosh1"}]},impactSound:{distance:5,id:"warrior/slash",delay:.3},effectDirImpact:[hu.meleeFlash,hu.meleeSlash],weaponRibbon:{steps:9,interval:.03,timer:.5,a:[.3,.7,0],b:[-.3,.2,0],uvTop:.8,Aj:[1,1,0,2.5],Ss:[1,0,0,.7]}},onCast:(t,e,s)=>{const i=t.stats.getDamageRoll()*(1.1+.14*e);return{id:1,mode:0,caster:t.id,target:s,dmg:i,type:1}}}),Ym=new Am({id:34,targetMode:1,minlevel:6,cd:15,cost:{resources:[[7,t=>4*t]]},fx:{animCast:{id:9,dur:.6},effectCast:[hu.taunt]},custom:[[t=>Math.round(200+t**1.2*100)," aggro generation"]],onCast:(t,e,s)=>({id:73,mode:4,stacks:1,caster:t.id,duration:.6+.2*e,level:e,aoe:{faction:!1,circleRadius:10}})}),Xm=new Am(Bm(19,59,18,300,150,[[7,t=>8*t]])),Zm=new Am(Bm(22,62,17,300,120,[[7,t=>5+10*t]])),Jm=new Am(Um(24,64,15,1.2,0,300,[[7,t=>2+3*t]],4,{animCast:{id:9,dur:.3,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5}})),Km=new Am({id:14,targetMode:1,minlevel:3,cd:20,cost:{resources:[[7,t=>4*t]]},fx:{animCast:{id:9,dur:.6},effectCast:[hu.icenova]},onCast:(t,e,s)=>({id:53,mode:4,stacks:1,caster:t.id,duration:6,level:e,aoe:{faction:!1,circleRadius:8}})}),tp=new Am({id:16,targetMode:16,minlevel:13,cd:45,gcd:0,onCast:(t,e,s)=>({id:55,mode:4,stacks:1,duration:6,caster:t.id,target:t.id,level:e})}),ep=new Am({id:4,targetMode:4096,range:25,minlevel:1,castLen:1.5,cost:{resources:[[7,t=>1+3*t]]},fx:{animCast:{id:6,dur:.6,sounds:[{delay:.1,distance:3,id:"mage/icecast1"}]},effectDirImpact:[hu.iceimpact],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.icecast},effectMissile:hu.icebolt},onCast:(t,e,s)=>({id:4,mode:6,speed:25,caster:t.id,target:s,dmg:4+t.stats.getDamageRoll()*(.4+.4*e),type:1}),onPermanent:(t,e,s)=>({id:85,mode:4,stacks:1,duration:-1,caster:t.id,target:t.id,level:e})});const sp=t=>3+t;var ip=new Am({id:23,targetMode:16,minlevel:5,cd:60,gcd:0,cost:{resources:[[7,t=>5*t]]},custom:[[sp," attacks blocked"]],fx:{animCast:{id:9,dur:.6,sounds:[{delay:.01,distance:4,id:"mage/iceshieldcast"}]}},onCast:(t,e,s)=>({id:63,mode:4,stacks:sp(e),duration:60,caster:t.id,target:t.id,level:e})}),np=new Am({id:15,targetMode:1,range:25,minlevel:8,cd:15,castLen:1.5,cost:{resources:[[7,t=>2+8*t]]},fx:{animCast:{id:6,dur:.6},effectDirImpact:[hu.icicleImpact],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.icecast},effectMissile:hu.icicle},onCast:(t,e,s)=>({id:15,mode:6,speed:10,timeout:2.5,caster:t.id,rot:t.rot,dmg:10+t.stats.getDamageRoll()*(1+.65*e),type:1,aoe:{circleRadius:4+.5*e,faction:!1,onlyOnce:[]}})}),ap=new Am({id:32,targetMode:1,skilllevels:1,minlevel:5,cd:12,disablingBuffs:[4],cost:{resources:[[7,t=>4*t]]},fx:{animCast:{id:9,dur:.6},effectCast:[hu.teleport]},custom:[[()=>12,"m distance"]],onCast:(t,e,s)=>{}}),rp=new Am({id:37,targetMode:4096,range:25,minlevel:15,cd:40,castLen:2.3,cost:{resources:[[7,t=>5+5*t]]},fx:{animCast:{id:6,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"},{delay:1,distance:3,id:"shaman/agonizeImpact"}]},effectDirImpact:[hu.decayImpact],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.naturecast}},onCast:(t,e,s)=>({id:75,mode:4,stacks:1,caster:t.id,target:s,duration:2.5+.7*e,level:e})}),op=new Am(Bm(28,68,12,15,60,[[7,t=>1+3*t]],{animCast:{id:6,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.naturecast}})),lp=new Am({id:12,targetMode:4096,range:25,minlevel:1,castLen:1,cost:{resources:[[7,t=>1+3*t]]},fx:{animCast:{id:6,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},effectDirImpact:[hu.decayImpact],animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.naturecast}},onCast:(t,e,s)=>({id:51,mode:4,stacks:1,caster:t.id,target:s,refresh:!0,duration:12,level:e})}),cp=new Am({id:30,targetMode:1,range:25,minlevel:18,cd:60,castLen:2.3,cost:{resources:[[7,t=>10+8*t]]},fx:{effectDirImpact:[hu.gainHealthTotem],animCast:{id:9,dur:1,sounds:[{delay:.1,distance:4,id:"shaman/healingtotemcast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.naturecast},effectMissile:hu.healingtotem},onCast:(t,e,s)=>({id:30,mode:6,speed:0,timeout:30,caster:t.id,rot:t.rot,interval:new Dl(0,1),heal:t.stats.getDamageRoll()*(.04+.025*e),type:1,aoe:{circleRadius:10,circleHeight:30,faction:!0,party:!0}})}),hp=new Am(Bm(13,52,6,15,120,[])),dp=new Am({id:6,targetMode:256,range:25,minlevel:8,cd:8,castLen:0,cost:{resources:[[7,t=>4+4*t]]},fx:{animCast:{id:9,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},effectTarget:[hu.natureHealOneshot]},onCast:(t,e,s)=>({id:6,mode:2,caster:t.id,target:s,heal:15+t.stats.getDamageRoll()*(.25+.11*e)})}),up=new Am(Um(7,44,3,1.8,0,12,[[7,t=>3+3*t]],5,{animCast:{id:9,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/genericcast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.naturecast}})),mp=new Am({id:36,targetMode:16,minlevel:10,cd:30,gcd:0,cost:{resources:[[7,t=>8+2*t]]},onCast:(t,e,s)=>({id:74,mode:4,stacks:1,duration:17+3*e,caster:t.id,target:t.id,level:e})}),pp=new Am({id:35,targetMode:1,skilllevels:1,minlevel:5,cd:120,castLen:5,outOfCombat:!0,pvpBoundsAdd:5,cost:{resources:[[7,t=>20+5*t]]},fx:{animCast:{id:9,dur:.6,sounds:[{delay:.1,distance:4,id:"magic/summoncast"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.purplecast}},onCast:(t,e,s)=>{}}),fp=new Am(zm(26,66,15)),gp=new Am({id:11,targetMode:16,minlevel:7,cd:50,gcd:0,custom:[[t=>23,"% of max mp recovered"]],onCast:(t,e,s)=>({id:50,mode:4,stacks:1,duration:15,caster:t.id,target:t.id,level:e})}),vp=new Am(Bm(27,67,12,15,100,[[7,t=>5+7*t]])),yp=new Am({id:29,cd:0,minlevel:9,autoSkillBar:!1,fx:{effectDirImpact:[hu.poisonImpact],impactSound:{distance:5,id:"warrior/bleedImpact",rndDelay:!0,delay:.3}},onPermanent:(t,e)=>({id:69,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:e})}),bp=new Am({id:9,targetMode:4096,range:25,minlevel:3,cd:6,castLen:1.7,cost:{resources:[[7,t=>2+2*t]]},fx:{animCast:{id:7,dur:.3,pre:.1,sounds:[{delay:.005,distance:5,id:"archer/preciseshot"}]},impactSound:{delay:.01,distance:6,id:"archer/preciseimpact"},effectDirImpact:[hu.arrowPreciseImpact],animTimedSound:{distance:2.5,loop:!0,id:"magic/casting"},animTimedCast:{id:5},effectMissile:hu.precisearrow},onCast:(t,e,s)=>({id:9,mode:6,speed:120,caster:t.id,target:s,dmg:5+t.stats.getDamageRoll()*(1.1+.45*e),type:1})}),xp=new Am({id:10,targetMode:16,minlevel:5,cd:0,autoSkillBar:!1,onPermanent:(t,e,s)=>({id:49,mode:4,stacks:1,duration:-1,caster:t.id,target:t.id,level:e})}),wp=new Am({id:38,targetMode:16,minlevel:5,skilllevels:1,cd:10,gcd:0,disablingBuffs:[4],cost:{resources:[[7,t=>6]]},fx:{animCast:{id:10,dur:.3}},onCast:(t,e,s)=>!0}),kp=new Am({id:31,targetMode:4096,range:25,minlevel:1,cd:0,castLen:1.4,cost:{resources:[[7,t=>1+1*t]]},fx:{animCast:{id:7,dur:.3,pre:.1,sounds:[{delay:.005,distance:5,id:"archer/swiftshot"}]},impactSound:{delay:.01,distance:6,id:"archer/swiftimpact"},effectDirImpact:[hu.arrowPreciseImpact],effectMissile:hu.swiftarrow,animTimedSound:{distance:2.5,loop:!0,id:"magic/casting"},animTimedCast:{id:5}},onCast:(t,e,s)=>({id:31,mode:6,speed:60,caster:t.id,target:s,dmg:2+t.stats.getDamageRoll()*(.51+.17*e),type:1})}),$p=new Am(Bm(25,65,18,300,120,[[7,t=>5+5*t]]));const Sp=new Am(Om(100,30,0,!0,"Drink potion",!0,{animCast:{id:3,dur:1,sounds:[{delay:.1,distance:5,id:"potion1"}]},effectTarget:[hu.potionConsume]})),Cp=new Am(Om(101,.5,0,!0,"Learn skill",!1)),Mp=new Am(Om(103,.5,3,!0,"Open",!1,{animCast:{id:9,dur:.6,sounds:[{delay:.1,distance:5,id:"item/boxopening"}]},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5}})),Ep=new Am(Om(102,.5,1.5,!1,"Mount up",!0,{animCast:{id:9,dur:.6},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5}}));var _p=new Am({id:5,targetMode:4096,range:25,engineOnly:!0,auto:!0,cd:t=>100/t.stats.getStat(17),fx:{animCast:{id:8,dur:.4,sounds:[{delay:.01,distance:5,id:"archer/arrow_release1"}]},impactSound:{delay:.01,distance:4,id:"archer/arrow_impact1"},effectDirImpact:[hu.arrowImpact],effectMissile:hu.arrow},onCast:(t,e,s)=>({id:5,mode:6,speed:30,caster:t.id,target:s,dmg:t.stats.getDamageRoll(),type:0})}),Rp=new Am({id:0,targetMode:4096,engineOnly:!0,auto:!0,range:1,cd:t=>100/t.stats.getStat(17),fx:{animCast:{id:0,dur:1,sounds:[{delay:.3,distance:5,id:"woosh1"}]},impactSound:t=>t.transform.sounds.melee,impactSoundPitchCaster:!0,effectDirImpact:[hu.meleeFlash,hu.meleePhys]},onCast:(t,e,s)=>({id:0,mode:0,caster:t.id,target:s,dmg:t.stats.getDamageRoll(),type:0})}),Pp=new Am({id:39,engineOnly:!1,skilllevels:1,minlevel:30,cd:0,goldValue:25e3,skillpoints:0,noReward:!0,autoSkillBar:!1});const Tp={recall:new Am({id:40,targetMode:1,engineOnly:!0,cd:300,castLen:5,outOfCombat:!0,cost:{resources:[[7,t=>20+5*t]]},fx:{animCast:{id:9,dur:.6},animTimedSound:{distance:3,loop:!0,id:"magic/casting"},animTimedCast:{id:5,effect:hu.purplecast}},onCast:(t,e,s)=>{}}),arrow:_p,melee:Rp,potion:Sp,book:Cp,specialization:new Am({id:8,engineOnly:!0,cd:0,onPermanent:(t,e)=>({id:t.class+45,mode:4,caster:t.id,target:t.id,duration:-1,stacks:1,level:e})}),mount:Pp,activatemount:Ep,container:Mp},Ip={temper:Fm,taunt:Ym,charge:qm,warcry:Xm,courage:Hm,armorreinforcement:jm,healOnBlock:Vm,slash:Gm,blockBuff:Lm,crescentStrike:Qm,crescentBleed:Wm},Dp={teleport:ap,enchantment:Jm,arcticaura:Zm,iceshield:ip,hypothermic:tp,frostnova:Km,icebolt:ep,icicle:np},Ap={snipe:wp,poisonarrows:yp,temporaldilation:$p,pathfinding:vp,preciseShot:bp,serpentArrows:xp,invigorate:gp,swiftshot:kp,cranialpunctures:fp},Fp={agonize:rp,caninehowl:op,mana:hp,mend:dp,revitalize:up,decay:lp,healingtotem:cp,summon:pp,spiritanimal:mp},zp=new Map;[Ip,Dp,Ap,Fp,Tp].forEach((t,e)=>{for(const s in t)e<=3&&(t[s].class=e),zp.set(t[s].id,t[s])});class Bp{constructor(t){this.entity=t,this.skills=new Map,this.skillIds=[],this.timedCast=new Dl,this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0}tick(t,e,s){}add(t,e=0,s=0,i){let n=this.skills.get(t);return n=Object.assign(n||{},{level:void 0!==i?i:n?n.level+1:1,logic:zp.get(t),cd:new Dl(e,s-e)}),this.skills.set(t,n),n}remove(t){this.skills.delete(t)}compileSkillIds(){this.skillIds.length=0,this.skills.forEach((t,e)=>{if(!t.logic.engineOnly)for(let s=0;s<t.level;++s)this.skillIds.push(e)})}globalCd(t,e){this.skills.forEach(s=>{s.logic.auto||s.logic.ignoreGcd||(s.cd.end<t&&(s.cd.start=t),s.cd.end<e&&(s.cd.end=e))})}startTimedCast(t,e,s,i){this.timedCast.reset(e,i),this.timedSkill=t,this.timedTarget=s,this.entity.steer[0]=0,this.entity.steer[1]=0,this.pvpBoundModifier=zp.get(t.id).pvpBoundsAdd}interruptTimedCast(){this.timedCast.reset(0,0),this.timedSkill=void 0,this.timedTarget=void 0,this.pvpBoundModifier=0}finishTimedCast(t){return this.interruptTimedCast(!1)}onDeath(){this.interruptTimedCast(!0)}clear(){}hasInstantCast(t){return this.entity.buffs.instantCast.size>0&&Array.from(this.entity.buffs.instantCast).some(e=>e.logic.instantCast.has(t))}}class Up extends Bp{constructor(t){super(t)}tick(t,e,s){super.tick(t,e,s),this.isPlayer&&this.skills.forEach((t,s)=>{const i=new Map;let n=t.logic.can(this.entity,t.level,this.entity.target);3!==n&&4!==n||(n=t.logic.can(this.entity,t.level,this.entity.id)),n!==t.status&&(t.status=n,i.set("status",n)),t.cd.done(e)?t.cd.icondone||(t.cd.icondone=!0,i.set("cd",void 0)):(t.cd.icondone=!1,i.set("cd",Math.round(100-100*t.cd.fraction(e)))),i.size>0&&te.update(e=>(i.forEach((s,i)=>e[t.logic.id][i]=s),e))}),this.timedSkill&&(this.entity.uiFrameDirty=!0,this.timedSkill.fx&&this.timedSkill.fx.animCast&&(!this.entity.transform.currentAnim||this.entity.transform.currentAnim.id!==this.timedSkill.fx.animCast.id)&&(this.timedCast.remaining(e)<=(void 0!==this.timedSkill.fx.animCast.pre?this.timedSkill.fx.animCast.pre:.5*this.timedSkill.fx.animCast.dur)||this.timedCast.done(e))&&(this.entity.transform.clearAnims(),this.entity.transform.anim(this.timedSkill.fx.animCast)))}add(t,e=0,s=0,i){if(super.add(t,e,s,i),this.isPlayer){this.compileSkillIds(),te.update(e=>(e[t]={},e));const e=this.skills.get(t);e.logic.id<100&&ee.update(t=>(t.indexOf(e)<0&&t.push(e),t))}}remove(t){if(this.isPlayer){this.compileSkillIds(),te.update(e=>(e[t]=void 0,e));const e=this.skills.get(t);e&&ee.update(t=>t=t.filter(t=>t!=e))}super.remove(t)}cd(t,e,s){this.skills.get(t).cd.set(e,s)}clearSkillInfo(){ee.update(t=>(t.length=0,t))}startTimedCast(t,e,s,i){this.cleanUpCastingEffect(),super.startTimedCast(t,e,s,i),this.entity.uiFrameDirty=!0,this.entity.transform&&(this.timedSkill.fx&&this.timedSkill.fx.animTimedCast&&(this.entity.transform.anim({id:this.timedSkill.fx.animTimedCast.id,loop:!0,dur:i}),this.timedSkill.fx.animTimedCast.effect&&this.entity.transform.hands&&this.entity.transform.hands.forEach(t=>{const e=lc(this.timedSkill.fx.animTimedCast.effect);e.setParent(t),t.data.timedCastEffect=e})),this.timedSkill.fx&&this.timedSkill.fx.animTimedSound&&(this.animTimedSound=Yr({transform:this.entity.transform,...this.timedSkill.fx.animTimedSound})))}interruptTimedCast(t){this.cleanUpCastingEffect(),super.interruptTimedCast(t),this.entity.uiFrameDirty=!0,t&&this.entity.transform&&this.entity.transform.clearAnims()}clear(){super.clear(),this.cleanUpCastingEffect()}cleanUpCastingEffect(){this.timedSkill&&(this.entity.transform&&this.entity.transform.hands&&this.entity.transform.hands.forEach(t=>{void 0!==t.data.timedCastEffect&&(t.data.timedCastEffect.data.remove=!0),t.data.timedCastEffect=void 0}),this.animTimedSound&&(this.animTimedSound.stop(),this.animTimedSound=void 0))}}class Op{constructor(t){this.entity=t,this.alive=!0,this.stat=new Map,this.resource=new Map,this.combatTimer=new Dl(-1,6)}tick(t,e){this.combatTimer.start>0&&this.combatTimer.done(e)&&this.onCombatEnd(e)}die(){return!!this.alive&&(this.alive=!1,this.entity.skills.onDeath(),this.entity.buffs.onDeath(),!0)}getStat(t){return 0|this.stat.get(t)}getResource(t){return 0|this.resource.get(t)}addStat(t,e){this.stat.set(t,(0|this.stat.get(t))+e)}maxStat(t,e){this.stat.set(t,Math.max(0|this.stat.get(t),e))}multiplyStat(t,e){this.stat.set(t,(0|this.stat.get(t))*e)}setResource(t,e){const s=Math.round(ia(e,0,this.getStat(t)));return this.resource.set(t,s),s}changeResource(t,e){return this.setResource(t,this.getResource(t)+e)}respawn(){this.alive=!0}clear(){}refreshCombatTimer(t,e){this.combatTimer.end<t+e&&this.combatTimer.reset(t,e)}onCombatEnd(){this.combatTimer.reset(-1)}getDamageRoll(){return Math.round((this.getStat(10)+this.getStat(11))/2)}}class jp extends Op{constructor(t){super(t)}setStat(t,e){this.stat.set(t,e),this.entity.uiFrameDirty=!0,this.entity.statsDirty=!0,20==t&&this.entity.setFame(e),19==t&&this.entity.inventory&&this.entity.inventory.setSize(e)}setResource(t,e){super.setResource(t,e),this.entity.uiFrameDirty=!0}die(){super.die(),this.entity.uiFrameDirty=!0,this.entity.transform&&this.entity.transform.onDeath()}respawn(){super.respawn(),this.entity.uiFrameDirty=!0,this.entity.transform&&this.entity.remakeTransform()}refreshCombatTimer(t,e){super.refreshCombatTimer(t,e),this.entity.uiFrameDirty=!0}onCombatEnd(){super.onCombatEnd(),this.entity.uiFrameDirty=!0}}const Lp={},Np=(t,e)=>!(t[0]>e.r||t[0]<e.l||t[2]<e.u||t[2]>e.d),qp=(t,e)=>!(t.l>e.r||t.r<e.l||t.d<e.u||t.u>e.d||t.b>e.t||t.t<e.b),Hp=(t,e,s)=>!(s&&!qp(t,e))&&Lp[t.type|e.type](t,e);Lp[Sm.type|Sm.type]=((t,e)=>{const s=[0,0,0],i=t.CR[1]>e.CR[1],n=i?t.b-e.t:t.t-e.b;if(i?n>0:n<0)return s;$i(s,e.CR,t.CR);let a=s[0]**2+s[2]**2;const r=t.radius+e.radius;if(a<r**2){if(0==(a=Math.sqrt(a))||Math.abs(n)<r-a)return xi(s,0,-n,0);const t=1/a*(a-r);return s[0]*=t,s[1]=0,s[2]*=t,s}return xi(s,0,0,0)}),Lp[Sm.type|Cm.type]=((t,e)=>{const s=Di([0,0,0],t.CR,-e.rot),i=[0,0,0],n=t.CR[1]>e.CR[1],a=n?t.b-e.t:t.t-e.b;if(n?a>0:a<0)return i;if(xi(i,ia(s[0],e.ll,e.lr),0,ia(s[2],e.lu,e.ld)),$i(i,i,s),0==i[0]&&0==i[2]){const n=$i([0,0,0],s,e.local);n[0]>0?n[0]=e.lr-s[0]+t.radius:n[0]=e.ll-s[0]-t.radius,n[2]>0?n[2]=e.lu-s[2]+t.radius:n[2]=e.ld-s[2]-t.radius,Math.abs(n[0])<Math.abs(n[2])?i[0]=n[0]:i[2]=n[2]}else{const e=Math.sqrt(i[0]**2+i[2]**2);if(e<t.radius){const s=1/e*(e-t.radius);i[0]*=s,i[2]*=s}else xi(i,0,0,0)}return 0==i[0]&&0==i[2]||!(Math.abs(a)<Math.abs(i[0])||Math.abs(a)<Math.abs(i[2]))?i[1]=0:xi(i,0,-a,0),Di(s,i,e.rot),s});class Wp extends Tm{constructor(t){t.spawn&&""!==t.spawn.name&&(t.name=t.spawn.name),super(t),this.stats=new jp(this),this.buffs=new km(this),this.skills=new Up(this),this.height=1.1,this.shape=new Sm(this,qn.bounds,0,this.CR,.5*this.size,this.size*this.height),qn.grids.entities.add(this.shape),this.steer=[0,0],this.vel=[0,0,0],this.speed=1,this.static=!1,this.jump=!1,this.onGround=!0,this.onProp=!1,this.weight=this.size**3,this.target=0,this.level=0,this.faction=0,this.yReach=10,this.posLock=[0,0],this.posLockRadius=0}tickFixed(t,e,s){super.tickFixed(t,e,s),this.buffs.tick(t,e,s),this.stats.tick(t,e),this.skills.tick(t,e,this),this.speed=this.stats.getStat(15)/20,this.buffMovementOverride(t,e,s),this.handleEntityCollisions(),this.handlePosLock(),this.clampWorldPos()}handlePosLock(){if(this.posLockRadius>0){Pn(ta,ga(Kn,this.CR),this.posLock);const t=Dn(ta);t>this.posLockRadius&&this.setXZPos(function(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}(ta,this.posLock,Tn(ta,ta,this.posLockRadius/t)))}}handleEntityCollisions(){this.onProp=!1,this.stats.alive&&!this.static&&(this.shape.aabb(),qn.grids.entities.query(this.shape).forEach(t=>{if(t==this.shape||!t.data.stats.alive||this.stationary&&t.data.static)return;const e=Hp(this.shape,t,!1);if(0!=e[0]||e[1]!=[0]||0!=e[2]){let s=t.data.static?0:this.weight/(t.data.weight+this.weight);e[1]>0&&(s=0,this.onGround=!0,this.onProp=!0),Ci(this.CR,this.CR,e,1-s),t.data.static||Ci(t.data.CR,t.data.CR,e,-s),_i(e,e);const i=Ri(this.vel,e),n=Si(Qn,e,i*(1-s));$i(this.vel,this.vel,n),this.shape.aabb(),this.hasCollided=!0}}))}buffMovementOverride(t,e,s){this.buffs.movementOverride.size&&this.buffs.movementOverride.forEach(i=>{i.logic.movementOverride(t,e,s,this,i)})}combatRangeCheck(t,e){const s=this.CR[0]-t.CR[0],i=Math.max(0,Math.abs(this.shape.b-t.shape.b)-this.yReach),n=this.CR[2]-t.CR[2];return Math.sqrt(s*s+i*i+n*n)-(t.shape.radius+this.shape.radius+.5)<e}getWorldYBody(t,e,s){return super.getWorldYBody(t,e,s)+.5*this.height*this.size}clampWorldPos(){super.clampWorldPos(),this.shape.aabb(),this.updateShape()}updateShape(){this.shape.update(this.CR,.5*this.size,this.size*this.height),qn.grids.entities.update(this.shape)}horizontalSteer(t){if(this.stats.alive){const e=An(Kn,this.steer);this.steer[1]<0&&(e[1]*=.5),Tn(e,e,this.speed*t),Ai(this.vel,e,this.rot)}else this.vel[0]=0,this.vel[2]=0}setSteer(t){t!=this.steer&&this.stats.alive&&_n(this.steer,t)}setJump(t){t&&!this.stats.alive||(this.jump=t)}setRot(t){this.stats.alive&&super.setRot(t)}setTarget(t){const e=t>0&&this.canTarget(qn.getEntityById(t));return!1!==e&&void 0!==e?e.onTarget(this.id):this.target!==(this.target=0)}onTarget(t){return qn.getEntityById(t).target=this.id,super.onTarget(t)}getTargetEntity(){return qn.getEntityById(this.target)}canTarget(t){return t}setFaction(t){this.faction=t}setLevel(t){this.level=t}setClass(t){this.class=t}onRemove(){this.stats.clear(),this.buffs.clearTempBuffs(),this.buffs.clearPassiveBuffs(),this.skills.clear(),qn.grids.entities.remove(this.shape),this.shape.onRemove(),super.onRemove()}hostility(t){return(!0===qn.mode.partyBasedHostility?t.party!==this.party:t.faction!==this.faction)?0===t.constructor.type?2:1:0}canCombatInteract(t){return!0}die(t,e,s){}setPosLock(t,e,s){this.posLock[0]=~~t,this.posLock[1]=~~e,this.posLockRadius=~~s}}class Qp extends Wp{constructor(t){super(t),this.netPosOffset=[0,0],this.uiFrameDirty=!0,this.visualPosition=[0,0,0],this.speechTimer=new Dl(0,5),this.mount=void 0,this.mountRotAdd=0,this.internalYRot=0,this.netViolations=0}remakeTransform(){void 0!==this.transform&&(this.transform.onRemove(),this.transform=void 0)}onRemove(){super.onRemove(),void 0!==this.mount&&this.mount.onRemove()}updateVisualPosition(t,e,s){Ci(this.visualPosition,this.visualPosition,this.vel,t),$i(Qn,this.CR,this.visualPosition);const i=yi(Qn);i>10?bi(this.visualPosition,this.CR):i>.001&&Ci(this.visualPosition,this.visualPosition,Qn,Math.min(.5,30*t)),s.clampV3(this.visualPosition),this.onGround&&!this.onProp&&(this.visualPosition[1]=this.getWorldYBody(s,this.visualPosition[0],this.visualPosition[2])),void 0===this.mount?bi(this.transform.position,this.visualPosition):(bi(this.mount.position,this.visualPosition),this.mount.tick(t,e,s),this.mount.mountPosition(this.transform.position))}updateTransformScale(t){wi(this.transform.scale,.7*this.size),void 0!==this.mount&&wi(this.mount.scale,.9*this.size)}updateTransformRotation(t){if(this.stats.alive){const e=pa(this.rot,da(this.internalYRot));Math.abs(e)>.1&&(this.internalYRot-=.2*Math.sign(e)*t*8),this.internalYRot-=e*t*5,this.transform.rotation[1]=this.internalYRot,void 0!==this.mount&&this.updateMountRotation(t),this.transform.rotation.onChange()}}updateMountRotation(t){if(this.onGround&&(0!==this.steer[0]||0!==this.steer[1])){let e=1.5*this.steer[0];this.steer[1]>0?e*=.5:this.steer[1]<0&&(e=0),this.mountRotAdd-=(this.mountRotAdd-e)*t*10}this.transform.rotation[1]+=this.mountRotAdd,this.mount.rotation[1]=this.transform.rotation[1],this.mount.rotation.onChange()}tickFixed(t,e,s){super.tickFixed(t,e,s)}postFixed(t,e,s){if(super.postFixed(t,e,s),this.transform.tickFixed(t,e,s),void 0!==this.mount&&this.mount.tickFixed(t,e,s),this.onGround&&(this.vel[1]=Math.max(0,this.vel[1])),this!==s.player&&(0!=this.netPosOffset[0]||0!=this.netPosOffset[1])){const e=Tn(Kn,this.netPosOffset,30*t);this.CR[0]+=e[0],this.CR[2]+=e[1],Pn(this.netPosOffset,this.netPosOffset,e)}}forceNetPosition(t){this.netViolations=0,this.netPosOffset[0]=0,this.netPosOffset[1]=0,this.CR[0]=t[0],this.CR[2]=t[1],this.onGround&&(this.CR[1]=this.getWorldYBody(qn,this.CR[0],this.CR[2])),bi(this.visualPosition,this.CR)}parseDelta(t,e,s){switch(t){case Em.posXZ:{const t=Qc(e,768);this.netPosOffset[0]=t[0]-this.CR[0],this.netPosOffset[1]=t[1]-this.CR[2];const i=Dn(this.netPosOffset);i>(this!==s.player?.2*this.speed:this.speed)&&(this.netViolations++,(i>10||this.netViolations>3)&&this.forceNetPosition(t));break}default:super.parseDelta(t,e,s)}}postDelta(t,e,s){super.postDelta(t,e,s),this.updateTransformScale(t),this.updateTransformRotation(t),this.updateVisualPosition(t,e,s),this.transform.tick(t,e,s),this.uiFrameDirty&&(s.player.target==this.id&&this.setUiStore(Vt),this==s.player?this.setUiStore(Qt):s.party.has(this.name)&&this.setUiStore(s.party.get(this.name).store)),this.speechText&&this.speechTimer.done(e)&&(this.speechText=void 0)}setTarget(t){const e=this.target,s=super.setTarget(t);if(e!=this.target&&this==qn.player&&s){const e=qn.getEntityById(t);e?e.setUiStore(Vt):Vt.update(t=>(t.visible=!1,t))}return s}setUiStore(t){t.update(t=>(t.visible=!0,t.name=this.name,t.alive=this.stats.alive,t.hp=this.stats.getResource(6),t.hpMax=this.stats.getStat(6),t.mp=this.stats.getResource(7),t.mpMax=this.stats.getStat(7),t.level=this.level,t.class=this.class,t.id=this.id,t.clan=this.clan,t.faction=this.faction,t.role=this.partyRole,t.type=this.constructor.type,t.combat=!this.stats.combatTimer.done(qn.time),t.range=!0,t.powertype=2===this.faction&&void 0!==this.spawn&&(this.spawn.meta[4]||!1),t.buffs.length=0,this.buffs.buffs.forEach(e=>{e.forEach(e=>{e.logic.passive||gi.buffsHideIrrelevant&&e.caster!==qn.player.id&&(this!==qn.player||1!=e.logic.type)||e.logic.diminish&&0!==t.buffs.reduce((t,s)=>t+(s.id===e.id?1:0),0)||t.buffs.push(e)})}),t.buffs.sort((t,e)=>e.timer.end-t.timer.end),t.buffs.sort((t,e)=>t.logic.type-e.logic.type),t.timedSkill=this.skills.timedSkill,t.timedCast=this.skills.timedCast,t)),this.uiFrameDirty=!1}speech(t,e){this.speechText=t,this.speechStyle=e,this.speechTimer.reset(qn.time)}}class Vp extends Qp{constructor(t){super(t),this.static=!0}}class Gp extends Vp{constructor(t){super(t),this.interactions=t.interactions,this.setDialogue(this.interactions[0].text,this.interactions[0].choices),this.remakeTransform()}interact(t){this.createInteraction()}createInteraction(){Ot.set({title:this.name,text:this.text,choices:this.choices})}setDialogue(t,e){this.text=t,this.choices=e}}const Yp=(t,e,s)=>{},Xp=[{id:0,storeValue:300,quality:90,level:1,custom:["Contains one random mount of rare or epic quality"]}],Zp=(t,e)=>Or[t].baselvl+Math.floor(e/Or[t].tiers*100),Jp=(t,e)=>{const s={level:t.level,type:t.type,tier:t.tier,stats:t.stats?new Map:void 0,class:t.class,quality:t.quality};t.stats&&Object.keys(t.stats).sort((t,e)=>t-e).forEach(e=>{const i=t.stats[e];s.stats.set(parseInt(e),{min:i.base+t.level*i.min,max:i.base+(t.level+10)*i.max})}),e[t.type+t.tier]=s},Kp={};(t=>{for(const e in Or)if(Or[e].tiers){const s=Or[e];for(let i=0;i<s.tiers;++i)Jp({type:e,tier:i,stats:s.stats,level:Zp(e,i),class:s.class,quality:s.quality},t)}})(Kp),(t=>{const e=[150,100,300,200,600,300];for(let s=0;s<6;++s){const i=Math.floor(s/2),n=s%2==0;t["misc"+s]={type:"misc",tier:s,level:1+20*i,goldvalue:5**i,quality:15,custom:[e[s]+(n?" HP recovered":" MP recovered")],useSkill:100,use:(t,e,s,i)=>{}}}})(Kp),(t=>{zp.forEach(e=>{if(!e.engineOnly)for(let s=0;s<e.skilllevels;++s){const i=5*e.id+s;t[`book${i}`]={type:"book",tier:i,level:e.minlevel+8*s,skillid:e.id,skilllevel:s,class:e.class,noReward:e.noReward||!1,goldValue:e.goldValue||(e.minlevel+5*s<5?4:0),quality:Math.round(Math.min(99,30+s/5*70)),art:qd(i,e.class),useSkill:101,use:(t,s,i,n)=>{Yp(t,e.id)}}}})})(Kp),(t=>{cm.forEach((e,s)=>{t["mount"+s]={...e,type:"mount",tier:s,requiredSkills:[39],useSkill:102,use:(t,e,i,n,a)=>({id:77,mode:4,stacks:1,duration:600,caster:t.id,target:t.id,buffdata:[s],sendBuffdata:!0,level:e})}})})(Kp),(t=>{Xp.forEach(e=>{t["box"+e.id]={...e,type:"box",tier:e.id,unsellable:!0,useSkill:103,use:(t,e,s,i)=>{}}})})(Kp);const tf=Object.values(Kp);tf.forEach((t,e)=>t.logicId=e);const ef=[];for(const t in Kp){const e=Kp[t];"book"===e.type&&0===e.skilllevel?ef.push({stacks:1,item:e}):"misc"===e.type?ef.push({stacks:5,item:e}):"box"===e.type?ef.push({bind:!0,rolls:!0,maxquality:0,item:e}):"mount"===e.type&&e.tier<2&&ef.push({item:e,rolls:!0,maxquality:0,bind:!0})}class sf extends Gp{constructor(t){super({size:1.2,name:"Trader",...t}),this.items=ef}static get type(){return 8}}const nf=[{step:10,fun:()=>ro.fwd.down||ro.left.down||ro.right.down},{step:10,fun:()=>ro.lmb.down||ro.rmb.down,click:!0},{click:!0},{element:"ufplayer",click:!0},{},{element:"uftarget",click:!0},{element:"sk1"},{},{click:!0},{element:"expbar",click:!0},{},{element:"sysbag",step:100,fun:()=>gi.inventoryOpen},{element:"bag2",click:!0},{click:!0},{element:"syschar",step:100,fun:()=>gi.charpanelOpen},{element:"equipslots",click:!0},{fixed:()=>qn.player.stats.getStat(21)>0?100:Math.round(qn.player.exp/eu(qn.player.level)*100)},{element:"syschar",step:100,fun:()=>gi.charpanelOpen},{element:"statpoints"},{step:100,fixed:()=>Math.round(qn.player.exp/eu(qn.player.level)*100),fun:()=>qn.player.level>3},{click:!0},{fixed:()=>Math.round(qn.player.inventory.gold/32*100)},{fun:()=>gi.traderWindow},{element:()=>"trader"+ef.findIndex(t=>"book"===t.item.type&&3===t.item.level&&t.item.class===qn.player.class)},{element:"bag0",click:!0},{element:"sysbook",step:100,fun:()=>gi.skillmenuOpen},{element:"skilllist",click:!0},{element:"skillbar",click:!0},{click:!0},{click:!0},{click:!0},{click:!0,element:"partybtn"},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{click:!0},{element:"chat"},{element:"chatinput"},{element:"syscog",step:100,click:!0,fun:()=>gi.settingsOpen},{click:!0},{step:100,fun:()=>!gi.settingsOpen},{click:!0},{click:!0},{gate:()=>qn.player.level>=25,click:!0}];hma.graphics.ui.elements=nf;let af=!1;const rf=t=>(Yr({id:"ui/event1",pitch:-1}),{...nf[t],msg:qh.ui.tutorial.msg[t],Tf:0}),of=new Dl(0,.2),lf=(t,e,s)=>!(!(s||e>0)||-1!==t&&gi.tutprogress!==t||(le.update(i=>i?(i.Tf=Math.min(100,s||i.Tf+e),i.complete=i.Tf>=100,i.complete&&!i.closing&&(i.closing=!0,Yr({id:"ui/event2",gain:.4,pitch:-1}),setTimeout(()=>{le.set(),setTimeout(()=>{ls.update(t=>(Kd("tutorial","completestep",t,Math.round(performance.now()/1e3)),nf[t+1]&&nf[t+1].element&&"string"!=typeof nf[t+1].element&&(nf[t+1].element=nf[t+1].element()),t+1))},100)},1e3)),i):rf(t)),0));var cf=Object.freeze({__proto__:null,steps:nf,onWorldEnter:()=>{of.reset(qn.smoothtime),af||(af=!0,ls.subscribe(t=>{const e=nf[t];e&&(void 0===e.gate||e.gate())?le.set(rf(t)):le.set()}))},postTick:()=>{const t=nf[gi.tutprogress];t&&of.done(qn.smoothtime)&&(of.reset(qn.smoothtime),(void 0===t.gate||t.gate())&&(t.gate&&t.gate()&&lf(gi.tutprogress,void 0,1),t.fun&&t.fun()&&lf(gi.tutprogress,t.step),t.fixed&&lf(gi.tutprogress,void 0,t.fixed())))},tut:lf});const{Map:hf}=wt;function df(t,e,s){const i=t.slice();return i[27]=e[s],i}function uf(t,e,s){const i=t.slice();return i[30]=e[s],i}function mf(t,e,s){const i=t.slice();return i[33]=e[s],i}function pf(t){let e,s,i,n;const a=[gf,ff],r=[];function o(t,e){return"whisper"!=t[33].channel&&void 0!==t[33].faction?0:1}return e=o(t),s=r[e]=a[e](t),{c(){s.c(),i=R()},m(t,s){r[e].m(t,s),$(t,i,s),n=!0},p(t,n){let l=e;(e=o(t))===l?r[e].p(t,n):(ft(),yt(r[l],1,1,()=>{r[l]=null}),gt(),(s=r[e])||(s=r[e]=a[e](t)).c(),vt(s,1),s.m(i.parentNode,i))},i(t){n||(vt(s),n=!0)},o(t){yt(s),n=!1},d(t){r[e].d(t),t&&S(i)}}}function ff(e){let s,i,n,a,r=e[33].sender+"";return{c(){s=M("span"),i=E(r),a=_(),T(s,"class",n="textf"+e[33].faction+" svelte-1vrlsr3")},m(t,e){$(t,s,e),k(s,i),$(t,a,e)},p(t,e){64&e[0]&&r!==(r=t[33].sender+"")&&D(i,r),64&e[0]&&n!==(n="textf"+t[33].faction+" svelte-1vrlsr3")&&T(s,"class",n)},i:t,o:t,d(t){t&&S(s),t&&S(a)}}}function gf(t){let e;const s=new Jd({props:{name:t[33].sender,pclass:t[33].cclass,level:t[33].level,faction:t[33].faction,sub:t[33].sub}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};64&e[0]&&(i.name=t[33].sender),64&e[0]&&(i.pclass=t[33].cclass),64&e[0]&&(i.level=t[33].level),64&e[0]&&(i.faction=t[33].faction),64&e[0]&&(i.sub=t[33].sub),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function vf(t){let e,s,i,n=t[33].text+"";return{c(){e=M("span"),s=E(n),T(e,"class",i="text"+t[33].channel+" svelte-1vrlsr3")},m(t,i){$(t,e,i),k(e,s)},p(t,a){64&a[0]&&n!==(n=t[33].text+"")&&D(s,n),64&a[0]&&i!==(i="text"+t[33].channel+" svelte-1vrlsr3")&&T(e,"class",i)},d(t){t&&S(e)}}}function yf(t){let e,s,i=t[33].text+"";return{c(){T(e=M("span"),"class",s="text"+t[33].channel+" svelte-1vrlsr3")},m(t,s){$(t,e,s),e.innerHTML=i},p(t,n){64&n[0]&&i!==(i=t[33].text+"")&&(e.innerHTML=i),64&n[0]&&s!==(s="text"+t[33].channel+" svelte-1vrlsr3")&&T(e,"class",s)},d(t){t&&S(e)}}}function bf(t,e){let s,i,n,a,r,o,l,c,h,d,u=e[33].time+"",m=e[33].channel+"",p=e[33].sender&&pf(e);function f(t,e){return t[33].interpolate?yf:vf}let g=f(e),v=g(e);return{key:t,first:null,c(){s=M("article"),i=M("div"),n=M("span"),a=E(u),r=M("span"),o=M("span"),l=E(m),c=_(),p&&p.c(),v.c(),T(n,"class","time svelte-1vrlsr3"),T(o,"class","capitalize channel svelte-1vrlsr3"),T(r,"class",h="text"+e[33].channel+" content svelte-1vrlsr3"),T(i,"class","linewrap svelte-1vrlsr3"),T(s,"class","line svelte-1vrlsr3"),this.first=s},m(t,e){$(t,s,e),k(s,i),k(i,n),k(n,a),k(i,r),k(r,o),k(o,l),k(r,c),p&&p.m(r,null),v.m(i,null),d=!0},p(t,e){(!d||64&e[0])&&u!==(u=t[33].time+"")&&D(a,u),(!d||64&e[0])&&m!==(m=t[33].channel+"")&&D(l,m),t[33].sender?p?(p.p(t,e),vt(p,1)):((p=pf(t)).c(),vt(p,1),p.m(r,null)):p&&(ft(),yt(p,1,1,()=>{p=null}),gt()),(!d||64&e[0]&&h!==(h="text"+t[33].channel+" content svelte-1vrlsr3"))&&T(r,"class",h),g===(g=f(t))&&v?v.p(t,e):(v.d(1),(v=g(t))&&(v.c(),v.m(i,null)))},i(t){d||(vt(p),d=!0)},o(t){yt(p),d=!1},d(t){t&&S(s),p&&p.d(),v.d()}}}function xf(t){let e,s,i,n,a,r=t[30]+"";function o(...e){return t[22](t[30],...e)}return{c(){e=M("div"),s=E("/"),i=E(r),T(e,"class",n="choice textsystem text"+t[30]+" svelte-1vrlsr3"),a=P(e,"click",o)},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(e,s){t=e},d(t){t&&S(e),a()}}}function wf(t){let e,s,i,n,a=t[27]+"";function r(...e){return t[26](t[27],...e)}return{c(){e=M("small"),s=E(a),T(e,"class",i="btn border black text"+(t[5].indexOf(t[27])<0?t[27]:"grey")+" svelte-1vrlsr3"),n=P(e,"click",r)},m(t,i){$(t,e,i),k(e,s)},p(s,n){t=s,32&n[0]&&i!==(i="btn border black text"+(t[5].indexOf(t[27])<0?t[27]:"grey")+" svelte-1vrlsr3")&&T(e,"class",i)},d(t){t&&S(e),n()}}}function kf(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y=[],b=new hf,x=t[6];const w=t=>t[33].id;for(let e=0;e<x.length;e+=1){let s=mf(t,x,e),i=w(s);b.set(i,y[e]=bf(i,s))}let _=Object.keys(jd),A=[];for(let e=0;e<_.length;e+=1)A[e]=xf(uf(t,_,e));let R=t[10],I=[];for(let e=0;e<R.length;e+=1)I[e]=wf(df(t,R,e));return{c(){e=M("div"),s=M("section");for(let t=0;t<y.length;t+=1)y[t].c();i=M("div"),n=M("section"),r=M("div"),o=M("div");for(let t=0;t<A.length;t+=1)A[t].c();(l=M("div")).textContent="/[playername]",c=M("div"),h=E(t[4]),u=M("input"),p=M("div");for(let t=0;t<I.length;t+=1)I[t].c();T(s,"id","chat"),T(s,"class","panel frame svelte-1vrlsr3"),T(l,"class","choice textwhisper"),T(o,"class","panel context commandlist textsystem svelte-1vrlsr3"),F(o,"display",t[3]?"block":"none"),T(c,"class",d="command btn black text"+(hma.chat.commands.list[t[4]]?hma.chat.commands.list[t[4]].chat?t[4]:"system":"whisper")+" svelte-1vrlsr3"),T(u,"maxlength","480"),T(u,"type","text"),T(u,"class","svelte-1vrlsr3"),T(r,"id","chatinput"),T(r,"class","inputcontainer panel-black border black svelte-1vrlsr3"),T(n,"class",m="chatsection "+(t[2]?"":"hidden")+" svelte-1vrlsr3"),T(p,"class",f="channelselect "+(t[2]?"hidden":"")+" svelte-1vrlsr3"),T(i,"class","lowercontainer svelte-1vrlsr3"),T(e,"class","l-corner-ll container uiscaled svelte-1vrlsr3"),v=[P(c,"click",function(){t[23].apply(this,arguments)}),P(u,"input",t[25])]},m(a,d){$(a,e,d),k(e,s);for(let t=0;t<y.length;t+=1)y[t].m(s,null);t[21](s),k(e,i),k(i,n),k(n,r),k(r,o);for(let t=0;t<A.length;t+=1)A[t].m(o,null);k(o,l),k(r,c),k(c,h),k(r,u),t[24](u),k(i,p);for(let t=0;t<I.length;t+=1)I[t].m(p,null);g=!0},p(e,i){const a=(t=e)[6];if(ft(),y=St(y,i,w,1,t,a,b,s,$t,bf,null,mf),gt(),256&i[0]){let e;for(_=Object.keys(jd),e=0;e<_.length;e+=1){const s=uf(t,_,e);A[e]?A[e].p(s,i):(A[e]=xf(s),A[e].c(),A[e].m(o,l))}for(;e<A.length;e+=1)A[e].d(1);A.length=_.length}if((!g||8&i[0])&&F(o,"display",t[3]?"block":"none"),(!g||16&i[0])&&D(h,t[4]),(!g||16&i[0]&&d!==(d="command btn black text"+(hma.chat.commands.list[t[4]]?hma.chat.commands.list[t[4]].chat?t[4]:"system":"whisper")+" svelte-1vrlsr3"))&&T(c,"class",d),(!g||4&i[0]&&m!==(m="chatsection "+(t[2]?"":"hidden")+" svelte-1vrlsr3"))&&T(n,"class",m),1568&i[0]){let e;for(R=t[10],e=0;e<R.length;e+=1){const s=df(t,R,e);I[e]?I[e].p(s,i):(I[e]=wf(s),I[e].c(),I[e].m(p,null))}for(;e<I.length;e+=1)I[e].d(1);I.length=R.length}(!g||4&i[0]&&f!==(f="channelselect "+(t[2]?"hidden":"")+" svelte-1vrlsr3"))&&T(p,"class",f)},i(t){if(!g){for(let t=0;t<x.length;t+=1)vt(y[t]);g=!0}},o(t){for(let t=0;t<y.length;t+=1)yt(y[t]);g=!1},d(s){s&&S(e);for(let t=0;t<y.length;t+=1)y[t].d();t[21](null),C(A,s),t[24](null),C(I,s),a(v)}}}function $f(t,e,s){let i,n,a,r;h(t,Wt,t=>s(14,i=t)),h(t,je,t=>s(4,n=t)),h(t,ms,t=>s(5,a=t));let o,l=!0;V(()=>{l=r&&(r.offsetHeight+r.scrollTop>r.scrollHeight-20||0==r.scrollTop)}),Y(()=>{!1!==l&&r.scrollTo(0,r.scrollHeight)});let c=!1,d=[],u=0,m=!1,p="global";const g=new Map([["c","clan"],["p","party"],["g","global"],["f","faction"]]),v=t=>{const e=t.match(/^\/[a-zA-Z0-9]+ /g);if(e){const a=e[0].substring(1,e[0].length-1);if("r"===a||"w"===a)for(let t=i.length-1;t>0;--t){const e=i[t];"whisper"==e.channel&&"from"===e.sender.substring(0,4)&&(f(je,n=e.sender.slice(5)),t=0)}else f(je,n=g.has(a)?g.get(a):a);s(1,o.value=t.substring(e[0].length),o)}},y=t=>hma.chat.commands.list[t]&&hma.chat.commands.list[t].chat,b=t=>{if(13===t.keyCode)if(t.target==o){if(""!=t.target.value){lf(39,100);const e=t.target.value.match(/^\/[a-zA-Z0-9]+/g);e&&(f(je,n=e[0].substring(1)),s(1,o.value="",o)),hma.chat.commands.pack(n,o.value);const i=`/${n} `+o.value;d[d.length-1]!=i&&(u=d.push(i)),s(1,o.value="",o),s(2,c=!1),o.blur()}else y(n)||hma.chat.commands.pack(n,o.value),s(2,c=!1),o.blur();y(n)?p=n:f(je,n=p)}else document.activeElement==document.body&&(s(2,c=!0),o.focus(),(rt(),it).then(k));else 38!==t.keyCode&&40!==t.keyCode||!d.length?27===t.keyCode&&(s(2,c=!1),o.blur()):t.target==o&&(u+=38===t.keyCode?-1:1,u=ia(u,0,d.length-1),v(d[u]),t.preventDefault())},k=t=>{o&&o.focus(),lf(38,100)},x=t=>{f(je,n=t),s(3,m=!1),o&&o.focus()};G(()=>{document.addEventListener("keydown",b)}),X(()=>{document.removeEventListener("keydown",b),s(1,o=void 0)});const $=t=>{const e=a.indexOf(t);ms.update(s=>(e>=0?s.splice(e,1):s.push(t),s))};let w;return t.$$.update=(()=>{16416&t.$$.dirty[0]&&s(6,w=i.filter(t=>a.indexOf(t.channel)<0))}),[r,o,c,m,n,a,w,v,x,$,["global","faction","party","clan","pvp","inv"],l,u,p,i,d,void 0,g,y,b,k,function(t){tt[t?"unshift":"push"](()=>{s(0,r=t)})},(t,e)=>x(t),t=>s(3,m=!m),function(t){tt[t?"unshift":"push"](()=>{s(1,o=t)})},t=>v(t.target.value),(t,e)=>$(t)]}class Sf extends Pt{constructor(t){super(),Rt(this,t,$f,kf,o,{},[-1,-1])}}function Cf(t){let e,s;return{c(){(e=M("img")).src!==(s="/assets/ui/icons/"+t[1]+".svg?v=3406973")&&T(e,"src",s),T(e,"class","titleicon svgicon svelte-1rw636")},m(t,s){$(t,e,s)},p(t,i){2&i&&e.src!==(s="/assets/ui/icons/"+t[1]+".svg?v=3406973")&&T(e,"src",s)},d(t){t&&S(e)}}}function Mf(e){let s,i,n;return{c(){(s=M("img")).src!==(i="/assets/ui/icons/cross.svg?v=3406973")&&T(s,"src","/assets/ui/icons/cross.svg?v=3406973"),T(s,"class","btn black svgicon"),n=P(s,"click",e[7])},m(t,e){$(t,s,e)},p:t,d(t){t&&S(s),n()}}}function Ef(t){let e,s,i,n,a,r,o,l,c=t[1]&&Cf(t),h=t[2]&&Mf(t);const p=t[6].default,f=d(p,t,t[5],null);return{c(){e=M("div"),s=M("div"),c&&c.c(),i=M("div"),n=M("div"),a=E(t[0]),h&&h.c(),r=M("div"),f&&f.c(),T(n,"name","title"),T(i,"class","textprimary title svelte-1rw636"),T(s,"class","titleframe svelte-1rw636"),T(r,"class","slot svelte-1rw636"),T(r,"style",o=t[3]?"overflow-y: auto;":""),T(e,"class","window panel-black svelte-1rw636")},m(t,o){$(t,e,o),k(e,s),c&&c.m(s,null),k(s,i),k(i,n),k(n,a),h&&h.m(s,null),k(e,r),f&&f.m(r,null),l=!0},p(t,[e]){t[1]?c?c.p(t,e):((c=Cf(t)).c(),c.m(s,i)):c&&(c.d(1),c=null),(!l||1&e)&&D(a,t[0]),t[2]?h?h.p(t,e):((h=Mf(t)).c(),h.m(s,null)):h&&(h.d(1),h=null),f&&f.p&&32&e&&f.p(u(p,t,t[5],null),m(p,t[5],e,null)),(!l||8&e&&o!==(o=t[3]?"overflow-y: auto;":""))&&T(r,"style",o)},i(t){l||(vt(f,t),l=!0)},o(t){yt(f,t),l=!1},d(t){t&&S(e),c&&c.d(),h&&h.d(),f&&f.d(t)}}}function _f(t,e,s){const i=Z();let{title:n="Title"}=e,{icon:a}=e,{close:r=!0}=e,{scroll:o=!1}=e,{$$slots:l={},$$scope:c}=e;return t.$set=(t=>{"title"in t&&s(0,n=t.title),"icon"in t&&s(1,a=t.icon),"close"in t&&s(2,r=t.close),"scroll"in t&&s(3,o=t.scroll),"$$scope"in t&&s(5,c=t.$$scope)}),[n,a,r,o,i,c,l,()=>i("close")]}class Rf extends Pt{constructor(t){super(),Rt(this,t,_f,Ef,o,{title:0,icon:1,close:2,scroll:3})}}const Pf=(t,e)=>{const{c:s,s:i,g:n}=(t=>{const e=(t||0).toString().split("");return{c:e.splice(-2).join(""),s:e.splice(-2).join(""),g:e.join("")}})(t);let a="<span/>";return""!=n&&(a+=`<span class=${e?"textred":"textgold"}>${n}</span> <img class=texticon src='/assets/ui/currency/gold.${wr}?v=3406973'/>`),""!=i&&(a+=`<span class=${e?"textred":"textsilver"}>${i}</span> <img class=texticon src='/assets/ui/currency/silver.${wr}?v=3406973'/>`),""!=s&&(a+=`<span class=${e?"textred":"textcopper"}>${s}</span> <img class=texticon src='/assets/ui/currency/copper.${wr}?v=3406973'/>`),a+"</span>"},Tf=[t=>t.replace(/\$c(\d)/g,(t,e)=>`<img class=texticon src='${Vd(e)}'>`),t=>t.replace(/\$l(\d+)/g,(t,e)=>`<span class=textwhite>${e}</span>`),t=>t.replace(/\$f(\d)(\w*)/g,(t,e,s)=>`<span class=textf${e}>${s}</span>`),t=>t.replace(/\$g(\d+)/g,(t,e)=>Pf(e,!1)),t=>t.replace(/\$fm(\d+)/g,(t,e)=>`<span class=textfame><img class=texticon src='/assets/ui/icons/crown.svg?v=3406973'> ${e}</span>`),t=>t.replace(/\$gt/g,(t,e)=>'<img class="svgicon" src="/assets/ui/icons/check.svg?v=3406973">'),t=>t.replace(/\$sp(\d+)/g,(t,e)=>"<img class=texticon src=/assets/ui/icons/gem.svg?v=3406973/>"+e)],If=t=>Tf.reduce((t,e)=>e(t),t);function Df(t,e,s){const i=t.slice();return i[4]=e[s],i[6]=s,i}function Af(t){let e,s;const i=new Rf({props:{title:"Interaction",$$slots:{default:[zf]},$$scope:{ctx:t}}});return i.$on("close",t[3]),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","l-upperLeftModal container uiscaled svelte-1uoyfak")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,e){const s={};129&e&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function Ff(t){let e,s,i,n,a=If(t[4])+"";function r(...e){return t[2](t[6],...e)}return{c(){e=M("div"),s=M("span"),T(e,"class","choice"),T(e,"value",i=t[6]),n=P(e,"click",r)},m(t,i){$(t,e,i),k(e,s),s.innerHTML=a},p(e,i){t=e,1&i&&a!==(a=If(t[4])+"")&&(s.innerHTML=a)},d(t){t&&S(e),n()}}}function zf(t){let e,s,i,n,a,r=t[0].title+"",o=t[0].text+"",l=t[0].choices,c=[];for(let e=0;e<l.length;e+=1)c[e]=Ff(Df(t,l,e));return{c(){e=M("div"),s=M("h3"),i=E(r),n=M("p"),a=E(o);for(let t=0;t<c.length;t+=1)c[t].c();T(s,"class","textprimary name svelte-1uoyfak"),T(e,"class","container svelte-1uoyfak")},m(t,r){$(t,e,r),k(e,s),k(s,i),k(e,n),k(n,a);for(let t=0;t<c.length;t+=1)c[t].m(e,null)},p(t,s){if(1&s&&r!==(r=t[0].title+"")&&D(i,r),1&s&&o!==(o=t[0].text+"")&&D(a,o),3&s){let i;for(l=t[0].choices,i=0;i<l.length;i+=1){const n=Df(t,l,i);c[i]?c[i].p(n,s):(c[i]=Ff(n),c[i].c(),c[i].m(e,null))}for(;i<c.length;i+=1)c[i].d(1);c.length=l.length}},d(t){t&&S(e),C(c,t)}}}function Bf(t){let e,s,i=t[0]&&Af(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),vt(i,1)):((i=Af(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function Uf(t,e,s){let i;function n(t){fd(hma.handle.data.clientPlayerInteract.packData({id:t})),f(Ot,i=void 0)}return h(t,Ot,t=>s(0,i=t)),[i,n,(t,e)=>n(t),()=>{f(Ot,i=void 0)}]}class Of extends Pt{constructor(t){super(),Rt(this,t,Uf,Bf,o,{})}}function jf(t){let e,s,i,n,a,r,o,l,c;const h=t[7].default,p=d(h,t,t[6],null);return{c(){e=M("div"),s=M("div"),i=M("span"),n=E(t[0]),a=M("span"),r=E(t[1]),p&&p.c(),T(i,"class","left svelte-kl29tr"),T(a,"class","right svelte-kl29tr"),T(s,"class",o="progressBar "+t[3]+" svelte-kl29tr"),F(s,"width",t[2]+"%"),F(s,"font-size",t[4]),T(e,"class",l="bar "+(t[5]?"dark":"")+" svelte-kl29tr"),F(e,"z-index","hp"==t[3]?"1":"0")},m(t,o){$(t,e,o),k(e,s),k(s,i),k(i,n),k(s,a),k(a,r),p&&p.m(e,null),c=!0},p(t,[i]){(!c||1&i)&&D(n,t[0]),(!c||2&i)&&D(r,t[1]),(!c||8&i&&o!==(o="progressBar "+t[3]+" svelte-kl29tr"))&&T(s,"class",o),(!c||4&i)&&F(s,"width",t[2]+"%"),(!c||16&i)&&F(s,"font-size",t[4]),p&&p.p&&64&i&&p.p(u(h,t,t[6],null),m(h,t[6],i,null)),(!c||32&i&&l!==(l="bar "+(t[5]?"dark":"")+" svelte-kl29tr"))&&T(e,"class",l),(!c||8&i)&&F(e,"z-index","hp"==t[3]?"1":"0")},i(t){c||(vt(p,t),c=!0)},o(t){yt(p,t),c=!1},d(t){t&&S(e),p&&p.d(t)}}}function Lf(t,e,s){let{left:i}=e,{right:n}=e,{fract:a}=e,{barcol:r}=e,{size:o}=e,{darken:l}=e,{$$slots:c={},$$scope:h}=e;return t.$set=(t=>{"left"in t&&s(0,i=t.left),"right"in t&&s(1,n=t.right),"fract"in t&&s(2,a=t.fract),"barcol"in t&&s(3,r=t.barcol),"size"in t&&s(4,o=t.size),"darken"in t&&s(5,l=t.darken),"$$scope"in t&&s(6,h=t.$$scope)}),[i,n,a,r,o,l,h,c]}class Nf extends Pt{constructor(t){super(),Rt(this,t,Lf,jf,l,{left:0,right:1,fract:2,barcol:3,size:4,darken:5})}}function qf(t){let e,s,i=t[2]>99?Math.round(t[2]/60)+"m":t[2]+"s";return{c(){e=M("div"),s=E(i),T(e,"class","time svelte-13z88m9")},m(t,i){$(t,e,i),k(e,s)},p(t,e){4&e&&i!==(i=t[2]>99?Math.round(t[2]/60)+"m":t[2]+"s")&&D(s,i)},d(t){t&&S(e)}}}function Hf(e){let s,i,n,a,r,o,l,c,h,d,u="default"===e[1]&&qf(e);return{c(){s=M("div"),u&&u.c(),i=M("div"),n=M("img"),o=M("div"),l=M("div"),c=E(e[3]),T(n,"class",a="icon "+e[1]+" svelte-13z88m9"),n.src!==(r=e[5])&&T(n,"src",r),T(o,"class","overlay cd svelte-13z88m9"),F(o,"height",e[4]+"%"),T(l,"class","stacks slottext svelte-13z88m9"),T(i,"class",h="slot border "+(1===e[0].logic.type?"negative":"positive")+" svelte-13z88m9"),T(s,"class",d="container "+(e[2]<5?"soon":"")+" svelte-13z88m9")},m(t,e){$(t,s,e),u&&u.m(s,null),k(s,i),k(i,n),k(i,o),k(i,l),k(l,c)},p(t,[e]){"default"===t[1]?u?u.p(t,e):((u=qf(t)).c(),u.m(s,i)):u&&(u.d(1),u=null),2&e&&a!==(a="icon "+t[1]+" svelte-13z88m9")&&T(n,"class",a),32&e&&n.src!==(r=t[5])&&T(n,"src",r),16&e&&F(o,"height",t[4]+"%"),8&e&&D(c,t[3]),1&e&&h!==(h="slot border "+(1===t[0].logic.type?"negative":"positive")+" svelte-13z88m9")&&T(i,"class",h),4&e&&d!==(d="container "+(t[2]<5?"soon":"")+" svelte-13z88m9")&&T(s,"class",d)},i:t,o:t,d(t){t&&S(s),u&&u.d()}}}function Wf(t,e,s){let i;h(t,Se,t=>s(6,i=t));let n,a,r,o,{buff:l}=e,{mode:c}=e,d="default"==c?29:21;return t.$set=(t=>{"buff"in t&&s(0,l=t.buff),"mode"in t&&s(1,c=t.mode)}),t.$$.update=(()=>{1&t.$$.dirty&&s(5,o=`/assets/ui/${l.logic.icon}.${kr}?v=3406973`),69&t.$$.dirty&&(s(2,n=Math.max(0,Math.ceil(l.timer.remaining(i)))),s(4,r=~~(Math.round(l.timer.fraction(i)*d)/d*100)),s(3,a=l.diminish>1?l.diminish:l.stacks>1?l.stacks:""))}),[l,c,n,a,r,o]}class Qf extends Pt{constructor(t){super(),Rt(this,t,Wf,Hf,l,{buff:0,mode:1})}}let Vf=0,Gf=!1;const Yf=[0,0,0],Xf={enemy:[1,0,0],friendly:[0,1,0],dead:[.6,.6,.6]},Zf=t=>{if(qn&&qn.player){const e=hma.handle.data.clientPlayerChangeTarget.packData({target:t});fd(e)}};let Jf=0;const Kf=(t,e=!0)=>{Vf=t,Gf=e&&Vf>0,Yt.set(Gf?"pointer":"auto"),re.set(Vf)};let tg=0,eg=0,sg=0;const ig=t=>{if(sg>0){let e=0,s=0;t=t.filter(t=>void 0!==t.transform&&void 0!==t.stats&&t.stats.alive&&t!==qn.player&&qn.player.canCombatInteract(t)&&Math.abs(pa(qn.player.rot,qn.player.rotationToV3(t.CR)))<.7);let i=0===qn.player.target;for(let n=t.length-1;n>=0;--n){const a=t[n];1===sg!=qn.player.hostility(a)>0&&(i&&(e=a.id),qn.player.target===a.id&&(i=!0),s||(s=a.id),0!==e&&(n=0))}0===e&&0!==s&&(e=s),Zf(e),sg=0}};var ng=Object.freeze({__proto__:null,get hovertarget(){return Vf},get hoverinteractive(){return Gf},YD:Yf,setTarget:Zf,init:()=>{ro.lmb.onPress(t=>{Jf=qn.time}),ro.lmb.onRelease(t=>{Vf>0&&uo<20&&qn.time-Jf<.3&&Zf(Vf)}),ro.nextTarget.onPress(t=>{sg=t.shiftKey?1:2}),ro.untarget.onPress(t=>{Zf(0)})},setHoverTarget:Kf,preTick:t=>{if(ro.shift.down)return;if(fo)return void(Vf>0&&(uo>=20||qn.time-Jf>.3)&&Kf(0,!1));xi(Yf,io[0],io[1],.5),Un.unproject(Yf),$i(Yf,Yf,Un.worldPosition),_i(Yf,Yf);const e=Vf;Vf=0;let s=1/0,i=!1;qn.entities.array.forEach(t=>{if(!t.transform.visible)return;const e=bi(Gn,t.transform.position);e[1]+=.3*t.size;const n=Ei(e,((t,e,s)=>{$i(Qn,s,t);const i=Ri(Qn,e);return Ci(Qn,t,e,i)})(Un.worldPosition,Yf,e));(void 0===t.stats||t.stats.alive)&&n<s&&n<(t.size+.5)**2&&t.hudPos[2]<1&&(s=n,Vf=t.id,i=3!==t.constructor.type||t.canBePickedUpBy(qn.player))}),e==Vf&&i===Gf||Kf(Vf,i)},tick:t=>{if(!qn.player)return;let e=qn.player.target;const s=Vf&&qn.getEntityById(Vf);if(s&&3==s.constructor.type&&(e=Vf),e!==tg?(tg=e,eg=1):eg=Math.max(eg*(1-20*t),0),e>0){const t=qn.getEntityById(e);if(void 0!==t){xi(cl.oZ.value,t.transform.position[0],.5*t.size+.5+eg,t.transform.position[2]);const e=t.stats&&t.stats.alive?qn.player.hostility(t)>0?Xf.enemy:Xf.friendly:Xf.dead;tn(cl.pP.value,...e,1-eg)}}else xi(cl.oZ.value,0,0,0)},parseHudTargets:ig});const ag={jQ:{managers:[],partyBasedHostility:!1,allowRespawn:!0,pvpprotect:!0},arena1v1:{name:"Arena 1v1",queue:!0,instances:["arena_ruins"],partyBasedHostility:!0,allowRespawn:!1,pvpprotect:!1,groupsize:1,groupcount:2},arena2v2:{name:"Arena 2v2",queue:!0,instances:["arena_ruins2"],partyBasedHostility:!0,allowRespawn:!1,pvpprotect:!1,groupsize:2,groupcount:2},memberfind:{name:"Find members",queue:!0,partyfind:!0}},rg={partyleave:t=>({name:qh.ui.party.leave,fun:()=>{hma.chat.commands.pack("partyleave")}}),partyinvite:t=>({name:qh.ui.party.invite,fun:()=>{hma.chat.commands.pack("partyinvite",t)}}),partykick:t=>({name:qh.ui.party.kick,fun:()=>{hma.chat.commands.pack("partykick",t)}}),partygiveassistant:t=>({name:qh.ui.party.giveAssistant,fun:()=>{hma.chat.commands.pack("partysetrole",t+" 1")}}),partygiveleader:t=>({name:qh.ui.party.giveLeader,fun:()=>{hma.chat.commands.pack("partysetrole",t+" 2")}}),partyremoveassistant:t=>({name:qh.ui.party.removeAssistant,fun:()=>{hma.chat.commands.pack("partysetrole",t+" 0")}}),partylink:t=>({name:qh.ui.party.link,fun:()=>{hma.chat.commands.pack("partylink")}}),partycreate:t=>({name:qh.ui.party.create,fun:()=>{hma.chat.commands.pack("partycreate")}}),whisper:t=>({name:qh.ui.chat.whisper,fun:()=>{je.set(t)}}),itemdrop:t=>({name:qh.ui.inventory.drop,fun:()=>{hma.chat.commands.pack("itemdrop",t)}}),itemstash:t=>({name:qh.ui.stash.stash,fun:()=>{hma.chat.commands.pack("itemstash",t)}}),itemmove:(t,e)=>({name:qh.ui.inventory.equip,fun:()=>{lf(13,100),hma.chat.commands.pack("itemmove",`${t} ${e}`)}}),itemsplithalf:t=>({name:qh.ui.inventory.splithalf,fun:()=>{hma.chat.commands.pack("itemsplithalf",t)}}),itemsplitone:t=>({name:qh.ui.inventory.splitone,fun:()=>{hma.chat.commands.pack("itemsplitone",t)}}),itemuse:(t,e)=>({name:zp.get(e).name||qh.ui.inventory.use,fun:()=>{fd(hma.handle.data.clientPlayerSkill.packData({id:e,info:[t]}))}}),startqueue:(t,e)=>({name:ag[t].name,css:e?"":"disabled",fun:()=>{hma.chat.commands.pack("startqueue",t)}}),stopqueue:(t,e)=>({icon:"check",name:ag[t].name,css:e?"":"disabled",fun:()=>{hma.chat.commands.pack("stopqueue",t)}})},og=(t,e)=>{const s=[];0===e.type&&(e.id==qn.player.id?gi.partyinfo.membercount>0?s.push(rg.partyleave()):s.push(rg.partycreate()):(e.faction==qn.player.faction&&(qn.party.has(e.name)?gi.partyinfo.role>e.role&&(2==gi.partyinfo.role&&s.push(rg.partykick(e.name)),0==e.role?s.push(rg.partygiveassistant(e.name)):1==e.role&&s.push(rg.partyremoveassistant(e.name)),gi.partyinfo.role>1&&s.push(rg.partygiveleader(e.name))):s.push(rg.partyinvite(e.name))),s.push(rg.whisper(e.name)))),zt.set({x:t.pageX,y:t.pageY,opts:s})},lg=t=>{const e=Object.entries(t);return e.forEach(t=>{t[0]=parseInt(t[0]),"object"==typeof t[1]&&(t[1]=lg(t[1]))}),new Map(e)},cg=t=>t>1e3?(t/1e3).toFixed(1)+"k":t+"",hg=t=>t<999?t+"":hg(~~(t/1e3))+","+("00"+~~(t%1e3)).substr(-3,3),dg=(t,e)=>t.length>e?`${t.slice(0,e-2)}...`:t,ug=lg({14:.1,13:.1,9:.1,8:.1,16:.1}),mg=lg({14:"%",13:"%",16:"%",18:"%"}),pg=(t,e)=>(ug.has(t)&&(e=(e*=ug.get(t)).toFixed(e>=.1?1:2)),e+(mg.get(t)||""));function fg(t,e,s){const i=t.slice();return i[26]=e[s],i}function gg(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g=[],v=new Map,y="default"==t[1]&&vg();const b=new Nf({props:{size:"1.3em",fract:t[7],barcol:t[12],left:t[9],right:t[5],darken:!1,$$slots:{default:[bg]},$$scope:{ctx:t}}});let x=("default"==t[1]||t[18])&&xg(t);function w(t,e){return t[14].role>=1?$g:kg}let E=w(t),C=E(t),_="default"==t[1]&&t[14].combat&&t[14].alive&&Sg(),A=t[14].buffs.slice(0,t[4]);const I=t=>t[26].caster+1e5*t[26].id;for(let e=0;e<A.length;e+=1){let s=fg(t,A,e),i=I(s);v.set(i,g[e]=Cg(i,s))}return{c(){e=M("div"),s=M("div"),y&&y.c(),i=M("img"),o=M("div"),Mt(b.$$.fragment),x&&x.c(),l=R(),C.c(),c=R(),_&&_.c(),h=M("div");for(let t=0;t<g.length;t+=1)g[t].c();T(i,"class",n="pclass icon border black bgc"+t[14].class+" svelte-1rrmvqb"),i.src!==(r=(!1!==t[14].powertype?"/assets/ui/mobpower/"+t[14].powertype:"/assets/ui/classes/"+t[14].class)+"."+wr)&&T(i,"src",r),T(s,"class","iconcontainer svelte-1rrmvqb"),T(h,"class",d="buffarray "+t[1]+" svelte-1rrmvqb"),T(o,"class",u="panel-black bars "+(t[17]&&t[14].id==t[17].id&&"party"==t[1]?"target":"")+" "+(t[14].id&&t[14].range?"targetable":"")+" svelte-1rrmvqb"),T(e,"id",t[3]),T(e,"class",m="grid "+(t[2]?"right":"left")+" svelte-1rrmvqb"),F(e,"font-size",t[16]+"%"),F(e,"opacity",t[14].range?"":.5),f=[P(e,"click",t[19]),P(e,"contextmenu",function(){t[25].apply(this,arguments)})]},m(t,n){$(t,e,n),k(e,s),y&&y.m(s,null),k(s,i),k(e,o),Et(b,o,null),x&&x.m(o,null),k(o,l),C.m(o,null),k(o,c),_&&_.m(o,null),k(o,h);for(let t=0;t<g.length;t+=1)g[t].m(h,null);p=!0},p(a,f){"default"==(t=a)[1]?y||((y=vg()).c(),y.m(s,i)):y&&(y.d(1),y=null),(!p||16384&f&&n!==(n="pclass icon border black bgc"+t[14].class+" svelte-1rrmvqb"))&&T(i,"class",n),(!p||16384&f&&i.src!==(r=(!1!==t[14].powertype?"/assets/ui/mobpower/"+t[14].powertype:"/assets/ui/classes/"+t[14].class)+"."+wr))&&T(i,"src",r);const k={};128&f&&(k.fract=t[7]),4096&f&&(k.barcol=t[12]),512&f&&(k.left=t[9]),32&f&&(k.right=t[5]),536883330&f&&(k.$$scope={dirty:f,ctx:t}),b.$set(k),"default"==t[1]||t[18]?x?(x.p(t,f),vt(x,1)):((x=xg(t)).c(),vt(x,1),x.m(o,l)):x&&(ft(),yt(x,1,1,()=>{x=null}),gt()),E===(E=w(t))&&C?C.p(t,f):(C.d(1),(C=E(t))&&(C.c(),C.m(o,c))),"default"==t[1]&&t[14].combat&&t[14].alive?_||((_=Sg()).c(),_.m(o,h)):_&&(_.d(1),_=null);const $=t[14].buffs.slice(0,t[4]);ft(),g=St(g,f,I,1,t,$,v,h,$t,Cg,null,fg),gt(),(!p||2&f&&d!==(d="buffarray "+t[1]+" svelte-1rrmvqb"))&&T(h,"class",d),(!p||147458&f&&u!==(u="panel-black bars "+(t[17]&&t[14].id==t[17].id&&"party"==t[1]?"target":"")+" "+(t[14].id&&t[14].range?"targetable":"")+" svelte-1rrmvqb"))&&T(o,"class",u),(!p||8&f)&&T(e,"id",t[3]),(!p||4&f&&m!==(m="grid "+(t[2]?"right":"left")+" svelte-1rrmvqb"))&&T(e,"class",m),(!p||65536&f)&&F(e,"font-size",t[16]+"%"),(!p||16384&f)&&F(e,"opacity",t[14].range?"":.5)},i(t){if(!p){vt(b.$$.fragment,t),vt(x);for(let t=0;t<A.length;t+=1)vt(g[t]);p=!0}},o(t){yt(b.$$.fragment,t),yt(x);for(let t=0;t<g.length;t+=1)yt(g[t]);p=!1},d(t){t&&S(e),y&&y.d(),_t(b),x&&x.d(),C.d(),_&&_.d();for(let t=0;t<g.length;t+=1)g[t].d();a(f)}}}function vg(t){let e;return{c(){T(e=M("div"),"class","deco svelte-1rrmvqb")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function yg(t){let e,s,i;return{c(){T(e=M("div"),"class",s="progressBar "+t[12]+" hpdelta svelte-1rrmvqb"),T(e,"style",i=(t[13]?"transition:none;":"")+"width:"+t[7]+"%;")},m(t,s){$(t,e,s)},p(t,n){4096&n&&s!==(s="progressBar "+t[12]+" hpdelta svelte-1rrmvqb")&&T(e,"class",s),8320&n&&i!==(i=(t[13]?"transition:none;":"")+"width:"+t[7]+"%;")&&T(e,"style",i)},d(t){t&&S(e)}}}function bg(t){let e,s="default"==t[1]&&yg(t);return{c(){s&&s.c(),e=R()},m(t,i){s&&s.m(t,i),$(t,e,i)},p(t,i){"default"==t[1]?s?s.p(t,i):((s=yg(t)).c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},d(t){s&&s.d(t),t&&S(e)}}}function xg(t){let e;const s=new Nf({props:{size:"0.7em",fract:t[8],barcol:t[15],left:t[10],right:t[6],darken:!0,$$slots:{default:[wg]},$$scope:{ctx:t}}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};256&e&&(i.fract=t[8]),32768&e&&(i.barcol=t[15]),1024&e&&(i.left=t[10]),64&e&&(i.right=t[6]),536872960&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function wg(t){let e;return{c(){T(e=M("div"),"class","progressBar bgspell castbar svelte-1rrmvqb"),F(e,"width",t[11]+"%"),F(e,"display",t[11]>0?"inherit":"none")},m(t,s){$(t,e,s)},p(t,s){2048&s&&F(e,"width",t[11]+"%"),2048&s&&F(e,"display",t[11]>0?"inherit":"none")},d(t){t&&S(e)}}}function kg(t){let e,s,i;return{c(){T(e=M("img"),"class",s="tag icon border black bgf"+t[14].faction+" round svelte-1rrmvqb"),e.src!==(i="/assets/ui/factions/"+t[14].faction+"."+wr)&&T(e,"src",i)},m(t,s){$(t,e,s)},p(t,n){16384&n&&s!==(s="tag icon border black bgf"+t[14].faction+" round svelte-1rrmvqb")&&T(e,"class",s),16384&n&&e.src!==(i="/assets/ui/factions/"+t[14].faction+"."+wr)&&T(e,"src",i)},d(t){t&&S(e)}}}function $g(t){let e,s;return{c(){T(e=M("img"),"class","tag icon border black bgblack round svelte-1rrmvqb"),e.src!==(s="/assets/ui/icons/"+(2==t[14].role?"star":"starsilver")+"."+wr)&&T(e,"src",s)},m(t,s){$(t,e,s)},p(t,i){16384&i&&e.src!==(s="/assets/ui/icons/"+(2==t[14].role?"star":"starsilver")+"."+wr)&&T(e,"src",s)},d(t){t&&S(e)}}}function Sg(t){let e;return{c(){T(e=M("div"),"class","tag icon border black round combat svelte-1rrmvqb")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Cg(t,e){let s,i;const n=new Qf({props:{buff:e[26],mode:e[1]}});return{key:t,first:null,c(){s=R(),Mt(n.$$.fragment),this.first=s},m(t,e){$(t,s,e),Et(n,t,e),i=!0},p(t,e){const s={};16400&e&&(s.buff=t[26]),2&e&&(s.mode=t[1]),n.$set(s)},i(t){i||(vt(n.$$.fragment,t),i=!0)},o(t){yt(n.$$.fragment,t),i=!1},d(t){t&&S(s),_t(n,t)}}}function Mg(t){let e,s,i=t[14].visible&&gg(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[14].visible?i?(i.p(t,s),vt(i,1)):((i=gg(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function Eg(e,s,i){let n,a,r,o=t,l=()=>(o(),o=c(d,t=>i(14,n=t)),d);h(e,Vt,t=>i(17,a=t)),h(e,bs,t=>i(18,r=t)),e.$$.on_destroy.push(()=>o());let{unit:d}=s;l();let u,m,p,f,g,v,y,b,k,x,$,w,S,{mode:M="default"}=s,{order:E=0}=s,{id:C=""}=s,{buffcount:T}=s,_=!1,A=0;return e.$set=(t=>{"unit"in t&&l(i(0,d=t.unit)),"mode"in t&&i(1,M=t.mode),"order"in t&&i(2,E=t.order),"id"in t&&i(3,C=t.id),"buffcount"in t&&i(4,T=t.buffcount)}),e.$$.update=(()=>{16384&e.$$.dirty&&i(23,$=n.world==qn.id?!n.alive&&"Dead":n.world),9453570&e.$$.dirty&&(i(20,u=n.hpMax?"default"==M?cg(n.hp)+"/"+cg(n.hpMax):cg(n.hp):"?"),i(5,p=$||u),i(7,g="offline"!=$?n.hpMax?n.hp/n.hpMax*100:100:0),i(12,x=$?"bggrey":n.faction===qn.player.faction?"bghealth":"bgenemy")),16386&e.$$.dirty&&i(21,m=n.mpMax?"default"==M?cg(n.mp)+"/"+cg(n.mpMax):cg(n.mp):"?"),16384&e.$$.dirty&&i(9,y=n.name?dg(n.name,10):""),16384&e.$$.dirty&&i(10,b=n.timedSkill?n.timedSkill.name||qh.items.book[n.timedSkill.id].name:`Lv. ${n.level}`),10502144&e.$$.dirty&&i(6,f=$||(n.timedSkill?n.timedCast.remaining(qn.smoothtime).toFixed(1):m)),8404992&e.$$.dirty&&i(8,v="offline"!=$?n.mpMax?n.mp/n.mpMax*100:100:0),8404992&e.$$.dirty&&i(11,k="offline"!=$&&n.timedSkill?100*n.timedCast.fraction(qn.smoothtime):0),8388608&e.$$.dirty&&i(15,w=$?"bggrey":"bgmana"),2&e.$$.dirty&&i(16,S=Math.round("default"==M?100:85)),4210688&e.$$.dirty&&(i(13,_=A!=n.id),i(22,A=n.id))}),[d,M,E,C,T,p,f,g,v,y,b,k,x,_,n,w,S,a,r,t=>{n.id&&Zf(n.id)},u,m,A,$,void 0,t=>og(t,n)]}class _g extends Pt{constructor(t){super(),Rt(this,t,Eg,Mg,o,{unit:0,mode:1,order:2,id:3,buffcount:4})}}function Rg(t){let e,s;const i=new _g({props:{id:"ufplayer",order:0,unit:Qt,buffcount:t[0]}}),n=new _g({props:{id:"uftarget",order:1,unit:Vt,buffcount:t[0]}});return{c(){e=M("div"),Mt(i.$$.fragment),Mt(n.$$.fragment),T(e,"class","targetframes svelte-17up9g6")},m(t,a){$(t,e,a),Et(i,e,null),Et(n,e,null),s=!0},p(t,[e]){const s={};1&e&&(s.buffcount=t[0]),i.$set(s);const a={};1&e&&(a.buffcount=t[0]),n.$set(a)},i(t){s||(vt(i.$$.fragment,t),vt(n.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),yt(n.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i),_t(n)}}}function Pg(t,e,s){let i;return h(t,xs,t=>s(0,i=t)),[i]}class Tg extends Pt{constructor(t){super(),Rt(this,t,Pg,Rg,l,{})}}function Ig(t){let e,s;return{c(){e=M("span"),s=E(t[2]),T(e,"class","slottext key")},m(t,i){$(t,e,i),k(e,s)},p(t,e){4&e[0]&&D(s,t[2])},d(t){t&&S(e)}}}function Dg(t){let e,s;return{c(){e=M("span"),s=E(t[3]),T(e,"class","slottext stacks")},m(t,i){$(t,e,i),k(e,s)},p(t,e){8&e[0]&&D(s,t[3])},d(t){t&&S(e)}}}function Ag(t){let e;return{c(){T(e=M("div"),"class","overlay cd svelte-mv78pz"),F(e,"height",t[4]+"%")},m(t,s){$(t,e,s)},p(t,s){16&s[0]&&F(e,"height",t[4]+"%")},d(t){t&&S(e)}}}function Fg(t){let e;return{c(){T(e=M("div"),"class","overlay combat svelte-mv78pz")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function zg(t){let e;return{c(){T(e=M("div"),"class","overlay range svelte-mv78pz")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Bg(t){let e;return{c(){T(e=M("div"),"class","overlay oom svelte-mv78pz")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Ug(t){let e;return{c(){T(e=M("div"),"class","overlay queued svelte-mv78pz")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Og(t){let e;return{c(){T(e=M("div"),"class","autocast svelte-mv78pz")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function jg(t){let e,s,i;return{c(){T(e=M("img"),"class",s="icon "+(t[1]?t[7]:"")+" "+(t[16]&&t[0]||t[4]>0?"filtered":"")+" svelte-mv78pz"),e.src!==(i=t[6])&&T(e,"src",i)},m(t,s){$(t,e,s)},p(t,n){65683&n[0]&&s!==(s="icon "+(t[1]?t[7]:"")+" "+(t[16]&&t[0]||t[4]>0?"filtered":"")+" svelte-mv78pz")&&T(e,"class",s),64&n[0]&&e.src!==(i=t[6])&&T(e,"src",i)},d(t){t&&S(e)}}}function Lg(t){let e,s,i;const n=t[30].default,a=d(n,t,t[29],null);return{c(){e=M("div"),a&&a.c(),T(e,"class",s="border "+t[5].replace("filtered","")+" slotdescription svelte-mv78pz"),T(e,"style",t[11])},m(s,n){$(s,e,n),a&&a.m(e,null),t[31](e),i=!0},p(t,r){a&&a.p&&536870912&r[0]&&a.p(u(n,t,t[29],null),m(n,t[29],r,null)),(!i||32&r[0]&&s!==(s="border "+t[5].replace("filtered","")+" slotdescription svelte-mv78pz"))&&T(e,"class",s),(!i||2048&r[0])&&T(e,"style",t[11])},i(t){i||(vt(a,t),i=!0)},o(t){yt(a,t),i=!1},d(s){s&&S(e),a&&a.d(s),t[31](null)}}}function Ng(t){let e,s,i,n,r,o,l,c,h,d,u,m,p=void 0!==t[2]&&Ig(t),f=void 0!==t[3]&&Dg(t),g=void 0!==t[4]&&Ag(t);function v(t,e){return 5==t[13]?Bg:6==t[13]?zg:11==t[13]?Fg:void 0}let y=v(t),b=y&&y(t),x=(t[12]||t[10])&&Ug(),w=t[12]&&Og(),E=t[6]&&jg(t),C=t[9]&&t[0]&&t[1]&&!t[16]&&Lg(t);return{c(){e=M("div"),p&&p.c(),s=R(),f&&f.c(),i=R(),g&&g.c(),n=R(),b&&b.c(),r=M("div"),x&&x.c(),l=R(),w&&w.c(),c=R(),E&&E.c(),h=R(),C&&C.c(),T(r,"class",o="overlay "+(!t[15]||t[4]>0&&t[4]<10?"":"offCd")+" svelte-mv78pz"),T(e,"id",t[8]),T(e,"class",d="border "+t[5]+" glow "+(t[16]&&t[16].data==t[1]?"filtered":"")+" slot "+(t[1]?"filled":"")+" svelte-mv78pz"),m=[P(e,"pointerenter",t[19]),P(e,"pointerleave",t[20]),P(e,"pointerdown",t[17]),P(e,"pointerup",t[18])]},m(t,a){$(t,e,a),p&&p.m(e,null),k(e,s),f&&f.m(e,null),k(e,i),g&&g.m(e,null),k(e,n),b&&b.m(e,null),k(e,r),x&&x.m(e,null),k(e,l),w&&w.m(e,null),k(e,c),E&&E.m(e,null),k(e,h),C&&C.m(e,null),u=!0},p(t,a){void 0!==t[2]?p?p.p(t,a):((p=Ig(t)).c(),p.m(e,s)):p&&(p.d(1),p=null),void 0!==t[3]?f?f.p(t,a):((f=Dg(t)).c(),f.m(e,i)):f&&(f.d(1),f=null),void 0!==t[4]?g?g.p(t,a):((g=Ag(t)).c(),g.m(e,n)):g&&(g.d(1),g=null),y!==(y=v(t))&&(b&&b.d(1),(b=y&&y(t))&&(b.c(),b.m(e,r))),(!u||32784&a[0]&&o!==(o="overlay "+(!t[15]||t[4]>0&&t[4]<10?"":"offCd")+" svelte-mv78pz"))&&T(r,"class",o),t[12]||t[10]?x||((x=Ug()).c(),x.m(e,l)):x&&(x.d(1),x=null),t[12]?w||((w=Og()).c(),w.m(e,c)):w&&(w.d(1),w=null),t[6]?E?E.p(t,a):((E=jg(t)).c(),E.m(e,h)):E&&(E.d(1),E=null),t[9]&&t[0]&&t[1]&&!t[16]?C?(C.p(t,a),vt(C,1)):((C=Lg(t)).c(),vt(C,1),C.m(e,null)):C&&(ft(),yt(C,1,1,()=>{C=null}),gt()),(!u||256&a[0])&&T(e,"id",t[8]),(!u||65570&a[0]&&d!==(d="border "+t[5]+" glow "+(t[16]&&t[16].data==t[1]?"filtered":"")+" slot "+(t[1]?"filled":"")+" svelte-mv78pz"))&&T(e,"class",d)},i(t){u||(vt(C),u=!0)},o(t){yt(C),u=!1},d(t){t&&S(e),p&&p.d(),f&&f.d(),g&&g.d(),b&&b.d(),x&&x.d(),w&&w.d(),E&&E.d(),C&&C.d(),a(m)}}}function qg(t,e,s){let i;h(t,Gt,t=>s(16,i=t));let{data:n}=e,{key:a}=e,{stacks:r}=e,{cd:o}=e,{border:l="grey"}=e,{img:c}=e,{meta:d}=e,{css:u=""}=e,{id:m=""}=e,{describe:p=!0}=e,{queued:g=!1}=e,{pickable:v=!0}=e,{descRoot:y}=e,{descPos:b="bottom: 100%; right: 100%;"}=e,{auto:k=!1}=e,{status:x=0}=e,{hover:$=!1}=e,w=!1;const S=()=>{C("discard")},M=t=>{"force"!==$&&s(0,$=t)},E=()=>{n&&!1!==v&&(n.moving||f(Gt,i={data:n,img:c,meta:d,border:l,css:u,discard:S}),n.type&&eo(n.type))},C=Z();let T,_,{$$slots:A={},$$scope:R}=e;return t.$set=(t=>{"data"in t&&s(1,n=t.data),"key"in t&&s(2,a=t.key),"stacks"in t&&s(3,r=t.stacks),"cd"in t&&s(4,o=t.cd),"border"in t&&s(5,l=t.border),"img"in t&&s(6,c=t.img),"meta"in t&&s(21,d=t.meta),"css"in t&&s(7,u=t.css),"id"in t&&s(8,m=t.id),"describe"in t&&s(9,p=t.describe),"queued"in t&&s(10,g=t.queued),"pickable"in t&&s(22,v=t.pickable),"descRoot"in t&&s(23,y=t.descRoot),"descPos"in t&&s(11,b=t.descPos),"auto"in t&&s(12,k=t.auto),"status"in t&&s(13,x=t.status),"hover"in t&&s(0,$=t.hover),"$$scope"in t&&s(29,R=t.$$scope)}),t.$$.update=(()=>{32784&t.$$.dirty[0]&&s(15,_=_||o>0),8404992&t.$$.dirty[0]&&T&&y&&y.appendChild(T)}),[$,n,a,r,o,l,c,u,m,p,g,b,k,x,T,_,i,t=>{w=!0,M(!1),C("click",d)},t=>{2==t.button?ro.shift.down?C("use",{e:t,...d}):C("context",{e:t,...d}):i?(i.data.type&&eo(i.data.type),C("move",{from:i.meta,to:d}),i.meta&&i.meta.store&&i.meta.store.set(),f(Gt,i=void 0)):E(),w=!1},t=>{M(!0)},t=>{M(!1),n&&w&&(w=!1,E())},d,v,y,w,S,M,E,C,R,A,function(t){tt[t?"unshift":"push"](()=>{s(14,T=t)})}]}class Hg extends Pt{constructor(t){super(),Rt(this,t,qg,Ng,l,{data:1,key:2,stacks:3,cd:4,border:5,img:6,meta:21,css:7,id:8,describe:9,queued:10,pickable:22,descRoot:23,descPos:11,auto:12,status:13,hover:0},[-1,-1])}}function Wg(t,e,s){const i=t.slice();return i[13]=e[s],i}function Qg(t,e,s){const i=t.slice();return i[16]=e[s],i}function Vg(t,e,s){const i=t.slice();return i[19]=e[s],i}function Gg(t,e,s){const i=t.slice();return i[19]=e[s],i}function Yg(t,e,s){const i=t.slice();return i[27]=e[s],i}function Xg(t,e,s){const i=t.slice();return i[24]=e[s],i}function Zg(t,e,s){const i=t.slice();return i[27]=e[s],i}function Jg(t,e,s){const i=t.slice();return i[24]=e[s],i}function Kg(t,e,s){const i=t.slice();return i[27]=e[s],i}function tv(t,e,s){const i=t.slice();return i[34]=e[s],i}function ev(t,e,s){const i=t.slice();return i[39]=e[s],i}function sv(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,E,_=!t[2]&&void 0===t[0].parent&&nv(t),A=t[0].actiontype&&av(t),P=t[0].auto&&rv(),I=t[0].cost&&t[0].cost.resources&&ov(t),D=t[0].castLen&&cv(t),q=t[0].cd&&hv(t),j=t[0].duration>0&&dv(t),F=t[0].refresh&&uv(),z=t[0].range&&mv(t),B=t[7][t[0].targetMode]&&pv(t),L=t[0].maxStacks&&fv(t),N=t[0].dmg&&gv(t),U=t[0].heal&&vv(t),O=[t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage],Q=[];for(let e=0;e<2;e+=1)Q[e]=bv(tv(t,O,e));let W=[t[0].addIncomingHeal,t[0].addIncomingDamage],V=[];for(let e=0;e<2;e+=1)V[e]=wv(Jg(t,W,e));let H=[t[0].addIncomingCrit],Y=[];for(let e=0;e<1;e+=1)Y[e]=$v(Xg(t,H,e));let G=t[0].statsStatic&&Sv(t),X=t[0].statsConvert&&Mv(t),Z=t[0].custom&&_v(t),J=t[0].aoe&&t[0].aoe.circleRadius&&Pv(t),K=!t[0].parent&&Tv(t),tt=t[3],et=[];for(let e=0;e<tt.length;e+=1)et[e]=Iv(Wg(t,tt,e));const st=t=>yt(et[t],1,1,()=>{et[t]=null});return{c(){_&&_.c(),e=M("div"),A&&A.c(),s=R(),P&&P.c(),i=R(),I&&I.c(),n=R(),D&&D.c(),a=R(),q&&q.c(),r=R(),j&&j.c(),o=R(),F&&F.c(),l=M("div"),z&&z.c(),c=R(),B&&B.c(),L&&L.c(),h=R(),N&&N.c(),d=R(),U&&U.c(),u=R();for(let t=0;t<2;t+=1)Q[t].c();m=R();for(let t=0;t<2;t+=1)V[t].c();p=R();for(let t=0;t<1;t+=1)Y[t].c();f=R(),G&&G.c(),g=R(),X&&X.c(),v=R(),Z&&Z.c(),y=R(),J&&J.c(),b=R(),K&&K.c(),x=R();for(let t=0;t<et.length;t+=1)et[t].c();w=R(),T(e,"class","pad textgreen svelte-14w0l4b")},m(t,S){_&&_.m(t,S),$(t,e,S),A&&A.m(e,null),k(e,s),P&&P.m(e,null),k(e,i),I&&I.m(e,null),k(e,n),D&&D.m(e,null),k(e,a),q&&q.m(e,null),k(e,r),j&&j.m(e,null),k(e,o),F&&F.m(e,null),k(e,l),z&&z.m(l,null),k(l,c),B&&B.m(l,null),L&&L.m(t,S),$(t,h,S),N&&N.m(t,S),$(t,d,S),U&&U.m(t,S),$(t,u,S);for(let e=0;e<2;e+=1)Q[e].m(t,S);$(t,m,S);for(let e=0;e<2;e+=1)V[e].m(t,S);$(t,p,S);for(let e=0;e<1;e+=1)Y[e].m(t,S);$(t,f,S),G&&G.m(t,S),$(t,g,S),X&&X.m(t,S),$(t,v,S),Z&&Z.m(t,S),$(t,y,S),J&&J.m(t,S),$(t,b,S),K&&K.m(t,S),$(t,x,S);for(let e=0;e<et.length;e+=1)et[e].m(t,S);$(t,w,S),E=!0},p(t,k){if(t[2]||void 0!==t[0].parent?_&&(_.d(1),_=null):_?_.p(t,k):((_=nv(t)).c(),_.m(e.parentNode,e)),t[0].actiontype?A?A.p(t,k):((A=av(t)).c(),A.m(e,s)):A&&(A.d(1),A=null),t[0].auto?P||((P=rv()).c(),P.m(e,i)):P&&(P.d(1),P=null),t[0].cost&&t[0].cost.resources?I?I.p(t,k):((I=ov(t)).c(),I.m(e,n)):I&&(I.d(1),I=null),t[0].castLen?D?D.p(t,k):((D=cv(t)).c(),D.m(e,a)):D&&(D.d(1),D=null),t[0].cd?q?q.p(t,k):((q=hv(t)).c(),q.m(e,r)):q&&(q.d(1),q=null),t[0].duration>0?j?j.p(t,k):((j=dv(t)).c(),j.m(e,o)):j&&(j.d(1),j=null),t[0].refresh?F||((F=uv()).c(),F.m(e,l)):F&&(F.d(1),F=null),t[0].range?z?z.p(t,k):((z=mv(t)).c(),z.m(l,c)):z&&(z.d(1),z=null),t[7][t[0].targetMode]?B?B.p(t,k):((B=pv(t)).c(),B.m(l,null)):B&&(B.d(1),B=null),t[0].maxStacks?L?L.p(t,k):((L=fv(t)).c(),L.m(h.parentNode,h)):L&&(L.d(1),L=null),t[0].dmg?N?N.p(t,k):((N=gv(t)).c(),N.m(d.parentNode,d)):N&&(N.d(1),N=null),t[0].heal?U?U.p(t,k):((U=vv(t)).c(),U.m(u.parentNode,u)):U&&(U.d(1),U=null),257&k[0]){let e;for(O=[t[0].multiplyIncomingHeal,t[0].multiplyIncomingDamage],e=0;e<2;e+=1){const s=tv(t,O,e);Q[e]?Q[e].p(s,k):(Q[e]=bv(s),Q[e].c(),Q[e].m(m.parentNode,m))}for(;e<2;e+=1)Q[e].d(1)}if(257&k[0]){let e;for(W=[t[0].addIncomingHeal,t[0].addIncomingDamage],e=0;e<2;e+=1){const s=Jg(t,W,e);V[e]?V[e].p(s,k):(V[e]=wv(s),V[e].c(),V[e].m(p.parentNode,p))}for(;e<2;e+=1)V[e].d(1)}if(257&k[0]){let e;for(H=[t[0].addIncomingCrit],e=0;e<1;e+=1){const s=Xg(t,H,e);Y[e]?Y[e].p(s,k):(Y[e]=$v(s),Y[e].c(),Y[e].m(f.parentNode,f))}for(;e<1;e+=1)Y[e].d(1)}if(t[0].statsStatic?G?G.p(t,k):((G=Sv(t)).c(),G.m(g.parentNode,g)):G&&(G.d(1),G=null),t[0].statsConvert?X?X.p(t,k):((X=Mv(t)).c(),X.m(v.parentNode,v)):X&&(X.d(1),X=null),t[0].custom?Z?Z.p(t,k):((Z=_v(t)).c(),Z.m(y.parentNode,y)):Z&&(Z.d(1),Z=null),t[0].aoe&&t[0].aoe.circleRadius?J?J.p(t,k):((J=Pv(t)).c(),J.m(b.parentNode,b)):J&&(J.d(1),J=null),t[0].parent?K&&(K.d(1),K=null):K?K.p(t,k):((K=Tv(t)).c(),K.m(x.parentNode,x)),10&k[0]){let e;for(tt=t[3],e=0;e<tt.length;e+=1){const s=Wg(t,tt,e);et[e]?(et[e].p(s,k),vt(et[e],1)):(et[e]=Iv(s),et[e].c(),vt(et[e],1),et[e].m(w.parentNode,w))}for(ft(),e=tt.length;e<et.length;e+=1)st(e);gt()}},i(t){if(!E){for(let t=0;t<tt.length;t+=1)vt(et[t]);E=!0}},o(t){et=et.filter(Boolean);for(let t=0;t<et.length;t+=1)yt(et[t]);E=!1},d(t){_&&_.d(t),t&&S(e),A&&A.d(),P&&P.d(),I&&I.d(),D&&D.d(),q&&q.d(),j&&j.d(),F&&F.d(),z&&z.d(),B&&B.d(),L&&L.d(t),t&&S(h),N&&N.d(t),t&&S(d),U&&U.d(t),t&&S(u),C(Q,t),t&&S(m),C(V,t),t&&S(p),C(Y,t),t&&S(f),G&&G.d(t),t&&S(g),X&&X.d(t),t&&S(v),Z&&Z.d(t),t&&S(y),J&&J.d(t),t&&S(b),K&&K.d(t),t&&S(x),C(et,t),t&&S(w)}}}function iv(e){let s,i,n=e[0].item+"";return{c(){s=M("div"),i=E(n)},m(t,e){$(t,s,e),k(s,i)},p(t,e){1&e[0]&&n!==(n=t[0].item+"")&&D(i,n)},i:t,o:t,d(t){t&&S(s)}}}function nv(t){let e,s,i,n,a,r,o=qh.items.book[t[0].id].name+"",l=t[0].engineOnly?"":" Lv. "+t[1];return{c(){e=M("div"),s=M("img"),n=_(),a=E(o),r=E(l),T(s,"class","texticon"),s.src!==(i=Wd(t[0].id))&&T(s,"src",i),T(e,"class","slottitle textprimary")},m(t,i){$(t,e,i),k(e,s),k(e,n),k(e,a),k(e,r)},p(t,e){1&e[0]&&s.src!==(i=Wd(t[0].id))&&T(s,"src",i),1&e[0]&&o!==(o=qh.items.book[t[0].id].name+"")&&D(a,o),3&e[0]&&l!==(l=t[0].engineOnly?"":" Lv. "+t[1])&&D(r,l)},d(t){t&&S(e)}}}function av(t){let e,s,i,n,a=t[9][t[0].mode]+"",r=t[0].actiontype+"";return{c(){e=M("div"),s=E(a),i=_(),n=E(r),T(e,"class","textwhite")},m(t,a){$(t,e,a),k(e,s),k(e,i),k(e,n)},p(t,e){1&e[0]&&a!==(a=t[9][t[0].mode]+"")&&D(s,a),1&e[0]&&r!==(r=t[0].actiontype+"")&&D(n,r)},d(t){t&&S(e)}}}function rv(t){let e;return{c(){(e=M("div")).textContent="Auto cast"},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function ov(t){let e,s,i=t[0].cost.resources,n=[];for(let e=0;e<i.length;e+=1)n[e]=lv(ev(t,i,e));return{c(){e=M("div"),s=E("Cost: ");for(let t=0;t<n.length;t+=1)n[t].c()},m(t,i){$(t,e,i),k(e,s);for(let t=0;t<n.length;t+=1)n[t].m(e,null)},p(t,s){if(259&s[0]){let a;for(i=t[0].cost.resources,a=0;a<i.length;a+=1){const r=ev(t,i,a);n[a]?n[a].p(r,s):(n[a]=lv(r),n[a].c(),n[a].m(e,null))}for(;a<n.length;a+=1)n[a].d(1);n.length=i.length}},d(t){t&&S(e),C(n,t)}}}function lv(t){let e,s,i,n,a=t[8](t[39][1],t[1])+"",r=qh.ui.stats.array[t[39][0]]+"";return{c(){e=E(a),s=_(),i=E(r),n=_()},m(t,a){$(t,e,a),$(t,s,a),$(t,i,a),$(t,n,a)},p(t,s){3&s[0]&&a!==(a=t[8](t[39][1],t[1])+"")&&D(e,a),1&s[0]&&r!==(r=qh.ui.stats.array[t[39][0]]+"")&&D(i,r)},d(t){t&&S(e),t&&S(s),t&&S(i),t&&S(n)}}}function cv(t){let e,s,i,n=t[8](t[0].castLen)+"";return{c(){e=M("div"),s=E(n),i=E("s Cast time")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].castLen)+"")&&D(s,n)},d(t){t&&S(e)}}}function hv(t){let e,s,i,n=t[8](t[0].cd)+"";return{c(){e=M("div"),s=E(n),i=E("s Cooldown")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].cd)+"")&&D(s,n)},d(t){t&&S(e)}}}function dv(t){let e,s,i,n=t[8](t[0].duration)+"";return{c(){e=M("div"),s=E(n),i=E("s Duration")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].duration)+"")&&D(s,n)},d(t){t&&S(e)}}}function uv(t){let e;return{c(){(e=M("div")).textContent="Stacks refresh duration"},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function mv(t){let e,s,i,n=t[8](t[0].range)+"";return{c(){e=M("span"),s=E(n),i=E("m range ")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].range)+"")&&D(s,n)},d(t){t&&S(e)}}}function pv(t){let e,s,i=t[7][t[0].targetMode]+"";return{c(){e=M("span"),s=E(i)},m(t,i){$(t,e,i),k(e,s)},p(t,e){1&e[0]&&i!==(i=t[7][t[0].targetMode]+"")&&D(s,i)},d(t){t&&S(e)}}}function fv(t){let e,s,i,n,a,r,o,l=t[5].stacks+"";return{c(){e=M("div"),s=M("u"),i=E("At "),n=E(l),a=E(" stacks"),r=E(":"),(o=M("span")).textContent="(Press shift to toggle)",T(e,"class","pad textsecondary svelte-14w0l4b"),T(o,"class","textgrey")},m(t,l){$(t,e,l),k(e,s),k(s,i),k(s,n),k(s,a),k(e,r),$(t,o,l)},p(t,e){32&e[0]&&l!==(l=t[5].stacks+"")&&D(n,l)},d(t){t&&S(e),t&&S(o)}}}function gv(t){let e,s,i,n=t[8](t[0].dmg)+"";return{c(){e=M("div"),s=E(n),i=E(" DMG"),T(e,"class","textgreen")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].dmg)+"")&&D(s,n)},d(t){t&&S(e)}}}function vv(t){let e,s,i,n=t[8](t[0].heal)+"";return{c(){e=M("div"),s=E(n),i=E(" Heal"),T(e,"class","textgreen")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){1&e[0]&&n!==(n=t[8](t[0].heal)+"")&&D(s,n)},d(t){t&&S(e)}}}function yv(t){let e,s,i,n,a,r,o=qh.items.book[t[27]].name+"",l=Math.round(100*t[8](t[34][t[27]](t[0]))-100)+"";return{c(){e=M("div"),s=E("Empower "),i=E(o),n=E(" by "),a=E(l),r=E("%"),T(e,"class","textcyan")},m(t,o){$(t,e,o),k(e,s),k(e,i),k(e,n),k(e,a),k(e,r)},p(t,e){1&e[0]&&o!==(o=qh.items.book[t[27]].name+"")&&D(i,o),1&e[0]&&l!==(l=Math.round(100*t[8](t[34][t[27]](t[0]))-100)+"")&&D(a,l)},d(t){t&&S(e)}}}function bv(t){let e,s=Object.keys(t[34]||{}),i=[];for(let e=0;e<s.length;e+=1)i[e]=yv(Kg(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=R()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);$(t,e,s)},p(t,n){if(257&n[0]){let a;for(s=Object.keys(t[34]||{}),a=0;a<s.length;a+=1){const r=Kg(t,s,a);i[a]?i[a].p(r,n):(i[a]=yv(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){C(i,t),t&&S(e)}}}function xv(t){let e,s,i,n,a,r=qh.items.book[t[27]].name+"",o=t[8](t[24][t[27]](t[0]))+"";return{c(){e=M("div"),s=E("Empower "),i=E(r),n=E(" by "),a=E(o),T(e,"class","textcyan")},m(t,r){$(t,e,r),k(e,s),k(e,i),k(e,n),k(e,a)},p(t,e){1&e[0]&&r!==(r=qh.items.book[t[27]].name+"")&&D(i,r),1&e[0]&&o!==(o=t[8](t[24][t[27]](t[0]))+"")&&D(a,o)},d(t){t&&S(e)}}}function wv(t){let e,s=Object.keys(t[24]||{}),i=[];for(let e=0;e<s.length;e+=1)i[e]=xv(Zg(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=R()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);$(t,e,s)},p(t,n){if(257&n[0]){let a;for(s=Object.keys(t[24]||{}),a=0;a<s.length;a+=1){const r=Zg(t,s,a);i[a]?i[a].p(r,n):(i[a]=xv(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){C(i,t),t&&S(e)}}}function kv(t){let e,s,i,n,a,r=qh.items.book[t[27]].name+"",o=pg(14,t[8](t[24][t[27]](t[0])))+"";return{c(){e=M("div"),s=E("Empower Crit% of "),i=E(r),n=E(" by "),a=E(o),T(e,"class","textcyan")},m(t,r){$(t,e,r),k(e,s),k(e,i),k(e,n),k(e,a)},p(t,e){1&e[0]&&r!==(r=qh.items.book[t[27]].name+"")&&D(i,r),1&e[0]&&o!==(o=pg(14,t[8](t[24][t[27]](t[0])))+"")&&D(a,o)},d(t){t&&S(e)}}}function $v(t){let e,s=Object.keys(t[24]||{}),i=[];for(let e=0;e<s.length;e+=1)i[e]=kv(Yg(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=R()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);$(t,e,s)},p(t,n){if(257&n[0]){let a;for(s=Object.keys(t[24]||{}),a=0;a<s.length;a+=1){const r=Yg(t,s,a);i[a]?i[a].p(r,n):(i[a]=kv(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){C(i,t),t&&S(e)}}}function Sv(t){let e,s=Array.from(t[4].stat),i=[];for(let e=0;e<s.length;e+=1)i[e]=Cv(Gg(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=R()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);$(t,e,s)},p(t,n){if(16&n[0]){let a;for(s=Array.from(t[4].stat),a=0;a<s.length;a+=1){const r=Gg(t,s,a);i[a]?i[a].p(r,n):(i[a]=Cv(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){C(i,t),t&&S(e)}}}function Cv(t){let e,s,i,n,a,r,o=pg(t[19][0],t[19][1])+"",l=qh.ui.stats.array[t[19][0]]+"";return{c(){e=M("div"),s=E("+"),i=E(o),n=_(),a=E(l),r=_(),T(e,"class","textcyan")},m(t,o){$(t,e,o),k(e,s),k(e,i),k(e,n),k(e,a),k(e,r)},p(t,e){16&e[0]&&o!==(o=pg(t[19][0],t[19][1])+"")&&D(i,o),16&e[0]&&l!==(l=qh.ui.stats.array[t[19][0]]+"")&&D(a,l)},d(t){t&&S(e)}}}function Mv(t){let e,s=t[0].statsConvert,i=[];for(let e=0;e<s.length;e+=1)i[e]=Ev(Vg(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=R()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);$(t,e,s)},p(t,n){if(1&n[0]){let a;for(s=t[0].statsConvert,a=0;a<s.length;a+=1){const r=Vg(t,s,a);i[a]?i[a].p(r,n):(i[a]=Ev(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){C(i,t),t&&S(e)}}}function Ev(t){let e,s,i,n,a,r,o,l=qh.ui.stats.array[t[19][0]]+"",c=pg(t[19][0],t[19][1])+"",h=qh.ui.stats.array[t[19][2]]+"";return{c(){e=M("div"),s=E("For 1 "),i=E(l),n=E(" gain "),a=E(c),r=_(),o=E(h),T(e,"class","textcyan")},m(t,l){$(t,e,l),k(e,s),k(e,i),k(e,n),k(e,a),k(e,r),k(e,o)},p(t,e){1&e[0]&&l!==(l=qh.ui.stats.array[t[19][0]]+"")&&D(i,l),1&e[0]&&c!==(c=pg(t[19][0],t[19][1])+"")&&D(a,c),1&e[0]&&h!==(h=qh.ui.stats.array[t[19][2]]+"")&&D(o,h)},d(t){t&&S(e)}}}function _v(t){let e,s=t[0].custom,i=[];for(let e=0;e<s.length;e+=1)i[e]=Rv(Qg(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=R()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);$(t,e,s)},p(t,n){if(259&n[0]){let a;for(s=t[0].custom,a=0;a<s.length;a+=1){const r=Qg(t,s,a);i[a]?i[a].p(r,n):(i[a]=Rv(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){C(i,t),t&&S(e)}}}function Rv(t){let e,s,i,n=t[8](t[16][0](t[1]))+"",a=t[16][1]+"";return{c(){e=M("div"),s=E(n),i=E(a),T(e,"class","textcyan")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){3&e[0]&&n!==(n=t[8](t[16][0](t[1]))+"")&&D(s,n),1&e[0]&&a!==(a=t[16][1]+"")&&D(i,a)},d(t){t&&S(e)}}}function Pv(t){let e,s,i,n,a,r,o=t[0].aoe.faction?t[0].aoe.party?"party members":"allies":"enemies",l=t[8](t[0].aoe.circleRadius)+"";return{c(){e=M("div"),s=E("All "),i=E(o),n=E(" within "),a=E(l),r=E("m"),T(e,"class","textfame")},m(t,o){$(t,e,o),k(e,s),k(e,i),k(e,n),k(e,a),k(e,r)},p(t,e){1&e[0]&&o!==(o=t[0].aoe.faction?t[0].aoe.party?"party members":"allies":"enemies")&&D(i,o),1&e[0]&&l!==(l=t[8](t[0].aoe.circleRadius)+"")&&D(a,l)},d(t){t&&S(e)}}}function Tv(t){let e,s,i,n,a=qh.items.book[t[0].id].description+"";return{c(){e=M("div"),(s=M("u")).textContent="Effect",i=E(": "),n=E(a),T(e,"class","textsecondary pad svelte-14w0l4b")},m(t,a){$(t,e,a),k(e,s),k(e,i),k(e,n)},p(t,e){1&e[0]&&a!==(a=qh.items.book[t[0].id].description+"")&&D(n,a)},d(t){t&&S(e)}}}function Iv(t){let e,s;const i=new Bv({props:{level:t[1],skill:t[13]}});return{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","pad svelte-14w0l4b")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,e){const s={};2&e[0]&&(s.level=t[1]),8&e[0]&&(s.skill=t[13]),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function Dv(t){let e,s,i,n;const a=[iv,sv],r=[];function o(t,e){return t[0].item?0:1}return s=o(t),i=r[s]=a[s](t),{c(){e=M("div"),i.c(),T(e,"class","container textsecondary svelte-14w0l4b")},m(t,i){$(t,e,i),r[s].m(e,null),n=!0},p(t,n){let l=s;(s=o(t))===l?r[s].p(t,n):(ft(),yt(r[l],1,1,()=>{r[l]=null}),gt(),(i=r[s])||(i=r[s]=a[s](t)).c(),vt(i,1),i.m(e,null))},i(t){n||(vt(i),n=!0)},o(t){yt(i),n=!1},d(t){t&&S(e),r[s].d()}}}let Av=1,Fv=1;function zv(t,e,s){let i,{skill:n}=e,{level:a}=e,{asItemDescription:r=!1}=e,o=ro.shift.store;h(t,o,t=>s(10,i=t));let l,c=[],d={};const u=t=>{if(qn)return t.onCast&&m("on cast",t.onCast,qn.player,a),t.onBlock&&m("on block",t.onBlock,d,qn.player),t.onInterval&&m(`every ${t.intervalDuration.toFixed(1)}s`,t.onInterval,d,qn.player,qn.player),t.onPermanent&&m("permanently",t.onPermanent,qn.player,a),t},m=(t,e,i,a,r)=>{const o=e(i,a,r);if(!o||!0===o)return;const l=Object.assign({},o);if(l.actiontype=t,l.parent||(l.parent=[]),l.parent.push(n),4==l.mode||5==l.mode){const t=xm.get(l.id);c.unshift(u({...l,...t}))}else if(n.id===l.id)n.parent||(l.parent=void 0),s(0,n={...n,...l});else{if(n.parent){const t=n.parent.find(t=>t.id==l.id);if(t)return t.parent||(l.parent=void 0),void Object.assign(t,l)}c.unshift(u(l))}};return t.$set=(t=>{"skill"in t&&s(0,n=t.skill),"level"in t&&s(1,a=t.level),"asItemDescription"in t&&s(2,r=t.asItemDescription)}),t.$$.update=(()=>{1075&t.$$.dirty[0]&&(s(5,d={stacks:1,level:a,diminish:Av,diminishFactor:Fv}),s(5,d.stacks=n.maxStacks?i?1:n.maxStacks:1,d),s(0,n.stacks=d.stacks,n),s(3,c=[]),n.parent||u(n),n.statsStatic&&(s(4,l=new Op),n.statsStatic(d,l)))}),[n,a,r,c,l,d,o,{1:"Requires no target",16:"Self cast",256:"on Allies",4096:"on Enemy"},(t,e=qn&&qn.player)=>{if(!e)return"?";const s=Im(t,e);return s%1==0?s:s.toFixed(1)},{0:"Melee attack",1:"Magic attack",2:"Heal",4:"Buff",5:"Stackable buff",6:"Ranged missile"}]}class Bv extends Pt{constructor(t){super(),Rt(this,t,zv,Dv,o,{skill:0,level:1,asItemDescription:2},[-1,-1])}}function Uv(e){let s;return{c(){s=M("span")},m(t,i){$(t,s,i),s.innerHTML=e[0]},p(t,[e]){1&e&&(s.innerHTML=t[0])},i:t,o:t,d(t){t&&S(s)}}}function Ov(t,e,s){let i;h(t,Xt,t=>s(4,i=t));let n,a,{amount:r}=e,{isPrice:o=!1}=e;return t.$set=(t=>{"amount"in t&&s(1,r=t.amount),"isPrice"in t&&s(2,o=t.isPrice)}),t.$$.update=(()=>{22&t.$$.dirty&&s(3,n=o&&r>i),10&t.$$.dirty&&s(0,a=Pf(r,n))}),[a,r,o]}class jv extends Pt{constructor(t){super(),Rt(this,t,Ov,Uv,l,{amount:1,isPrice:2})}}function Lv(e){let s,i,n,a,r,o;return{c(){s=M("span"),i=M("img"),a=M("span"),r=E(e[0]),T(i,"class","svgicon texticon"),i.src!==(n="/assets/ui/icons/gem.svg?v=3406973")&&T(i,"src","/assets/ui/icons/gem.svg?v=3406973"),T(a,"class",o=!e[1]||e[0]<e[2]?"textprimary":"textred")},m(t,e){$(t,s,e),k(s,i),k(s,a),k(a,r)},p(t,[e]){1&e&&D(r,t[0]),7&e&&o!==(o=!t[1]||t[0]<t[2]?"textprimary":"textred")&&T(a,"class",o)},i:t,o:t,d(t){t&&S(s)}}}function Nv(t,e,s){let i;h(t,Zt,t=>s(2,i=t));let{amount:n}=e,{isPrice:a=!1}=e;return t.$set=(t=>{"amount"in t&&s(0,n=t.amount),"isPrice"in t&&s(1,a=t.isPrice)}),[n,a,i]}class qv extends Pt{constructor(t){super(),Rt(this,t,Nv,Lv,l,{amount:0,isPrice:1})}}function Hv(t,e,s){const i=t.slice();return i[10]=e[s],i}function Wv(t,e,s){const i=t.slice();return i[13]=e[s],i}function Qv(t,e,s){const i=t.slice();return i[16]=e[s],i}function Vv(t,e,s){const i=t.slice();return i[10]=e[s],i}function Gv(t){let e,s,i,n=t[0].dbid+"";return{c(){e=M("small"),s=E("ID: "),i=E(n),T(e,"class","textgrey")},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(t,e){1&e&&n!==(n=t[0].dbid+"")&&D(i,n)},d(t){t&&S(e)}}}function Yv(t){let e,s,i,n,a,r,o,l="bonus"==t[10][1].type?"+ ":"",c=pg(t[10][0],t[10][1].value)+"",h=qh.ui.stats.array[t[10][0]]+"",d="bonus"==t[10][1].type&&t[3]&&Zv(t);return{c(){e=M("div"),s=E(l),i=E(c),n=_(),a=E(h),r=_(),d&&d.c(),T(e,"class",o="text"+lu(t[10][1].qual)[0]+" svelte-o1dug")},m(t,o){$(t,e,o),k(e,s),k(e,i),k(e,n),k(e,a),k(e,r),d&&d.m(e,null)},p(t,s){"bonus"==t[10][1].type&&t[3]?d?d.p(t,s):((d=Zv(t)).c(),d.m(e,null)):d&&(d.d(1),d=null)},d(t){t&&S(e),d&&d.d()}}}function Xv(t){let e,s,i,n,a,r,o,l,c,h,d,u,m=t[0].stats.get(10).value+"",p=t[0].stats.get(11).value+"",f=qh.ui.stats.misc.damage+"";return{c(){e=M("div"),s=M("span"),i=E(m),a=E(" - "),r=M("span"),o=E(p),c=_(),h=M("span"),d=E(f),T(s,"class",n="text"+lu(t[0].stats.get(10).qual)[0]+" svelte-o1dug"),T(r,"class",l="text"+lu(t[0].stats.get(11).qual)[0]+" svelte-o1dug"),T(h,"class",u="text"+lu(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-o1dug")},m(t,n){$(t,e,n),k(e,s),k(s,i),k(e,a),k(e,r),k(r,o),k(e,c),k(e,h),k(h,d)},p(t,e){1&e&&m!==(m=t[0].stats.get(10).value+"")&&D(i,m),1&e&&n!==(n="text"+lu(t[0].stats.get(10).qual)[0]+" svelte-o1dug")&&T(s,"class",n),1&e&&p!==(p=t[0].stats.get(11).value+"")&&D(o,p),1&e&&l!==(l="text"+lu(t[0].stats.get(11).qual)[0]+" svelte-o1dug")&&T(r,"class",l),1&e&&u!==(u="text"+lu(Math.min(t[0].stats.get(10).qual,t[0].stats.get(11).qual))[0]+" svelte-o1dug")&&T(h,"class",u)},d(t){t&&S(e)}}}function Zv(e){let s,i,n,a=Math.round(e[10][1].qual)+"";return{c(){s=M("span"),i=E(a),n=E("%")},m(t,e){$(t,s,e),k(s,i),k(s,n)},p:t,d(t){t&&S(s)}}}function Jv(t){let e,s;function i(t,s){return(null==e||1&s)&&(e=!(10!=t[10][0]||!t[0].stats.has(11))),e?Xv:Yv}let n=i(t,-1),a=n(t);return{c(){a.c(),s=R()},m(t,e){a.m(t,e),$(t,s,e)},p(t,e){n===(n=i(t,e))&&a?a.p(t,e):(a.d(1),(a=n(t))&&(a.c(),a.m(s.parentNode,s)))},d(t){a.d(t),t&&S(s)}}}function Kv(t){let e,s=t[0].logic.custom,i=[];for(let e=0;e<s.length;e+=1)i[e]=ty(Qv(t,s,e));return{c(){for(let t=0;t<i.length;t+=1)i[t].c();e=R()},m(t,s){for(let e=0;e<i.length;e+=1)i[e].m(t,s);$(t,e,s)},p(t,n){if(1&n){let a;for(s=t[0].logic.custom,a=0;a<s.length;a+=1){const r=Qv(t,s,a);i[a]?i[a].p(r,n):(i[a]=ty(r),i[a].c(),i[a].m(e.parentNode,e))}for(;a<i.length;a+=1)i[a].d(1);i.length=s.length}},d(t){C(i,t),t&&S(e)}}}function ty(t){let e,s,i=t[16]+"";return{c(){e=M("span"),s=E(i),T(e,"class","textgreen")},m(t,i){$(t,e,i),k(e,s)},p(t,e){1&e&&i!==(i=t[16]+"")&&D(s,i)},d(t){t&&S(e)}}}function ey(t){let e,s,i,n=t[13][0]+"";return{c(){e=M("div"),s=E(n),T(e,"class",i=t[13][1]?"textgreen":"textred")},m(t,i){$(t,e,i),k(e,s)},p(t,a){1&a&&n!==(n=t[13][0]+"")&&D(s,n),1&a&&i!==(i=t[13][1]?"textgreen":"textred")&&T(e,"class",i)},d(t){t&&S(e)}}}function sy(t){let e;return{c(){(e=M("div")).textContent="Account bound",T(e,"class","textgreen")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function iy(t){let e;const s=new qv({props:{amount:t[0].storeValue(),isPrice:!0}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};1&e&&(i.amount=t[0].storeValue()),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function ny(t){let e;const s=new jv({props:{amount:t[0].goldValue(t[1]),isPrice:t[1]}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};3&e&&(i.amount=t[0].goldValue(t[1])),2&e&&(i.isPrice=t[1]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function ay(t){let e,s,i,n,a;const r=[ly,oy],o=[];function l(t,e){return"book"==t[0].type?0:1}e=l(t),s=o[e]=r[e](t);let c=t[5]&&cy();return{c(){s.c(),i=R(),c&&c.c(),n=R()},m(t,s){o[e].m(t,s),$(t,i,s),c&&c.m(t,s),$(t,n,s),a=!0},p(t,a){let h=e;(e=l(t))===h?o[e].p(t,a):(ft(),yt(o[h],1,1,()=>{o[h]=null}),gt(),(s=o[e])||(s=o[e]=r[e](t)).c(),vt(s,1),s.m(i.parentNode,i)),t[5]?c||((c=cy()).c(),c.m(n.parentNode,n)):c&&(c.d(1),c=null)},i(t){a||(vt(s),a=!0)},o(t){yt(s),a=!1},d(t){o[e].d(t),t&&S(i),c&&c.d(t),t&&S(n)}}}function ry(e){let s,i,n=e[4],a=[];for(let t=0;t<n.length;t+=1)a[t]=hy(Hv(e,n,t));return{c(){s=M("div"),(i=M("div")).textContent="Equipping this item will have these effects:";for(let t=0;t<a.length;t+=1)a[t].c();T(i,"class","textgrey"),T(s,"class","pack svelte-o1dug")},m(t,e){$(t,s,e),k(s,i);for(let t=0;t<a.length;t+=1)a[t].m(s,null)},p(t,e){if(16&e){let i;for(n=t[4],i=0;i<n.length;i+=1){const r=Hv(t,n,i);a[i]?a[i].p(r,e):(a[i]=hy(r),a[i].c(),a[i].m(s,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},i:t,o:t,d(t){t&&S(s),C(a,t)}}}function oy(e){let s,i,n=Qh(e[0].type,e[0].tier)+"";return{c(){s=M("div"),i=E(n),T(s,"class","pack description svelte-o1dug")},m(t,e){$(t,s,e),k(s,i)},p(t,e){1&e&&n!==(n=Qh(t[0].type,t[0].tier)+"")&&D(i,n)},i:t,o:t,d(t){t&&S(s)}}}function ly(t){let e;const s=new Bv({props:{level:t[0].logic.skilllevel+1,skill:zp.get(t[0].logic.skillid),asItemDescription:!0}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};1&e&&(i.level=t[0].logic.skilllevel+1),1&e&&(i.skill=zp.get(t[0].logic.skillid)),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function cy(t){let e;return{c(){(e=M("div")).textContent="Press Shift to compare item.",T(e,"class","pack svelte-o1dug")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function hy(t){let e,s,i,n,a,r,o=t[10][1]>0?"+":"",l=pg(t[10][0],t[10][1])+"",c=qh.ui.stats.array[t[10][0]]+"";return{c(){e=M("div"),s=E(o),i=E(l),n=_(),a=E(c),T(e,"class",r="text"+(t[10][1]>0?"green":"red"))},m(t,r){$(t,e,r),k(e,s),k(e,i),k(e,n),k(e,a)},p(t,n){16&n&&o!==(o=t[10][1]>0?"+":"")&&D(s,o),16&n&&l!==(l=pg(t[10][0],t[10][1])+"")&&D(i,l),16&n&&c!==(c=qh.ui.stats.array[t[10][0]]+"")&&D(a,c),16&n&&r!==(r="text"+(t[10][1]>0?"green":"red"))&&T(e,"class",r)},d(t){t&&S(e)}}}function dy(t){let e,s,i;const n=new py({props:{item:t[2],comparison:!0}});return{c(){e=M("div"),Mt(n.$$.fragment),T(e,"class",s="slotdescription border "+lu(t[2].quality)[0]+" comparecontainer svelte-o1dug")},m(t,s){$(t,e,s),Et(n,e,null),i=!0},p(t,a){const r={};4&a&&(r.item=t[2]),n.$set(r),(!i||4&a&&s!==(s="slotdescription border "+lu(t[2].quality)[0]+" comparecontainer svelte-o1dug"))&&T(e,"class",s)},i(t){i||(vt(n.$$.fragment,t),i=!0)},o(t){yt(n.$$.fragment,t),i=!1},d(t){t&&S(e),_t(n)}}}function uy(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,A,P,I,q,j=t[3]?"T"+(t[0].tier+1)+" ":"",F=Wh(t[0].type,t[0].tier)+"",z=t[0].upgrade?" +"+t[0].upgrade:"",B=(t[0].stacks?"":lu(t[0].quality)[1])+"",L=t[0].type+"",N=t[0].quality&&!t[0].stacks?t[0].quality+"%":"",U=t[0].storeValue()>0&&t[1],O=t[0].canBeSold(),Q=t[0].dbid&&Gv(t),W=t[7],V=[];for(let e=0;e<W.length;e+=1)V[e]=Jv(Vv(t,W,e));let H=void 0!==t[0].logic.custom&&Kv(t),Y=t[0].equipReasons(qn&&qn.player),G=[];for(let e=0;e<Y.length;e+=1)G[e]=ey(Wv(t,Y,e));let X=t[0].bound&&sy(),Z=U&&iy(t),J=O&&ny(t);const K=[ry,ay],tt=[];function et(t,e){return t[2]?0:1}A=et(t),P=tt[A]=K[A](t);let st=t[2]&&dy(t);return{c(){e=M("div"),s=M("div"),i=M("div"),n=E(j),a=E(F),r=M("span"),o=E(z),c=M("div"),h=E(B),d=_(),u=E(L),m=_(),p=M("span"),f=E(N),Q&&Q.c(),g=M("div");for(let t=0;t<V.length;t+=1)V[t].c();v=R(),H&&H.c(),y=M("div");for(let t=0;t<G.length;t+=1)G[t].c();b=R(),X&&X.c(),x=M("div"),Z&&Z.c(),w=R(),J&&J.c(),P.c(),st&&st.c(),I=R(),T(r,"class","textprimary"),T(i,"class",l="slottitle text"+lu(t[0].quality)[0]+" svelte-o1dug"),T(c,"class","type textwhite svelte-o1dug"),T(s,"class","pack svelte-o1dug"),T(g,"class","pack svelte-o1dug"),T(y,"class","pack svelte-o1dug"),T(x,"class","pack svelte-o1dug"),T(e,"class","container svelte-o1dug")},m(t,l){$(t,e,l),k(e,s),k(s,i),k(i,n),k(i,a),k(i,r),k(r,o),k(s,c),k(c,h),k(c,d),k(c,u),k(c,m),k(c,p),k(p,f),Q&&Q.m(s,null),k(e,g);for(let t=0;t<V.length;t+=1)V[t].m(g,null);k(g,v),H&&H.m(g,null),k(e,y);for(let t=0;t<G.length;t+=1)G[t].m(y,null);k(y,b),X&&X.m(y,null),k(e,x),Z&&Z.m(x,null),k(x,w),J&&J.m(x,null),tt[A].m(e,null),st&&st.m(t,l),$(t,I,l),q=!0},p(t,[r]){if((!q||9&r)&&j!==(j=t[3]?"T"+(t[0].tier+1)+" ":"")&&D(n,j),(!q||1&r)&&F!==(F=Wh(t[0].type,t[0].tier)+"")&&D(a,F),(!q||1&r)&&z!==(z=t[0].upgrade?" +"+t[0].upgrade:"")&&D(o,z),(!q||1&r&&l!==(l="slottitle text"+lu(t[0].quality)[0]+" svelte-o1dug"))&&T(i,"class",l),(!q||1&r)&&B!==(B=(t[0].stacks?"":lu(t[0].quality)[1])+"")&&D(h,B),(!q||1&r)&&L!==(L=t[0].type+"")&&D(u,L),(!q||1&r)&&N!==(N=t[0].quality&&!t[0].stacks?t[0].quality+"%":"")&&D(f,N),t[0].dbid?Q?Q.p(t,r):((Q=Gv(t)).c(),Q.m(s,null)):Q&&(Q.d(1),Q=null),137&r){let e;for(W=t[7],e=0;e<W.length;e+=1){const s=Vv(t,W,e);V[e]?V[e].p(s,r):(V[e]=Jv(s),V[e].c(),V[e].m(g,v))}for(;e<V.length;e+=1)V[e].d(1);V.length=W.length}if(void 0!==t[0].logic.custom?H?H.p(t,r):((H=Kv(t)).c(),H.m(g,null)):H&&(H.d(1),H=null),1&r){let e;for(Y=t[0].equipReasons(qn&&qn.player),e=0;e<Y.length;e+=1){const s=Wv(t,Y,e);G[e]?G[e].p(s,r):(G[e]=ey(s),G[e].c(),G[e].m(y,b))}for(;e<G.length;e+=1)G[e].d(1);G.length=Y.length}t[0].bound?X||((X=sy()).c(),X.m(y,null)):X&&(X.d(1),X=null),3&r&&(U=t[0].storeValue()>0&&t[1]),U?Z?(Z.p(t,r),vt(Z,1)):((Z=iy(t)).c(),vt(Z,1),Z.m(x,w)):Z&&(ft(),yt(Z,1,1,()=>{Z=null}),gt()),1&r&&(O=t[0].canBeSold()),O?J?(J.p(t,r),vt(J,1)):((J=ny(t)).c(),vt(J,1),J.m(x,null)):J&&(ft(),yt(J,1,1,()=>{J=null}),gt());let c=A;(A=et(t))===c?tt[A].p(t,r):(ft(),yt(tt[c],1,1,()=>{tt[c]=null}),gt(),(P=tt[A])||(P=tt[A]=K[A](t)).c(),vt(P,1),P.m(e,null)),t[2]?st?(st.p(t,r),vt(st,1)):((st=dy(t)).c(),vt(st,1),st.m(I.parentNode,I)):st&&(ft(),yt(st,1,1,()=>{st=null}),gt())},i(t){q||(vt(Z),vt(J),vt(P),vt(st),q=!0)},o(t){yt(Z),yt(J),yt(P),yt(st),q=!1},d(t){t&&S(e),Q&&Q.d(),C(V,t),H&&H.d(),C(G,t),X&&X.d(),Z&&Z.d(),J&&J.d(),tt[A].d(),st&&st.d(t),t&&S(I)}}}function my(t,e,s){let i,{item:n}=e,{comparison:a=!1}=e,{isTrader:r=!1}=e,o=ro.shift.store;h(t,o,t=>s(3,i=t));let l,c,d,u=n.stats.has(10)?Array.from(n.stats).filter(t=>11!==t[0]):Array.from(n.stats);return t.$set=(t=>{"item"in t&&s(0,n=t.item),"comparison"in t&&s(8,a=t.comparison),"isTrader"in t&&s(1,r=t.isTrader)}),t.$$.update=(()=>{265&t.$$.dirty&&s(2,l=i&&!a?qn&&qn.player.inventory.slots.get(Or[n.type].slot)&&void 0!==qn.player.inventory.slots.get(Or[n.type].slot).type&&qn.player.inventory.slots.get(Or[n.type].slot):void 0),4&t.$$.dirty&&s(4,c=l?(()=>{const t=new Map;return n.stats.forEach((e,s)=>{t.set(s,e.value)}),l.stats.forEach((e,s)=>{const i=(t.get(s)||0)-e.value;0!==i?t.set(s,i):t.delete(s)}),Array.from(t)})():void 0),257&t.$$.dirty&&s(5,d=!a&&void 0!==Or[n.type].slot)}),[n,r,l,i,c,d,o,u,a]}class py extends Pt{constructor(t){super(),Rt(this,t,my,uy,o,{item:0,comparison:8,isTrader:1})}}function fy(t){let e;const s=new Bv({props:{level:t[10]||1,skill:{...zp.get(t[2].id)}}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};1024&e&&(i.level=t[10]||1),4&e&&(i.skill={...zp.get(t[2].id)}),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function gy(t){let e;const s=new py({props:{item:t[11]}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};2048&e&&(i.item=t[11]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function vy(t){let e,s,i,n;const a=[gy,fy],r=[];function o(t,e){return t[2].item&&t[11]?0:t[2].item?-1:1}return~(e=o(t))&&(s=r[e]=a[e](t)),{c(){s&&s.c(),i=R()},m(t,s){~e&&r[e].m(t,s),$(t,i,s),n=!0},p(t,n){let l=e;(e=o(t))===l?~e&&r[e].p(t,n):(s&&(ft(),yt(r[l],1,1,()=>{r[l]=null}),gt()),~e?((s=r[e])||(s=r[e]=a[e](t)).c(),vt(s,1),s.m(i.parentNode,i)):s=null)},i(t){n||(vt(s),n=!0)},o(t){yt(s),n=!1},d(t){~e&&r[e].d(t),t&&S(i)}}}function yy(t){let e;const s=new Hg({props:{describe:t[2].id>=0&&(!t[2].item||t[8]>0),descPos:"bottom:100%;left:50%;transform:translateX(-50%);",",":!0,status:void 0!==t[4]?t[4].status:0,id:"sk"+t[2].hotkey,data:t[2].id>=0?t[2]:void 0,auto:t[12]===t[2].id,queued:t[13]===t[2].id,meta:t[1],css:t[7],stacks:t[8],cd:t[6],img:t[5],key:t[2].hotkey,border:t[2].item&&!t[8]||!t[2].item&&0===t[10]?"grey filtered":t[13]===t[2].id||t[9]?"auto":t[12]===t[2].id||t[3]||t[6]?"grey":"white",$$slots:{default:[vy]},$$scope:{ctx:t}}});return s.$on("discard",t[27]),s.$on("move",t[28]),{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,[e]){const i={};260&e&&(i.describe=t[2].id>=0&&(!t[2].item||t[8]>0)),16&e&&(i.status=void 0!==t[4]?t[4].status:0),4&e&&(i.id="sk"+t[2].hotkey),4&e&&(i.data=t[2].id>=0?t[2]:void 0),4100&e&&(i.auto=t[12]===t[2].id),8196&e&&(i.queued=t[13]===t[2].id),2&e&&(i.meta=t[1]),128&e&&(i.css=t[7]),256&e&&(i.stacks=t[8]),64&e&&(i.cd=t[6]),32&e&&(i.img=t[5]),4&e&&(i.key=t[2].hotkey),14156&e&&(i.border=t[2].item&&!t[8]||!t[2].item&&0===t[10]?"grey filtered":t[13]===t[2].id||t[9]?"auto":t[12]===t[2].id||t[3]||t[6]?"grey":"white"),536873988&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function by(e,s,i){let n,a,r,o,l,d,u=t,m=()=>(u(),u=c(p,t=>i(2,n=t)),p);h(e,te,t=>i(20,a=t)),h(e,Kt,t=>i(22,r=t)),h(e,ee,t=>i(23,o=t)),h(e,ne,t=>i(12,l=t)),h(e,ie,t=>i(13,d=t)),e.$$.on_destroy.push(()=>u());let{skill:p}=s;m();let{skillslot:g}=s,v=void 0,y=void 0,b=void 0,k=void 0;Y(()=>{if(n.hotkey!==v&&(void 0!==y&&w(),void 0!==(v=n.hotkey))){null==(k=ro[v])&&(k=ro[v]={});const t=ho(v,k);y=t.onPress(x),b=t.onRelease($)}});const x=()=>{if(qn.player&&n.id>=0){if(n.item){const t=qn.player.inventory.findFirstSlotOfType(n.item.type,n.item.tier);if(void 0===t)return;f(p,n.info[0]=t,n)}fd(hma.handle.data.clientPlayerSkill.packData({id:n.id,info:n.info})),i(9,I=!0),Yr({id:"ui/pressbtn"})}},$=()=>{i(9,I=!1)},w=()=>{k&&k.mappings&&(k.mappings=k.mappings.filter(t=>t!=v)),k&&k.press&&(k.press=k.press.filter(t=>t!=y)),k&&k.release&&(k.release=k.release.filter(t=>t!=b)),v=void 0,y=void 0,b=void 0};let S,M,E,C,T,_,A,R,P,I,D,q;return X(w),e.$set=(t=>{"skill"in t&&m(i(0,p=t.skill)),"skillslot"in t&&i(14,g=t.skillslot)}),e.$$.update=(()=>{16388&e.$$.dirty&&i(1,S={type:"skill",slot:g,skill:n}),4&e.$$.dirty&&i(3,M=n.id<0),4&e.$$.dirty&&i(19,E=n.item),1048588&e.$$.dirty&&i(4,C=M?void 0:a[n.id]),524300&e.$$.dirty&&i(5,T=M?void 0:E?Hd(E.type,E.tier,E.logic?E.logic.class:0):Wd(n.id)),16&e.$$.dirty&&i(6,_=C?C.cd:void 0),16&e.$$.dirty&&(A=C?C.status:0),524288&e.$$.dirty&&i(7,R=E?"slotitem":"slotskill"),4718592&e.$$.dirty&&i(8,P=E?r[E.type+E.tier]||0:void 0),8912908&e.$$.dirty&&i(10,D=E||M?0:o.reduce((t,e)=>t+(e.logic.id===n.id&&e.level),0)),260&e.$$.dirty&&i(11,q=P&&n.item?qn.player.inventory.findFirstItemOfType(n.item.type,n.item.tier):void 0)}),i(9,I=!1),[p,S,n,M,C,T,_,R,P,I,D,q,l,d,g,v,y,b,k,E,a,A,r,o,x,$,w,function(t){J(e,t)},function(t){J(e,t)}]}class xy extends Pt{constructor(t){super(),Rt(this,t,by,yy,o,{skill:0,skillslot:14})}}var wy=lg({0:10,1:10,2:10,3:10,4:10,5:5,15:100,17:10,6:100,7:100,14:50,9:30,8:20,12:15});const ky=wy,$y=lg({2:1,1:2});var Sy=Object.freeze({__proto__:null,startSkills:[31],engineSkills:[8,5,40],baseStats:ky,statPerLevel:$y});const Cy=wy,My=lg({3:1,1:2});var Ey=Object.freeze({__proto__:null,baseStats:Cy,startSkills:[4],engineSkills:[8,40],statPerLevel:My});const _y=lg({0:3,1:5,2:5,3:5,5:5,17:50,15:60,10:1,11:2,6:15,7:100,9:80}),Ry=lg({0:1,12:2,2:4,10:.4,11:.4,6:4}),Py=lg({12:.03,6:6,10:.04,11:.05});var Ty=Object.freeze({__proto__:null,baseStats:_y,statPerLevel:Ry,statPerLevelExponential:Py});const Iy=lg({0:10,1:10,2:10,3:10,4:10,5:10}),Dy=lg({0:20,1:20,2:20,4:20});var Ay=Object.freeze({__proto__:null,baseStats:Iy,statPerLevel:Dy});const Fy=wy,zy=lg({4:1,1:2});var By=Object.freeze({__proto__:null,baseStats:Fy,startSkills:[12],engineSkills:[8,0,40],statPerLevel:zy});const Uy=wy,Oy=lg({0:1,1:2});var jy=[Object.freeze({__proto__:null,baseStats:Uy,startSkills:[1,21],engineSkills:[8,0,40],statPerLevel:Oy}),Ey,Sy,By,Ay,Ty];function Ly(t,e,s){const i=t.slice();return i[8]=e[s],i[10]=s,i}function Ny(e){let s;const i=new xy({props:{skill:e[8],skillslot:e[10]}});return i.$on("discard",e[1]),i.$on("move",e[0]),{c(){Mt(i.$$.fragment)},m(t,e){Et(i,t,e),s=!0},p:t,i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){_t(i,t)}}}function qy(t){let e,s,i=Ce,n=[];for(let e=0;e<i.length;e+=1)n[e]=Ny(Ly(t,i,e));const a=t=>yt(n[t],1,1,()=>{n[t]=null});return{c(){e=M("div");for(let t=0;t<n.length;t+=1)n[t].c();T(e,"id","skillbar"),T(e,"class","panel-black bar svelte-1v6qmvo")},m(t,i){$(t,e,i);for(let t=0;t<n.length;t+=1)n[t].m(e,null);s=!0},p(t,[s]){if(3&s){let r;for(i=Ce,r=0;r<i.length;r+=1){const a=Ly(t,i,r);n[r]?(n[r].p(a,s),vt(n[r],1)):(n[r]=Ny(a),n[r].c(),vt(n[r],1),n[r].m(e,null))}for(ft(),r=i.length;r<n.length;r+=1)a(r);gt()}},i(t){if(!s){for(let t=0;t<i.length;t+=1)vt(n[t]);s=!0}},o(t){n=n.filter(Boolean);for(let t=0;t<n.length;t+=1)yt(n[t]);s=!1},d(t){t&&S(e),C(n,t)}}}function Hy(t,e,s){let i,n,a;h(t,Ke,t=>s(3,i=t)),h(t,qs,t=>s(4,n=t)),h(t,Gt,t=>s(5,a=t));const r=qn.player.name;let o=i[r];o||(o=f(Ke,i[r]=[],i));for(let t=0;t<n;++t)if(void 0===i[r][t]){const e=jy[qn.player.class].startSkills[t];i[r].push({id:void 0!==e&&zp.get(e).autoSkillbar?e:-1,type:0,info:[]}),4===t||5===t?(f(Ke,i[r][t].id=100,i),f(Ke,i[r][t].item={type:"misc",tier:t-4},i)):11===t&&f(Ke,i[r][11].id=40,i)}for(let t=0;t<n;++t)void 0===Ce[t]&&Ce.push(It({id:-1,type:0,info:[]}));i[r].forEach((t,e)=>{Ce[e]&&(t.hotkey=gi["kbSkillbar"+(e+1)],Ce[e].set(t))}),Ce.forEach((t,e)=>{t.subscribe(t=>{Ke.update(s=>(s[r][e]=t,s))})});const l=t=>(t.id=-1,t.item=void 0,t);return[t=>{const{from:e,to:s}=t.detail;e!==s&&("item"==e.type?Ce[s.slot].update(t=>(t.id=e.item.logic.useSkill,t.item={type:e.item.type,tier:e.item.tier},t)):"skill"==e.type&&(Ce[s.slot].update(t=>(t.id=e.skill.id,t.item=e.skill.item,t)),void 0!==e.slot&&Ce[e.slot].update(l)))},t=>{Ce[a.meta.slot].update(l)}]}class Wy extends Pt{constructor(t){super(),Rt(this,t,Hy,qy,l,{})}}function Qy(t){let e;const s=new py({props:{isTrader:t[6],item:t[9]}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};64&e&&(i.isTrader=t[6]),512&e&&(i.item=t[9]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Vy(t){let e,s,i=t[9]&&Qy(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,s){t[9]?i?(i.p(t,s),vt(i,1)):((i=Qy(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function Gy(t){let e;const s=new Hg({props:{cd:t[14],id:t[7],hover:t[5],descPos:t[4],descRoot:t[3],pickable:t[1],meta:t[10],img:t[8],border:t[11],stacks:t[13],data:t[9],key:t[2],css:t[12],$$slots:{default:[Vy]},$$scope:{ctx:t}}});return s.$on("discard",t[21]),s.$on("use",t[22]),s.$on("click",t[23]),s.$on("context",t[24]),s.$on("move",t[25]),{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,[e]){const i={};16384&e&&(i.cd=t[14]),128&e&&(i.id=t[7]),32&e&&(i.hover=t[5]),16&e&&(i.descPos=t[4]),8&e&&(i.descRoot=t[3]),2&e&&(i.pickable=t[1]),1024&e&&(i.meta=t[10]),256&e&&(i.img=t[8]),2048&e&&(i.border=t[11]),8192&e&&(i.stacks=t[13]),512&e&&(i.data=t[9]),4&e&&(i.key=t[2]),4096&e&&(i.css=t[12]),67109440&e&&(i.$$scope={dirty:e,ctx:t}),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Yy(e,s,i){let n,a,r=t,o=()=>(r(),r=c(l,t=>i(9,n=t)),l);h(e,te,t=>i(19,a=t)),e.$$.on_destroy.push(()=>r());let{item:l}=s;o();let{filter:d=""}=s,{invslot:u}=s,{pickable:m=!0}=s,{text:p}=s,{descRoot:f}=s,{descPos:g}=s,{hover:v}=s,{isTrader:y=!1}=s,{clearOnMove:b=!1}=s,{id:k=""}=s;const x=t=>!(!0!==t&&!n.moving)||!!t&&!(n.type.includes(t)||n.logic.level>t||qh.items[n.type]["book"===n.type?n.logic.skillid:n.tier].name.toLowerCase().includes(t));let $,w,S,M,E,C,T;return e.$set=(t=>{"item"in t&&o(i(0,l=t.item)),"filter"in t&&i(15,d=t.filter),"invslot"in t&&i(16,u=t.invslot),"pickable"in t&&i(1,m=t.pickable),"text"in t&&i(2,p=t.text),"descRoot"in t&&i(3,f=t.descRoot),"descPos"in t&&i(4,g=t.descPos),"hover"in t&&i(5,v=t.hover),"isTrader"in t&&i(6,y=t.isTrader),"clearOnMove"in t&&i(17,b=t.clearOnMove),"id"in t&&i(7,k=t.id)}),e.$$.update=(()=>{66048&e.$$.dirty&&i(8,$=n?Hd(n.type,n.tier,n.logic?n.logic.class:0):u>100?Qd(u):void 0),197121&e.$$.dirty&&i(10,w={type:"item",slot:u,item:n,store:b?l:void 0}),33344&e.$$.dirty&&i(11,S=n?lu(n.quality)[0]+((y?!n.canEquipClass(qn.player):x(d))?" filtered":y?n.canEquip(qn.player)?"":" red":""):"grey"),512&e.$$.dirty&&i(12,M="slotitem"+(n&&Ur[n.type].rot?" rot":"")),512&e.$$.dirty&&i(13,E=n&&(n.upgrade?"+"+n.upgrade:n.stacks)),524800&e.$$.dirty&&i(18,C=n&&n.logic.use?n.logic.useSkill&&a[n.logic.useSkill]:void 0),262144&e.$$.dirty&&i(14,T=C?C.cd:void 0)}),[l,m,p,f,g,v,y,k,$,n,w,S,M,E,T,d,u,b,C,a,x,function(t){J(e,t)},function(t){J(e,t)},function(t){J(e,t)},function(t){J(e,t)},function(t){J(e,t)}]}class Xy extends Pt{constructor(t){super(),Rt(this,t,Yy,Gy,o,{item:0,filter:15,invslot:16,pickable:1,text:2,descRoot:3,descPos:4,hover:5,isTrader:6,clearOnMove:17,id:7})}}function Zy(t,e,s){const i=t.slice();return i[15]=e[s],i[17]=s,i}function Jy(t){let e;const s=new Xy({props:{id:"bag"+t[17],item:t[15],invslot:t[17],filter:t[0].toLowerCase()}});return s.$on("use",t[8]),s.$on("context",t[7]),s.$on("move",t[6]),{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};2&e&&(i.item=t[15]),1&e&&(i.filter=t[0].toLowerCase()),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Ky(t){let e,s,i,n,a,r,o=t[1].filter(eb),l=[];for(let e=0;e<o.length;e+=1)l[e]=Jy(Zy(t,o,e));const c=t=>yt(l[t],1,1,()=>{l[t]=null}),h=new jv({props:{amount:t[4]}}),d=new qv({props:{amount:t[5]}});return{c(){e=M("input"),s=M("div");for(let t=0;t<l.length;t+=1)l[t].c();i=M("div"),Mt(h.$$.fragment),n=M("div"),Mt(d.$$.fragment),T(e,"class","filter svelte-1lsjq6i"),T(e,"type","text"),T(e,"placeholder","Filter"),T(s,"class","slotcontainer svelte-1lsjq6i"),F(s,"grid-auto-rows","46px"),F(s,"grid-template-columns","repeat("+t[3]+", 46px)"),T(i,"class","panel-black gold svelte-1lsjq6i"),T(n,"class","panel-black gold svelte-1lsjq6i"),F(n,"margin-right","3px"),r=P(e,"input",t[13])},m(r,o){$(r,e,o),A(e,t[0]),$(r,s,o);for(let t=0;t<l.length;t+=1)l[t].m(s,null);$(r,i,o),Et(h,i,null),$(r,n,o),Et(d,n,null),a=!0},p(t,i){if(1&i&&e.value!==t[0]&&A(e,t[0]),451&i){let e;for(o=t[1].filter(eb),e=0;e<o.length;e+=1){const n=Zy(t,o,e);l[e]?(l[e].p(n,i),vt(l[e],1)):(l[e]=Jy(n),l[e].c(),vt(l[e],1),l[e].m(s,null))}for(ft(),e=o.length;e<l.length;e+=1)c(e);gt()}(!a||8&i)&&F(s,"grid-template-columns","repeat("+t[3]+", 46px)");const n={};16&i&&(n.amount=t[4]),h.$set(n);const r={};32&i&&(r.amount=t[5]),d.$set(r)},i(t){if(!a){for(let t=0;t<o.length;t+=1)vt(l[t]);vt(h.$$.fragment,t),vt(d.$$.fragment,t),a=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)yt(l[t]);yt(h.$$.fragment,t),yt(d.$$.fragment,t),a=!1},d(t){t&&S(e),t&&S(s),C(l,t),t&&S(i),_t(h),t&&S(n),_t(d),r()}}}function tb(t){let e,s;const i=new Rf({props:{title:"Inventory",pad:"5",icon:"bag",$$slots:{default:[Ky]},$$scope:{ctx:t}}});return i.$on("close",function(){t[14].apply(this,arguments)}),{c(){e=M("div"),Mt(i.$$.fragment),F(e,"display",t[2]?"block":"none"),T(e,"class","l-corner-lr container svelte-1lsjq6i")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(n,[a]){t=n;const r={};262203&a&&(r.$$scope={dirty:a,ctx:t}),i.$set(r),(!s||4&a)&&F(e,"display",t[2]?"block":"none")},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}const eb=(t,e)=>e<101;function sb(t,e,s){let i,n,a,r,o,l,c,d,u;h(t,Jt,t=>s(1,i=t)),h(t,Gt,t=>s(9,n=t)),h(t,pe,t=>s(10,a=t)),h(t,ce,t=>s(11,r=t)),h(t,ge,t=>s(12,o=t)),h(t,He,t=>s(2,l=t)),h(t,qe,t=>s(3,c=t)),h(t,Xt,t=>s(4,d=t)),h(t,Zt,t=>s(5,u=t));let m="";return[m,i,l,c,d,u,t=>{const{from:e,to:s}=t.detail;if(e!==s&&"item"==e.type){if(hma.chat.commands.pack("itemmove",`${e.slot} ${s.slot}`),e.slot>=101)return;e.item.stacks&&(e.item.stacks=""),e.item.moving=!0,s.item?(s.item.stacks&&(s.item.stacks=""),i[e.slot].set(s.item),s.item.moving=!0):i[e.slot]&&i[e.slot].set(void 0),i[s.slot].set(e.item)}},t=>{if(!t.detail.item||n)return;const e=[];a?e.push(rg.itemstash(t.detail.slot)):(t.detail.item.canEquip(qn.player)&&(Or[t.detail.item.type].slot&&e.push(rg.itemmove(t.detail.slot,Or[t.detail.item.type].slot)),t.detail.item.logic.use&&e.push(rg.itemuse(t.detail.slot,t.detail.item.logic.useSkill))),t.detail.item.canBeDropped()&&e.push(rg.itemdrop(t.detail.slot)),t.detail.item.stacks>1&&(e.push(rg.itemsplithalf(t.detail.slot)),e.push(rg.itemsplitone(t.detail.slot)))),zt.set({x:t.detail.e.pageX-t.detail.e.layerX,y:t.detail.e.pageY+(46-t.detail.e.layerY),opts:e})},t=>{t.detail.item&&(a?hma.chat.commands.pack("itemstash",`${t.detail.slot}`):r?de.set(t.detail.item):o?hma.chat.commands.pack("itemtradersell",`${t.detail.slot}`):t.detail.item.canBeDropped()&&hma.chat.commands.pack("itemdrop",`${t.detail.slot}`))},n,a,r,o,function(){m=this.value,s(0,m)},t=>f(He,l=!1)]}class ib extends Pt{constructor(t){super(),Rt(this,t,sb,tb,o,{})}}const nb=new Map,ab=new Dl(0,.5),rb=()=>{nb.clear(),ab.reset(0)},ob=rb,lb=(t,e)=>{if(void 0===t.name||!gi.dpsmeterOpen||0!==t.constructor.type)return;if(gi.dpsmeterParty&&(0===qn.player.party&&t!==qn.player||t.party!==qn.player.party))return;let s=void 0;nb.has(t.name)?s=nb.get(t.name):(nb.set(t.name,s={}),s.amount=0,s.start=0,s.class=t.class,s.dps=0,s.id=t.id,s.ooc=!0),s.ooc?(s.start=qn.time,s.ooc=!1,s.amount=e):s.amount+=e,s.last=qn.time};var cb=Object.freeze({__proto__:null,values:nb,init:rb,onWorldEnter:ob,tick:t=>{gi.dpsmeterOpen&&ab.done(qn.time)&&(ab.reset(qn.time),nb.forEach((t,e)=>{t.ooc?qn.time-t.start>5&&nb.delete(e):!qn.entity(t.id)||qn.time-t.last>5?(t.ooc=!0,t.start=qn.time):t.dps=(t.amount/Math.max(5,qn.time-t.start)).toFixed(1)}),we.set(Array.from(nb).sort((t,e)=>e[1].dps-t[1].dps).slice(0,10)))},add:lb});function hb(t,e,s){const i=t.slice();return i[6]=e[s],i}function db(t){let e,s;const i=new Rf({props:{title:"Damage / DPS",pad:"5",icon:"trophy",$$slots:{default:[mb]},$$scope:{ctx:t}}});return i.$on("close",function(){t[5].apply(this,arguments)}),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","l-corner-lr container svelte-rhzpkh")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(e,s){t=e;const n={};518&s&&(n.$$scope={dirty:s,ctx:t}),i.$set(n)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function ub(t,e){let s,i;const n=new Nf({props:{size:"1em",fract:Math.round(100*e[6][1].dps/e[1][0][1].dps),barcol:"bgc"+e[6][1].class,left:e[6][0],right:`${e[6][1].amount} (${e[6][1].dps})`}});return{key:t,first:null,c(){s=R(),Mt(n.$$.fragment),this.first=s},m(t,e){$(t,s,e),Et(n,t,e),i=!0},p(t,e){const s={};2&e&&(s.fract=Math.round(100*t[6][1].dps/t[1][0][1].dps)),2&e&&(s.barcol="bgc"+t[6][1].class),2&e&&(s.left=t[6][0]),2&e&&(s.right=`${t[6][1].amount} (${t[6][1].dps})`),n.$set(s)},i(t){i||(vt(n.$$.fragment,t),i=!0)},o(t){yt(n.$$.fragment,t),i=!1},d(t){t&&S(s),_t(n,t)}}}function mb(t){let e,s,i,n,r,o,l,c,h=[],d=new Map,u=t[1];const m=t=>t[6][1].id;for(let e=0;e<u.length;e+=1){let s=hb(t,u,e),i=m(s);d.set(i,h[e]=ub(i,s))}return{c(){e=M("div");for(let t=0;t<h.length;t+=1)h[t].c();s=M("div"),(i=M("div")).textContent="Reset",n=M("div"),r=E("Party Only"),T(e,"class","wrapper svelte-rhzpkh"),T(i,"class","btn grey"),T(n,"class",o="btn "+(t[2]?"grey active":"black")),T(s,"class","grid two buttons marg-top svelte-rhzpkh"),c=[P(i,"click",t[3]),P(n,"click",function(){t[4].apply(this,arguments)})]},m(t,a){$(t,e,a);for(let t=0;t<h.length;t+=1)h[t].m(e,null);$(t,s,a),k(s,i),k(s,n),k(n,r),l=!0},p(s,i){const a=(t=s)[1];ft(),h=St(h,i,m,1,t,a,d,e,$t,ub,null,hb),gt(),(!l||4&i&&o!==(o="btn "+(t[2]?"grey active":"black")))&&T(n,"class",o)},i(t){if(!l){for(let t=0;t<u.length;t+=1)vt(h[t]);l=!0}},o(t){for(let t=0;t<h.length;t+=1)yt(h[t]);l=!1},d(t){t&&S(e);for(let t=0;t<h.length;t+=1)h[t].d();t&&S(s),a(c)}}}function pb(t){let e,s,i=t[0]&&db(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),vt(i,1)):((i=db(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function fb(t,e,s){let i,n,a;return h(t,Ve,t=>s(0,i=t)),h(t,we,t=>s(1,n=t)),h(t,Ze,t=>s(2,a=t)),[i,n,a,t=>nb.clear(),t=>f(Ze,a=!a),t=>f(Ve,i=!1)]}class gb extends Pt{constructor(t){super(),Rt(this,t,fb,pb,o,{})}}function vb(t){let e,s,i,n,a,r=t[0].Pp+"";return{c(){e=M("p"),s=E(r),n=_(),T(e,"class","text location textgreen svelte-hrt4ky")},m(t,i){$(t,e,i),k(e,s),$(t,n,i),a=!0},p(t,e){(!a||1&e)&&r!==(r=t[0].Pp+"")&&D(s,r)},i(t){a||(ot(()=>{i||(i=xt(e,Yh,{},!0)),i.run(1)}),a=!0)},o(t){i||(i=xt(e,Yh,{},!1)),i.run(0),a=!1},d(t){t&&S(e),t&&i&&i.end(),t&&S(n)}}}function yb(s){let i,n,o,l,c=s[0].error+"";return{c(){i=M("p"),n=E(c),T(i,"class","text error textred svelte-hrt4ky")},m(t,e){$(t,i,e),k(i,n),l=!0},p(t,e){(!l||1&e)&&c!==(c=t[0].error+"")&&D(n,c)},i(t){l||(o&&o.end(1),l=!0)},o(s){o=function(s,i,n){let o,l=Yh(s,{}),c=!0;const h=pt;function d(){const{delay:i=0,duration:n=300,easing:r=e,tick:d=t,css:u}=l||bt;u&&(o=q(s,1,0,n,i,r,u));const m=v()+i,p=m+n;ot(()=>ut(s,!1,"start")),w(t=>{if(c){if(t>=p)return d(0,1),ut(s,!1,"end"),--h.r||a(h.c),!1;if(t>=m){const e=r((t-m)/n);d(1-e,e)}}return c})}return h.r+=1,r(l)?dt().then(()=>{l=l(),d()}):d(),{end(t){t&&l.tick&&l.tick(1,0),c&&(o&&H(s,o),c=!1)}}}(i),l=!1},d(t){t&&S(i),t&&o&&o.end()}}}function bb(t){let e,s,i,n=t[0].Pp&&vb(t),a=t[0].error&&yb(t);return{c(){e=M("div"),n&&n.c(),s=R(),a&&a.c(),T(e,"class","l-ui")},m(t,r){$(t,e,r),n&&n.m(e,null),k(e,s),a&&a.m(e,null),i=!0},p(t,[i]){t[0].Pp?n?(n.p(t,i),vt(n,1)):((n=vb(t)).c(),vt(n,1),n.m(e,s)):n&&(ft(),yt(n,1,1,()=>{n=null}),gt()),t[0].error?a?(a.p(t,i),vt(a,1)):((a=yb(t)).c(),vt(a,1),a.m(e,null)):a&&(ft(),yt(a,1,1,()=>{a=null}),gt())},i(t){i||(vt(n),vt(a),i=!0)},o(t){yt(n),yt(a),i=!1},d(t){t&&S(e),n&&n.d(),a&&a.d()}}}function xb(t,e,s){let i={},n={};return Ut.subscribe(t=>{s(0,i[t.type]=t.text,i),n[t.type]&&clearTimeout(n[t.type]),n[t.type]=setTimeout(()=>{s(0,i[t.type]=void 0,i)},t.time||1e3)}),[i]}class wb extends Pt{constructor(t){super(),Rt(this,t,xb,bb,o,{})}}function kb(t,e,s){const i=t.slice();return i[6]=e[s],i}function $b(t){let e,s,i,n;const a=new Rf({props:{title:"Request",close:!1,$$slots:{default:[Cb]},$$scope:{ctx:t}}});return{c(){e=M("div"),Mt(a.$$.fragment),T(e,"class","absCentered container svelte-cy0tay"),n=P(e,"outroend",t[5])},m(t,s){$(t,e,s),Et(a,e,null),i=!0},p(t,e){const s={};518&e&&(s.$$scope={dirty:e,ctx:t}),a.$set(s)},i(t){i||(vt(a.$$.fragment,t),ot(()=>{s||(s=xt(e,Yh,{duration:100},!0)),s.run(1)}),i=!0)},o(t){yt(a.$$.fragment,t),s||(s=xt(e,Yh,{duration:100},!1)),s.run(0),i=!1},d(t){t&&S(e),_t(a),t&&s&&s.end(),n()}}}function Sb(t){let e,s,i,n,a,r=t[6].text+"",o=t[6].nocombat&&t[2].combat?" (Must leave combat)":"";function l(...e){return t[4](t[6],...e)}return{c(){e=M("div"),s=E(r),i=E(o),T(e,"class",n="choice "+(t[6].nocombat&&t[2].combat?"nocombat textgrey":"")+" svelte-cy0tay"),a=P(e,"click",l)},m(t,n){$(t,e,n),k(e,s),k(e,i)},p(a,l){t=a,2&l&&r!==(r=t[6].text+"")&&D(s,r),6&l&&o!==(o=t[6].nocombat&&t[2].combat?" (Must leave combat)":"")&&D(i,o),6&l&&n!==(n="choice "+(t[6].nocombat&&t[2].combat?"nocombat textgrey":"")+" svelte-cy0tay")&&T(e,"class",n)},d(t){t&&S(e),a()}}}function Cb(t){let e,s,i,n,a=t[1][0].title+"",r=t[1][0].text+"",o=t[1][0].choices,l=[];for(let e=0;e<o.length;e+=1)l[e]=Sb(kb(t,o,e));return{c(){e=M("div"),s=M("h3"),i=E(a),n=M("p");for(let t=0;t<l.length;t+=1)l[t].c();T(s,"class","textprimary"),T(e,"class","container svelte-cy0tay")},m(t,a){$(t,e,a),k(e,s),k(s,i),k(e,n),n.innerHTML=r;for(let t=0;t<l.length;t+=1)l[t].m(e,null)},p(t,s){if(2&s&&a!==(a=t[1][0].title+"")&&D(i,a),2&s&&r!==(r=t[1][0].text+"")&&(n.innerHTML=r),14&s){let i;for(o=t[1][0].choices,i=0;i<o.length;i+=1){const n=kb(t,o,i);l[i]?l[i].p(n,s):(l[i]=Sb(n),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=o.length}},d(t){t&&S(e),C(l,t)}}}function Mb(t){let e,s,i=t[1].length&&!t[0]&&$b(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[1].length&&!t[0]?i?(i.p(t,s),vt(i,1)):((i=$b(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function Eb(t,e,s){let i,n;h(t,Bt,t=>s(1,i=t)),h(t,Qt,t=>s(2,n=t));let a=!1;const r=async t=>{t&&await t(),Bt.update(t=>(t.shift(),t)),s(0,a=!0)};return[a,i,n,r,t=>{r(t.fun)},()=>{s(0,a=!1)}]}class _b extends Pt{constructor(t){super(),Rt(this,t,Eb,Mb,o,{})}}function Rb(t){let e,s,i,n=t[0][0].text+"",a=t[0][0].icon&&Pb(t);return{c(){e=M("div"),a&&a.c(),s=M("div"),T(e,"class","notification panel-black border grey svelte-9nlpzp"),i=P(e,"click",t[2])},m(t,i){$(t,e,i),a&&a.m(e,null),k(e,s),s.innerHTML=n},p(t,i){t[0][0].icon?a?a.p(t,i):((a=Pb(t)).c(),a.m(e,s)):a&&(a.d(1),a=null),1&i&&n!==(n=t[0][0].text+"")&&(s.innerHTML=n)},d(t){t&&S(e),a&&a.d(),i()}}}function Pb(t){let e,s,i;return{c(){T(e=M("img"),"class",s="icon "+t[0][0].css+" svelte-9nlpzp"),e.src!==(i="/assets/ui/"+t[0][0].icon)&&T(e,"src",i)},m(t,s){$(t,e,s)},p(t,n){1&n&&s!==(s="icon "+t[0][0].css+" svelte-9nlpzp")&&T(e,"class",s),1&n&&e.src!==(i="/assets/ui/"+t[0][0].icon)&&T(e,"src",i)},d(t){t&&S(e)}}}function Tb(e){let s,i=e[0].length&&!e[1]&&Rb(e);return{c(){i&&i.c(),s=R()},m(t,e){i&&i.m(t,e),$(t,s,e)},p(t,[e]){t[0].length&&!t[1]?i?i.p(t,e):((i=Rb(t)).c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},i:t,o:t,d(t){i&&i.d(t),t&&S(s)}}}function Ib(t,e,s){let i,n;return h(t,Dt,t=>s(0,i=t)),h(t,qt,t=>s(1,n=t)),[i,n,()=>{Dt.update(t=>(t.shift(),t))}]}class Db extends Pt{constructor(t){super(),Rt(this,t,Ib,Tb,o,{})}}function Ab(t,e,s){const i=t.slice();return i[5]=e[s],i}function Fb(t){let e,s;return{c(){e=M("div"),s=E(t[0]),T(e,"class","btn border grey")},m(t,i){$(t,e,i),k(e,s)},p(t,e){1&e&&D(s,t[0])},d(t){t&&S(e)}}}function zb(t){let e,s,i,n,r;function o(...e){return t[4](t[5],...e)}return{c(){e=M("div"),T(s=M("img"),"class","svgicon"),s.src!==(i="/assets/ui/icons/"+t[5].img+".svg?v=3406973")&&T(s,"src",i),T(e,"id",n="sys"+t[5].img),T(e,"class","btn border black"),r=[P(e,"mouseenter",function(){(function(...e){return t[2](t[5],...e)}).apply(this,arguments)}),P(e,"mouseleave",function(){t[3].apply(this,arguments)}),P(e,"click",o)]},m(t,i){$(t,e,i),k(e,s)},p(e,s){t=e},d(t){t&&S(e),a(r)}}}function Bb(e){let s,i,n=""!==e[0]&&Fb(e),a=e[1],r=[];for(let t=0;t<a.length;t+=1)r[t]=zb(Ab(e,a,t));return{c(){s=M("div"),n&&n.c(),i=R();for(let t=0;t<r.length;t+=1)r[t].c();T(s,"class","btnbar svelte-133q4bd")},m(t,e){$(t,s,e),n&&n.m(s,null),k(s,i);for(let t=0;t<r.length;t+=1)r[t].m(s,null)},p(t,[e]){if(""!==t[0]?n?n.p(t,e):((n=Fb(t)).c(),n.m(s,i)):n&&(n.d(1),n=null),3&e){let i;for(a=t[1],i=0;i<a.length;i+=1){const n=Ab(t,a,i);r[i]?r[i].p(n,e):(r[i]=zb(n),r[i].c(),r[i].m(s,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=a.length}},i:t,o:t,d(t){t&&S(s),n&&n.d(),C(r,t)}}}function Ub(t,e,s){let i="";return[i,[{img:"gem",store:Ye,desc:"Elixir"},{img:"char",store:Je,desc:"Character"},{img:"book",store:Qe,desc:"Skills"},{img:"bag",store:He,desc:"Inventory"},{img:"clan",store:Xe,desc:"Clan"},{img:"trophy",store:Ve,desc:"DPS Meter"},{img:"cog",store:We,desc:"Settings"},{img:"fullscreen",fun:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()},desc:"Fullscreen"},{img:"back",fun:()=>{document.location.href="/"},desc:"Back to Menu"}],(t,e)=>s(0,i=t.desc),t=>s(0,i=""),(t,e)=>{t.fun?t.fun():t.store.update(t=>!t)}]}class Ob extends Pt{constructor(t){super(),Rt(this,t,Ub,Bb,o,{})}}function jb(e){let s,i,n,a,r,o,l;return{c(){s=M("div"),(i=M("a")).innerHTML='<img class="svgicon" src="/assets/ui/icons/instagram.svg?v=3406973">',(n=M("a")).innerHTML='<img class="svgicon" src="/assets/ui/icons/reddit.svg?v=3406973">',(a=M("a")).innerHTML='<img class="svgicon" src="/assets/ui/icons/discord.svg?v=3406973">',(r=M("a")).innerHTML='<img class="svgicon" src="/assets/ui/icons/twitter.svg?v=3406973">',(o=M("div")).innerHTML='<img class="svgicon" src="/assets/ui/icons/twitch.svg?v=3406973">',T(i,"class","btn border black"),T(i,"target","_blank"),T(i,"rel","noopener noreferrer"),T(i,"href","https://www.instagram.com/hordesio.official"),T(n,"class","btn border black"),T(n,"target","_blank"),T(n,"rel","noopener noreferrer"),T(n,"href","https://www.reddit.com/r/Hordesio"),T(a,"class","btn border black"),T(a,"target","_blank"),T(a,"rel","noopener noreferrer"),T(a,"href","https://discord.gg/hordes"),T(r,"class","btn border black"),T(r,"target","_blank"),T(r,"rel","noopener noreferrer"),T(r,"href","https://twitter.com/hordesio"),T(o,"class","btn border black"),T(s,"class","btnbar svelte-1wol45y"),l=P(o,"click",function(){e[1].apply(this,arguments)})},m(t,e){$(t,s,e),k(s,i),k(s,n),k(s,a),k(s,r),k(s,o)},p(t,[s]){e=t},i:t,o:t,d(t){t&&S(s),l()}}}function Lb(t,e,s){let i;return h(t,Ge,t=>s(0,i=t)),[i,t=>f(Ge,i=!i)]}class Nb extends Pt{constructor(t){super(),Rt(this,t,Lb,jb,o,{})}}function qb(e){let s,i,n;return{c(){T(s=M("div"),"class",i="btn checkbox "+(e[2]?"active":"")),n=P(s,"click",function(){e[3].apply(this,arguments)})},m(t,e){$(t,s,e)},p(t,[n]){e=t,4&n&&i!==(i="btn checkbox "+(e[2]?"active":""))&&T(s,"class",i)},i:t,o:t,d(t){t&&S(s),n()}}}function Hb(e,s,i){let n,a=t,r=()=>(a(),a=c(o,t=>i(2,n=t)),o);e.$$.on_destroy.push(()=>a());let{store:o}=s;r();let{cb:l}=s;return e.$set=(t=>{"store"in t&&r(i(0,o=t.store)),"cb"in t&&i(1,l=t.cb)}),[o,l,n,t=>{f(o,n=!n),l&&l(n)}]}class Wb extends Pt{constructor(t){super(),Rt(this,t,Hb,qb,o,{store:0,cb:1})}}function Qb(t,e,s){const i=t.slice();return i[52]=e[s],i[54]=s,i}function Vb(t,e,s){const i=t.slice();return i[49]=e[s],i}function Gb(t,e,s){const i=t.slice();return i[46]=e[s],i}function Yb(t,e,s){const i=t.slice();return i[55]=e[s],i}function Xb(t){let e,s;const i=new Rf({props:{title:qh.ui.settings.name,icon:"cog",$$slots:{default:[rx]},$$scope:{ctx:t}}});return i.$on("close",t[45]),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","container svelte-1xknmu9")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,e){const s={};524281&e[0]|134217728&e[1]&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function Zb(t){let e,s,i,n,a=t[55].name+"";return{c(){e=M("div"),s=E(a),T(e,"class",i="choice "+(t[55]==t[0]?"active":"")),n=P(e,"click",function(){(function(...e){return t[23](t[55],...e)}).apply(this,arguments)})},m(t,i){$(t,e,i),k(e,s)},p(s,n){t=s,1&n[0]&&i!==(i="choice "+(t[55]==t[0]?"active":""))&&T(e,"class",i)},d(t){t&&S(e),n()}}}function Jb(t){let e,s,i,n,a;const r=new Wb({props:{store:cs}});let o=qh.ui.chat.types,l=[];for(let e=0;e<o.length;e+=1)l[e]=ix(Qb(t,o,e));return{c(){(e=M("div")).textContent=`${qh.ui.settings.chatbubbles}`,Mt(r.$$.fragment),(s=M("div")).textContent=`${qh.ui.settings.combatlog}`,i=M("div");for(let t=0;t<l.length;t+=1)l[t].c();n=R(),T(s,"class","textprimary")},m(t,o){$(t,e,o),Et(r,t,o),$(t,s,o),$(t,i,o);for(let e=0;e<l.length;e+=1)l[e].m(t,o);$(t,n,o),a=!0},p(t,e){if(262144&e[0]){let s;for(o=qh.ui.chat.types,s=0;s<o.length;s+=1){const i=Qb(t,o,s);l[s]?l[s].p(i,e):(l[s]=ix(i),l[s].c(),l[s].m(n.parentNode,n))}for(;s<l.length;s+=1)l[s].d(1);l.length=o.length}},i(t){a||(vt(r.$$.fragment,t),a=!0)},o(t){yt(r.$$.fragment,t),a=!1},d(t){t&&S(e),_t(r,t),t&&S(s),t&&S(i),C(l,t),t&&S(n)}}}function Kb(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,R,I,q,j,F,B,L,N,U,O,Q,W,V,H,Y,G,X,Z,J,K,tt,et,st,it,nt,at,rt,lt,ct,ht,dt,ut,mt,pt,ft,gt,bt,kt,xt,$t,wt,St,Ct,Tt,At,Rt,Pt,It,Dt,qt,jt,Ft,zt,Bt,Lt,Nt,Ut,Ot=qh.ui.settings.language+"",Qt=!1,Wt=!1,Vt=qh.ui.settings.invwidth+"",Ht=qh.ui.settings.stashwidth+"",Yt=qh.ui.settings.stashheight+"",Gt=t[20],Xt=[];for(let e=0;e<Gt.length;e+=1)Xt[e]=nx(Vb(t,Gt,e));const Zt=new Wb({props:{store:gs}}),Jt=new Wb({props:{store:ns}}),Kt=new Wb({props:{store:as}}),te=new Wb({props:{store:fs}}),ee=new Wb({props:{store:ds}}),se=new Wb({props:{store:hs}}),ie=new Wb({props:{store:us}}),ne=new Wb({props:{store:ys}}),ae=new Wb({props:{store:bs}}),re=new Wb({props:{store:ks}});function oe(){Qt=!0,t[39].call(rt)}function le(){Wt=!0,t[40].call(ct)}const ce=new Wb({props:{store:rs}}),he=new Wb({props:{store:os}});return{c(){e=M("div"),s=E(Ot),i=_(),n=M("br"),(r=M("small")).textContent="Requires reload",o=M("select");for(let t=0;t<Xt.length;t+=1)Xt[t].c();(l=M("div")).textContent=`${qh.ui.settings.tutorial}`,c=M("div"),(h=M("div")).textContent="Restart",(d=M("div")).textContent=`${qh.ui.settings.resettutorial}`,(u=M("div")).textContent="Disable",(m=M("div")).textContent=`${qh.ui.settings.disabletutorial}`,(p=M("div")).textContent="FPS / Ping",f=M("div"),(g=M("div")).textContent="Show FPS / Ping",Mt(Zt.$$.fragment),(v=M("div")).textContent="Nameplates",y=M("div"),(b=M("div")).textContent="Draw range",x=M("input"),(w=M("div")).textContent="Show Monsters",Mt(Jt.$$.fragment),(R=M("div")).textContent="Transparency",Mt(Kt.$$.fragment),(I=M("div")).textContent="Drops",q=M("div"),(j=M("div")).textContent="Show Drop Quality %",Mt(te.$$.fragment),F=M("div"),B=E("Drop Quality Minimum"),L=M("br"),N=M("small"),U=E(t[11]),O=E("%"),Q=M("input"),(W=M("div")).textContent="Damage / Healing",V=M("div"),(H=M("div")).textContent="Incoming damage",Mt(ee.$$.fragment),(Y=M("div")).textContent="Incoming healing",Mt(se.$$.fragment),(G=M("div")).textContent="Incoming mana",Mt(ie.$$.fragment),(X=M("div")).textContent="Unitframes",Z=M("div"),(J=M("div")).textContent="Show self in party",Mt(ne.$$.fragment),(K=M("div")).textContent="Party mana",Mt(ae.$$.fragment),(tt=M("div")).textContent="Party frame width",et=M("input"),(st=M("div")).textContent="Buffs",it=M("div"),(nt=M("div")).textContent="Hide foreign buffs",Mt(re.$$.fragment),(at=M("div")).textContent="Buff maximum",rt=M("input"),(lt=M("div")).textContent="Buff maximum (party)",ct=M("input"),(ht=M("div")).textContent="Map",dt=M("div"),(ut=M("div")).textContent=`${qh.ui.settings.mapshowmonsters}`,Mt(ce.$$.fragment),(mt=M("div")).textContent=`${qh.ui.settings.maplowqual}`,Mt(he.$$.fragment),(pt=M("div")).textContent=`${qh.ui.inventory.name}`,ft=M("div"),gt=M("div"),bt=E(Vt),kt=M("br"),xt=M("small"),$t=E(t[15]),wt=M("input"),(St=M("div")).textContent="Stash",Ct=M("div"),Tt=M("div"),At=E(Ht),Rt=M("br"),Pt=M("small"),It=E(t[16]),Dt=M("input"),qt=M("div"),jt=E(Yt),Ft=M("br"),zt=M("small"),Bt=E(t[17]),Lt=M("input"),T(r,"class","textgrey"),void 0===t[9]&&ot(()=>t[33].call(o)),T(l,"class","textprimary"),T(d,"class","btn blue"),T(m,"class","btn orange"),T(p,"class","textprimary"),T(v,"class","textprimary"),T(x,"type","range"),T(I,"class","textprimary"),T(N,"class","textgrey"),T(Q,"type","range"),T(Q,"min","0"),T(Q,"max","100"),T(W,"class","textprimary"),T(X,"class","textprimary"),T(et,"type","range"),T(et,"min","50"),T(et,"max","400"),T(st,"class","textprimary"),T(rt,"placeholder","14"),T(rt,"type","number"),T(rt,"min","0"),T(ct,"placeholder","8"),T(ct,"type","number"),T(ct,"min","0"),T(ht,"class","textprimary"),T(pt,"class","textprimary"),T(xt,"class","textgrey"),T(wt,"type","range"),T(wt,"min","4"),T(wt,"max","10"),T(St,"class","textprimary"),T(Pt,"class","textgrey"),T(Dt,"type","range"),T(Dt,"min","6"),T(Dt,"max","20"),T(zt,"class","textgrey"),T(Lt,"type","range"),T(Lt,"min","50"),T(Lt,"max","500"),Ut=[P(o,"change",t[33]),P(o,"change",t[21]),P(d,"click",t[34]),P(m,"click",t[35]),P(x,"change",t[36]),P(x,"input",t[36]),P(Q,"change",t[37]),P(Q,"input",t[37]),P(et,"change",t[38]),P(et,"input",t[38]),P(rt,"input",oe),P(ct,"input",le),P(wt,"change",t[41]),P(wt,"input",t[41]),P(Dt,"change",t[42]),P(Dt,"input",t[42]),P(Lt,"change",t[43]),P(Lt,"input",t[43])]},m(a,S){$(a,e,S),k(e,s),k(e,i),k(e,n),k(e,r),$(a,o,S);for(let t=0;t<Xt.length;t+=1)Xt[t].m(o,null);z(o,t[9]),$(a,l,S),$(a,c,S),$(a,h,S),$(a,d,S),$(a,u,S),$(a,m,S),$(a,p,S),$(a,f,S),$(a,g,S),Et(Zt,a,S),$(a,v,S),$(a,y,S),$(a,b,S),$(a,x,S),A(x,t[10]),$(a,w,S),Et(Jt,a,S),$(a,R,S),Et(Kt,a,S),$(a,I,S),$(a,q,S),$(a,j,S),Et(te,a,S),$(a,F,S),k(F,B),k(F,L),k(F,N),k(N,U),k(N,O),$(a,Q,S),A(Q,t[11]),$(a,W,S),$(a,V,S),$(a,H,S),Et(ee,a,S),$(a,Y,S),Et(se,a,S),$(a,G,S),Et(ie,a,S),$(a,X,S),$(a,Z,S),$(a,J,S),Et(ne,a,S),$(a,K,S),Et(ae,a,S),$(a,tt,S),$(a,et,S),A(et,t[12]),$(a,st,S),$(a,it,S),$(a,nt,S),Et(re,a,S),$(a,at,S),$(a,rt,S),A(rt,t[13]),$(a,lt,S),$(a,ct,S),A(ct,t[14]),$(a,ht,S),$(a,dt,S),$(a,ut,S),Et(ce,a,S),$(a,mt,S),Et(he,a,S),$(a,pt,S),$(a,ft,S),$(a,gt,S),k(gt,bt),k(gt,kt),k(gt,xt),k(xt,$t),$(a,wt,S),A(wt,t[15]),$(a,St,S),$(a,Ct,S),$(a,Tt,S),k(Tt,At),k(Tt,Rt),k(Tt,Pt),k(Pt,It),$(a,Dt,S),A(Dt,t[16]),$(a,qt,S),k(qt,jt),k(qt,Ft),k(qt,zt),k(zt,Bt),$(a,Lt,S),A(Lt,t[17]),Nt=!0},p(t,e){if(1048576&e[0]){let s;for(Gt=t[20],s=0;s<Gt.length;s+=1){const i=Vb(t,Gt,s);Xt[s]?Xt[s].p(i,e):(Xt[s]=nx(i),Xt[s].c(),Xt[s].m(o,null))}for(;s<Xt.length;s+=1)Xt[s].d(1);Xt.length=Gt.length}512&e[0]&&z(o,t[9]),1024&e[0]&&A(x,t[10]),(!Nt||2048&e[0])&&D(U,t[11]),2048&e[0]&&A(Q,t[11]),4096&e[0]&&A(et,t[12]),!Qt&&8192&e[0]&&A(rt,t[13]),Qt=!1,!Wt&&16384&e[0]&&A(ct,t[14]),Wt=!1,(!Nt||32768&e[0])&&D($t,t[15]),32768&e[0]&&A(wt,t[15]),(!Nt||65536&e[0])&&D(It,t[16]),65536&e[0]&&A(Dt,t[16]),(!Nt||131072&e[0])&&D(Bt,t[17]),131072&e[0]&&A(Lt,t[17])},i(t){Nt||(vt(Zt.$$.fragment,t),vt(Jt.$$.fragment,t),vt(Kt.$$.fragment,t),vt(te.$$.fragment,t),vt(ee.$$.fragment,t),vt(se.$$.fragment,t),vt(ie.$$.fragment,t),vt(ne.$$.fragment,t),vt(ae.$$.fragment,t),vt(re.$$.fragment,t),vt(ce.$$.fragment,t),vt(he.$$.fragment,t),Nt=!0)},o(t){yt(Zt.$$.fragment,t),yt(Jt.$$.fragment,t),yt(Kt.$$.fragment,t),yt(te.$$.fragment,t),yt(ee.$$.fragment,t),yt(se.$$.fragment,t),yt(ie.$$.fragment,t),yt(ne.$$.fragment,t),yt(ae.$$.fragment,t),yt(re.$$.fragment,t),yt(ce.$$.fragment,t),yt(he.$$.fragment,t),Nt=!1},d(t){t&&S(e),t&&S(o),C(Xt,t),t&&S(l),t&&S(c),t&&S(h),t&&S(d),t&&S(u),t&&S(m),t&&S(p),t&&S(f),t&&S(g),_t(Zt,t),t&&S(v),t&&S(y),t&&S(b),t&&S(x),t&&S(w),_t(Jt,t),t&&S(R),_t(Kt,t),t&&S(I),t&&S(q),t&&S(j),_t(te,t),t&&S(F),t&&S(Q),t&&S(W),t&&S(V),t&&S(H),_t(ee,t),t&&S(Y),_t(se,t),t&&S(G),_t(ie,t),t&&S(X),t&&S(Z),t&&S(J),_t(ne,t),t&&S(K),_t(ae,t),t&&S(tt),t&&S(et),t&&S(st),t&&S(it),t&&S(nt),_t(re,t),t&&S(at),t&&S(rt),t&&S(lt),t&&S(ct),t&&S(ht),t&&S(dt),t&&S(ut),_t(ce,t),t&&S(mt),_t(he,t),t&&S(pt),t&&S(ft),t&&S(gt),t&&S(wt),t&&S(St),t&&S(Ct),t&&S(Tt),t&&S(Dt),t&&S(qt),t&&S(Lt),a(Ut)}}}function tx(e){let s,i,n,r,o;return{c(){(s=M("div")).textContent=`${qh.ui.settings.sfxvolume}`,i=M("input"),(n=M("div")).textContent=`${qh.ui.settings.musicvolume}`,r=M("input"),T(i,"type","range"),T(r,"type","range"),o=[P(i,"change",e[31]),P(i,"input",e[31]),P(r,"change",e[32]),P(r,"input",e[32])]},m(t,a){$(t,s,a),$(t,i,a),A(i,e[7]),$(t,n,a),$(t,r,a),A(r,e[8])},p(t,e){128&e[0]&&A(i,t[7]),256&e[0]&&A(r,t[8])},i:t,o:t,d(t){t&&S(s),t&&S(i),t&&S(n),t&&S(r),a(o)}}}function ex(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,I,q,j,F,z,B,L,N,U=qh.ui.settings.mousesensitivity+"",O=t[5].toFixed(2)+"";const Q=new Wb({props:{store:Ss}}),W=new Wb({props:{store:Cs}}),V=new Wb({props:{store:Ms}}),H=new Wb({props:{store:Es}});let Y=Object.keys(vi).filter(lx).map(t[28]),G=[];for(let e=0;e<Y.length;e+=1)G[e]=ax(Gb(t,Y,e));return{c(){(e=M("div")).textContent=`${qh.ui.settings.camera}`,s=M("div"),i=M("div"),n=E(U),r=_(),o=M("span"),l=E(O),c=M("input"),(h=M("div")).textContent=`${qh.ui.settings.invertmousex}`,Mt(Q.$$.fragment),(d=M("div")).textContent=`${qh.ui.settings.invertmousey}`,Mt(W.$$.fragment),(u=M("div")).textContent=`${qh.ui.settings.lockedcamera}`,Mt(V.$$.fragment),(m=M("div")).textContent=`${qh.ui.settings.pointerlock}`,Mt(H.$$.fragment),(p=M("div")).textContent="Skillbar",f=M("div"),g=M("div"),v=E("Skillbar slots "),y=M("span"),b=E(t[6]),x=M("br"),(w=M("small")).textContent="Requires reload",I=M("input"),(q=M("div")).textContent=`${qh.ui.settings.keybindings}`,j=M("div"),(F=M("small")).textContent="Requires reload",(z=M("small")).textContent="To reset, leave field blank.";for(let t=0;t<G.length;t+=1)G[t].c();B=R(),T(e,"class","textprimary"),T(o,"class","textgrey"),T(c,"type","range"),T(c,"step","0.05"),T(c,"min","0.1"),T(c,"max","3"),T(p,"class","textprimary"),T(y,"class","textgrey"),T(w,"class","textgrey"),T(I,"type","range"),T(I,"min","10"),T(I,"max","24"),T(q,"class","textprimary"),T(F,"class","textgrey"),T(z,"class","textprimary"),N=[P(c,"change",t[26]),P(c,"input",t[26]),P(I,"change",t[27]),P(I,"input",t[27]),P(I,"change",t[21])]},m(a,S){$(a,e,S),$(a,s,S),$(a,i,S),k(i,n),k(i,r),k(i,o),k(o,l),$(a,c,S),A(c,t[5]),$(a,h,S),Et(Q,a,S),$(a,d,S),Et(W,a,S),$(a,u,S),Et(V,a,S),$(a,m,S),Et(H,a,S),$(a,p,S),$(a,f,S),$(a,g,S),k(g,v),k(g,y),k(y,b),k(g,x),k(g,w),$(a,I,S),A(I,t[6]),$(a,q,S),$(a,j,S),$(a,F,S),$(a,z,S);for(let t=0;t<G.length;t+=1)G[t].m(a,S);$(a,B,S),L=!0},p(t,e){if((!L||32&e[0])&&O!==(O=t[5].toFixed(2)+"")&&D(l,O),32&e[0]&&A(c,t[5]),(!L||64&e[0])&&D(b,t[6]),64&e[0]&&A(I,t[6]),4194304&e[0]){let s;for(Y=Object.keys(vi).filter(lx).map(t[28]),s=0;s<Y.length;s+=1){const i=Gb(t,Y,s);G[s]?G[s].p(i,e):(G[s]=ax(i),G[s].c(),G[s].m(B.parentNode,B))}for(;s<G.length;s+=1)G[s].d(1);G.length=Y.length}},i(t){L||(vt(Q.$$.fragment,t),vt(W.$$.fragment,t),vt(V.$$.fragment,t),vt(H.$$.fragment,t),L=!0)},o(t){yt(Q.$$.fragment,t),yt(W.$$.fragment,t),yt(V.$$.fragment,t),yt(H.$$.fragment,t),L=!1},d(t){t&&S(e),t&&S(s),t&&S(i),t&&S(c),t&&S(h),_t(Q,t),t&&S(d),_t(W,t),t&&S(u),_t(V,t),t&&S(m),_t(H,t),t&&S(p),t&&S(f),t&&S(g),t&&S(I),t&&S(q),t&&S(j),t&&S(F),t&&S(z),C(G,t),t&&S(B),a(N)}}}function sx(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,C,_,R,I,D,q,j,F,z=qh.ui.settings.ssao+"",B=qh.ui.settings.grass+"",L=qh.ui.settings.shadows+"",N=qh.ui.settings.clouds+"",U=qh.ui.settings.detailprops+"";const O=new Wb({props:{store:Pe}}),Q=new Wb({props:{cb:t[21],store:De}}),W=new Wb({props:{cb:t[21],store:Te}}),V=new Wb({props:{cb:t[21],store:Ie}}),H=new Wb({props:{cb:t[21],store:Ae}}),Y=new Wb({props:{cb:t[21],store:ze}}),G=new Wb({props:{store:Fe}});return{c(){(e=M("div")).textContent=`${qh.ui.settings.resolution}`,s=M("input"),(i=M("div")).textContent=`${qh.ui.settings.viewrange}`,n=M("input"),(r=M("div")).textContent=`${qh.ui.settings.postprocessing}`,Mt(O.$$.fragment),o=M("div"),l=E(z),c=M("br"),(h=M("small")).textContent="Requires reload",Mt(Q.$$.fragment),d=M("div"),u=E(B),m=M("br"),(p=M("small")).textContent="Requires reload",Mt(W.$$.fragment),f=M("div"),g=E(L),v=M("br"),(y=M("small")).textContent="Requires reload",Mt(V.$$.fragment),b=M("div"),x=E(N),w=M("br"),(C=M("small")).textContent="Requires reload",Mt(H.$$.fragment),_=M("div"),R=E(U),I=M("br"),(D=M("small")).textContent="Requires reload",Mt(Y.$$.fragment),(q=M("div")).textContent=`${qh.ui.settings.particles}`,Mt(G.$$.fragment),T(s,"type","range"),T(s,"min","30"),T(s,"step","10"),T(n,"type","range"),T(n,"min","20"),T(h,"class","textgrey"),T(p,"class","textgrey"),T(y,"class","textgrey"),T(C,"class","textgrey"),T(D,"class","textgrey"),F=[P(s,"change",t[24]),P(s,"input",t[24]),P(n,"change",t[25]),P(n,"input",t[25])]},m(a,S){$(a,e,S),$(a,s,S),A(s,t[3]),$(a,i,S),$(a,n,S),A(n,t[4]),$(a,r,S),Et(O,a,S),$(a,o,S),k(o,l),k(o,c),k(o,h),Et(Q,a,S),$(a,d,S),k(d,u),k(d,m),k(d,p),Et(W,a,S),$(a,f,S),k(f,g),k(f,v),k(f,y),Et(V,a,S),$(a,b,S),k(b,x),k(b,w),k(b,C),Et(H,a,S),$(a,_,S),k(_,R),k(_,I),k(_,D),Et(Y,a,S),$(a,q,S),Et(G,a,S),j=!0},p(t,e){8&e[0]&&A(s,t[3]),16&e[0]&&A(n,t[4])},i(t){j||(vt(O.$$.fragment,t),vt(Q.$$.fragment,t),vt(W.$$.fragment,t),vt(V.$$.fragment,t),vt(H.$$.fragment,t),vt(Y.$$.fragment,t),vt(G.$$.fragment,t),j=!0)},o(t){yt(O.$$.fragment,t),yt(Q.$$.fragment,t),yt(W.$$.fragment,t),yt(V.$$.fragment,t),yt(H.$$.fragment,t),yt(Y.$$.fragment,t),yt(G.$$.fragment,t),j=!1},d(t){t&&S(e),t&&S(s),t&&S(i),t&&S(n),t&&S(r),_t(O,t),t&&S(o),_t(Q,t),t&&S(d),_t(W,t),t&&S(f),_t(V,t),t&&S(b),_t(H,t),t&&S(_),_t(Y,t),t&&S(q),_t(G,t),a(F)}}}function ix(t){let e,s,i,n,a,r=t[52]+"";return{c(){e=M("div"),s=E(r),T(i=M("div"),"class",n="btn checkbox "+(t[18][t[54]]?"active":"")),a=P(i,"click",function(){(function(...e){return t[44](t[54],...e)}).apply(this,arguments)})},m(t,n){$(t,e,n),k(e,s),$(t,i,n)},p(e,s){t=e,262144&s[0]&&n!==(n="btn checkbox "+(t[18][t[54]]?"active":""))&&T(i,"class",n)},d(t){t&&S(e),t&&S(i),a()}}}function nx(e){let s,i,n,a=e[49].name+"";return{c(){s=M("option"),i=E(a),s.__value=n=e[49].val,s.value=s.__value},m(t,e){$(t,s,e),k(s,i)},p:t,d(t){t&&S(s)}}}function ax(t){let e,s,i,n,r=t[46].k.slice(2)+"";function o(){t[29].call(i,t[46])}function l(...e){return t[30](t[46],...e)}return{c(){e=M("div"),s=E(r),T(i=M("input"),"type","text"),n=[P(i,"input",o),P(i,"change",l)]},m(n,a){$(n,e,a),k(e,s),$(n,i,a),A(i,gi[t[46].k])},p(e,n){t=e,0&n&&r!==(r=t[46].k.slice(2)+"")&&D(s,r),0&n&&i.value!==gi[t[46].k]&&A(i,gi[t[46].k])},d(t){t&&S(e),t&&S(i),a(n)}}}function rx(t){let e,s,i,n,a,r,o,l,c,h=t[0].name+"",d=t[19],u=[];for(let e=0;e<d.length;e+=1)u[e]=Zb(Yb(t,d,e));const m=[sx,ex,tx,Kb,Jb],p=[];function f(t,e){return"gfx"==t[0].id?0:"controls"==t[0].id?1:"audio"==t[0].id?2:"ui"==t[0].id?3:"chat"==t[0].id?4:-1}return~(o=f(t))&&(l=p[o]=m[o](t)),{c(){e=M("div"),s=M("div");for(let t=0;t<u.length;t+=1)u[t].c();i=M("div"),n=M("h3"),a=E(h),r=M("div"),l&&l.c(),T(n,"class","textprimary"),T(r,"class","settings svelte-1xknmu9"),T(i,"class","menu panel-black svelte-1xknmu9"),T(e,"class","divide svelte-1xknmu9")},m(t,l){$(t,e,l),k(e,s);for(let t=0;t<u.length;t+=1)u[t].m(s,null);k(e,i),k(i,n),k(n,a),k(i,r),~o&&p[o].m(r,null),c=!0},p(t,e){if(524289&e[0]){let i;for(d=t[19],i=0;i<d.length;i+=1){const n=Yb(t,d,i);u[i]?u[i].p(n,e):(u[i]=Zb(n),u[i].c(),u[i].m(s,null))}for(;i<u.length;i+=1)u[i].d(1);u.length=d.length}(!c||1&e[0])&&h!==(h=t[0].name+"")&&D(a,h);let i=o;(o=f(t))===i?~o&&p[o].p(t,e):(l&&(ft(),yt(p[i],1,1,()=>{p[i]=null}),gt()),~o?((l=p[o])||(l=p[o]=m[o](t)).c(),vt(l,1),l.m(r,null)):l=null)},i(t){c||(vt(l),c=!0)},o(t){yt(l),c=!1},d(t){t&&S(e),C(u,t),~o&&p[o].d()}}}function ox(t){let e,s,i=t[2]&&Xb(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,s){t[2]?i?(i.p(t,s),vt(i,1)):((i=Xb(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}const lx=t=>"kb"==t.slice(0,2);function cx(t,e,s){let i,n,a,r,o,l,c,d,u,m,p,g,v,y,b,k,x;h(t,We,t=>s(2,i=t)),h(t,Re,t=>s(3,n=t)),h(t,_e,t=>s(4,a=t)),h(t,$s,t=>s(5,r=t)),h(t,qs,t=>s(6,o=t)),h(t,Be,t=>s(7,l=t)),h(t,Ue,t=>s(8,c=t)),h(t,Oe,t=>s(9,d=t)),h(t,is,t=>s(10,u=t)),h(t,ps,t=>s(11,m=t)),h(t,vs,t=>s(12,p=t)),h(t,xs,t=>s(13,g=t)),h(t,ws,t=>s(14,v=t)),h(t,qe,t=>s(15,y=t)),h(t,Le,t=>s(16,b=t)),h(t,Ne,t=>s(17,k=t)),h(t,ts,t=>s(18,x=t));const $=[{id:"ui",name:qh.ui.settings.interface},{id:"gfx",name:qh.ui.settings.graphics},{id:"controls",name:qh.ui.settings.controls},{id:"chat",name:qh.ui.settings.chat},{id:"audio",name:qh.ui.settings.audio}];let w=$[0];const S=[{val:"en",name:"English"},{val:"de",name:"German"},{val:"nl",name:"Dutch"},{val:"ru",name:"Russian"},{val:"pt",name:"Portugese"},{val:"es",name:"Spanish"},{val:"fr",name:"French"},{val:"hu",name:"Hungarian"},{val:"ro",name:"Romanian"}];let M=!1;const E=(t,e)=>{e.set(""===t?void 0:t),s(1,M=!0)};return[w,M,i,n,a,r,o,l,c,d,u,m,p,g,v,y,b,k,x,$,S,()=>{s(1,M=!0)},E,(t,e)=>{s(0,w=t)},function(){n=I(this.value),Re.set(n)},function(){a=I(this.value),_e.set(a)},function(){r=I(this.value),$s.set(r)},function(){o=I(this.value),qs.set(o)},t=>({k:t,s:vi[t]}),function(t){gi[t.k]=this.value},(t,e)=>{E(gi[t.k],t.s)},function(){l=I(this.value),Be.set(l)},function(){c=I(this.value),Ue.set(c)},function(){d=B(this),Oe.set(d),s(20,S)},t=>ls.set(0),t=>ls.set(nf.length),function(){u=I(this.value),is.set(u)},function(){m=I(this.value),ps.set(m)},function(){p=I(this.value),vs.set(p)},function(){g=I(this.value),xs.set(g)},function(){v=I(this.value),ws.set(v)},function(){y=I(this.value),qe.set(y)},function(){b=I(this.value),Le.set(b)},function(){k=I(this.value),Ne.set(k)},(t,e)=>f(ts,x[t]=x[t]?0:1,x),()=>{f(We,i=!1),M&&window.location.reload()}]}class hx extends Pt{constructor(t){super(),Rt(this,t,cx,ox,o,{},[-1,-1])}}function dx(t,e,s){const i=t.slice();return i[11]=e[s],i}function ux(t,e,s){const i=t.slice();return i[11]=e[s],i}function mx(t){let e,s;const i=new Rf({props:{title:"Skills",icon:"book",$$slots:{default:[yx]},$$scope:{ctx:t}}});return i.$on("close",t[9]),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","l-upperLeftModal container svelte-7b6b0t")},m(n,a){$(n,e,a),Et(i,e,null),t[10](e),s=!0},p(t,e){const s={};65563&e&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(s){s&&S(e),_t(i),t[10](null)}}}function px(t){let e;const s=new Bv({props:{level:t[11].level,skill:t[11].logic}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};16&e&&(i.level=t[11].level),16&e&&(i.skill=t[11].logic),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function fx(t){let e,s,i,n,a,r,o,l,c,h,d,u,m=qh.items.book[t[11].logic.id].name+"",p=t[11].logic.engineOnly?"Default":"Lv. "+t[11].level,f=void 0!==t[11].logic.onCast?"Spell":"Passive";const g=new Hg({props:{descPos:"left:100%;top:0;",descRoot:t[0],border:"white",data:{},pickable:void 0!==t[11].logic.onCast,meta:{type:"skill",skill:t[11].logic},css:"slotskill",img:`/assets/ui/skills/${t[11].logic.id}.${kr}?v=3406973`,$$slots:{default:[px]},$$scope:{ctx:t}}});return{c(){e=M("div"),Mt(g.$$.fragment),s=M("div"),i=M("div"),n=E(m),a=M("span"),r=M("div"),o=E(p),l=_(),c=E(f),T(a,"class","textgrey"),T(i,"class","textprimary name svelte-7b6b0t"),T(r,"class","textgrey"),T(e,"class",h=(t[11].logic.engineOnly?"panel-black":"btn")+" grid "+(t[1]==t[11]?"grey":"black")+" svelte-7b6b0t"),u=P(e,"click",function(){(function(...e){return t[7](t[11],...e)}).apply(this,arguments)})},m(t,h){$(t,e,h),Et(g,e,null),k(e,s),k(s,i),k(i,n),k(i,a),k(s,r),k(r,o),k(r,l),k(r,c),d=!0},p(s,i){t=s;const a={};1&i&&(a.descRoot=t[0]),16&i&&(a.pickable=void 0!==t[11].logic.onCast),16&i&&(a.meta={type:"skill",skill:t[11].logic}),16&i&&(a.img=`/assets/ui/skills/${t[11].logic.id}.${kr}?v=3406973`),65552&i&&(a.$$scope={dirty:i,ctx:t}),g.$set(a),(!d||16&i)&&m!==(m=qh.items.book[t[11].logic.id].name+"")&&D(n,m),(!d||16&i)&&p!==(p=t[11].logic.engineOnly?"Default":"Lv. "+t[11].level)&&D(o,p),(!d||16&i)&&f!==(f=void 0!==t[11].logic.onCast?"Spell":"Passive")&&D(c,f),(!d||18&i&&h!==(h=(t[11].logic.engineOnly?"panel-black":"btn")+" grid "+(t[1]==t[11]?"grey":"black")+" svelte-7b6b0t"))&&T(e,"class",h)},i(t){d||(vt(g.$$.fragment,t),d=!0)},o(t){yt(g.$$.fragment,t),d=!1},d(t){t&&S(e),_t(g),u()}}}function gx(t){let e;const s=new Bv({props:{level:1,skill:t[11]}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};16&e&&(i.skill=t[11]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function vx(t){let e,s,i,n,a,r,o,l,c=qh.items.book[t[11].id].name+"",h=t[11].minlevel+"";const d=new Hg({props:{descPos:"left:100%;top:0;",descRoot:t[0],border:"grey filtered",data:{},pickable:!1,meta:{type:"skill",skill:t[11]},css:"slotskill",img:`/assets/ui/skills/${t[11].id}.${kr}?v=3406973`,$$slots:{default:[gx]},$$scope:{ctx:t}}});return{c(){e=M("div"),Mt(d.$$.fragment),s=M("div"),i=M("div"),n=E(c),a=M("div"),r=E("Requires Lv. "),o=E(h),T(i,"class","name svelte-7b6b0t"),T(s,"class","textgrey"),T(e,"class","panel-black grid svelte-7b6b0t")},m(t,c){$(t,e,c),Et(d,e,null),k(e,s),k(s,i),k(i,n),k(s,a),k(a,r),k(a,o),l=!0},p(t,e){const s={};1&e&&(s.descRoot=t[0]),16&e&&(s.meta={type:"skill",skill:t[11]}),16&e&&(s.img=`/assets/ui/skills/${t[11].id}.${kr}?v=3406973`),65552&e&&(s.$$scope={dirty:e,ctx:t}),d.$set(s),(!l||16&e)&&c!==(c=qh.items.book[t[11].id].name+"")&&D(n,c),(!l||16&e)&&h!==(h=t[11].minlevel+"")&&D(o,h)},i(t){l||(vt(d.$$.fragment,t),l=!0)},o(t){yt(d.$$.fragment,t),l=!1},d(t){t&&S(e),_t(d)}}}function yx(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,p=t[3][22]+"",f=t[4],g=[];for(let e=0;e<f.length;e+=1)g[e]=fx(ux(t,f,e));const v=t=>yt(g[t],1,1,()=>{g[t]=null});let y=Array.from(zp.values()).filter(t[8]).sort(xx),b=[];for(let e=0;e<y.length;e+=1)b[e]=vx(dx(t,y,e));const x=t=>yt(b[t],1,1,()=>{b[t]=null});return{c(){e=M("div"),s=M("div"),i=M("span"),n=E("Skill points: "),a=E(p),r=M("div"),o=E("Unlearn"),c=_(),h=M("div");for(let t=0;t<g.length;t+=1)g[t].c();(d=M("div")).textContent="Learnable through books:";for(let t=0;t<b.length;t+=1)b[t].c();T(r,"class",l="btn primary unlearn "+(void 0===t[1]||t[1].logic.engineOnly?"disabled":"")),T(s,"class","panel-black textprimary bar svelte-7b6b0t"),T(d,"class","learndiv textgrey textcenter svelte-7b6b0t"),T(h,"id","skilllist"),T(h,"class","scroll svelte-7b6b0t"),T(e,"class","flexer svelte-7b6b0t"),m=P(r,"click",function(){t[6].apply(this,arguments)})},m(t,l){$(t,e,l),k(e,s),k(s,i),k(i,n),k(i,a),k(s,r),k(r,o),k(e,c),k(e,h);for(let t=0;t<g.length;t+=1)g[t].m(h,null);k(h,d);for(let t=0;t<b.length;t+=1)b[t].m(h,null);u=!0},p(e,s){if(t=e,(!u||8&s)&&p!==(p=t[3][22]+"")&&D(a,p),(!u||2&s&&l!==(l="btn primary unlearn "+(void 0===t[1]||t[1].logic.engineOnly?"disabled":"")))&&T(r,"class",l),19&s){let e;for(f=t[4],e=0;e<f.length;e+=1){const i=ux(t,f,e);g[e]?(g[e].p(i,s),vt(g[e],1)):(g[e]=fx(i),g[e].c(),vt(g[e],1),g[e].m(h,d))}for(ft(),e=f.length;e<g.length;e+=1)v(e);gt()}if(17&s){let e;for(y=Array.from(zp.values()).filter(t[8]).sort(xx),e=0;e<y.length;e+=1){const i=dx(t,y,e);b[e]?(b[e].p(i,s),vt(b[e],1)):(b[e]=vx(i),b[e].c(),vt(b[e],1),b[e].m(h,null))}for(ft(),e=y.length;e<b.length;e+=1)x(e);gt()}},i(t){if(!u){for(let t=0;t<f.length;t+=1)vt(g[t]);for(let t=0;t<y.length;t+=1)vt(b[t]);u=!0}},o(t){g=g.filter(Boolean);for(let t=0;t<g.length;t+=1)yt(g[t]);b=b.filter(Boolean);for(let t=0;t<b.length;t+=1)yt(b[t]);u=!1},d(t){t&&S(e),C(g,t),C(b,t),m()}}}function bx(t){let e,s,i=t[2]&&mx(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[2]?i?(i.p(t,s),vt(i,1)):((i=mx(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}const xx=(t,e)=>t.minlevel-e.minlevel;function wx(t,e,s){let i,n,a,r,o;h(t,Qe,t=>s(2,i=t)),h(t,xe,t=>s(3,n=t)),h(t,ee,t=>s(4,a=t));const l=t=>{hma.chat.commands.pack("skillremove",`${t.logic.id}`),s(1,o=void 0)};return[r,o,i,n,a,l,t=>l(o),(t,e)=>t.logic.engineOnly||s(1,o=t),t=>t.class===qn.player.class&&!t.engineOnly&&!a.some(e=>e.logic.id===t.id),()=>{f(Qe,i=!1)},function(t){tt[t?"unshift":"push"](()=>{s(0,r=t)})}]}class kx extends Pt{constructor(t){super(),Rt(this,t,wx,bx,o,{})}}const $x=t=>9+Math.ceil(.015*t);function Sx(t,e,s){const i=t.slice();return i[47]=e[s],i}function Cx(t,e,s){const i=t.slice();return i[50]=e[s],i}function Mx(t){let e,s;const i=new Rf({props:{title:"Merchant",$$slots:{default:[Ax]},$$scope:{ctx:t}}});return i.$on("close",t[46]),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","l-upperLeftModal container svelte-1gzciq8")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,e){const s={};114687&e[0]|4194304&e[1]&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function Ex(t){let e,s,i,n,a=t[50]+"";return{c(){e=M("div"),s=E(a),T(e,"class",i="choice "+(t[50]==t[1]?"active":"")+" svelte-1gzciq8"),n=P(e,"click",function(){(function(...e){return t[40](t[50],...e)}).apply(this,arguments)})},m(t,i){$(t,e,i),k(e,s)},p(s,n){t=s,2&n[0]&&i!==(i="choice "+(t[50]==t[1]?"active":"")+" svelte-1gzciq8")&&T(e,"class",i)},d(t){t&&S(e),n()}}}function _x(t){let e;const s=new Gh({});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Rx(t){let e,s,i,n,a,r,o,l,c,h,d,u,m=Wh(t[47].temp.type,t[47].temp.tier)+"",p=t[47].temp.owner+"",f=t[22](t[47].temp.auction.getTime())+"";const g=new Xy({props:{descPos:"right:0;top:0;",descRoot:t[0],pickable:!1,item:t[47]}}),v=new jv({props:{amount:t[47].temp.auctionprice}});return{c(){e=M("div"),Mt(g.$$.fragment),s=M("span"),i=E(m),a=M("span"),r=E(p),o=M("span"),l=E(f),c=M("div"),Mt(v.$$.fragment),T(s,"class",n="marg text"+lu(t[47].temp.quality)[0]+" svelte-1gzciq8"),T(a,"class","marg svelte-1gzciq8"),T(o,"class","marg svelte-1gzciq8"),T(c,"class","marg svelte-1gzciq8"),F(c,"text-align","end"),T(e,"class",h="buy "+(t[12]==t[47]?"selected":"")+" item panel-black svelte-1gzciq8"),u=P(e,"click",function(){(function(...e){return t[44](t[47],...e)}).apply(this,arguments)})},m(t,n){$(t,e,n),Et(g,e,null),k(e,s),k(s,i),k(e,a),k(a,r),k(e,o),k(o,l),k(e,c),Et(v,c,null),d=!0},p(a,o){t=a;const c={};1&o[0]&&(c.descRoot=t[0]),2048&o[0]&&(c.item=t[47]),g.$set(c),(!d||2048&o[0])&&m!==(m=Wh(t[47].temp.type,t[47].temp.tier)+"")&&D(i,m),(!d||2048&o[0]&&n!==(n="marg text"+lu(t[47].temp.quality)[0]+" svelte-1gzciq8"))&&T(s,"class",n),(!d||2048&o[0])&&p!==(p=t[47].temp.owner+"")&&D(r,p),(!d||2048&o[0])&&f!==(f=t[22](t[47].temp.auction.getTime())+"")&&D(l,f);const u={};2048&o[0]&&(u.amount=t[47].temp.auctionprice),v.$set(u),(!d||6144&o[0]&&h!==(h="buy "+(t[12]==t[47]?"selected":"")+" item panel-black svelte-1gzciq8"))&&T(e,"class",h)},i(t){d||(vt(g.$$.fragment,t),vt(v.$$.fragment,t),d=!0)},o(t){yt(g.$$.fragment,t),yt(v.$$.fragment,t),d=!1},d(t){t&&S(e),_t(g),_t(v),u()}}}function Px(t){let e,s,i,n;const a=[Dx,Ix],r=[];function o(t,e){return t[12].temp.owner!==qn.player.name?0:1}return s=o(t),i=r[s]=a[s](t),{c(){e=M("section"),i.c(),T(e,"class","confirm panel-black svelte-1gzciq8")},m(t,i){$(t,e,i),r[s].m(e,null),n=!0},p(t,n){let l=s;(s=o(t))===l?r[s].p(t,n):(ft(),yt(r[l],1,1,()=>{r[l]=null}),gt(),(i=r[s])||(i=r[s]=a[s](t)).c(),vt(i,1),i.m(e,null))},i(t){n||(vt(i),n=!0)},o(t){yt(i),n=!1},d(t){t&&S(e),r[s].d()}}}function Tx(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y=(t[13]?Wh(t[13].type,t[13].tier):qh.ui.merchant.dragitem)+"",b=qh.ui.merchant.price+"",x=qh.ui.merchant.fee+"",w=!1,C=qh.ui.merchant.post+"";const _=new Xy({props:{descPos:"left:100%;bottom:100%;",clearOnMove:!0,invslot:t[13]?t[10]:void 0,pickable:!0,item:de}});_.$on("discard",t[21]),_.$on("move",t[20]);const R=new jv({props:{amount:t[9]}}),I=new jv({props:{amount:t[15]}});function q(){w=!0,t[45].call(u)}return{c(){e=M("section"),Mt(_.$$.fragment),s=M("span"),i=E(y),r=M("div"),o=M("span"),l=E(b),Mt(R.$$.fragment),c=M("br"),h=M("span"),d=E(x),Mt(I.$$.fragment),u=M("input"),m=M("div"),p=E(C),T(s,"class",n="marg text"+(t[13]?lu(t[13].quality)[0]:"grey")+" svelte-1gzciq8"),T(o,"class","textwhite"),T(h,"class","textgrey"),T(r,"class","marg svelte-1gzciq8"),F(r,"text-align","end"),T(u,"class","marg svelte-1gzciq8"),T(u,"type","number"),T(u,"placeholder","Set price"),T(m,"class",f="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-1gzciq8"),T(e,"class","post panel-black svelte-1gzciq8"),v=[P(u,"input",q),P(m,"click",t[19])]},m(n,a){$(n,e,a),Et(_,e,null),k(e,s),k(s,i),k(e,r),k(r,o),k(o,l),Et(R,o,null),k(r,c),k(r,h),k(h,d),Et(I,h,null),k(e,u),A(u,t[9]),k(e,m),k(m,p),g=!0},p(t,e){const a={};9216&e[0]&&(a.invslot=t[13]?t[10]:void 0),_.$set(a),(!g||8192&e[0])&&y!==(y=(t[13]?Wh(t[13].type,t[13].tier):qh.ui.merchant.dragitem)+"")&&D(i,y),(!g||8192&e[0]&&n!==(n="marg text"+(t[13]?lu(t[13].quality)[0]:"grey")+" svelte-1gzciq8"))&&T(s,"class",n);const r={};512&e[0]&&(r.amount=t[9]),R.$set(r);const o={};32768&e[0]&&(o.amount=t[15]),I.$set(o),!w&&512&e[0]&&A(u,t[9]),w=!1,(!g||65536&e[0]&&f!==(f="marg btn formatted secondary "+(t[16]?"":"disabled")+" svelte-1gzciq8"))&&T(m,"class",f)},i(t){g||(vt(_.$$.fragment,t),vt(R.$$.fragment,t),vt(I.$$.fragment,t),g=!0)},o(t){yt(_.$$.fragment,t),yt(R.$$.fragment,t),yt(I.$$.fragment,t),g=!1},d(t){t&&S(e),_t(_),_t(R),_t(I),a(v)}}}function Ix(e){let s,i,n,r,o,l,c,h,d,u=qh.items[e[12].temp.type]["book"===e[12].temp.type?e[12].temp.logic.skillid:e[12].temp.tier].name+"";return{c(){s=M("span"),i=E("Stop "),n=M("span"),r=E(u),l=E(" from being listed?"),(c=M("div")).textContent=`${qh.ui.cancel}`,(h=M("div")).textContent=`${qh.ui.merchant.delist}`,T(n,"class",o="text"+lu(e[12].temp.quality)[0]+" svelte-1gzciq8"),T(s,"class","marg svelte-1gzciq8"),T(c,"class","marg btn formatted grey svelte-1gzciq8"),T(h,"class","marg btn formatted orange svelte-1gzciq8"),d=[P(c,"click",e[24]),P(h,"click",e[26])]},m(t,e){$(t,s,e),k(s,i),k(s,n),k(n,r),k(s,l),$(t,c,e),$(t,h,e)},p(t,e){4096&e[0]&&u!==(u=qh.items[t[12].temp.type]["book"===t[12].temp.type?t[12].temp.logic.skillid:t[12].temp.tier].name+"")&&D(r,u),4096&e[0]&&o!==(o="text"+lu(t[12].temp.quality)[0]+" svelte-1gzciq8")&&T(n,"class",o)},i:t,o:t,d(t){t&&S(s),t&&S(c),t&&S(h),a(d)}}}function Dx(t){let e,s,i,n,r,o,l,c,h,d,u,m=qh.items[t[12].temp.type]["book"===t[12].temp.type?t[12].temp.logic.skillid:t[12].temp.tier].name+"";const p=new jv({props:{amount:t[12].temp.auctionprice}});return{c(){e=M("span"),s=E("Buy "),i=M("span"),n=E(m),o=E("\n          for "),Mt(p.$$.fragment),l=E("?"),(c=M("div")).textContent=`${qh.ui.cancel}`,(h=M("div")).textContent=`${qh.ui.merchant.buy}`,T(i,"class",r="text"+lu(t[12].temp.quality)[0]+" svelte-1gzciq8"),T(e,"class","marg svelte-1gzciq8"),T(c,"class","marg btn formatted grey svelte-1gzciq8"),T(h,"class","marg btn formatted secondary svelte-1gzciq8"),u=[P(c,"click",t[24]),P(h,"click",t[25])]},m(t,a){$(t,e,a),k(e,s),k(e,i),k(i,n),k(e,o),Et(p,e,null),k(e,l),$(t,c,a),$(t,h,a),d=!0},p(t,e){(!d||4096&e[0])&&m!==(m=qh.items[t[12].temp.type]["book"===t[12].temp.type?t[12].temp.logic.skillid:t[12].temp.tier].name+"")&&D(n,m),(!d||4096&e[0]&&r!==(r="text"+lu(t[12].temp.quality)[0]+" svelte-1gzciq8"))&&T(i,"class",r);const s={};4096&e[0]&&(s.amount=t[12].temp.auctionprice),p.$set(s)},i(t){d||(vt(p.$$.fragment,t),d=!0)},o(t){yt(p.$$.fragment,t),d=!1},d(t){t&&S(e),_t(p),t&&S(c),t&&S(h),a(u)}}}function Ax(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,R,I,q,j,z,B,L,N,U,O,Q,W,V,H,Y=!1,G=!1,X=qh.ui.merchant.filtermine+"",Z=qh.ui.merchant.search+"",J=t[27](t[7],"tier",t[8])+"",K=t[27](t[7],"auction",t[8])+"",tt=t[27](t[7],"auctionprice",t[8])+"";function et(){Y=!0,t[36].call(r)}function st(){G=!0,t[37].call(l)}let it=t[17],nt=[];for(let e=0;e<it.length;e+=1)nt[e]=Ex(Cx(t,it,e));let at=!t[6]&&_x(),rt=t[11],ot=[];for(let e=0;e<rt.length;e+=1)ot[e]=Rx(Sx(t,rt,e));const lt=t=>yt(ot[t],1,1,()=>{ot[t]=null}),ct=[Tx,Px],ht=[];function dt(t,e){return t[12]?1:0}return Q=dt(t),W=ht[Q]=ct[Q](t),{c(){e=M("div"),s=M("section"),i=M("input"),(n=M("span")).textContent="Lv.",r=M("input"),(o=M("span")).textContent="–",l=M("input"),c=M("span"),h=M("div"),d=M("div"),m=_(),p=E(X),f=M("div"),g=E(Z),y=M("section");for(let t=0;t<nt.length;t+=1)nt[t].c();b=M("section"),x=M("div"),w=M("span"),at&&at.c(),R=M("span"),I=E(J),q=E("Item"),(j=M("span")).textContent="Owner",z=M("span"),B=E(K),L=E("Time left"),N=M("span"),U=E(tt),O=E("Price");for(let t=0;t<ot.length;t+=1)ot[t].c();W.c(),T(i,"class","marg svelte-1gzciq8"),T(i,"type","search"),T(i,"placeholder","Name"),T(n,"class","marg svelte-1gzciq8"),T(r,"class","marg svelte-1gzciq8"),T(r,"type","number"),T(o,"class","marg svelte-1gzciq8"),T(l,"class","marg svelte-1gzciq8"),T(l,"type","number"),T(d,"class",u="btn checkbox "+(t[5]?"active":"disabled")),T(h,"class","marg svelte-1gzciq8"),T(f,"class",v="btn marg formatted secondary "+(t[6]?"":"disabled")+" svelte-1gzciq8"),T(s,"class","search panel-black svelte-1gzciq8"),T(y,"class","choices border grey svelte-1gzciq8"),F(w,"position","relative"),F(N,"text-align","end"),T(x,"class","buy panel-black svelte-1gzciq8"),T(b,"class","items border grey svelte-1gzciq8"),T(e,"class","layout svelte-1gzciq8"),H=[P(i,"input",t[35]),P(r,"input",et),P(l,"input",st),P(h,"click",function(){t[38].apply(this,arguments)}),P(f,"click",t[18]),P(R,"click",t[41]),P(z,"click",t[42]),P(N,"click",t[43])]},m(a,u){$(a,e,u),k(e,s),k(s,i),A(i,t[4]),k(s,n),k(s,r),A(r,t[2]),k(s,o),k(s,l),A(l,t[3]),k(s,c),k(s,h),k(h,d),k(h,m),k(h,p),k(s,f),k(f,g),t[39](s),k(e,y);for(let t=0;t<nt.length;t+=1)nt[t].m(y,null);k(e,b),k(b,x),k(x,w),at&&at.m(w,null),k(x,R),k(R,I),k(R,q),k(x,j),k(x,z),k(z,B),k(z,L),k(x,N),k(N,U),k(N,O);for(let t=0;t<ot.length;t+=1)ot[t].m(b,null);ht[Q].m(e,null),V=!0},p(s,n){if(t=s,16&n[0]&&A(i,t[4]),!Y&&4&n[0]&&A(r,t[2]),Y=!1,!G&&8&n[0]&&A(l,t[3]),G=!1,(!V||32&n[0]&&u!==(u="btn checkbox "+(t[5]?"active":"disabled")))&&T(d,"class",u),(!V||64&n[0]&&v!==(v="btn marg formatted secondary "+(t[6]?"":"disabled")+" svelte-1gzciq8"))&&T(f,"class",v),131074&n[0]){let e;for(it=t[17],e=0;e<it.length;e+=1){const s=Cx(t,it,e);nt[e]?nt[e].p(s,n):(nt[e]=Ex(s),nt[e].c(),nt[e].m(y,null))}for(;e<nt.length;e+=1)nt[e].d(1);nt.length=it.length}if(t[6]?at&&(ft(),yt(at,1,1,()=>{at=null}),gt()):at?vt(at,1):((at=_x()).c(),vt(at,1),at.m(w,null)),(!V||384&n[0])&&J!==(J=t[27](t[7],"tier",t[8])+"")&&D(I,J),(!V||384&n[0])&&K!==(K=t[27](t[7],"auction",t[8])+"")&&D(B,K),(!V||384&n[0])&&tt!==(tt=t[27](t[7],"auctionprice",t[8])+"")&&D(U,tt),12589057&n[0]){let e;for(rt=t[11],e=0;e<rt.length;e+=1){const s=Sx(t,rt,e);ot[e]?(ot[e].p(s,n),vt(ot[e],1)):(ot[e]=Rx(s),ot[e].c(),vt(ot[e],1),ot[e].m(b,null))}for(ft(),e=rt.length;e<ot.length;e+=1)lt(e);gt()}let a=Q;(Q=dt(t))===a?ht[Q].p(t,n):(ft(),yt(ht[a],1,1,()=>{ht[a]=null}),gt(),(W=ht[Q])||(W=ht[Q]=ct[Q](t)).c(),vt(W,1),W.m(e,null))},i(t){if(!V){vt(at);for(let t=0;t<rt.length;t+=1)vt(ot[t]);vt(W),V=!0}},o(t){yt(at),ot=ot.filter(Boolean);for(let t=0;t<ot.length;t+=1)yt(ot[t]);yt(W),V=!1},d(s){s&&S(e),t[39](null),C(nt,s),at&&at.d(),C(ot,s),ht[Q].d(),a(H)}}}function Fx(t){let e,s,i=t[14]&&Mx(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,s){t[14]?i?(i.p(t,s),vt(i,1)):((i=Mx(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function zx(t,e,s){let i,n,a,r,o;h(t,de,t=>s(13,i=t)),h(t,ue,t=>s(32,n=t)),h(t,ce,t=>s(14,a=t)),h(t,he,t=>s(33,r=t));let l=Object.keys(Or).filter(t=>"gold"!=t);l.unshift("all");let c=l[0],d=0,u=100,m="",p=[],g=!1,v=!0,y="auctionprice",b="asc";const k=()=>{if(v&&a){let t=m.toLowerCase();if(t.length&&(p=tf.filter(e=>Wh(e.type,e.tier).toLowerCase().includes(t))).length){const t=p[0];s(1,c=t.type),s(2,d=t.level),s(3,u=t.level)}hma.chat.commands.pack("itemauctionfind",`${c} ${d} ${u} ${g?1:0} ${y} ${b}`),s(6,v=!1)}};let x,$,w,S=[],M=[];const E=()=>{if(w=Date.now(),r.length){const t=r.map(t=>t.dbid);fetch("/api/item/get",{method:"POST",body:JSON.stringify({auction:1,ids:t})}).then(async t=>{const e=await t.json();e.fail?console.error(e):(s(11,M.length=0,M),r.forEach((t,s)=>{const i=e.find(e=>e.id===t.dbid);i&&(i.store=S[s]||(S[s]=It()),i.store.temp=t,t.hydrate(i),M.push(i.store))}),s(6,v=!0))})}else s(6,v=!0),s(11,M.length=0,M)};let C;const T=t=>{s(12,C=t)},_=()=>{s(12,C=void 0)},A=t=>{t==y?s(8,b="asc"==b?"desc":"asc"):s(7,y=t),k()};let R,P;return t.$$.update=(()=>{16384&t.$$.dirty[0]&&(a||f(de,i=void 0)),8192&t.$$.dirty[0]&&i&&s(1,c=i.type),12&t.$$.dirty[0]&&(s(2,d=Math.min(Math.max(0,d||0),100)),s(3,u=Math.min(Math.max(0,u)||100,100))),16386&t.$$.dirty[0]|2&t.$$.dirty[1]&&a&&k(),8704&t.$$.dirty[0]&&s(9,x=i?ia(0,2147483646,x):0),512&t.$$.dirty[0]&&s(15,R=Number.isInteger(x)?$x(x):0),8704&t.$$.dirty[0]&&s(16,P=Number.isInteger(x)&&x>0&&i&&i.canBeTraded()),4&t.$$.dirty[1]&&E()}),[o,c,d,u,m,g,v,y,b,x,$,M,C,i,a,R,P,l,k,()=>{P&&hma.chat.commands.pack("itemauctionpost",`${i.dbid} ${x}`)},t=>{const{from:e,to:i}=t.detail;e!==i&&"item"==e.type&&(de.set(e.item),s(10,$=e.slot))},t=>{de.set(),s(10,$=void 0)},t=>{let e=Math.ceil((t-w)/6e4);return e<60?`${e} minutes`:`${Math.ceil(e/60)} hours`},T,_,()=>{hma.chat.commands.pack("itemauctionbuy",C.temp.dbid+""),_()},()=>{hma.chat.commands.pack("itemauctioncancel",C.temp.dbid+""),_()},(t,e,s)=>t==e?"asc"==s?"🠕 ":"🠗 ":"",A,p,w,S,n,r,E,function(){m=this.value,s(4,m)},function(){d=I(this.value),s(2,d),s(3,u)},function(){u=I(this.value),s(3,u),s(2,d)},t=>s(5,g=!g),function(t){tt[t?"unshift":"push"](()=>{s(0,o=t)})},(t,e)=>{s(1,c=t)},t=>A("tier"),t=>A("auction"),t=>A("auctionprice"),(t,e)=>T(t),function(){x=I(this.value),s(9,x),s(13,i),s(14,a)},()=>{f(ce,a=void 0),s(2,d=0),s(3,u=100),s(4,m="")}]}class Bx extends Pt{constructor(t){super(),Rt(this,t,zx,Fx,o,{},[-1,-1])}}let Ux=0;const Ox=new Dl(0,10),jx=(t,e,s=!1,i,n,a,r,o)=>{Wt.update(l=>{l.length>100&&l.shift(),s&&(e=If(e)),"whisper"===t&&"f"===i[0]&&(Ox.done(qn.time)&&Yr({id:"ui/msg",pitch:-1}),Ox.reset(qn.time));const c=new Date;return l.push({channel:t,time:`${String(c.getHours()).padStart(2,"0")}.${String(c.getMinutes()).padStart(2,"0")}`,text:e,id:++Ux,sender:i,sub:o,faction:n,cclass:a,level:r,interpolate:s}),l})},Lx=[{name:"Year",description:"one year",days:365,price:9e3},{name:"Month",description:"one month",days:30,price:900}],Nx=[{stash:15,inventory:15,auction:10,auctionHours:12},{stash:100,inventory:25,auction:100,auctionHours:24}];function qx(t,e,s){const i=t.slice();return i[26]=e[s],i}function Hx(t){let e,s,i;const n=new Rf({props:{title:"Stash",pad:"5",icon:"bag",$$slots:{default:[Yx]},$$scope:{ctx:t}}});return n.$on("close",function(){t[24].apply(this,arguments)}),{c(){e=M("div"),Mt(n.$$.fragment),T(e,"class","l-upperLeftModal container svelte-1tde6tk"),i=P(e,"pointerup",t[11])},m(i,a){$(i,e,a),Et(n,e,null),t[25](e),s=!0},p(e,s){t=e;const i={};536872959&s&&(i.$$scope={dirty:s,ctx:t}),n.$set(i)},i(t){s||(vt(n.$$.fragment,t),s=!0)},o(t){yt(n.$$.fragment,t),s=!1},d(s){s&&S(e),_t(n),t[25](null),i()}}}function Wx(t){let e;return{c(){e=M("div")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Qx(t){let e;const s=new Xy({props:{descPos:"left:100%;top:0;",descRoot:t[0],pickable:!1,text:t[12](t[26].temp.stash.getTime()),item:t[26],filter:!t[3]||t[26].temp.stash.getTime()>t[1]||""}});return s.$on("click",t[13]),{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};1&e&&(i.descRoot=t[0]),4&e&&(i.text=t[12](t[26].temp.stash.getTime())),4&e&&(i.item=t[26]),14&e&&(i.filter=!t[3]||t[26].temp.stash.getTime()>t[1]||""),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Vx(t){let e,s;return{c(){(e=M("span")).innerHTML='Upgrade <img class="svgicon texticon" src="/assets/ui/icons/gem.svg?v=3406973">',T(e,"class","btn textwhite"),s=P(e,"click",function(){t[20].apply(this,arguments)})},m(t,s){$(t,e,s)},p(e,s){t=e},d(t){t&&S(e),s()}}}function Gx(t){let e,s,i,n,r,o,l,c,h,d,u,m,p=(1==t[4]?qh.ui.stash.deposit:qh.ui.stash.withdraw)+"",f=!1,g=(1==t[4]?qh.ui.stash.deposit:qh.ui.stash.withdraw)+"";const v=new jv({props:{amount:t[4]>0?t[5]:0}});function y(){f=!0,t[23].call(l)}return{c(){e=M("div"),s=M("span"),i=E(p),n=_(),Mt(v.$$.fragment),r=E(" ?"),o=M("div"),l=M("input"),c=M("div"),h=E(g),F(l,"width","150px"),T(l,"class","navbtn formatted"),T(l,"type","number"),T(c,"class",d="btn "+(!t[3]||t[5]<=0?"disabled":"")+" "+(1==t[4]?"blue":"green")+" formatted"),T(o,"class","marg-top formelements svelte-1tde6tk"),T(e,"class","panel-black marg-top"),F(e,"text-align","right"),m=[P(l,"input",y),P(c,"click",t[14])]},m(a,d){$(a,e,d),k(e,s),k(s,i),k(s,n),Et(v,s,null),k(s,r),k(e,o),k(o,l),A(l,t[5]),k(o,c),k(c,h),u=!0},p(t,e){(!u||16&e)&&p!==(p=(1==t[4]?qh.ui.stash.deposit:qh.ui.stash.withdraw)+"")&&D(i,p);const s={};48&e&&(s.amount=t[4]>0?t[5]:0),v.$set(s),!f&&32&e&&A(l,t[5]),f=!1,(!u||16&e)&&g!==(g=(1==t[4]?qh.ui.stash.deposit:qh.ui.stash.withdraw)+"")&&D(h,g),(!u||56&e&&d!==(d="btn "+(!t[3]||t[5]<=0?"disabled":"")+" "+(1==t[4]?"blue":"green")+" formatted"))&&T(c,"class",d)},i(t){u||(vt(v.$$.fragment,t),u=!0)},o(t){yt(v.$$.fragment,t),u=!1},d(t){t&&S(e),_t(v),a(m)}}}function Yx(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,_=t[2].length+"",A=(t[7].subscribed_until?Nx[1].stash:Nx[0].stash)+"",I=t[2],q=[];for(let e=0;e<I.length;e+=1)q[e]=Qx(qx(t,I,e));const j=t=>yt(q[t],1,1,()=>{q[t]=null});let z=null;I.length||(z=Wx()).c();let B=!t[7].subscribed_until&&Vx(t);const L=new jv({props:{amount:t[6].gold}});let N=t[4]>0&&Gx(t);return{c(){e=M("div");for(let t=0;t<q.length;t+=1)q[t].c();s=M("div"),i=M("div"),n=M("span"),r=E(_),o=E(" / "),l=E(A),B&&B.c(),h=M("div"),Mt(L.$$.fragment),d=M("div"),u=M("img"),f=M("div"),g=M("img"),N&&N.c(),b=R(),T(e,"class","panel-black slotcontainer svelte-1tde6tk"),F(e,"grid-template-columns","repeat("+t[8]+", 46px)"),F(e,"max-height",t[9]+"px"),T(n,"class",c=t[2].length<(t[7].subscribed_until?Nx[1].stash:Nx[0].stash)?"textgreen":"textred"),T(i,"class","navbtn panel-black border black gold svelte-1tde6tk"),F(i,"margin-right","auto"),T(h,"class","navbtn panel-black border black gold svelte-1tde6tk"),T(u,"class","svgicon"),u.src!==(m="/assets/ui/icons/deposit.svg?v=3406973")&&T(u,"src","/assets/ui/icons/deposit.svg?v=3406973"),T(d,"class",p="navbtn btn grey gold "+(1==t[4]?"active":"")+" svelte-1tde6tk"),T(g,"class","svgicon"),g.src!==(v="/assets/ui/icons/withdraw.svg?v=3406973")&&T(g,"src","/assets/ui/icons/withdraw.svg?v=3406973"),T(f,"class",y="navbtn btn grey gold "+(2==t[4]?"active":"")+" svelte-1tde6tk"),T(s,"class","formelements svelte-1tde6tk"),w=[P(d,"click",function(){t[21].apply(this,arguments)}),P(f,"click",function(){t[22].apply(this,arguments)})]},m(t,a){$(t,e,a);for(let t=0;t<q.length;t+=1)q[t].m(e,null);z&&z.m(e,null),$(t,s,a),k(s,i),k(i,n),k(n,r),k(n,o),k(n,l),B&&B.m(n,null),k(s,h),Et(L,h,null),k(s,d),k(d,u),k(s,f),k(f,g),N&&N.m(t,a),$(t,b,a),x=!0},p(s,i){if(t=s,12303&i){let s;for(I=t[2],s=0;s<I.length;s+=1){const n=qx(t,I,s);q[s]?(q[s].p(n,i),vt(q[s],1)):(q[s]=Qx(n),q[s].c(),vt(q[s],1),q[s].m(e,null))}for(ft(),s=I.length;s<q.length;s+=1)j(s);gt()}I.length?z&&(z.d(1),z=null):z||((z=Wx()).c(),z.m(e,null)),(!x||256&i)&&F(e,"grid-template-columns","repeat("+t[8]+", 46px)"),(!x||512&i)&&F(e,"max-height",t[9]+"px"),(!x||4&i)&&_!==(_=t[2].length+"")&&D(r,_),(!x||128&i)&&A!==(A=(t[7].subscribed_until?Nx[1].stash:Nx[0].stash)+"")&&D(l,A),t[7].subscribed_until?B&&(B.d(1),B=null):B?B.p(t,i):((B=Vx(t)).c(),B.m(n,null)),(!x||132&i&&c!==(c=t[2].length<(t[7].subscribed_until?Nx[1].stash:Nx[0].stash)?"textgreen":"textred"))&&T(n,"class",c);const a={};64&i&&(a.amount=t[6].gold),L.$set(a),(!x||16&i&&p!==(p="navbtn btn grey gold "+(1==t[4]?"active":"")+" svelte-1tde6tk"))&&T(d,"class",p),(!x||16&i&&y!==(y="navbtn btn grey gold "+(2==t[4]?"active":"")+" svelte-1tde6tk"))&&T(f,"class",y),t[4]>0?N?(N.p(t,i),vt(N,1)):((N=Gx(t)).c(),vt(N,1),N.m(b.parentNode,b)):N&&(ft(),yt(N,1,1,()=>{N=null}),gt())},i(t){if(!x){for(let t=0;t<I.length;t+=1)vt(q[t]);vt(L.$$.fragment,t),vt(N),x=!0}},o(t){q=q.filter(Boolean);for(let t=0;t<q.length;t+=1)yt(q[t]);yt(L.$$.fragment,t),yt(N),x=!1},d(t){t&&S(e),C(q,t),z&&z.d(),t&&S(s),B&&B.d(),_t(L),N&&N.d(t),t&&S(b),a(w)}}}function Xx(t){let e,s,i=t[6]&&t[7]&&Hx(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[6]&&t[7]?i?(i.p(t,s),vt(i,1)):((i=Hx(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function Zx(t,e,s){let i,n,a,r,o,l,c,d,u,m;h(t,fe,t=>s(16,i=t)),h(t,Gt,t=>s(17,n=t)),h(t,pe,t=>s(6,a=t)),h(t,Xt,t=>s(18,r=t)),h(t,$e,t=>s(7,o=t)),h(t,Le,t=>s(8,l=t)),h(t,Ne,t=>s(9,c=t)),h(t,Ye,t=>s(10,d=t));let p=[],g=[],v=!1;const y=async()=>{if(s(1,m=Date.now()),i.length){const t=await fetch("/api/item/get",{method:"POST",body:JSON.stringify({stash:1,ids:i.map(t=>t.dbid)})}),e=await t.json();if(e.fail)console.error(e);else{s(2,g.length=0,g);let t=new Map(i.map(t=>[t.dbid,t]));e.forEach((e,i)=>{e.store=p[i]||(p[i]=It()),s(2,g[i]=p[i],g),t.has(e.id)&&(t.get(e.id).hydrate(e),s(2,g[i].temp=t.get(e.id),g))})}s(3,v=!0)}else s(3,v=!0),s(2,g.length=0,g)};let b=2,k=0;return t.$$.update=(()=>{65536&t.$$.dirty&&y(),262256&t.$$.dirty&&s(5,k=a?Math.min(1==b?r:a.gold,k):0)}),[u,m,g,v,b,k,a,o,l,c,d,t=>{n&&(hma.chat.commands.pack("itemstash",`${n.meta.slot}`),f(Gt,n=void 0))},t=>t<m?void 0:`${Math.ceil((t-m)/6e4)}m`,t=>{v&&(t.detail.item.stash.getTime()>Date.now()?jx("system",qh.ui.stash.waitunstash):(hma.chat.commands.pack("itemunstash",t.detail.item.dbid+""),s(3,v=!1)))},t=>{v&&(hma.chat.commands.pack(1==b?"goldstash":"goldunstash",k+""),s(3,v=!1),setTimeout(()=>{s(3,v=!0)},500))},p,i,n,r,y,t=>f(Ye,d=!0),t=>s(4,b=1),t=>s(4,b=2),function(){k=I(this.value),s(5,k),s(6,a),s(4,b),s(18,r)},t=>f(pe,a=!1),function(t){tt[t?"unshift":"push"](()=>{s(0,u=t)})}]}class Jx extends Pt{constructor(t){super(),Rt(this,t,Zx,Xx,o,{})}}function Kx(t,e,s){const i=t.slice();return i[7]=e[s],i[9]=s,i}function tw(t){let e,s,i;const n=new Rf({props:{title:"Trader",icon:"bag",$$slots:{default:[rw]},$$scope:{ctx:t}}});return n.$on("close",function(){t[5].apply(this,arguments)}),{c(){e=M("div"),Mt(n.$$.fragment),T(e,"class","l-upperLeftModal container svelte-46w0ts"),i=P(e,"pointerup",t[3])},m(i,a){$(i,e,a),Et(n,e,null),t[6](e),s=!0},p(e,s){t=e;const i={};1027&s&&(i.$$scope={dirty:s,ctx:t}),n.$set(i)},i(t){s||(vt(n.$$.fragment,t),s=!0)},o(t){yt(n.$$.fragment,t),s=!1},d(s){s&&S(e),_t(n),t[6](null),i()}}}function ew(t){let e;const s=new Xy({props:{id:"trader"+t[9],descPos:"left:100%;top:0;",descRoot:t[0],isTrader:!0,pickable:!1,item:t[7]}});return s.$on("click",t[4]),{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};1&e&&(i.descRoot=t[0]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function sw(e){let s;return{c(){(s=M("span")).textContent="Select an item to sell",T(s,"class","textgrey")},m(t,e){$(t,s,e)},p:t,i:t,o:t,d(t){t&&S(s)}}}function iw(t){let e,s,i,n,a;const r=[aw,nw],o=[];function l(t,s){return 2&s&&(e=!!t[1].data.canBeSold()),e?0:1}return s=l(t,-1),i=o[s]=r[s](t),{c(){i.c(),n=R()},m(t,e){o[s].m(t,e),$(t,n,e),a=!0},p(t,e){let a=s;(s=l(t,e))===a?o[s].p(t,e):(ft(),yt(o[a],1,1,()=>{o[a]=null}),gt(),(i=o[s])||(i=o[s]=r[s](t)).c(),vt(i,1),i.m(n.parentNode,n))},i(t){a||(vt(i),a=!0)},o(t){yt(i),a=!1},d(t){o[s].d(t),t&&S(n)}}}function nw(e){let s;return{c(){(s=M("span")).textContent="The trader does not want this item",T(s,"class","textred")},m(t,e){$(t,s,e)},p:t,i:t,o:t,d(t){t&&S(s)}}}function aw(t){let e;const s=new jv({props:{amount:t[1].data.goldValue()}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};2&e&&(i.amount=t[1].data.goldValue()),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function rw(t){let e,s,i,n,a,r,o,l,c,h=qn.player.getTargetEntity().itemStores,d=[];for(let e=0;e<h.length;e+=1)d[e]=ew(Kx(t,h,e));const u=t=>yt(d[t],1,1,()=>{d[t]=null}),m=[iw,sw],p=[];function f(t,e){return t[1]&&"item"===t[1].meta.type?0:1}return o=f(t),l=p[o]=m[o](t),{c(){(e=M("p")).textContent=`${qh.npcs.trader.buy}`,s=M("div");for(let t=0;t<d.length;t+=1)d[t].c();i=M("div"),(n=M("p")).textContent=`${qh.npcs.trader.info}`,(a=M("p")).textContent=`${qh.npcs.trader.price}`,r=M("span"),l.c(),T(e,"class","textprimary textcenter"),T(s,"class","panel-black slotcontainer svelte-46w0ts"),T(n,"class","textprimary"),T(r,"class","panel-black formatted info svelte-46w0ts"),T(i,"class","textcenter")},m(t,l){$(t,e,l),$(t,s,l);for(let t=0;t<d.length;t+=1)d[t].m(s,null);$(t,i,l),k(i,n),k(i,a),k(i,r),p[o].m(r,null),c=!0},p(t,e){if(17&e){let i;for(h=qn.player.getTargetEntity().itemStores,i=0;i<h.length;i+=1){const n=Kx(t,h,i);d[i]?(d[i].p(n,e),vt(d[i],1)):(d[i]=ew(n),d[i].c(),vt(d[i],1),d[i].m(s,null))}for(ft(),i=h.length;i<d.length;i+=1)u(i);gt()}let i=o;(o=f(t))===i?p[o].p(t,e):(ft(),yt(p[i],1,1,()=>{p[i]=null}),gt(),(l=p[o])||(l=p[o]=m[o](t)).c(),vt(l,1),l.m(r,null))},i(t){if(!c){for(let t=0;t<h.length;t+=1)vt(d[t]);vt(l),c=!0}},o(t){d=d.filter(Boolean);for(let t=0;t<d.length;t+=1)yt(d[t]);yt(l),c=!1},d(t){t&&S(e),t&&S(s),C(d,t),t&&S(i),p[o].d()}}}function ow(t){let e,s,i=t[2]&&tw(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[2]?i?(i.p(t,s),vt(i,1)):((i=tw(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function lw(t,e,s){let i,n,a;return h(t,Gt,t=>s(1,i=t)),h(t,ge,t=>s(2,n=t)),[a,i,n,t=>{i&&(hma.chat.commands.pack("itemtradersell",`${i.meta.slot}`),f(Gt,i=void 0))},t=>{hma.chat.commands.pack("itemtraderbuy",`${t.detail.item.traderslot}`)},t=>f(ge,n=!1),function(t){tt[t?"unshift":"push"](()=>{s(0,a=t)})}]}class cw extends Pt{constructor(t){super(),Rt(this,t,lw,ow,o,{})}}const hw=t=>void 0===t.stacks&&t.rolls.length>0&&!Or[t.type].noupgrade,dw=t=>t<101,uw=t=>{if(!hw(t))return 0;const e=Kp[t.type+t.tier];return Math.ceil(((1+e.level*(1+t.upgrade))/Or[t.type].drop)**(1.2+.2*t.upgrade))+100},mw=t=>{if(hw(t)){const e=[];for(let s=0;s<Math.max(1,Math.min(t.upgrade,3));++s)e.push({type:"rune",tier:s+Math.max(0,t.upgrade-3),stacks:Math.min(t.upgrade+1,3-s)});return e}return[]},pw=lg({0:{6:1,8:.5},1:{6:4,12:1},2:{14:.5},3:{14:.4,7:1},4:{16:.3,7:1},5:{14:.2,18:.5}}),fw=(t,e,s,i,n)=>gw(t,i,n)&&vw(s,i,n)&&ww(e,i,n)&&$w(e,i,n)&&xw(e,t,i,n,s),gw=(t,e,s)=>t>=Kp[e+s].level,vw=(t,e,s)=>void 0===Kp[e+s].class||t===Kp[e+s].class,yw=(t,e)=>t+zp.get(e).skillpoints,bw=(t,e)=>zp.get(Kp[t+e].skillid).skillpoints,xw=(t,e,s,i,n)=>"book"!==s||((t,e)=>Math.ceil(t/2)+jy[e].startSkills.length)(e,n)>=(t=>t.reduce(yw,0))(t)+bw(s,i),ww=(t,e,s)=>"book"!==e||kw(t,Kp[e+s].skillid)===Kp[e+s].skilllevel,kw=(t,e)=>t.reduce((t,s)=>t+(s===e),0),$w=(t,e,s)=>!Kp[e+s].requiredSkills||!Kp[e+s].requiredSkills.some(e=>t.indexOf(e)<0),Sw=(t,e,s,i)=>Math.ceil(t.goldValue||(.4*(t.level**1.3+.4*e))**(1.1+e/100)/Or[t.type].drop)*(s||1)*(i?8:1);class Cw{constructor(t){this.dbid=t,this.stats=new Map,this.dirty=!0}hydrate(t){if(this.dirty=!1,this.bound=t.bound,this.type=t.type,this.tier=t.tier,this.logic=Kp[this.type+this.tier],this.auction=t.auction?new Date(t.auction):void 0,this.auctionprice=t.auctionprice,this.owner=t.name,this.stash=t.stash?new Date(t.stash):void 0,void 0===this.logic)throw"Unknown item "+t.type+t.tier;if(this.upgrade=t.upgrade,this.stats.clear(),t.rolls){if(this.setRolls(t.rolls),this.quality=this.nextRoll(),this.logic.stats){this.logic.stats.forEach((t,e)=>{this.stats.set(e,{type:"base",qual:this.quality,value:Math.floor(t.min+(t.max-t.min)*(this.quality/100)**2+Nr[e]*this.upgrade)})});const t=Math.round((this.quality/100)**1.5*3.6);for(let e=0;e<t;++e){let t=this.nextRoll(),e=-1;for(;-1===e||this.stats.has(e);)e=parseInt(Br(Mw,t/101)),t=(t+5)%100;const s=(this.nextRoll()+this.quality)/2;this.stats.set(e,{type:"bonus",qual:s,value:Math.ceil(Math.max((Lr[e].min+(Lr[e].max-Lr[e].min)*(s/100)**2)*this.logic.level*Or[this.type].weight,Nr[e])+Nr[e]*this.upgrade)})}}this.quality=this.logic.quality||this.quality,this.stacks=void 0}else this.stacks=t.stacks,this.quality=this.logic.quality||0}setRolls(t){this.rolls=t,this.currentRoll=0}nextRoll(){if(this.currentRoll==this.rolls.length)throw"roll maximum reached";return this.rolls[this.currentRoll++]}use(t){this.logic.use&&this.logic.use(t)}goldValue(t){if(!this.canBeSold())throw"Item cant have value because it cant be sold";return Sw(this.logic,this.quality,this.stacks,t)}storeValue(){return this.logic.storeValue||0}canEquip(t){return fw(t.level,t.skills.skillIds,t.class,this.type,this.tier)}canEquipClass(t){return vw(t.class,this.type,this.tier)}equipReasons(t){const e=[];return this.logic.level&&e.push(["Lv. "+this.logic.level,!0]),e}canBeDropped(){return!Or[this.type].undroppable&&!this.bound}canBeTraded(){return!this.bound}canBeSold(){return!this.logic.unsellable}}const Mw=Object.keys(Lr),Ew=(t,e,s)=>{if(t&&t.type)switch(e){case 13:t.rolls&&t.quality>=70&&Yr({id:"item/"+(t.quality<90?"discoverRare":"discoverEpic"),pitch:-1});case 1:gi.chat[7]&&jx("inv",qh.ui.inventory.pick.replace("$1",Wh(t.type,t.tier)),!0),lf(10,100),eo(t.type),nf[12].element="bag"+s,"book"==t.type&&lf(23,100)&&(nf[24].element="bag"+s);break;case 10:t.rolls&&ye.update(e=>(be.set(t.upgrade-e.upgrade),t))}},_w=(t,e)=>{if(t&&t.type)switch(e){case 7:gi.chat[8]&&jx("inv",qh.ui.stash.stashed.replace("$1",Wh(t.type,t.tier))),eo(t.type);break;case 6:de.set(),ue.update(t=>!t),gi.chat[8]&&jx("inv",qh.ui.merchant.auctionpost.replace("$1",Wh(t.type,t.tier)));break;case 9:gi.chat[8]&&jx("inv",qh.ui.inventory.sell.replace("$1",Wh(t.type,t.tier))),eo(t.type);break;case 2:gi.chat[7]&&jx("inv",qh.ui.inventory.throw.replace("$1",Wh(t.type,t.tier))),eo(t.type)}},Rw=(t,e,s)=>{switch(0!=s&&eo("gold"),s){case 1:gi.chat[9]&&jx("inv",qh.ui.inventory.pick.replace("$1","$g"+e),!0);break;case 4:ue.update(t=>!t),gi.chat[10]&&jx("inv",qh.ui.merchant.auctionbuy.replace("$1",e),!0);break;case 3:gi.chat[10]&&jx("inv",qh.ui.inventory.spend.replace("$1",e),!0);break;case 12:gi.chat[10]&&jx("inv",qh.ui.inventory.spend.replace("$g","$sp").replace("$1",e),!0);break;case 11:gi.chat[10]&&jx("inv",qh.ui.inventory.death.replace("$1",e),!0);break;case 9:gi.chat[10]&&jx("inv",qh.ui.inventory.receive.replace("$1","$g"+e),!0)}};class Pw extends Cw{constructor(t){super(t)}hydrate(t){super.hydrate(t),t.store?t.store.set(this):console.error("no store for item",t),Ew(this,this.reason,t.slot)}equipReasons(t){const e=[];if(void 0!==this.logic.class&&e.push(["Class: "+qh.classes[this.logic.class].name,vw(t.class,this.type,this.tier)]),this.logic.level&&e.push(["Requires Lv. "+this.logic.level,gw(t.level,this.type,this.tier)]),this.logic.requiredSkills&&e.push(["Must know: "+this.logic.requiredSkills.map(t=>qh.items.book[t].name).join(", "),$w(t.skills.skillIds,this.type,this.tier)]),vw(t.class,this.type,this.tier)&&"book"==this.type){const s=ww(t.skills.skillIds,this.type,this.tier),i=kw(t.skills.skillIds,this.logic.skillid);e.push([s?"Use book to learn skill":i>=this.logic.skilllevel?"You already know this skill":`Must learn book Lv. ${this.logic.skilllevel} first`,s]);const n=xw(t.skills.skillIds,t.level,this.type,this.tier,t.class);e.push([n?`Requires ${bw(this.type,this.tier)||"no"} skill point`:"Not enough skill points",n])}return e}}function Tw(t,e,s){const i=t.slice();return i[18]=e[s],i}function Iw(t){let e,s;const i=new Rf({props:{title:"Blacksmith",pad:"5",icon:"bag",$$slots:{default:[Fw]},$$scope:{ctx:t}}});return i.$on("close",function(){t[17].apply(this,arguments)}),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","absCentered container textcenter svelte-1pe30wj")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(e,s){t=e;const n={};2097407&s&&(n.$$scope={dirty:s,ctx:t}),i.$set(n)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function Dw(t){let e;return{c(){e=M("div")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Aw(t){let e;const s=new Xy({props:{pickable:!1,item:t[18],filter:t[18].filter}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};2&e&&(i.item=t[18]),2&e&&(i.filter=t[18].filter),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Fw(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,p,f,g=(t[5]||"Place an item into the upgrade slot")+"";const v=new Xy({props:{clearOnMove:!0,invslot:t[7]?t[0]:void 0,pickable:!0,item:ye,filter:!!t[3]||""}});v.$on("discard",t[10]),v.$on("move",t[9]);let y=t[1],b=[];for(let e=0;e<y.length;e+=1)b[e]=Aw(Tw(t,y,e));const x=t=>yt(b[t],1,1,()=>{b[t]=null});let w=null;y.length||(w=Dw()).c();const _=new jv({props:{isPrice:!0,amount:t[7]?uw(t[7]):0}});return{c(){(e=M("h3")).textContent="Upgrade Item",s=M("span"),i=E(g),a=M("div"),Mt(v.$$.fragment),o=M("div"),(l=M("span")).textContent="Cost:",c=M("div");for(let t=0;t<b.length;t+=1)b[t].c();h=M("div"),Mt(_.$$.fragment),d=M("div"),u=E("Upgrade"),T(e,"class","textwhite"),T(s,"class",n="panel-black upgradetext "+t[6]+" svelte-1pe30wj"),T(a,"class",r="upgradeslot "+t[4]+" svelte-1pe30wj"),T(c,"class","panel-black costgrid svelte-1pe30wj"),F(c,"grid-template-columns","repeat("+(t[1].length||3)+", 30px)"),T(d,"class",m="btn primary formatted textcenter upgradebutton "+(t[2]?"":"disabled")+" svelte-1pe30wj"),T(o,"class","upgrade svelte-1pe30wj"),f=P(d,"click",t[11])},m(t,n){$(t,e,n),$(t,s,n),k(s,i),$(t,a,n),Et(v,a,null),$(t,o,n),k(o,l),k(o,c);for(let t=0;t<b.length;t+=1)b[t].m(c,null);w&&w.m(c,null),k(o,h),Et(_,h,null),k(o,d),k(d,u),p=!0},p(t,e){(!p||32&e)&&g!==(g=(t[5]||"Place an item into the upgrade slot")+"")&&D(i,g),(!p||64&e&&n!==(n="panel-black upgradetext "+t[6]+" svelte-1pe30wj"))&&T(s,"class",n);const o={};if(129&e&&(o.invslot=t[7]?t[0]:void 0),8&e&&(o.filter=!!t[3]||""),v.$set(o),(!p||16&e&&r!==(r="upgradeslot "+t[4]+" svelte-1pe30wj"))&&T(a,"class",r),2&e){let s;for(y=t[1],s=0;s<y.length;s+=1){const i=Tw(t,y,s);b[s]?(b[s].p(i,e),vt(b[s],1)):(b[s]=Aw(i),b[s].c(),vt(b[s],1),b[s].m(c,null))}for(ft(),s=y.length;s<b.length;s+=1)x(s);gt()}y.length?w&&(w.d(1),w=null):w||((w=Dw()).c(),w.m(c,null)),(!p||2&e)&&F(c,"grid-template-columns","repeat("+(t[1].length||3)+", 30px)");const l={};128&e&&(l.amount=t[7]?uw(t[7]):0),_.$set(l),(!p||4&e&&m!==(m="btn primary formatted textcenter upgradebutton "+(t[2]?"":"disabled")+" svelte-1pe30wj"))&&T(d,"class",m)},i(t){if(!p){vt(v.$$.fragment,t);for(let t=0;t<y.length;t+=1)vt(b[t]);vt(_.$$.fragment,t),p=!0}},o(t){yt(v.$$.fragment,t),b=b.filter(Boolean);for(let t=0;t<b.length;t+=1)yt(b[t]);yt(_.$$.fragment,t),p=!1},d(t){t&&S(e),t&&S(s),t&&S(a),_t(v),t&&S(o),C(b,t),w&&w.d(),_t(_),f()}}}function zw(t){let e,s,i=t[8]&&Iw(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[8]?i?(i.p(t,s),vt(i,1)):((i=Iw(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function Bw(t,e,s){let i,n,a,r,o;h(t,ye,t=>s(7,i=t)),h(t,ve,t=>s(8,n=t)),h(t,be,t=>s(12,a=t)),h(t,Xt,t=>s(13,r=t)),h(t,Kt,t=>s(14,o=t));let l,c=[],d=!1,u=!1;const m=()=>{const t=hw(i),e=r>uw(i),n=dw(l);s(2,d=t&&e&&n);const a=mw(i);a.forEach((t,e)=>{const i=c[e]||s(1,c[e]=It(),c),n=new Pw;n.hydrate({...t,store:i}),i.filter=!(o[n.type+n.tier]>=n.stacks)||"",i.filter&&s(2,d=!1)}),s(1,c=c.slice(0,a.length)),d||s(5,g="You lack the required materials"),t||s(5,g="This item type cannot be upgraded"),e||s(5,g="You do not have enough gold"),n||s(5,g="You must un-equip the item first"),d?(s(6,v="textgreen"),s(5,g="Ready to upgrade")):s(6,v="textred")};let p,g,v;const y=()=>{Yr({id:a>0?"upgrade_success":"upgrade_fail",loop:!1,gain:!0}),s(4,p=a>0?"flash_success":"flash_fail"),s(5,g=(a>0?"Success! ":"Fail! ")+(a<0?"-":"+")+a),s(6,v=a>0?"textgreen":"textred")};return t.$$.update=(()=>{256&t.$$.dirty&&(n||(f(ye,i=void 0),f(be,a=void 0))),128&t.$$.dirty&&(s(2,d=!0),i?m():(s(1,c.length=0,c),s(2,d=!1),s(6,v=void 0),s(5,g=void 0)),s(3,u=!1)),4096&t.$$.dirty&&(void 0!==a?y():(s(4,p=""),s(6,v="")))}),[l,c,d,u,p,g,v,i,n,t=>{const{from:e,to:i}=t.detail;e!==i&&"item"==e.type&&(ye.set(e.item),s(0,l=e.slot))},t=>{ye.set(),s(0,l=void 0)},()=>{i&&d&&!u&&(s(3,u=!0),f(be,a=void 0),s(5,g="Upgrading..."),s(6,v="textprimary"),Yr({id:"anvil",loop:!1,gain:!0}),setTimeout(()=>hma.chat.commands.pack("itemblacksmithupgrade",`${i.dbid}`),1e3))},a,r,o,m,y,t=>f(ve,n=!1)]}class Uw extends Pt{constructor(t){super(),Rt(this,t,Bw,zw,o,{})}}function Ow(e){let s,i,n,a,r,o=qh.ui.stats.array[e[1]]+"",l=(e[3]?"+"+pg(e[1],e[0].get(e[2]).get(e[1])):pg(e[1],e[4][e[1]]||0))+"";return{c(){s=M("span"),i=E(o),n=M("span"),a=E(l),T(n,"class",r="number "+(e[3]?"textgreen":e[0]?"textprimary":"textgreen")+" svelte-1ddmf0x")},m(t,e){$(t,s,e),k(s,i),$(t,n,e),k(n,a)},p(t,[e]){2&e&&o!==(o=qh.ui.stats.array[t[1]]+"")&&D(i,o),31&e&&l!==(l=(t[3]?"+"+pg(t[1],t[0].get(t[2]).get(t[1])):pg(t[1],t[4][t[1]]||0))+"")&&D(a,l),9&e&&r!==(r="number "+(t[3]?"textgreen":t[0]?"textprimary":"textgreen")+" svelte-1ddmf0x")&&T(n,"class",r)},i:t,o:t,d(t){t&&S(s),t&&S(n)}}}function jw(t,e,s){let i;h(t,xe,t=>s(4,i=t));let n,{relmap:a}=e,{id:r}=e,{relation:o}=e;return t.$set=(t=>{"relmap"in t&&s(0,a=t.relmap),"id"in t&&s(1,r=t.id),"relation"in t&&s(2,o=t.relation)}),t.$$.update=(()=>{7&t.$$.dirty&&s(3,n=void 0!==o&&void 0!==a.get(o).get(r))}),[a,r,o,n,i]}class Lw extends Pt{constructor(t){super(),Rt(this,t,jw,Ow,o,{relmap:0,id:1,relation:2})}}const Nw=[10,180,600,1300,2100,3200,4500,5900,7600,1e4],qw=Nw.length,Hw=t=>{for(let e=0;e<qw;++e)if(Nw[e]>t)return e;return Math.max(0,qw-1)};function Ww(t,e,s){const i=t.slice();return i[17]=e[s],i}function Qw(t,e,s){const i=t.slice();return i[14]=e[s],i}function Vw(t,e,s){const i=t.slice();return i[20]=e[s],i[22]=s,i}function Gw(t,e,s){const i=t.slice();return i[17]=e[s],i}function Yw(t){let e,s;const i=new Rf({props:{title:"Character",icon:"char",$$slots:{default:[tk]},$$scope:{ctx:t}}});return i.$on("close",t[13]),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","l-upperLeftModal container uiscaled svelte-11akou7")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,e){const s={};33554487&e&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function Xw(t){let e,s,i,n,r;const o=new Lw({props:{id:t[17]}});function l(...e){return t[12](t[17],...e)}return{c(){Mt(o.$$.fragment),(e=M("img")).src!==(s="/assets/ui/icons/arrow.svg?v=3406973")&&T(e,"src","/assets/ui/icons/arrow.svg?v=3406973"),T(e,"class",i="btn "+(t[1][21]>0?"green":"disabled")+" svgicon statbtn svelte-11akou7"),r=[P(e,"pointerenter",function(){(function(...e){return t[10](t[17],...e)}).apply(this,arguments)}),P(e,"pointerleave",function(){t[11].apply(this,arguments)}),P(e,"click",l)]},m(t,s){Et(o,t,s),$(t,e,s),n=!0},p(s,a){t=s,(!n||2&a&&i!==(i="btn "+(t[1][21]>0?"green":"disabled")+" svgicon statbtn svelte-11akou7"))&&T(e,"class",i)},i(t){n||(vt(o.$$.fragment,t),n=!0)},o(t){yt(o.$$.fragment,t),n=!1},d(t){_t(o,t),t&&S(e),a(r)}}}function Zw(t){let e;const s=new Xy({props:{descPos:"left:100%;top:0;",item:t[20],invslot:101+t[22]}});return s.$on("move",t[7]),{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};32&e&&(i.item=t[20]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Jw(t){let e;const s=new Lw({props:{id:t[17],relmap:t[6],relation:t[0]}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};1&e&&(i.relation=t[0]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function Kw(t){let e,s,i=t[14],n=[];for(let e=0;e<i.length;e+=1)n[e]=Jw(Ww(t,i,e));const a=t=>yt(n[t],1,1,()=>{n[t]=null});return{c(){e=M("div");for(let t=0;t<n.length;t+=1)n[t].c();T(e,"class","statcol panel-black svelte-11akou7")},m(t,i){$(t,e,i);for(let t=0;t<n.length;t+=1)n[t].m(e,null);s=!0},p(t,s){if(321&s){let r;for(i=t[14],r=0;r<i.length;r+=1){const a=Ww(t,i,r);n[r]?(n[r].p(a,s),vt(n[r],1)):(n[r]=Jw(a),n[r].c(),vt(n[r],1),n[r].m(e,null))}for(ft(),r=i.length;r<n.length;r+=1)a(r);gt()}},i(t){if(!s){for(let t=0;t<i.length;t+=1)vt(n[t]);s=!0}},o(t){n=n.filter(Boolean);for(let t=0;t<n.length;t+=1)yt(n[t]);s=!1},d(t){t&&S(e),C(n,t)}}}function tk(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,f,g,v,y,b,x,w,A,P,I,q,j,z,B,L,N,U,O,Q,W,V,H,Y,G,X,Z=t[4].name+"",J=t[4].level+"",K=qh.classes[t[4].class].name+"",tt=qh.factions[t[4].faction].name+"",et=(t[1][20]||0)+"",st=t[2]<qw?"/ "+Nw[t[2]]:"",it=(t[2]||"None")+"",nt=[0,1,2,3,4,5],at=[];for(let e=0;e<6;e+=1)at[e]=Xw(Gw(t,nt,e));const rt=t=>yt(at[t],1,1,()=>{at[t]=null}),ot=new Lw({props:{id:21}});let lt=t[5].filter(sk),ct=[];for(let e=0;e<lt.length;e+=1)ct[e]=Zw(Vw(t,lt,e));const ht=t=>yt(ct[t],1,1,()=>{ct[t]=null});let dt=t[8],ut=[];for(let e=0;e<dt.length;e+=1)ut[e]=Kw(Qw(t,dt,e));const mt=t=>yt(ut[t],1,1,()=>{ut[t]=null});return{c(){e=M("div"),s=M("div"),(i=M("span")).textContent="Name",n=M("span"),a=E(Z),(r=M("span")).textContent="Level",o=M("span"),l=E(J),(c=M("span")).textContent="Class",h=M("span"),d=M("img"),m=_(),f=E(K),(v=M("span")).textContent="Faction",y=M("span"),b=M("img"),w=_(),A=E(tt),(I=M("span")).textContent="Fame",q=M("span"),j=E(et),z=_(),B=E(st),(L=M("span")).textContent="Fame Rank",N=M("span"),U=M("img"),Q=_(),W=E(it),V=M("div");for(let t=0;t<6;t+=1)at[t].c();H=R(),Mt(ot.$$.fragment),Y=M("div");for(let t=0;t<ct.length;t+=1)ct[t].c();G=M("div");for(let t=0;t<ut.length;t+=1)ut[t].c();T(n,"class","textwhite"),T(o,"class","textwhite"),T(d,"class","texticon"),d.src!==(u=Vd(t[4].class))&&T(d,"src",u),T(h,"class",g=p("textc"+t[4].class)+" svelte-11akou7"),T(b,"class","texticon"),b.src!==(x=Gd(t[4].faction))&&T(b,"src",x),T(y,"class",P=p("textf"+t[4].faction)+" svelte-11akou7"),T(q,"class","textfame"),T(U,"class","texticon"),U.src!==(O="/assets/ui/icons/crown.svg?v=3406973")&&T(U,"src","/assets/ui/icons/crown.svg?v=3406973"),T(N,"class","textfame"),T(s,"class","statcol panel-black svelte-11akou7"),T(V,"id","statpoints"),T(V,"class","statcol panel-black svelte-11akou7"),F(V,"grid-template-columns","1fr auto auto"),T(e,"class","grid two"),T(Y,"id","equipslots"),T(Y,"class","items svelte-11akou7"),T(G,"class","grid three stats2 svelte-11akou7")},m(t,u){$(t,e,u),k(e,s),k(s,i),k(s,n),k(n,a),k(s,r),k(s,o),k(o,l),k(s,c),k(s,h),k(h,d),k(h,m),k(h,f),k(s,v),k(s,y),k(y,b),k(y,w),k(y,A),k(s,I),k(s,q),k(q,j),k(q,z),k(q,B),k(s,L),k(s,N),k(N,U),k(N,Q),k(N,W),k(e,V);for(let t=0;t<6;t+=1)at[t].m(V,null);k(V,H),Et(ot,V,null),$(t,Y,u);for(let t=0;t<ct.length;t+=1)ct[t].m(Y,null);$(t,G,u);for(let t=0;t<ut.length;t+=1)ut[t].m(G,null);X=!0},p(t,e){if((!X||16&e)&&Z!==(Z=t[4].name+"")&&D(a,Z),(!X||16&e)&&J!==(J=t[4].level+"")&&D(l,J),(!X||16&e&&d.src!==(u=Vd(t[4].class)))&&T(d,"src",u),(!X||16&e)&&K!==(K=qh.classes[t[4].class].name+"")&&D(f,K),(!X||16&e&&g!==(g=p("textc"+t[4].class)+" svelte-11akou7"))&&T(h,"class",g),(!X||16&e&&b.src!==(x=Gd(t[4].faction)))&&T(b,"src",x),(!X||16&e)&&tt!==(tt=qh.factions[t[4].faction].name+"")&&D(A,tt),(!X||16&e&&P!==(P=p("textf"+t[4].faction)+" svelte-11akou7"))&&T(y,"class",P),(!X||2&e)&&et!==(et=(t[1][20]||0)+"")&&D(j,et),(!X||4&e)&&st!==(st=t[2]<qw?"/ "+Nw[t[2]]:"")&&D(B,st),(!X||4&e)&&it!==(it=(t[2]||"None")+"")&&D(W,it),515&e){let s;for(nt=[0,1,2,3,4,5],s=0;s<6;s+=1){const i=Gw(t,nt,s);at[s]?(at[s].p(i,e),vt(at[s],1)):(at[s]=Xw(i),at[s].c(),vt(at[s],1),at[s].m(V,H))}for(ft(),s=6;s<6;s+=1)rt(s);gt()}if(160&e){let s;for(lt=t[5].filter(sk),s=0;s<lt.length;s+=1){const i=Vw(t,lt,s);ct[s]?(ct[s].p(i,e),vt(ct[s],1)):(ct[s]=Zw(i),ct[s].c(),vt(ct[s],1),ct[s].m(Y,null))}for(ft(),s=lt.length;s<ct.length;s+=1)ht(s);gt()}if(321&e){let s;for(dt=t[8],s=0;s<dt.length;s+=1){const i=Qw(t,dt,s);ut[s]?(ut[s].p(i,e),vt(ut[s],1)):(ut[s]=Kw(i),ut[s].c(),vt(ut[s],1),ut[s].m(G,null))}for(ft(),s=dt.length;s<ut.length;s+=1)mt(s);gt()}},i(t){if(!X){for(let t=0;t<6;t+=1)vt(at[t]);vt(ot.$$.fragment,t);for(let t=0;t<lt.length;t+=1)vt(ct[t]);for(let t=0;t<dt.length;t+=1)vt(ut[t]);X=!0}},o(t){at=at.filter(Boolean);for(let t=0;t<6;t+=1)yt(at[t]);yt(ot.$$.fragment,t),ct=ct.filter(Boolean);for(let t=0;t<ct.length;t+=1)yt(ct[t]);ut=ut.filter(Boolean);for(let t=0;t<ut.length;t+=1)yt(ut[t]);X=!1},d(t){t&&S(e),C(at,t),_t(ot),t&&S(Y),C(ct,t),t&&S(G),C(ut,t)}}}function ek(t){let e,s,i=t[3]&&Yw(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[3]?i?(i.p(t,s),vt(i,1)):((i=Yw(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}const sk=(t,e)=>e>=101;function ik(t,e,s){let i,n,a,r;h(t,xe,t=>s(1,i=t)),h(t,Je,t=>s(3,n=t)),h(t,Qt,t=>s(4,a=t)),h(t,Jt,t=>s(5,r=t));const o=new Map;if(pw.forEach((t,e)=>{const s=new Map;t.forEach((t,e)=>{s.set(e,t)}),o.set(e,s)}),qn&&qn.player){const t=qn.player.buffs.casters.get(qn.player.id);t&&t.forEach(t=>{t.logic.statsConvert&&t.logic.statsConvert.forEach(t=>{const e=pw.get(t[0])||new Map;e.set(t[2],t[1]),o.set(t[0],e)})})}let l=void 0;const c=t=>{i[21]&&(hma.chat.commands.pack("statincrease",t+" "+(ro.shift.down?10:1)),s(0,l=void 0),lf(18,50))};let d;return t.$$.update=(()=>{2&t.$$.dirty&&s(2,d=Hw(i[20]||0))}),[l,i,d,n,a,r,o,t=>{const{from:e,to:s}=t.detail;e!==s&&"item"==e.type&&hma.chat.commands.pack("itemmove",`${e.slot} ${s.slot}`)},[[6,8,7,9,12,13],[10,11,17,14,16],[15,19,18]],c,(t,e)=>s(0,l=t),t=>s(0,l=void 0),(t,e)=>c(t),()=>{f(Je,n=!1)}]}class nk extends Pt{constructor(t){super(),Rt(this,t,ik,ek,o,{})}}function ak(t,e,s){const i=t.slice();return i[9]=e[s],i}function rk(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g,v,y=t[1]?"Searching...":"Find "+(t[0].membercount<2?"party":"members"),b=t[0].exprate+"",x=0===t[0].membercount?"":"/"+t[0].nearby,w=t[0].itemfind+"",C=[],_=new Map;function A(t,e){return 0===t[0].membercount?lk:ok}let R=A(t),I=R(t),q=t[3];const j=t=>t[9].name;for(let e=0;e<q.length;e+=1){let s=ak(t,q,e),i=j(s);_.set(i,C[e]=ck(i,s))}return{c(){e=M("div"),(s=M("div")).textContent="Party",(i=M("div")).textContent="Queue",n=M("div"),r=E(y),I.c(),l=M("div"),c=E(b),h=E("% EXP"),d=E(x),u=M("div"),m=E(w),p=E("% FIND"),f=M("div");for(let t=0;t<C.length;t+=1)C[t].c();T(s,"class","btn party"),T(i,"class","btn purp"),T(n,"id","partybtn"),T(n,"class",o="btn border green "+(t[1]?"active":"")+" textwhite"),T(l,"class","btn border grey disabled textexp"),T(u,"class","btn border grey disabled textcyan"),T(e,"class","btnbar"),T(f,"class","partyframes svelte-1xmlhk"),F(f,"width",t[2]+"px"),v=[P(s,"click",t[5]),P(i,"click",t[6]),P(n,"click",t[7])]},m(t,a){$(t,e,a),k(e,s),k(e,i),k(e,n),k(n,r),I.m(e,null),k(e,l),k(l,c),k(l,h),k(l,d),k(e,u),k(u,m),k(u,p),$(t,f,a);for(let t=0;t<C.length;t+=1)C[t].m(f,null);g=!0},p(t,s){(!g||3&s)&&y!==(y=t[1]?"Searching...":"Find "+(t[0].membercount<2?"party":"members"))&&D(r,y),(!g||2&s&&o!==(o="btn border green "+(t[1]?"active":"")+" textwhite"))&&T(n,"class",o),R===(R=A(t))&&I?I.p(t,s):(I.d(1),(I=R(t))&&(I.c(),I.m(e,l))),(!g||1&s)&&b!==(b=t[0].exprate+"")&&D(c,b),(!g||1&s)&&x!==(x=0===t[0].membercount?"":"/"+t[0].nearby)&&D(d,x),(!g||1&s)&&w!==(w=t[0].itemfind+"")&&D(m,w);const i=t[3];ft(),C=St(C,s,j,1,t,i,_,f,$t,ck,null,ak),gt(),(!g||4&s)&&F(f,"width",t[2]+"px")},i(t){if(!g){for(let t=0;t<q.length;t+=1)vt(C[t]);g=!0}},o(t){for(let t=0;t<C.length;t+=1)yt(C[t]);g=!1},d(t){t&&S(e),I.d(),t&&S(f);for(let t=0;t<C.length;t+=1)C[t].d();a(v)}}}function ok(t){let e,s,i,n,a=t[0].nearby+"",r=t[0].membercount+"";return{c(){e=M("div"),s=E(a),i=E("/"),n=E(r),T(e,"class","btn border grey disabled textwhite")},m(t,a){$(t,e,a),k(e,s),k(e,i),k(e,n)},p(t,e){1&e&&a!==(a=t[0].nearby+"")&&D(s,a),1&e&&r!==(r=t[0].membercount+"")&&D(n,r)},d(t){t&&S(e)}}}function lk(e){let s;return{c(){(s=M("div")).textContent="No party",T(s,"class","btn border grey disabled textgrey")},m(t,e){$(t,s,e)},p:t,d(t){t&&S(s)}}}function ck(t,e){let s,i;const n=new _g({props:{mode:"party",unit:e[9].store,buffcount:e[4]}});return{key:t,first:null,c(){s=R(),Mt(n.$$.fragment),this.first=s},m(t,e){$(t,s,e),Et(n,t,e),i=!0},p(t,e){const s={};8&e&&(s.unit=t[9].store),16&e&&(s.buffcount=t[4]),n.$set(s)},i(t){i||(vt(n.$$.fragment,t),i=!0)},o(t){yt(n.$$.fragment,t),i=!1},d(t){t&&S(s),_t(n,t)}}}function hk(t){let e,s,i=t[0]&&rk(t);return{c(){e=M("div"),i&&i.c(),T(e,"class","l-corner-ul uiscaled")},m(t,n){$(t,e,n),i&&i.m(e,null),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),vt(i,1)):((i=rk(t)).c(),vt(i,1),i.m(e,null)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){t&&S(e),i&&i.d()}}}function dk(t,e,s){let i,n,a,r;h(t,At,t=>s(0,i=t)),h(t,vs,t=>s(2,n=t)),h(t,Ft,t=>s(3,a=t)),h(t,ws,t=>s(4,r=t));const o=()=>hma.chat.commands.pack(l?"stopqueue":"startqueue","memberfind");let l;return t.$$.update=(()=>{1&t.$$.dirty&&s(1,l=i.queues&&i.queues.indexOf("memberfind")>=0)}),[i,l,n,a,r,t=>{const e=[i.membercount?rg.partyleave():rg.partycreate()];zt.set({x:t.pageX,y:t.pageY,opts:e})},t=>{const e=[];if(0==i.membercount)e.push({css:"disabled",name:"Party required"});else for(let t in ag)if(ag[t].queue){const s=void 0===ag[t].groupsize||ag[t].groupsize===i.membercount;e.push(i.queues.indexOf(t)<0?rg.startqueue(t,s):rg.stopqueue(t,s))}zt.set({x:t.pageX,y:t.pageY,opts:e})},()=>{lf(31,100),l||0!==i.membercount?o():(hma.chat.commands.pack("partycreate",""),setTimeout(o,1e3))}]}class uk extends Pt{constructor(t){super(),Rt(this,t,dk,hk,o,{})}}function mk(t){let e;return{c(){T(e=M("div"),"class","pattern svelte-16344pz")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function pk(t){let e,s;const i=new Nf({props:{size:"0.8em",fract:t[0],barcol:"bgexp",left:t[1],right:`${t[0]}%`,$$slots:{default:[mk]},$$scope:{ctx:t}}});return{c(){e=M("div"),Mt(i.$$.fragment),T(e,"id","expbar"),T(e,"class","container svelte-16344pz")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,[e]){const s={};1&e&&(s.fract=t[0]),2&e&&(s.left=t[1]),1&e&&(s.right=`${t[0]}%`),8&e&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function fk(t,e,s){let i,n,a;return h(t,se,t=>s(2,i=t)),t.$$.update=(()=>{4&t.$$.dirty&&(s(0,n=(100*i.current/i.max).toFixed(2)),s(1,a=`${hg(i.current)} / ${hg(i.max)} EXP`))}),[n,a]}class gk extends Pt{constructor(t){super(),Rt(this,t,fk,pk,o,{})}}function vk(t){let e,s,i,n,a,r,o,l=t[5].msg+"",c=(t[5].fixed||t[5].step||t[5].fixed)&&yk(t),h=t[5].click&&bk(t);return{c(){e=M("div"),s=M("div"),c&&c.c(),i=R(),h&&h.c(),T(s,"class","textprimary msgtext svelte-1trgmuj"),T(e,"class",n="msg "+(t[5].complete?"complete":"")+" svelte-1trgmuj"),T(e,"style",a=t[5].click?"cursor:pointer;":""),o=P(e,"click",function(){t[7].apply(this,arguments)})},m(t,n){$(t,e,n),k(e,s),s.innerHTML=l,c&&c.m(e,null),k(e,i),h&&h.m(e,null),r=!0},p(o,d){t=o,(!r||32&d)&&l!==(l=t[5].msg+"")&&(s.innerHTML=l),t[5].fixed||t[5].step||t[5].fixed?c?(c.p(t,d),vt(c,1)):((c=yk(t)).c(),vt(c,1),c.m(e,i)):c&&(ft(),yt(c,1,1,()=>{c=null}),gt()),t[5].click?h?h.p(t,d):((h=bk(t)).c(),h.m(e,null)):h&&(h.d(1),h=null),(!r||32&d&&n!==(n="msg "+(t[5].complete?"complete":"")+" svelte-1trgmuj"))&&T(e,"class",n),(!r||32&d&&a!==(a=t[5].click?"cursor:pointer;":""))&&T(e,"style",a)},i(t){r||(vt(c),r=!0)},o(t){yt(c),r=!1},d(t){t&&S(e),c&&c.d(),h&&h.d(),o()}}}function yk(t){let e;const s=new Nf({props:{size:"0.8em",fract:t[5].Tf,barcol:"bgtut",left:"",right:Math.ceil(t[5].Tf)+"%"}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};32&e&&(i.fract=t[5].Tf),32&e&&(i.right=Math.ceil(t[5].Tf)+"%"),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function bk(t){let e,s,i,n,a,r=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next";return{c(){e=M("div"),(s=M("a")).textContent="Disable tutorial",i=M("div"),n=E(r),T(s,"class","textgrey"),T(i,"class","textgreen"),F(e,"display","flex"),F(e,"justify-content","space-between"),a=P(s,"click",t[6])},m(t,a){$(t,e,a),k(e,s),k(e,i),k(i,n)},p(t,e){32&e&&r!==(r=t[5].fixed||t[5].step||t[5].fixed?"Skip":"Next")&&D(n,r)},d(t){t&&S(e),a()}}}function xk(t){let e,s;return{c(){T(e=M("div"),"class",s="border skill tut "+(t[5].complete?"complete":"")+" svelte-1trgmuj"),F(e,"top",t[2]+"px"),F(e,"left",t[1]+"px"),F(e,"width",t[3]+"px"),F(e,"height",t[4]+"px")},m(t,s){$(t,e,s)},p(t,i){32&i&&s!==(s="border skill tut "+(t[5].complete?"complete":"")+" svelte-1trgmuj")&&T(e,"class",s),4&i&&F(e,"top",t[2]+"px"),2&i&&F(e,"left",t[1]+"px"),8&i&&F(e,"width",t[3]+"px"),16&i&&F(e,"height",t[4]+"px")},d(t){t&&S(e)}}}function wk(t){let e,s,i,n=t[5]&&t[5].msg&&vk(t),a=t[0]&&xk(t);return{c(){n&&n.c(),e=R(),a&&a.c(),s=R()},m(t,r){n&&n.m(t,r),$(t,e,r),a&&a.m(t,r),$(t,s,r),i=!0},p(t,[i]){t[5]&&t[5].msg?n?(n.p(t,i),vt(n,1)):((n=vk(t)).c(),vt(n,1),n.m(e.parentNode,e)):n&&(ft(),yt(n,1,1,()=>{n=null}),gt()),t[0]?a?a.p(t,i):((a=xk(t)).c(),a.m(s.parentNode,s)):a&&(a.d(1),a=null)},i(t){i||(vt(n),i=!0)},o(t){yt(n),i=!1},d(t){n&&n.d(t),t&&S(e),a&&a.d(t),t&&S(s)}}}function kk(t,e,s){let i;h(t,le,t=>s(5,i=t));let n,a,r,o,l=!1;return le.subscribe(t=>{if(t){const e=document.getElementById(t.element);if(e){s(0,l=!0);const t=e.getBoundingClientRect();s(3,r=t.width+10),s(4,o=t.height+10),s(1,n=t.x-5),s(2,a=t.y-5)}else s(0,l=!1)}else s(0,l=!1)}),[l,n,a,r,o,i,t=>ls.set(1e3),t=>{i.click&&lf(-1,100)}]}class $k extends Pt{constructor(t){super(),Rt(this,t,kk,wk,o,{})}}const Sk=async(t,e,s)=>{const i=await fetch(t,{method:void 0!==e?"POST":"GET",body:e?JSON.stringify(e):void 0});return 500===i.status?s(await i.text()):await i.json()},Ck=t=>50*Math.round((10+5*t)**1.85/50),Mk=t=>Math.min(100,8+2*t),Ek=(t,e=200)=>{let s=void 0;return(i,n)=>{s&&clearTimeout(s),s=setTimeout(e=>t(i),null==n?e:n)}};function _k(t,e,s){const i=t.slice();return i[14]=e[s],i[16]=s,i}function Rk(t){let e,s,i,n=t[1],a=[];for(let e=0;e<n.length;e+=1)a[e]=Tk(_k(t,n,e));const r=t=>yt(a[t],1,1,()=>{a[t]=null});let o=null;return n.length||(o=Pk()).c(),{c(){e=M("div");for(let t=0;t<a.length;t+=1)a[t].c();s=R(),T(e,"class","divider svelte-1pxrrpt")},m(t,n){$(t,e,n);for(let e=0;e<a.length;e+=1)a[e].m(t,n);$(t,s,n),o&&o.m(t,n),i=!0},p(t,e){if(74&e){let i;for(n=t[1],i=0;i<n.length;i+=1){const r=_k(t,n,i);a[i]?(a[i].p(r,e),vt(a[i],1)):(a[i]=Tk(r),a[i].c(),vt(a[i],1),a[i].m(s.parentNode,s))}for(ft(),i=n.length;i<a.length;i+=1)r(i);gt()}n.length?o&&(o.d(1),o=null):o||((o=Pk()).c(),o.m(s.parentNode,s))},i(t){if(!i){for(let t=0;t<n.length;t+=1)vt(a[t]);i=!0}},o(t){a=a.filter(Boolean);for(let t=0;t<a.length;t+=1)yt(a[t]);i=!1},d(t){t&&S(e),C(a,t),t&&S(s),o&&o.d(t)}}}function Pk(t){let e;return{c(){(e=M("div")).textContent="No results",T(e,"class","textgrey result svelte-1pxrrpt")},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Tk(t){let e,i,n,a;const r=[t[14]];let o={};for(let t=0;t<r.length;t+=1)o=s(o,r[t]);const l=new Jd({props:o});function c(...e){return t[13](t[16],...e)}return{c(){e=M("div"),Mt(l.$$.fragment),T(e,"class",i="result "+(t[16]===t[3]?"sel":"")+" svelte-1pxrrpt"),a=P(e,"mousedown",c)},m(t,s){$(t,e,s),Et(l,e,null),n=!0},p(s,a){t=s;const o=2&a?function(t,e){const s={},i={},n={$$scope:1};let a=t.length;for(;a--;){const r=t[a],o=e[a];if(o){for(const t in r)t in o||(i[t]=1);for(const t in o)n[t]||(s[t]=o[t],n[t]=1);t[a]=o}else for(const t in r)n[t]=1}for(const t in i)t in s||(s[t]=void 0);return s}(r,[(c=t[14],"object"==typeof c&&null!==c?c:{})]):{};var c;l.$set(o),(!n||8&a&&i!==(i="result "+(t[16]===t[3]?"sel":"")+" svelte-1pxrrpt"))&&T(e,"class",i)},i(t){n||(vt(l.$$.fragment,t),n=!0)},o(t){yt(l.$$.fragment,t),n=!1},d(t){t&&S(e),_t(l),a()}}}function Ik(t){let e,s,i,n,r,o,l=t[2]&&Rk(t);return{c(){e=M("div"),s=M("div"),i=M("input"),l&&l.c(),T(i,"placeholder","Enter player name"),T(i,"type","text"),T(i,"class","svelte-1pxrrpt"),T(s,"class",n="container input "+(t[2]?"focus":"")+" svelte-1pxrrpt"),T(e,"class","navbtn wrapper svelte-1pxrrpt"),o=[P(i,"input",t[9]),P(i,"input",t[5]),P(i,"focus",function(){t[11].apply(this,arguments)}),P(i,"blur",function(){t[12].apply(this,arguments)})]},m(n,a){$(n,e,a),k(e,s),k(s,i),A(i,t[0]),t[10](i),l&&l.m(s,null),r=!0},p(e,[a]){t=e,1&a&&i.value!==t[0]&&A(i,t[0]),t[2]?l?(l.p(t,a),vt(l,1)):((l=Rk(t)).c(),vt(l,1),l.m(s,null)):l&&(ft(),yt(l,1,1,()=>{l=null}),gt()),(!r||4&a&&n!==(n="container input "+(t[2]?"focus":"")+" svelte-1pxrrpt"))&&T(s,"class",n)},i(t){r||(vt(l),r=!0)},o(t){yt(l),r=!1},d(s){s&&S(e),t[10](null),l&&l.d(),a(o)}}}function Dk(t,e,s){const i=Ek(async()=>{s(1,o=await Sk("api/playerinfo/search",{name:r,order:"name"})),h(o.findIndex(t=>t.name.toLowerCase()==r.toLowerCase()))});let n,a,{name:r=""}=e,o=[],l=!1,c=-1;const h=t=>{s(3,c=t),c>=0&&(n=o[c],s(0,r=n.name))},d=t=>{t.target==a&&(38!==t.keyCode&&40!==t.keyCode||!o.length?13!=t.keyCode&&27!=t.keyCode||a.blur():(h(na(c+(38===t.keyCode?-1:1),o.length)),t.preventDefault()))};return G(()=>{document.addEventListener("keydown",d)}),X(()=>{document.removeEventListener("keydown",d),s(4,a=void 0)}),t.$set=(t=>{"name"in t&&s(0,r=t.name)}),[r,o,l,c,a,i,h,n,d,function(){r=this.value,s(0,r)},function(t){tt[t?"unshift":"push"](()=>{s(4,a=t)})},t=>s(2,l=!0),t=>s(2,l=!1),(t,e)=>h(t)]}class Ak extends Pt{constructor(t){super(),Rt(this,t,Dk,Ik,o,{name:0})}}function Fk(t,e,s){const i=t.slice();return i[24]=e[s],i[23]=s,i}function zk(t,e,s){const i=t.slice();return i[21]=e[s],i[23]=s,i}function Bk(t,e,s){const i=t.slice();return i[26]=e[s],i[23]=s,i}function Uk(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,C,_,A,I,q,j,F,z,B,L,N,U,O,Q,W,V,H,Y,G,X,Z,J,K,tt,et,st,it,nt,at,rt,ot,lt,ct,ht=t[0].tag+"",dt=t[0].name+"",ut=qh.factions[t[0].faction].name+"",mt=t[0].level+"",pt=Mk(t[0].level)+"",bt=Mk(t[0].level+1)-Mk(t[0].level)+"",kt=t[0].tax+"",xt=t[0].members.length+"",$t=`${t[0].online} (+${60*t[0].online} EXP/h)`+"",wt=t[0].fame+"";const St=new Nf({props:{size:"1em",fract:Math.ceil(t[0].exp/Ck(t[0].level)*100),barcol:"bgpurp",left:`${t[0].exp} / ${Ck(t[0].level)}`,right:`${Math.ceil(t[0].exp/Ck(t[0].level)*100)}%`}}),Ct=new jv({props:{amount:t[0].gold}});let Tt=t[0].role>-1&&Ok(t),At=t[0].role>0&&jk(t),Rt=t[0].eligibleApply.length>0&&Lk(t),Pt=t[1]&&qk(t),It=t[0].role>0&&Hk(t);const Dt=[Qk,Wk],qt=[];function jt(t,e){return"members"==t[6]?0:"applications"==t[6]?1:-1}return~(at=jt(t))&&(rt=qt[at]=Dt[at](t)),{c(){e=M("div"),s=M("img"),n=M("div"),a=M("div"),r=M("h1"),o=E(ht),l=M("h3"),c=E(dt),d=M("p"),u=E(ut),m=E(" Clan"),p=M("div"),Mt(St.$$.fragment),f=M("div"),g=M("div"),v=M("div"),(y=M("span")).textContent="Clan Level",b=M("span"),x=E(mt),(w=M("span")).textContent="Capacity",C=M("span"),_=E(pt),(A=M("span")).textContent="Next Level",I=M("span"),q=E("+"),j=E(bt),F=E(" Capacity"),(z=M("span")).textContent="Tax rate",B=M("span"),L=E(kt),N=E("%"),U=M("div"),O=M("div"),(Q=M("span")).textContent="Members",W=M("span"),V=E(xt),(H=M("span")).textContent="Online",Y=M("span"),G=E($t),(X=M("span")).textContent="Fame",Z=M("span"),J=E(wt),(K=M("span")).textContent="Treasury",Mt(Ct.$$.fragment),Tt&&Tt.c(),tt=R(),At&&At.c(),et=R(),Rt&&Rt.c(),st=R(),Pt&&Pt.c(),it=M("div"),(nt=M("div")).textContent="Members",It&&It.c(),rt&&rt.c(),ot=R(),T(s,"class","helmet absCentered svelte-6t8hqd"),s.src!==(i="/assets/ui/factions/"+t[0].faction+".svg?v=3406973")&&T(s,"src",i),T(a,"class",h="textf"+t[0].faction+" svelte-6t8hqd"),T(n,"class","textcenter"),T(e,"class","hero svelte-6t8hqd"),T(p,"class","panel-black svelte-6t8hqd"),T(y,"class","textprimary"),T(w,"class","textprimary"),T(A,"class","textprimary"),T(z,"class","textprimary"),T(v,"class","panel-black grid two svelte-6t8hqd"),T(Q,"class","textprimary"),T(H,"class","textprimary"),T(X,"class","textprimary"),T(K,"class","textprimary"),T(O,"class","panel-black grid two svelte-6t8hqd"),T(f,"class","marg-top grid two"),T(nt,"class","btn navbtn grey"),T(it,"class","subnav"),ct=P(nt,"click",function(){t[17].apply(this,arguments)})},m(t,i){$(t,e,i),k(e,s),k(e,n),k(n,a),k(a,r),k(r,o),k(a,l),k(l,c),k(n,d),k(d,u),k(d,m),$(t,p,i),Et(St,p,null),$(t,f,i),k(f,g),k(g,v),k(v,y),k(v,b),k(b,x),k(v,w),k(v,C),k(C,_),k(v,A),k(v,I),k(I,q),k(I,j),k(I,F),k(v,z),k(v,B),k(B,L),k(B,N),k(f,U),k(U,O),k(O,Q),k(O,W),k(W,V),k(O,H),k(O,Y),k(Y,G),k(O,X),k(O,Z),k(Z,J),k(O,K),Et(Ct,O,null),Tt&&Tt.m(t,i),$(t,tt,i),At&&At.m(t,i),$(t,et,i),Rt&&Rt.m(t,i),$(t,st,i),Pt&&Pt.m(t,i),$(t,it,i),k(it,nt),It&&It.m(it,null),~at&&qt[at].m(t,i),$(t,ot,i),lt=!0},p(e,n){t=e,(!lt||1&n&&s.src!==(i="/assets/ui/factions/"+t[0].faction+".svg?v=3406973"))&&T(s,"src",i),(!lt||1&n)&&ht!==(ht=t[0].tag+"")&&D(o,ht),(!lt||1&n)&&dt!==(dt=t[0].name+"")&&D(c,dt),(!lt||1&n&&h!==(h="textf"+t[0].faction+" svelte-6t8hqd"))&&T(a,"class",h),(!lt||1&n)&&ut!==(ut=qh.factions[t[0].faction].name+"")&&D(u,ut);const r={};1&n&&(r.fract=Math.ceil(t[0].exp/Ck(t[0].level)*100)),1&n&&(r.left=`${t[0].exp} / ${Ck(t[0].level)}`),1&n&&(r.right=`${Math.ceil(t[0].exp/Ck(t[0].level)*100)}%`),St.$set(r),(!lt||1&n)&&mt!==(mt=t[0].level+"")&&D(x,mt),(!lt||1&n)&&pt!==(pt=Mk(t[0].level)+"")&&D(_,pt),(!lt||1&n)&&bt!==(bt=Mk(t[0].level+1)-Mk(t[0].level)+"")&&D(j,bt),(!lt||1&n)&&kt!==(kt=t[0].tax+"")&&D(L,kt),(!lt||1&n)&&xt!==(xt=t[0].members.length+"")&&D(V,xt),(!lt||1&n)&&$t!==($t=`${t[0].online} (+${60*t[0].online} EXP/h)`+"")&&D(G,$t),(!lt||1&n)&&wt!==(wt=t[0].fame+"")&&D(J,wt);const l={};1&n&&(l.amount=t[0].gold),Ct.$set(l),t[0].role>-1?Tt?Tt.p(t,n):((Tt=Ok(t)).c(),Tt.m(tt.parentNode,tt)):Tt&&(Tt.d(1),Tt=null),t[0].role>0?At?(At.p(t,n),vt(At,1)):((At=jk(t)).c(),vt(At,1),At.m(et.parentNode,et)):At&&(ft(),yt(At,1,1,()=>{At=null}),gt()),t[0].eligibleApply.length>0?Rt?Rt.p(t,n):((Rt=Lk(t)).c(),Rt.m(st.parentNode,st)):Rt&&(Rt.d(1),Rt=null),t[1]?Pt?Pt.p(t,n):((Pt=qk(t)).c(),Pt.m(it.parentNode,it)):Pt&&(Pt.d(1),Pt=null),t[0].role>0?It?It.p(t,n):((It=Hk(t)).c(),It.m(it,null)):It&&(It.d(1),It=null);let d=at;(at=jt(t))===d?~at&&qt[at].p(t,n):(rt&&(ft(),yt(qt[d],1,1,()=>{qt[d]=null}),gt()),~at?((rt=qt[at])||(rt=qt[at]=Dt[at](t)).c(),vt(rt,1),rt.m(ot.parentNode,ot)):rt=null)},i(t){lt||(vt(St.$$.fragment,t),vt(Ct.$$.fragment,t),vt(At),vt(rt),lt=!0)},o(t){yt(St.$$.fragment,t),yt(Ct.$$.fragment,t),yt(At),yt(rt),lt=!1},d(t){t&&S(e),t&&S(p),_t(St),t&&S(f),_t(Ct),Tt&&Tt.d(t),t&&S(tt),At&&At.d(t),t&&S(et),Rt&&Rt.d(t),t&&S(st),Pt&&Pt.d(t),t&&S(it),It&&It.d(),~at&&qt[at].d(t),t&&S(ot),ct()}}}function Ok(t){let e,s,i,n,a=qh.ui.clan.roles[t[0].role]+"";return{c(){e=M("div"),(s=M("span")).textContent="Your highest rank: ",i=M("span"),n=E(a),T(s,"class","textprimary"),T(i,"class","textgreen"),T(e,"class","marg-top panel-black svelte-6t8hqd")},m(t,a){$(t,e,a),k(e,s),k(e,i),k(i,n)},p(t,e){1&e&&a!==(a=qh.ui.clan.roles[t[0].role]+"")&&D(n,a)},d(t){t&&S(e)}}}function jk(t){let e,s,i,n,a,r,o,l,c;function h(e){t[15].call(null,e)}let d={};void 0!==t[4]&&(d.name=t[4]);const u=new Ak({props:d});return tt.push(()=>Ct(u,"name",h)),{c(){e=M("div"),(s=M("span")).textContent="Invite players",i=M("div"),Mt(u.$$.fragment),a=M("div"),r=E("Invite player"),T(s,"class","textgrey"),T(a,"class",o="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")),T(i,"class","subnav"),T(e,"class","marg-top panel-black svelte-6t8hqd"),c=P(a,"click",t[8])},m(t,n){$(t,e,n),k(e,s),k(e,i),Et(u,i,null),k(i,a),k(a,r),l=!0},p(t,e){const s={};!n&&16&e&&(n=!0,s.name=t[4],lt(()=>n=!1)),u.$set(s),(!l||24&e&&o!==(o="btn formatted navbtn grey "+(t[3]||!t[4].length?"disabled":"")))&&T(a,"class",o)},i(t){l||(vt(u.$$.fragment,t),l=!0)},o(t){yt(u.$$.fragment,t),l=!1},d(t){t&&S(e),_t(u),c()}}}function Lk(t){let e,s,i,n,r,o,l,c,h=t[0].eligibleApply,d=[];for(let e=0;e<h.length;e+=1)d[e]=Nk(Bk(t,h,e));return{c(){e=M("div"),(s=M("span")).textContent="Apply to clan (request invitation)",i=M("div"),n=M("select");for(let t=0;t<d.length;t+=1)d[t].c();r=M("div"),o=E("Apply"),T(s,"class","textgrey"),T(n,"class","navbtn"),void 0===t[5]&&ot(()=>t[16].call(n)),T(r,"class",l="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":"")),T(i,"class","subnav"),T(e,"class","marg-top panel-black svelte-6t8hqd"),c=[P(n,"change",t[16]),P(r,"click",t[9])]},m(a,l){$(a,e,l),k(e,s),k(e,i),k(i,n);for(let t=0;t<d.length;t+=1)d[t].m(n,null);z(n,t[5]),k(i,r),k(r,o)},p(t,e){if(33&e){let s;for(h=t[0].eligibleApply,s=0;s<h.length;s+=1){const i=Bk(t,h,s);d[s]?d[s].p(i,e):(d[s]=Nk(i),d[s].c(),d[s].m(n,null))}for(;s<d.length;s+=1)d[s].d(1);d.length=h.length}32&e&&z(n,t[5]),40&e&&l!==(l="btn formatted navbtn grey "+(t[3]||!t[5].length?"disabled":""))&&T(r,"class",l)},d(t){t&&S(e),C(d,t),a(c)}}}function Nk(t){let e,s,i,n,a=t[26]+"";return{c(){e=M("option"),s=E(a),e.selected=i=t[5]==t[26],e.__value=n=t[26],e.value=e.__value},m(t,i){$(t,e,i),k(e,s)},p(t,r){1&r&&a!==(a=t[26]+"")&&D(s,a),33&r&&i!==(i=t[5]==t[26])&&(e.selected=i),1&r&&n!==(n=t[26])&&(e.__value=n),e.value=e.__value},d(t){t&&S(e)}}}function qk(t){let e,s,i,n,a;return{c(){e=M("div"),s=M("span"),i=E(t[1]),T(s,"class",n="text"+t[2]+" svelte-6t8hqd"),T(e,"class",a="marg-top panel-black border "+t[2]+" svelte-6t8hqd")},m(t,n){$(t,e,n),k(e,s),k(s,i)},p(t,r){2&r&&D(i,t[1]),4&r&&n!==(n="text"+t[2]+" svelte-6t8hqd")&&T(s,"class",n),4&r&&a!==(a="marg-top panel-black border "+t[2]+" svelte-6t8hqd")&&T(e,"class",a)},d(t){t&&S(e)}}}function Hk(t){let e,s,i,n,a,r,o=t[0].applications.length+"";return{c(){e=M("div"),s=E("Applications ("),i=E(o),n=E(")"),a=_(),T(e,"class","btn navbtn grey"),r=P(e,"click",function(){t[18].apply(this,arguments)})},m(t,r){$(t,e,r),k(e,s),k(e,i),k(e,n),$(t,a,r)},p(e,s){t=e,1&s&&o!==(o=t[0].applications.length+"")&&D(i,o)},d(t){t&&S(e),t&&S(a),r()}}}function Wk(t){let e,s,i,n,a,r=[],o=new Map,l=t[0].applications;const c=t=>t[24].name;for(let e=0;e<l.length;e+=1){let s=Fk(t,l,e),i=c(s);o.set(i,r[e]=Vk(i,s))}return{c(){(e=M("div")).textContent="This is a list of active applications to your clan. Right click to accept an application and invite the player to your clan",s=M("table"),(i=M("thead")).innerHTML='<tr class="textprimary"><th width="70%">Player</th></tr>',n=M("tbody");for(let t=0;t<r.length;t+=1)r[t].c();T(e,"class","marg-top textgrey"),T(s,"class","marg-top panel-black svelte-6t8hqd")},m(t,o){$(t,e,o),$(t,s,o),k(s,i),k(s,n);for(let t=0;t<r.length;t+=1)r[t].m(n,null);a=!0},p(t,e){const s=t[0].applications;ft(),r=St(r,e,c,1,t,s,o,n,$t,Vk,null,Fk),gt()},i(t){if(!a){for(let t=0;t<l.length;t+=1)vt(r[t]);a=!0}},o(t){for(let t=0;t<r.length;t+=1)yt(r[t]);a=!1},d(t){t&&S(e),t&&S(s);for(let t=0;t<r.length;t+=1)r[t].d()}}}function Qk(t){let e,s,i,n,a,r=[],o=new Map,l=t[0].members;const c=t=>t[21].name;for(let e=0;e<l.length;e+=1){let s=zk(t,l,e),i=c(s);o.set(i,r[e]=Gk(i,s))}return{c(){(e=M("div")).textContent="This is a list of active members of this clan. Right click the members for additional options.",s=M("table"),(i=M("thead")).innerHTML='<tr class="textprimary"><th width="70%">Member</th><th>Rank</th></tr>',n=M("tbody");for(let t=0;t<r.length;t+=1)r[t].c();T(e,"class","marg-top textgrey"),T(s,"class","marg-top panel-black svelte-6t8hqd")},m(t,o){$(t,e,o),$(t,s,o),k(s,i),k(s,n);for(let t=0;t<r.length;t+=1)r[t].m(n,null);a=!0},p(t,e){const s=t[0].members;ft(),r=St(r,e,c,1,t,s,o,n,$t,Gk,null,zk),gt()},i(t){if(!a){for(let t=0;t<l.length;t+=1)vt(r[t]);a=!0}},o(t){for(let t=0;t<r.length;t+=1)yt(r[t]);a=!1},d(t){t&&S(e),t&&S(s);for(let t=0;t<r.length;t+=1)r[t].d()}}}function Vk(t,e){let s,i,n,a;const r=new Jd({props:{name:e[24].name,pclass:e[24].class,level:e[24].level,faction:e[0].faction}});return{key:t,first:null,c(){s=M("tr"),i=M("td"),Mt(r.$$.fragment),T(s,"class","striped"),a=P(s,"mousedown",function(){(function(...t){return e[20](e[24],...t)}).apply(this,arguments)}),this.first=s},m(t,e){$(t,s,e),k(s,i),Et(r,i,null),n=!0},p(t,s){e=t;const i={};1&s&&(i.name=e[24].name),1&s&&(i.pclass=e[24].class),1&s&&(i.level=e[24].level),1&s&&(i.faction=e[0].faction),r.$set(i)},i(t){n||(vt(r.$$.fragment,t),n=!0)},o(t){yt(r.$$.fragment,t),n=!1},d(t){t&&S(s),_t(r),a()}}}function Gk(t,e){let s,i,n,a,r,o,l,c,h,d,u=e[21].online?"⬤":"",m=e[21].owned?"⭐":"",p=qh.ui.clan.roles[e[21].clanrole]+"";const f=new Jd({props:{name:e[21].name,pclass:e[21].class,level:e[21].level,faction:e[0].faction}});return{key:t,first:null,c(){s=M("tr"),i=M("td"),Mt(f.$$.fragment),n=M("span"),a=E(u),r=E(m),o=M("td"),l=E(p),T(n,"class","textgreen"),T(s,"class",c="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"),d=P(s,"mousedown",function(){(function(...t){return e[19](e[21],...t)}).apply(this,arguments)}),this.first=s},m(t,e){$(t,s,e),k(s,i),Et(f,i,null),k(i,n),k(n,a),k(n,r),k(s,o),k(o,l),h=!0},p(t,i){e=t;const n={};1&i&&(n.name=e[21].name),1&i&&(n.pclass=e[21].class),1&i&&(n.level=e[21].level),1&i&&(n.faction=e[0].faction),f.$set(n),(!h||1&i)&&u!==(u=e[21].online?"⬤":"")&&D(a,u),(!h||1&i)&&m!==(m=e[21].owned?"⭐":"")&&D(r,m),(!h||1&i)&&p!==(p=qh.ui.clan.roles[e[21].clanrole]+"")&&D(l,p),(!h||1&i&&c!==(c="striped "+(e[21].online?"":"offline")+" svelte-6t8hqd"))&&T(s,"class",c)},i(t){h||(vt(f.$$.fragment,t),h=!0)},o(t){yt(f.$$.fragment,t),h=!1},d(t){t&&S(s),_t(f),d()}}}function Yk(t){let e,s,i=t[0]&&Uk(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[0]?i?(i.p(t,s),vt(i,1)):((i=Uk(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function Xk(t,e,s){let i,n,{tag:a}=e;const r=async()=>{const t=await Sk("/api/claninfo/info",{tag:a});t.name&&(s(0,i=t),i.eligibleApply.length&&s(5,m=i.eligibleApply[0]),s(0,i.online=i.members.filter(t=>t.online).length,i)),n&&(clearTimeout(n),n=setTimeout(r,5e3))};n=!0,r(),X(()=>{clearTimeout(n),n=void 0});const o=(t,e)=>{const s=[];e.owned?s.push({name:"Leave clan",fun:async()=>{d(await Sk("/api/clan/leave",{name:e.name}),"Left the clan")}}):e.clanrole<i.role&&s.push({name:"Kick member",fun:async()=>{d(await Sk("/api/clan/kick",{name:e.name}),"Member kicked")}});for(let t=0;t<(3==i.role?4:i.role);t++)s.push({name:"Set rank: "+qh.ui.clan.roles[t],fun:async()=>{d(await Sk("/api/clan/setrole",{name:e.name,role:t}),"Set rank: "+qh.ui.clan.roles[t])}});zt.set({x:t.pageX,y:t.pageY,opts:s})};let l,c,h=!1;const d=async(t,e)=>{"ok"!==t.result?(s(1,l=t.result),s(2,c="red")):(s(1,l=e),s(2,c="green")),await r(),s(3,h=!1)};let u="",m="";const p=(t,e)=>{const s=[];i.role>0&&s.push({name:"Accept application",fun:async()=>{d(await Sk("/api/clan/acceptapplication",{id:e.id}),"Accepted application")}}),i.role>1&&s.push({name:"Deny application",fun:async()=>{d(await Sk("/api/clan/denyapplication",{id:e.id}),"Denied application")}}),zt.set({x:t.pageX,y:t.pageY,opts:s})};let f="members";return t.$set=(t=>{"tag"in t&&s(11,a=t.tag)}),[i,l,c,h,u,m,f,o,async()=>{s(3,h=!0),d(await Sk("/api/clan/invite",{name:u,tag:a}),u+" invited"),s(4,u="")},async()=>{s(3,h=!0),d(await Sk("/api/clan/apply",{name:m,tag:a}),"Applied to clan"),s(5,m="")},p,a,n,r,d,function(t){s(4,u=t)},function(){m=B(this),s(5,m),s(0,i)},t=>s(6,f="members"),t=>s(6,f="applications"),(t,e)=>o(e,t),(t,e)=>p(e,t)]}class Zk extends Pt{constructor(t){super(),Rt(this,t,Xk,Yk,o,{tag:11})}}function Jk(t){let e,s,i,n,r,o,l,c,h,d,u,m,p,f,g;const v=new jv({props:{amount:1e4}});return{c(){(e=M("h3")).textContent="Create clan",(s=M("label")).textContent="Clan name",i=M("input"),(n=M("label")).textContent="Clan tag",r=M("input"),o=M("p"),l=E("Cost: "),Mt(v.$$.fragment),h=M("div"),d=E(t[2]),u=M("div"),m=E("Create"),T(e,"class","textprimary"),T(s,"class","svelte-7uvqsx"),T(i,"type","text"),T(i,"placeholder","Guardians of Guardstone (a-Z)"),T(i,"maxlength","20"),T(n,"class","svelte-7uvqsx"),T(r,"type","text"),T(r,"placeholder","GoG (a-Z !~=#*+-)"),T(r,"maxlength","4"),T(o,"class",c="text"+(t[4]>1e4?"primary":"red")),T(h,"class","textred"),F(u,"display","inline-block"),T(u,"class",p="btn marg-top formatted "+(t[3]?"blue":"blue disabled")),g=[P(i,"input",t[7]),P(r,"input",t[8]),P(u,"click",t[5])]},m(a,c){$(a,e,c),$(a,s,c),$(a,i,c),A(i,t[0]),$(a,n,c),$(a,r,c),A(r,t[1]),$(a,o,c),k(o,l),Et(v,o,null),$(a,h,c),k(h,d),$(a,u,c),k(u,m),f=!0},p(t,[e]){1&e&&i.value!==t[0]&&A(i,t[0]),2&e&&r.value!==t[1]&&A(r,t[1]),(!f||16&e&&c!==(c="text"+(t[4]>1e4?"primary":"red")))&&T(o,"class",c),(!f||4&e)&&D(d,t[2]),(!f||8&e&&p!==(p="btn marg-top formatted "+(t[3]?"blue":"blue disabled")))&&T(u,"class",p)},i(t){f||(vt(v.$$.fragment,t),f=!0)},o(t){yt(v.$$.fragment,t),f=!1},d(t){t&&S(e),t&&S(s),t&&S(i),t&&S(n),t&&S(r),t&&S(o),_t(v),t&&S(h),t&&S(u),a(g)}}}function Kk(t,e,s){let i;h(t,Xt,t=>s(4,i=t));let n,a="",r="",o=!1,l="";return t.$$.update=(()=>{83&t.$$.dirty&&s(3,n=!o&&i>=1e4&&a.length<=20&&a.length>=3&&r.length<=4&&r.length>=2)}),[a,r,l,n,i,async()=>{if(o)return;s(6,o=!0);const t=await Sk("/api/clan/create",{name:a,tag:r});"ok"!==t.result&&(s(2,l=t.result),s(6,o=!1))},o,function(){a=this.value,s(0,a)},function(){r=this.value,s(1,r)}]}class t$ extends Pt{constructor(t){super(),Rt(this,t,Kk,Jk,o,{})}}function e$(t,e,s){const i=t.slice();return i[4]=e[s],i[6]=s,i}function s$(t){let e,s=[],i=new Map,n=t[0];const a=t=>t[4].clan;for(let e=0;e<n.length;e+=1){let r=e$(t,n,e),o=a(r);i.set(o,s[e]=a$(o,r))}return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=R()},m(t,i){for(let e=0;e<s.length;e+=1)s[e].m(t,i);$(t,e,i)},p(t,n){const r=t[0];s=St(s,n,a,1,t,r,i,e.parentNode,kt,a$,e,e$)},d(t){for(let e=0;e<s.length;e+=1)s[e].d(t);t&&S(e)}}}function i$(t){let e,s;return{c(){(e=M("div")).textContent="Accept",T(e,"class","btn blue"),s=P(e,"click",function(){(function(...e){return t[3](t[4],...e)}).apply(this,arguments)})},m(t,s){$(t,e,s)},p(e,s){t=e},d(t){t&&S(e),s()}}}function n$(e){let s;return{c(){(s=M("div")).textContent="Application"},m(t,e){$(t,s,e)},p:t,d(t){t&&S(s)}}}function a$(t,e){let s,i,n,a,r,o,l=e[4].tag+"",c=e[4].name+"";function h(t,e){return t[4].request?n$:i$}let d=h(e),u=d(e);return{key:t,first:null,c(){s=M("tr"),i=M("td"),n=E(l),a=M("td"),r=E(c),o=M("td"),u.c(),T(s,"class","striped"),this.first=s},m(t,e){$(t,s,e),k(s,i),k(i,n),k(s,a),k(a,r),k(s,o),u.m(o,null)},p(t,e){1&e&&l!==(l=t[4].tag+"")&&D(n,l),1&e&&c!==(c=t[4].name+"")&&D(r,c),d===(d=h(t))&&u?u.p(t,e):(u.d(1),(u=d(t))&&(u.c(),u.m(o,null)))},d(t){t&&S(s),u.d()}}}function r$(e){let s,i,n,a=e[0]&&s$(e);return{c(){s=M("table"),(i=M("thead")).innerHTML='<tr class="textprimary"><th width="20%">Tag</th><th width="60%">Clan Name</th><th>Action</th></tr>',n=M("tbody"),a&&a.c(),T(s,"class","marg-top panel-black")},m(t,e){$(t,s,e),k(s,i),k(s,n),a&&a.m(n,null)},p(t,[e]){t[0]?a?a.p(t,e):((a=s$(t)).c(),a.m(n,null)):a&&(a.d(1),a=null)},i:t,o:t,d(t){t&&S(s),a&&a.d()}}}function o$(t,e,s){let i;const n=async()=>{s(0,i=await Sk("/api/clan/invites",{name:qn.player.name}))};n();const a=async t=>{await Sk("/api/clan/acceptinvite",{id:t})};return[i,a,n,(t,e)=>a(t.id)]}class l$ extends Pt{constructor(t){super(),Rt(this,t,o$,r$,o,{})}}function c$(t){let e,s;const i=new Rf({props:{title:"Clan",icon:"clan",scroll:"true",$$slots:{default:[f$]},$$scope:{ctx:t}}});return i.$on("close",t[6]),{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","absCentered container svelte-9et4uw")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,e){const s={};133&e&&(s.$$scope={dirty:e,ctx:t}),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function h$(e){let s,i,n,r,o,l;return{c(){s=M("div"),i=M("div"),(n=M("h3")).textContent="You have no clan",(r=M("div")).textContent="View invitations",(o=M("div")).textContent="Create clan",T(r,"class","btn grey"),T(o,"class","btn grey marg-top"),T(i,"class","panel-black"),T(s,"class","clanInfoBox textcenter svelte-9et4uw"),l=[P(r,"click",function(){e[4].apply(this,arguments)}),P(o,"click",function(){e[5].apply(this,arguments)})]},m(t,e){$(t,s,e),k(s,i),k(i,n),k(i,r),k(i,o)},p(t,s){e=t},i:t,o:t,d(t){t&&S(s),a(l)}}}function d$(t){let e,s,i,n,a,r;const o=[p$,m$],l=[];function c(t,e){return"create"==t[0]?0:"invites"==t[0]?1:-1}return~(i=c(t))&&(n=l[i]=o[i](t)),{c(){e=M("div"),(s=M("div")).textContent="Back",n&&n.c(),F(s,"display","inline-block"),T(s,"class","btn formatted grey"),T(e,"class","modemenu svelte-9et4uw"),r=P(s,"click",function(){t[3].apply(this,arguments)})},m(t,n){$(t,e,n),k(e,s),~i&&l[i].m(e,null),a=!0},p(s,a){let r=i;(i=c(t=s))!==r&&(n&&(ft(),yt(l[r],1,1,()=>{l[r]=null}),gt()),~i?((n=l[i])||(n=l[i]=o[i](t)).c(),vt(n,1),n.m(e,null)):n=null)},i(t){a||(vt(n),a=!0)},o(t){yt(n),a=!1},d(t){t&&S(e),~i&&l[i].d(),r()}}}function u$(t){let e,s;const i=new Zk({props:{tag:t[2]}});return{c(){e=M("div"),Mt(i.$$.fragment),T(e,"class","clanView svelte-9et4uw")},m(t,n){$(t,e,n),Et(i,e,null),s=!0},p(t,e){const s={};4&e&&(s.tag=t[2]),i.$set(s)},i(t){s||(vt(i.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),s=!1},d(t){t&&S(e),_t(i)}}}function m$(t){let e;const s=new l$({});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function p$(t){let e;const s=new t$({});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function f$(t){let e,s,i,n;const a=[u$,d$,h$],r=[];function o(t,e){return t[2]?0:t[0]?1:2}return e=o(t),s=r[e]=a[e](t),{c(){s.c(),i=R()},m(t,s){r[e].m(t,s),$(t,i,s),n=!0},p(t,n){let l=e;(e=o(t))===l?r[e].p(t,n):(ft(),yt(r[l],1,1,()=>{r[l]=null}),gt(),(s=r[e])||(s=r[e]=a[e](t)).c(),vt(s,1),s.m(i.parentNode,i))},i(t){n||(vt(s),n=!0)},o(t){yt(s),n=!1},d(t){r[e].d(t),t&&S(i)}}}function g$(t){let e,s,i=t[1]&&c$(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[1]?i?(i.p(t,s),vt(i,1)):((i=c$(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function v$(t,e,s){let i,n;h(t,Xe,t=>s(1,i=t)),h(t,ke,t=>s(2,n=t));let a=!1;return[a,i,n,t=>s(0,a=!1),t=>s(0,a="invites"),t=>s(0,a="create"),()=>{f(Xe,i=!1)}]}class y$ extends Pt{constructor(t){super(),Rt(this,t,v$,g$,o,{})}}function b$(t){let e,s,i,n,a,r,o,l,c,h,d,u,m=t[0].name+"",f=(void 0!==t[0].level?`Lv. ${t[0].level} `:"")+"",g=(void 0!==t[0].class?qh.classes[t[0].class].name:"Item")+"",v=(void 0!==t[0].faction?qh.factions[t[0].faction].name:"")+"";return{c(){e=M("div"),s=M("div"),i=E(m),n=M("div"),a=M("span"),r=E(f),o=M("span"),l=E(g),h=M("span"),d=E(v),T(s,"class","textwhite title svelte-1wip79f"),T(o,"class",c=p(void 0!==t[0].class?"textc"+t[0].class:"textyellow")+" svelte-1wip79f"),T(h,"class",u=p(void 0!==t[0].faction?"textf"+t[0].faction:"")+" svelte-1wip79f"),T(e,"class","panel-black container svelte-1wip79f"),F(e,"display",t[1]?"block":"none")},m(t,c){$(t,e,c),k(e,s),k(s,i),k(e,n),k(n,a),k(a,r),k(n,o),k(o,l),k(e,h),k(h,d)},p(t,s){1&s&&m!==(m=t[0].name+"")&&D(i,m),1&s&&f!==(f=(void 0!==t[0].level?`Lv. ${t[0].level} `:"")+"")&&D(r,f),1&s&&g!==(g=(void 0!==t[0].class?qh.classes[t[0].class].name:"Item")+"")&&D(l,g),1&s&&c!==(c=p(void 0!==t[0].class?"textc"+t[0].class:"textyellow")+" svelte-1wip79f")&&T(o,"class",c),1&s&&v!==(v=(void 0!==t[0].faction?qh.factions[t[0].faction].name:"")+"")&&D(d,v),1&s&&u!==(u=p(void 0!==t[0].faction?"textf"+t[0].faction:"")+" svelte-1wip79f")&&T(h,"class",u),2&s&&F(e,"display",t[1]?"block":"none")},d(t){t&&S(e)}}}function x$(e){let s,i=e[0]&&b$(e);return{c(){i&&i.c(),s=R()},m(t,e){i&&i.m(t,e),$(t,s,e)},p(t,[e]){t[0]?i?i.p(t,e):((i=b$(t)).c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},i:t,o:t,d(t){i&&i.d(t),t&&S(s)}}}function w$(t,e,s){let i,n;return h(t,re,t=>s(1,i=t)),t.$$.update=(()=>{2&t.$$.dirty&&i>0&&qn.isEntityIdTaken(i)&&s(0,n=qn.entity(i))}),[n,i]}class k$ extends Pt{constructor(t){super(),Rt(this,t,w$,x$,o,{})}}const $$=$e,S$=async t=>{const e=await Sk("/api/account/info");$$.set(e),Zt.set(e.storepoints),t&&t(e)};function C$(e){let s,i,n,a,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,C,A,R,P,I,D,q,j,F,z,B,L,N,U,O,Q,W,V,H;return{c(){s=M("div"),(i=M("div")).innerHTML='<img class="artwork svelte-cbx1m" src="/assets/ui/elixir.svg?v=3406973"><div class="sparkle svelte-cbx1m" style="font-size:35px; left:30%; top:30%; animation-delay: -1s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:50px; left:40%; top:60%; animation-delay: -2s;">+</div><div class="sparkle svelte-cbx1m" style="font-size:80px; left:60%; top:20%; animation-delay: -3s;">+</div>',n=M("div"),(a=M("h1")).innerHTML='Hordes <span class="textsub">Elixir</span>',(r=M("div")).innerHTML='<img class="svgicon" src="/assets/ui/icons/gem.svg?v=3406973"> Chat supporter icon',(o=M("div")).innerHTML='<img class="svgicon" src="/assets/ui/icons/check.svg?v=3406973"> No ads',l=M("div"),c=M("img"),d=_(),(u=M("span")).textContent=`${Nx[0].inventory}`,m=_(),(p=M("span")).textContent=`${Nx[1].inventory}`,f=E(" base bag slots"),g=M("div"),v=M("img"),b=_(),(x=M("span")).textContent=`${Nx[0].stash}`,w=_(),(C=M("span")).textContent=`${Nx[1].stash}`,A=E(" stash storage"),R=M("div"),P=M("img"),D=_(),(q=M("span")).textContent=`${Nx[0].auction}`,j=_(),(F=M("span")).textContent=`${Nx[1].auction}`,z=E(" merchant limit"),B=M("div"),L=M("img"),U=_(),(O=M("span")).textContent=`${Nx[0].auctionHours}h`,Q=_(),(W=M("span")).textContent=`${Nx[1].auctionHours}h`,V=E(" merchant duration"),(H=M("div")).textContent="+ more to come (TBA)",T(i,"class","artcontainer svelte-cbx1m"),T(a,"class","textprimary"),T(r,"class","textwhite"),T(o,"class","textwhite"),T(c,"class","svgicon"),c.src!==(h="/assets/ui/icons/check.svg?v=3406973")&&T(c,"src","/assets/ui/icons/check.svg?v=3406973"),T(u,"class","old svelte-cbx1m"),T(p,"class","textsub"),T(l,"class","textwhite"),T(v,"class","svgicon"),v.src!==(y="/assets/ui/icons/check.svg?v=3406973")&&T(v,"src","/assets/ui/icons/check.svg?v=3406973"),T(x,"class","old svelte-cbx1m"),T(C,"class","textsub"),T(g,"class","textwhite"),T(P,"class","svgicon"),P.src!==(I="/assets/ui/icons/check.svg?v=3406973")&&T(P,"src","/assets/ui/icons/check.svg?v=3406973"),T(q,"class","old svelte-cbx1m"),T(F,"class","textsub"),T(R,"class","textwhite"),T(L,"class","svgicon"),L.src!==(N="/assets/ui/icons/check.svg?v=3406973")&&T(L,"src","/assets/ui/icons/check.svg?v=3406973"),T(O,"class","old svelte-cbx1m"),T(W,"class","textsub"),T(B,"class","textwhite"),T(H,"class","textgrey"),T(s,"class","split svelte-cbx1m")},m(t,e){$(t,s,e),k(s,i),k(s,n),k(n,a),k(n,r),k(n,o),k(n,l),k(l,c),k(l,d),k(l,u),k(l,m),k(l,p),k(l,f),k(n,g),k(g,v),k(g,b),k(g,x),k(g,w),k(g,C),k(g,A),k(n,R),k(R,P),k(R,D),k(R,q),k(R,j),k(R,F),k(R,z),k(n,B),k(B,L),k(B,U),k(B,O),k(B,Q),k(B,W),k(B,V),k(n,H)},p:t,i:t,o:t,d(t){t&&S(s)}}}class M$ extends Pt{constructor(t){super(),Rt(this,t,null,C$,o,{})}}const E$={SECONDS_A_MINUTE:60,SECONDS_A_HOUR:3600,SECONDS_A_DAY:86400,SECONDS_A_WEEK:604800,MILLISECONDS_A_SECOND:1e3,MILLISECONDS_A_MINUTE:6e4,MILLISECONDS_A_HOUR:36e5,MILLISECONDS_A_DAY:864e5,MILLISECONDS_A_WEEK:6048e5,MS:"millisecond",S:"second",MIN:"minute",H:"hour",D:"day",W:"week",M:"month",Q:"quarter",Y:"year",DATE:"date",FORMAT_DEFAULT:"YYYY-MM-DDTHH:mm:ssZ",INVALID_DATE_STRING:"Invalid Date",REGEX_PARSE:/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,REGEX_FORMAT:/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g},_$=(t,e,s)=>{const i=String(t);return!i||i.length>=e?t:`${Array(e+1-i.length).join(s)}${t}`},R$={s:_$,z:t=>{const e=-t.utcOffset(),s=Math.abs(e),i=Math.floor(s/60),n=s%60;return`${e<=0?"+":"-"}${_$(i,2,"0")}:${_$(n,2,"0")}`},m:(t,e)=>{const s=12*(e.year()-t.year())+(e.month()-t.month()),i=t.clone().add(s,E$.M),n=e-i<0,a=t.clone().add(s+(n?-1:1),E$.M);return Number(-(s+(e-i)/(n?i-a:a-i))||0)},a:t=>t<0?Math.ceil(t)||0:Math.floor(t),p:t=>({M:E$.M,y:E$.Y,w:E$.W,d:E$.D,h:E$.H,m:E$.MIN,s:E$.S,ms:E$.MS,Q:E$.Q})[t]||String(t||"").toLowerCase().replace(/s$/,""),u:t=>void 0===t},P$={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")};let T$="en";const I$={};I$[T$]=P$;const D$=t=>t instanceof U$,A$=(t,e,s)=>{let i;if(!t)return T$;if("string"==typeof t)I$[t]&&(i=t),e&&(I$[t]=e,i=t);else{const{name:e}=t;I$[e]=t,i=e}return s||(T$=i),i},F$=(t,e,s)=>{if(D$(t))return t.clone();const i=e?"string"==typeof e?{format:e,pl:s}:e:{};return i.date=t,new U$(i)},z$=R$;z$.l=A$,z$.i=D$,z$.w=((t,e)=>F$(t,{locale:e.$L,utc:e.$u,$offset:e.$offset}));const B$=t=>{const{date:e,utc:s}=t;if(null===e)return new Date(NaN);if(z$.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){const t=e.match(E$.REGEX_PARSE);if(t)return s?new Date(Date.UTC(t[1],t[2]-1,t[3]||1,t[4]||0,t[5]||0,t[6]||0,t[7]||0)):new Date(t[1],t[2]-1,t[3]||1,t[4]||0,t[5]||0,t[6]||0,t[7]||0)}return new Date(e)};class U${constructor(t){this.$L=this.$L||A$(t.locale,null,!0),this.parse(t)}parse(t){this.$d=B$(t),this.init()}init(){const{$d:t}=this;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()}$utils(){return z$}isValid(){return!(this.$d.toString()===E$.INVALID_DATE_STRING)}isSame(t,e){const s=F$(t);return this.startOf(e)<=s&&s<=this.endOf(e)}isAfter(t,e){return F$(t)<this.startOf(e)}isBefore(t,e){return this.endOf(e)<F$(t)}$g(t,e,s){return z$.u(t)?this[e]:this.set(s,t)}year(t){return this.$g(t,"$y",E$.Y)}month(t){return this.$g(t,"$M",E$.M)}day(t){return this.$g(t,"$W",E$.D)}date(t){return this.$g(t,"$D",E$.DATE)}hour(t){return this.$g(t,"$H",E$.H)}minute(t){return this.$g(t,"$m",E$.MIN)}second(t){return this.$g(t,"$s",E$.S)}millisecond(t){return this.$g(t,"$ms",E$.MS)}unix(){return Math.floor(this.valueOf()/1e3)}valueOf(){return this.$d.getTime()}startOf(t,e){const s=!!z$.u(e)||e,i=z$.p(t),n=(t,e)=>{const i=z$.w(this.$u?Date.UTC(this.$y,e,t):new Date(this.$y,e,t),this);return s?i:i.endOf(E$.D)},a=(t,e)=>z$.w(this.toDate()[t].apply(this.toDate(),(s?[0,0,0,0]:[23,59,59,999]).slice(e)),this),{$W:r,$M:o,$D:l}=this,c=`set${this.$u?"UTC":""}`;switch(i){case E$.Y:return s?n(1,0):n(31,11);case E$.M:return s?n(1,o):n(0,o+1);case E$.W:{const t=this.$locale().weekStart||0,e=(r<t?r+7:r)-t;return n(s?l-e:l+(6-e),o)}case E$.D:case E$.DATE:return a(`${c}Hours`,0);case E$.H:return a(`${c}Minutes`,1);case E$.MIN:return a(`${c}Seconds`,2);case E$.S:return a(`${c}Milliseconds`,3);default:return this.clone()}}endOf(t){return this.startOf(t,!1)}$set(t,e){const s=z$.p(t),i=`set${this.$u?"UTC":""}`,n={[E$.D]:`${i}Date`,[E$.DATE]:`${i}Date`,[E$.M]:`${i}Month`,[E$.Y]:`${i}FullYear`,[E$.H]:`${i}Hours`,[E$.MIN]:`${i}Minutes`,[E$.S]:`${i}Seconds`,[E$.MS]:`${i}Milliseconds`}[s],a=s===E$.D?this.$D+(e-this.$W):e;if(s===E$.M||s===E$.Y){const t=this.clone().set(E$.DATE,1);t.$d[n](a),t.init(),this.$d=t.set(E$.DATE,Math.min(this.$D,t.daysInMonth())).toDate()}else n&&this.$d[n](a);return this.init(),this}set(t,e){return this.clone().$set(t,e)}get(t){return this[z$.p(t)]()}add(t,e){t=Number(t);const s=z$.p(e),i=e=>{const s=F$(this);return z$.w(s.date(s.date()+Math.round(e*t)),this)};if(s===E$.M)return this.set(E$.M,this.$M+t);if(s===E$.Y)return this.set(E$.Y,this.$y+t);if(s===E$.D)return i(1);if(s===E$.W)return i(7);const n={[E$.MIN]:E$.MILLISECONDS_A_MINUTE,[E$.H]:E$.MILLISECONDS_A_HOUR,[E$.S]:E$.MILLISECONDS_A_SECOND}[s]||1,a=this.$d.getTime()+t*n;return z$.w(a,this)}subtract(t,e){return this.add(-1*t,e)}format(t){if(!this.isValid())return E$.INVALID_DATE_STRING;const e=t||E$.FORMAT_DEFAULT,s=z$.z(this),i=this.$locale(),{$H:n,$m:a,$M:r}=this,{weekdays:o,months:l,meridiem:c}=i,h=(t,s,i,n)=>t&&(t[s]||t(this,e))||i[s].substr(0,n),d=t=>z$.s(n%12||12,t,"0"),u=c||((t,e,s)=>{const i=t<12?"AM":"PM";return s?i.toLowerCase():i}),m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:r+1,MM:z$.s(r+1,2,"0"),MMM:h(i.monthsShort,r,l,3),MMMM:l[r]||l(this,e),D:this.$D,DD:z$.s(this.$D,2,"0"),d:String(this.$W),dd:h(i.weekdaysMin,this.$W,o,2),ddd:h(i.weekdaysShort,this.$W,o,3),dddd:o[this.$W],H:String(n),HH:z$.s(n,2,"0"),h:d(1),hh:d(2),a:u(n,a,!0),A:u(n,a,!1),m:String(a),mm:z$.s(a,2,"0"),s:String(this.$s),ss:z$.s(this.$s,2,"0"),SSS:z$.s(this.$ms,3,"0"),Z:s};return e.replace(E$.REGEX_FORMAT,(t,e)=>e||m[t]||s.replace(":",""))}utcOffset(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)}diff(t,e,s){const i=z$.p(e),n=F$(t),a=(n.utcOffset()-this.utcOffset())*E$.MILLISECONDS_A_MINUTE,r=this-n;let o=z$.m(this,n);return o={[E$.Y]:o/12,[E$.M]:o,[E$.Q]:o/3,[E$.W]:(r-a)/E$.MILLISECONDS_A_WEEK,[E$.D]:(r-a)/E$.MILLISECONDS_A_DAY,[E$.H]:r/E$.MILLISECONDS_A_HOUR,[E$.MIN]:r/E$.MILLISECONDS_A_MINUTE,[E$.S]:r/E$.MILLISECONDS_A_SECOND}[i]||r,s?o:z$.a(o)}daysInMonth(){return this.endOf(E$.M).$D}$locale(){return I$[this.$L]}locale(t,e){if(!t)return this.$L;const s=this.clone();return s.$L=A$(t,e,!0),s}clone(){return z$.w(this.$d,this)}toDate(){return new Date(this.valueOf())}toJSON(){return this.isValid()?this.toISOString():null}toISOString(){return this.$d.toISOString()}toString(){return this.$d.toUTCString()}}function O$(t,e,s){const i=t.slice();return i[13]=e[s],i[15]=s,i}function j$(e){let s;return{c(){s=E("Not active")},m(t,e){$(t,s,e)},p:t,d(t){t&&S(s)}}}function L$(t){let e,s,i,n,a=F$(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"";return{c(){e=M("img"),i=_(),n=E(a),T(e,"class","svgicon"),e.src!==(s="/assets/ui/icons/check.svg?v=3406973")&&T(e,"src","/assets/ui/icons/check.svg?v=3406973")},m(t,s){$(t,e,s),$(t,i,s),$(t,n,s)},p(t,e){2&e&&a!==(a=F$(t[1].subscribed_until).format("MMM DD, YYYY HH:mm")+"")&&D(n,a)},d(t){t&&S(e),t&&S(i),t&&S(n)}}}function N$(t){let e,s,i,n,a,r,o=t[13].name+"";const l=new qv({props:{amount:t[13].price}});return{c(){e=M("btn"),s=E(o),i=_(),Mt(l.$$.fragment),T(e,"class",n="btn black navbtn "+(t[5]==t[15]?"active":"")+" big"),r=P(e,"click",function(){(function(...e){return t[9](t[15],...e)}).apply(this,arguments)})},m(t,n){$(t,e,n),k(e,s),k(e,i),Et(l,e,null),a=!0},p(s,i){t=s,(!a||32&i&&n!==(n="btn black navbtn "+(t[5]==t[15]?"active":"")+" big"))&&T(e,"class",n)},i(t){a||(vt(l.$$.fragment,t),a=!0)},o(t){yt(l.$$.fragment,t),a=!1},d(t){t&&S(e),_t(l),r()}}}function q$(e){let s;return{c(){(s=M("div")).innerHTML='<p class="fadeIn textsub">Elixir time added. Thank you for your support. Please re-log any active characters.</p>',T(s,"class","fadeIn card marg-top")},m(t,e){$(t,s,e)},p:t,i:t,o:t,d(t){t&&S(s)}}}function H$(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,p,f,g,v,y,b,x,w,C=t[6]?"Gift":"Add",A=t[8].description+"",I=t[6]?"someone":"your account",q=t[6]?"Send Elixir Gift":t[1].subscribed_until?"Extend Elixir":"Activate Elixir";const j=new qv({props:{amount:t[8].price}}),z=[Q$,W$],B=[];function L(t,e){return t[6]?1:0}m=L(t),p=B[m]=z[m](t);let N="addsubscription"==t[0]&&t[2]&&V$(t),U=t[1].storepoints<t[8].price&&G$();return{c(){e=M("div"),s=M("div"),i=E(C),n=_(),a=M("span"),r=E(A),o=E(" of "),(l=M("span")).textContent="Elixir",c=E(" to "),h=E(I),d=E(" for "),Mt(j.$$.fragment),u=E("."),p.c(),f=R(),N&&N.c(),g=M("div"),v=M("div"),y=E(q),U&&U.c(),T(a,"class","bold textwhite"),T(l,"class","textsub"),T(s,"class","textgrey"),T(v,"class",b="btn grey formatted "+("addsubscription"==t[3]||t[1].storepoints<t[8].price?"disabled":"")),T(g,"class","subnav"),T(e,"class","fadeIn card marg-top"),F(e,"padding","18px"),w=P(v,"click",function(){t[12].apply(this,arguments)})},m(t,p){$(t,e,p),k(e,s),k(s,i),k(s,n),k(s,a),k(a,r),k(s,o),k(s,l),k(s,c),k(s,h),k(s,d),Et(j,s,null),k(s,u),B[m].m(e,null),k(e,f),N&&N.m(e,null),k(e,g),k(g,v),k(v,y),U&&U.m(e,null),x=!0},p(s,n){t=s,(!x||64&n)&&C!==(C=t[6]?"Gift":"Add")&&D(i,C),(!x||256&n)&&A!==(A=t[8].description+"")&&D(r,A),(!x||64&n)&&I!==(I=t[6]?"someone":"your account")&&D(h,I);const a={};256&n&&(a.amount=t[8].price),j.$set(a);let o=m;(m=L(t))===o?B[m].p(t,n):(ft(),yt(B[o],1,1,()=>{B[o]=null}),gt(),(p=B[m])||(p=B[m]=z[m](t)).c(),vt(p,1),p.m(e,f)),"addsubscription"==t[0]&&t[2]?N?N.p(t,n):((N=V$(t)).c(),N.m(e,g)):N&&(N.d(1),N=null),(!x||66&n)&&q!==(q=t[6]?"Send Elixir Gift":t[1].subscribed_until?"Extend Elixir":"Activate Elixir")&&D(y,q),(!x||266&n&&b!==(b="btn grey formatted "+("addsubscription"==t[3]||t[1].storepoints<t[8].price?"disabled":"")))&&T(v,"class",b),t[1].storepoints<t[8].price?U||((U=G$()).c(),U.m(e,null)):U&&(U.d(1),U=null)},i(t){x||(vt(j.$$.fragment,t),vt(p),x=!0)},o(t){yt(j.$$.fragment,t),yt(p),x=!1},d(t){t&&S(e),_t(j),B[m].d(),N&&N.d(),U&&U.d(),w()}}}function W$(t){let e,s,i;function n(e){t[11].call(null,e)}let a={};void 0!==t[7]&&(a.name=t[7]);const r=new Ak({props:a});return tt.push(()=>Ct(r,"name",n)),{c(){e=M("div"),Mt(r.$$.fragment),T(e,"class","subnav")},m(t,s){$(t,e,s),Et(r,e,null),i=!0},p(t,e){const i={};!s&&128&e&&(s=!0,i.name=t[7],lt(()=>s=!1)),r.$set(i)},i(t){i||(vt(r.$$.fragment,t),i=!0)},o(t){yt(r.$$.fragment,t),i=!1},d(t){t&&S(e),_t(r)}}}function Q$(e){let s,i,n,a,r,o=F$(e[1].subscribed_until||void 0).add(e[8].days,"day").format("MMM DD, YYYY HH:mm")+"";return{c(){s=M("p"),i=E("Enables Elixir until "),n=M("span"),a=E(o),r=E("."),T(n,"class","textwhite"),T(s,"class","bold textsub")},m(t,e){$(t,s,e),k(s,i),k(s,n),k(n,a),k(s,r)},p(t,e){258&e&&o!==(o=F$(t[1].subscribed_until||void 0).add(t[8].days,"day").format("MMM DD, YYYY HH:mm")+"")&&D(a,o)},i:t,o:t,d(t){t&&S(s)}}}function V$(t){let e,s;return{c(){e=M("p"),s=E(t[2]),T(e,"class","fadeIn textred")},m(t,i){$(t,e,i),k(e,s)},p(t,e){4&e&&D(s,t[2])},d(t){t&&S(e)}}}function G$(t){let e;return{c(){(e=M("p")).innerHTML='<small>You do not have enough Hordes Points to do this. <a class="textprimary" href="/store">Buy Hordes Points</a></small>'},m(t,s){$(t,e,s)},d(t){t&&S(e)}}}function Y$(t){let e,s,i,n,a,r,o,l,c,h,d,u,m,p,f,g,v;const y=new M$({});function b(t,e){return t[1].subscribed_until?L$:j$}let x=b(t),w=x(t);const A=new qv({props:{amount:t[1].storepoints}});let R=Lx,I=[];for(let e=0;e<R.length;e+=1)I[e]=N$(O$(t,R,e));const D=t=>yt(I[t],1,1,()=>{I[t]=null}),q=[H$,q$],j=[];function F(t,e){return void 0!==t[5]?0:"addsubscription"==t[0]?1:-1}return~(p=F(t))&&(f=j[p]=q[p](t)),{c(){e=M("div"),Mt(y.$$.fragment),(s=M("small")).textContent="Elixir",i=M("div"),w.c(),(a=M("small")).textContent="Hordes Points",r=M("div"),Mt(A.$$.fragment),o=_(),(l=M("a")).textContent="(Buy Hordes Points)",(c=M("p")).textContent="Support Hordes development for a low cost. Unlock additional bag slots, store more items in your stash, make use of enhanced merchant features and many more perks (TBA).",h=M("div");for(let t=0;t<I.length;t+=1)I[t].c();d=M("btn"),u=E("Send Gift"),f&&f.c(),T(s,"class","textgrey"),T(i,"class",n="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")),T(a,"class","textgrey"),T(l,"class","textwhite"),T(l,"href","/store"),T(r,"class","cardinfo"),T(c,"class","textgrey"),T(d,"class",m="btn navbtn "+(t[6]?"active white":"")+" big"),T(h,"class","subnav"),T(e,"class","card"),v=P(d,"click",function(){t[10].apply(this,arguments)})},m(t,n){$(t,e,n),Et(y,e,null),k(e,s),k(e,i),w.m(i,null),k(e,a),k(e,r),Et(A,r,null),k(r,o),k(r,l),k(e,c),k(e,h);for(let t=0;t<I.length;t+=1)I[t].m(h,null);k(h,d),k(d,u),~p&&j[p].m(e,null),g=!0},p(s,[a]){x===(x=b(t=s))&&w?w.p(t,a):(w.d(1),(w=x(t))&&(w.c(),w.m(i,null))),(!g||2&a&&n!==(n="cardinfo "+(t[1].subscribed_until?"textsub":"textgrey")))&&T(i,"class",n);const r={};if(2&a&&(r.amount=t[1].storepoints),A.$set(r),32&a){let e;for(R=Lx,e=0;e<R.length;e+=1){const s=O$(t,R,e);I[e]?(I[e].p(s,a),vt(I[e],1)):(I[e]=N$(s),I[e].c(),vt(I[e],1),I[e].m(h,d))}for(ft(),e=R.length;e<I.length;e+=1)D(e);gt()}(!g||64&a&&m!==(m="btn navbtn "+(t[6]?"active white":"")+" big"))&&T(d,"class",m);let o=p;(p=F(t))===o?~p&&j[p].p(t,a):(f&&(ft(),yt(j[o],1,1,()=>{j[o]=null}),gt()),~p?((f=j[p])||(f=j[p]=q[p](t)).c(),vt(f,1),f.m(e,null)):f=null)},i(t){if(!g){vt(y.$$.fragment,t),vt(A.$$.fragment,t);for(let t=0;t<R.length;t+=1)vt(I[t]);vt(f),g=!0}},o(t){yt(y.$$.fragment,t),yt(A.$$.fragment,t),I=I.filter(Boolean);for(let t=0;t<I.length;t+=1)yt(I[t]);yt(f),g=!1},d(t){t&&S(e),_t(y),w.d(),_t(A),C(I,t),~p&&j[p].d(),v()}}}function X$(t,e,s){let i,n,a,r=!1,{user:o}=e,{flash:l}=e,{flashmsg:c}=e,{action:h}=e,{apiCall:d}=e;return t.$set=(t=>{"user"in t&&s(1,o=t.user),"flash"in t&&s(0,l=t.flash),"flashmsg"in t&&s(2,c=t.flashmsg),"action"in t&&s(3,h=t.action),"apiCall"in t&&s(4,d=t.apiCall)}),t.$$.update=(()=>{32&t.$$.dirty&&s(8,a=Lx[i])}),[l,o,c,h,d,i,r,n,a,(t,e)=>s(5,i=t),t=>s(6,r=!r),function(t){s(7,n=t)},t=>d("addsubscription","/api/account/addsubscription",{value:i,gift:r?n:void 0},!0,t=>{"ok"==t.result&&(s(5,i=void 0),s(0,l="addsubscription"))})]}F$.prototype=U$.prototype,F$.extend=((t,e)=>(t(e,U$,F$),F$)),F$.locale=A$,F$.isDayjs=D$,F$.unix=(t=>F$(1e3*t)),F$.en=I$[T$],F$.Ls=I$;class Z$ extends Pt{constructor(t){super(),Rt(this,t,X$,Y$,o,{user:1,flash:0,flashmsg:2,action:3,apiCall:4})}}function J$(t){let e,s,i;const n=new Rf({props:{title:"Store / Elixir",icon:"gem",$$slots:{default:[tS]},$$scope:{ctx:t}}});return n.$on("close",function(){t[7].apply(this,arguments)}),{c(){e=M("div"),s=M("div"),Mt(n.$$.fragment),T(s,"class","uiscaled"),T(e,"class","absCentered container svelte-1fl1zyr")},m(t,a){$(t,e,a),k(e,s),Et(n,s,null),i=!0},p(e,s){t=e;const i={};302&s&&(i.$$scope={dirty:s,ctx:t}),n.$set(i)},i(t){i||(vt(n.$$.fragment,t),i=!0)},o(t){yt(n.$$.fragment,t),i=!1},d(t){t&&S(e),_t(n)}}}function K$(t){let e;const s=new Z$({props:{user:t[5],flash:t[1],flashmsg:t[2],action:t[3],apiCall:t[0]}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},p(t,e){const i={};32&e&&(i.user=t[5]),2&e&&(i.flash=t[1]),4&e&&(i.flashmsg=t[2]),8&e&&(i.action=t[3]),s.$set(i)},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function tS(t){let e,s,i=t[5]&&K$(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,s){t[5]?i?(i.p(t,s),vt(i,1)):((i=K$(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function eS(t){let e,s,i=t[4]&&J$(t);return{c(){i&&i.c(),e=R()},m(t,n){i&&i.m(t,n),$(t,e,n),s=!0},p(t,[s]){t[4]?i?(i.p(t,s),vt(i,1)):((i=J$(t)).c(),vt(i,1),i.m(e.parentNode,e)):i&&(ft(),yt(i,1,1,()=>{i=null}),gt())},i(t){s||(vt(i),s=!0)},o(t){yt(i),s=!1},d(t){i&&i.d(t),t&&S(e)}}}function sS(t,e,s){let i,n;h(t,Ye,t=>s(4,i=t)),h(t,$$,t=>s(5,n=t));let a=void 0,r=void 0,o=void 0;return t.$$.update=(()=>{16&t.$$.dirty&&i&&S$()}),[async(t,e,i,n,l)=>{s(3,o=t);const c=await Sk(e,i);s(3,o=void 0),"ok"===c.result?s(1,a=void 0):(s(1,a=t),s(2,r=c.result)),n&&S$(),l&&l(c)},a,r,o,i,n,void 0,t=>f(Ye,i=!1)]}class iS extends Pt{constructor(t){super(),Rt(this,t,sS,eS,o,{apiCall:0})}get apiCall(){return this.$$.ctx[0]}}function nS(e){let s,i,n,a,r,o,l,c;return{c(){s=M("div"),i=M("h3"),n=E("Using AdBlock? Buy "),(a=M("span")).innerHTML='<span class="textwhite">Hordes</span>  <img class="svgicon texticon" src="/assets/ui/icons/gem.svg?v=3406973">  Elixir',r=E(" to hide this window and support development."),o=M("ins"),(l=M("script")).textContent="(adsbygoogle = window.adsbygoogle || []).push({});",T(a,"class","btn textsub"),T(i,"class","textgrey blocktext svelte-svpjti"),T(o,"class","adsbygoogle"),F(o,"display","inline-block"),F(o,"width","728px"),F(o,"height","90px"),T(o,"data-ad-client","ca-pub-6128207871826113"),T(o,"data-ad-slot","2385450998"),T(s,"class","container panel-black svelte-svpjti"),c=P(a,"click",function(){e[1].apply(this,arguments)})},m(t,e){$(t,s,e),k(s,i),k(i,n),k(i,a),k(i,r),k(s,o),k(s,l)},p(t,[s]){e=t},i:t,o:t,d(t){t&&S(s),c()}}}function aS(t,e,s){let i;return h(t,Ye,t=>s(0,i=t)),[i,t=>f(Ye,i=!0)]}class rS extends Pt{constructor(t){super(),Rt(this,t,aS,nS,o,{})}}function oS(t,e,s){const i=t.slice();return i[4]=e[s],i}function lS(t){let e,s,i,n,a,r=cg(t[4].viewers)+"",o=cg(t[4].followers)+"";return{c(){e=M("div"),s=M("span"),i=E(r),n=_(),a=E(o),T(s,"class","textgreen"),T(e,"class","bold viewcount textbox svelte-13wcf6i")},m(t,r){$(t,e,r),k(e,s),k(s,i),k(e,n),k(e,a)},p(t,e){2&e&&r!==(r=cg(t[4].viewers)+"")&&D(i,r),2&e&&o!==(o=cg(t[4].followers)+"")&&D(a,o)},d(t){t&&S(e)}}}function cS(t){let e,s,i,n,a,r,o,l=t[4].name+"",c=(t[4].viewers||t[4].followers)&&lS(t);return{c(){e=M("a"),s=M("div"),c&&c.c(),i=M("div"),n=E(l),T(i,"class","name textbox svelte-13wcf6i"),T(s,"class","border black preview svelte-13wcf6i"),T(s,"style",a="background-image:url("+(t[4].preview||"")+"); "+(t[0]?"margin-top:2px;":"")),T(e,"class","fadeIn stream svelte-13wcf6i"),T(e,"target","_blank"),T(e,"rel","noopener noreferrer"),T(e,"href",r=t[4].url),T(e,"style",o=t[0]?"":"width:calc(100%/6);")},m(t,a){$(t,e,a),k(e,s),c&&c.m(s,null),k(s,i),k(i,n)},p(t,h){t[4].viewers||t[4].followers?c?c.p(t,h):((c=lS(t)).c(),c.m(s,i)):c&&(c.d(1),c=null),2&h&&l!==(l=t[4].name+"")&&D(n,l),3&h&&a!==(a="background-image:url("+(t[4].preview||"")+"); "+(t[0]?"margin-top:2px;":""))&&T(s,"style",a),2&h&&r!==(r=t[4].url)&&T(e,"href",r),1&h&&o!==(o=t[0]?"":"width:calc(100%/6);")&&T(e,"style",o)},d(t){t&&S(e),c&&c.d()}}}function hS(e){let s,i,n=e[1],a=[];for(let t=0;t<n.length;t+=1)a[t]=cS(oS(e,n,t));return{c(){s=M("div");for(let t=0;t<a.length;t+=1)a[t].c();T(s,"style",i="pointer-events: all; "+(e[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))},m(t,e){$(t,s,e);for(let t=0;t<a.length;t+=1)a[t].m(s,null)},p(t,[e]){if(3&e){let i;for(n=t[1],i=0;i<n.length;i+=1){const r=oS(t,n,i);a[i]?a[i].p(r,e):(a[i]=cS(r),a[i].c(),a[i].m(s,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}1&e&&i!==(i="pointer-events: all; "+(t[0]?"float:right; clear:right; width:150px;":"display: flex; justify-content: center;"))&&T(s,"style",i)},i:t,o:t,d(t){t&&S(s),C(a,t)}}}function dS(t,e,s){let i,{vertical:n=!1}=e,a=[];n&&a.push({name:"Loading streams..."});const r=async()=>{i=setTimeout(r,1e4),s(1,a=await Sk("/api/twitch/streams",{max:6})),n&&0===a.length&&a.push({name:"No streams, refreshing..."})};return G(r),X(t=>{i&&clearTimeout(i)}),t.$set=(t=>{"vertical"in t&&s(0,n=t.vertical)}),[n,a]}class uS extends Pt{constructor(t){super(),Rt(this,t,dS,hS,o,{vertical:0})}}function mS(t){let e,s,i,n,a,r,o,l,c,h,d=t[1][1]+"",u=t[1][0]+"",m=t[1][2]+"";return{c(){e=M("small"),s=M("div"),i=E(d),n=E(" fps"),a=M("div"),r=E(u),o=E(" ms"),l=M("div"),c=E(m),h=E(" KBs"),T(s,"class","textgreen"),T(a,"class","textcyan"),T(l,"class","textorange"),T(e,"class","marg-top bar btn black grey svelte-1apx3f3")},m(t,d){$(t,e,d),k(e,s),k(s,i),k(s,n),k(e,a),k(a,r),k(a,o),k(e,l),k(l,c),k(l,h)},p(t,e){2&e&&d!==(d=t[1][1]+"")&&D(i,d),2&e&&u!==(u=t[1][0]+"")&&D(r,u),2&e&&m!==(m=t[1][2]+"")&&D(c,m)},d(t){t&&S(e)}}}function pS(e){let s,i=e[0]&&mS(e);return{c(){i&&i.c(),s=R()},m(t,e){i&&i.m(t,e),$(t,s,e)},p(t,[e]){t[0]?i?i.p(t,e):((i=mS(t)).c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},i:t,o:t,d(t){i&&i.d(t),t&&S(s)}}}function fS(t,e,s){let i,n;return h(t,gs,t=>s(0,i=t)),h(t,oe,t=>s(1,n=t)),[i,n]}class gS extends Pt{constructor(t){super(),Rt(this,t,fS,pS,o,{})}}const vS=getComputedStyle(document.body),yS=t=>vS.getPropertyValue("--"+t),bS=document.createElement("canvas"),xS=bS.getContext("2d"),wS=document.createElement("img");let kS=!1;const $S={player:"#fff",monster:"#D53434",pvp:yS("pvp"),friendly:yS("health"),party:yS("party")},SS=t=>{const e=bS.parentElement.parentElement.parentElement,s=Math.min(e.offsetWidth,e.offsetHeight);let i=Math.round(t?.8*s:Math.max(150,Math.min(200,.2*s)));i%2!=0&&(i+=1),PS=(bS.width=i)/2,RS=(bS.height=i)/2};let CS=0;const MS=(t,e,s,i,n,a)=>{if(!gi.mapShowMonsters&&1===s)return;const r=TS(t,e);if(!(r[0]<1||r[1]<1||r[0]>=bS.width||r[1]>=bS.height))if(0===s){if(kS&&n&&qn.smoothtime%1>.5)return;xS.fillStyle=0===i?a?$S.player:n?$S.party:$S.friendly:$S.pvp,xS.fillRect(...r,5,5)}else xS.fillStyle=i>0?$S.monster:$S.friendly,xS.fillRect(...r,3,3)};let ES=0,_S=0,RS=0,PS=0;const TS=(t,e)=>[Math.round(t/qn.bounds*(kS?bS.width:wS.width)-ES),Math.round(e/qn.bounds*(kS?bS.height:wS.height)-_S)];var IS=Object.freeze({__proto__:null,canvas:bS,init:()=>{ro.map.onPress(()=>{SS(kS=!kS)})},changeCanvas:SS,postTick:t=>{CS++,!wS.complete||!qn.player||gi.mapLowQuality&&CS%10!=0||(kS?(ES=_S=0,xS.drawImage(wS,0,0,bS.width,bS.height)):(ES=wS.width*qn.player.CR[0]/qn.bounds-PS,_S=wS.height*qn.player.CR[2]/qn.bounds-RS,xS.drawImage(wS,-Math.round(ES),-Math.round(_S))),qn.entities.array.forEach(t=>{t.stats&&t.stats.alive&&MS(t.CR[0],t.CR[2],t.constructor.type,qn.player.hostility(t),t.party>0&&t.party===qn.player.party,t===qn.player)}),qn.party.forEach(t=>{t.CR&&!qn.entity(t.id)&&MS(t.CR[0],t.CR[1],0,0,qn.player.party,!1)}))},onWorldEnter:t=>{wS.src=(t=>`/assets/ui/maps/${t}.${kr}?v=3406973`)(t.id)},onWorldDestroy:t=>{}});function DS(e){let s;return{c(){T(s=M("div"),"class","marg-top container panel-black svelte-hiyby7")},m(t,i){$(t,s,i),e[1](s)},p:t,i:t,o:t,d(t){t&&S(s),e[1](null)}}}function AS(t,e,s){let i;return G(()=>{i.appendChild(bS),SS(!1)}),[i,function(t){tt[t?"unshift":"push"](()=>{s(0,i=t)})}]}class FS extends Pt{constructor(t){super(),Rt(this,t,AS,DS,o,{})}}function zS(t){let e;const s=new rS({});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function BS(t){let e;const s=new uS({props:{vertical:!0}});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function US(t){let e,s,i,n,a,r,o,l;const c=new wb({}),h=new Pd({});let d=t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])&&zS();const u=new $k({}),m=new Ud({}),p=new _b({}),f=new Of({}),g=new uk({}),v=new Sf({}),y=new ib({}),b=new gb({}),x=new Db({}),w=new hx({}),E=new nk({}),C=new kx({}),_=new Bx({}),A=new Jx({}),P=new cw({}),I=new Uw({}),D=new y$({}),q=new iS({}),j=new Ob({}),F=new FS({}),z=new gS({}),B=new Nb({});let L=t[6]&&BS();const N=new Tg({}),U=new Wy({}),O=new k$({}),Q=new gk({});return{c(){Mt(c.$$.fragment),e=M("div"),Mt(h.$$.fragment),s=M("div"),d&&d.c(),i=R(),Mt(u.$$.fragment),Mt(m.$$.fragment),Mt(p.$$.fragment),Mt(f.$$.fragment),Mt(g.$$.fragment),Mt(v.$$.fragment),Mt(y.$$.fragment),Mt(b.$$.fragment),Mt(x.$$.fragment),Mt(w.$$.fragment),Mt(E.$$.fragment),Mt(C.$$.fragment),Mt(_.$$.fragment),Mt(A.$$.fragment),Mt(P.$$.fragment),Mt(I.$$.fragment),Mt(D.$$.fragment),Mt(q.$$.fragment),n=M("div"),Mt(j.$$.fragment),Mt(F.$$.fragment),Mt(z.$$.fragment),Mt(B.$$.fragment),L&&L.c(),a=M("div"),r=M("div"),o=M("div"),Mt(N.$$.fragment),Mt(U.$$.fragment),Mt(O.$$.fragment),Mt(Q.$$.fragment),T(n,"class","l-corner-ur uiscaled"),T(s,"class","container svelte-1j9lddf"),T(o,"class","actionbarcontainer svelte-1j9lddf"),T(r,"class","uiscaled"),T(a,"class","container svelte-1j9lddf"),T(e,"class","l-ui layout svelte-1j9lddf")},m(t,S){Et(c,t,S),$(t,e,S),Et(h,e,null),k(e,s),d&&d.m(s,null),k(s,i),Et(u,s,null),Et(m,s,null),Et(p,s,null),Et(f,s,null),Et(g,s,null),Et(v,s,null),Et(y,s,null),Et(b,s,null),Et(x,s,null),Et(w,s,null),Et(E,s,null),Et(C,s,null),Et(_,s,null),Et(A,s,null),Et(P,s,null),Et(I,s,null),Et(D,s,null),Et(q,s,null),k(s,n),Et(j,n,null),Et(F,n,null),Et(z,n,null),Et(B,n,null),L&&L.m(n,null),k(e,a),k(a,r),k(r,o),Et(N,o,null),Et(U,o,null),Et(O,a,null),Et(Q,e,null),l=!0},p(t,[e]){t[0]&&!t[0].subscribed_until&&(t[1]||t[2]||t[3]||t[4]||t[5])?d?vt(d,1):((d=zS()).c(),vt(d,1),d.m(s,i)):d&&(ft(),yt(d,1,1,()=>{d=null}),gt()),t[6]?L?vt(L,1):((L=BS()).c(),vt(L,1),L.m(n,null)):L&&(ft(),yt(L,1,1,()=>{L=null}),gt())},i(t){l||(vt(c.$$.fragment,t),vt(h.$$.fragment,t),vt(d),vt(u.$$.fragment,t),vt(m.$$.fragment,t),vt(p.$$.fragment,t),vt(f.$$.fragment,t),vt(g.$$.fragment,t),vt(v.$$.fragment,t),vt(y.$$.fragment,t),vt(b.$$.fragment,t),vt(x.$$.fragment,t),vt(w.$$.fragment,t),vt(E.$$.fragment,t),vt(C.$$.fragment,t),vt(_.$$.fragment,t),vt(A.$$.fragment,t),vt(P.$$.fragment,t),vt(I.$$.fragment,t),vt(D.$$.fragment,t),vt(q.$$.fragment,t),vt(j.$$.fragment,t),vt(F.$$.fragment,t),vt(z.$$.fragment,t),vt(B.$$.fragment,t),vt(L),vt(N.$$.fragment,t),vt(U.$$.fragment,t),vt(O.$$.fragment,t),vt(Q.$$.fragment,t),l=!0)},o(t){yt(c.$$.fragment,t),yt(h.$$.fragment,t),yt(d),yt(u.$$.fragment,t),yt(m.$$.fragment,t),yt(p.$$.fragment,t),yt(f.$$.fragment,t),yt(g.$$.fragment,t),yt(v.$$.fragment,t),yt(y.$$.fragment,t),yt(b.$$.fragment,t),yt(x.$$.fragment,t),yt(w.$$.fragment,t),yt(E.$$.fragment,t),yt(C.$$.fragment,t),yt(_.$$.fragment,t),yt(A.$$.fragment,t),yt(P.$$.fragment,t),yt(I.$$.fragment,t),yt(D.$$.fragment,t),yt(q.$$.fragment,t),yt(j.$$.fragment,t),yt(F.$$.fragment,t),yt(z.$$.fragment,t),yt(B.$$.fragment,t),yt(L),yt(N.$$.fragment,t),yt(U.$$.fragment,t),yt(O.$$.fragment,t),yt(Q.$$.fragment,t),l=!1},d(t){_t(c,t),t&&S(e),_t(h),d&&d.d(),_t(u),_t(m),_t(p),_t(f),_t(g),_t(v),_t(y),_t(b),_t(x),_t(w),_t(E),_t(C),_t(_),_t(A),_t(P),_t(I),_t(D),_t(q),_t(j),_t(F),_t(z),_t(B),L&&L.d(),_t(N),_t(U),_t(O),_t(Q)}}}function OS(t,e,s){let i,n,a,r,o,l,c;return h(t,$e,t=>s(0,i=t)),h(t,me,t=>s(1,n=t)),h(t,ce,t=>s(2,a=t)),h(t,ve,t=>s(3,r=t)),h(t,ge,t=>s(4,o=t)),h(t,pe,t=>s(5,l=t)),h(t,Ge,t=>s(6,c=t)),S$(t=>{t&&t.subscribed_until&&jx("sub","Hordes Elixir active $gt",!0)}),[i,n,a,r,o,l,c]}class jS extends Pt{constructor(t){super(),Rt(this,t,OS,US,o,{})}}function LS(t){let e;const s=new jS({});return{c(){Mt(s.$$.fragment)},m(t,i){Et(s,t,i),e=!0},i(t){e||(vt(s.$$.fragment,t),e=!0)},o(t){yt(s.$$.fragment,t),e=!1},d(t){_t(s,t)}}}function NS(t){let e,s;const i=new $d({props:{active:t[0]}});let n="play"==t[1]&&t[2]&&!t[0]&&t[3]&&LS();const a=new Md({});return{c(){Mt(i.$$.fragment),n&&n.c(),e=R(),Mt(a.$$.fragment)},m(t,r){Et(i,t,r),n&&n.m(t,r),$(t,e,r),Et(a,t,r),s=!0},p(t,[s]){const a={};1&s&&(a.active=t[0]),i.$set(a),"play"==t[1]&&t[2]&&!t[0]&&t[3]?n?vt(n,1):((n=LS()).c(),vt(n,1),n.m(e.parentNode,e)):n&&(ft(),yt(n,1,1,()=>{n=null}),gt())},i(t){s||(vt(i.$$.fragment,t),vt(n),vt(a.$$.fragment,t),s=!0)},o(t){yt(i.$$.fragment,t),yt(n),yt(a.$$.fragment,t),s=!1},d(t){_t(i,t),n&&n.d(t),t&&S(e),_t(a,t)}}}function qS(t,e,s){let i,n,a,r;return h(t,qt,t=>s(0,i=t)),h(t,Ht,t=>s(1,n=t)),h(t,jt,t=>s(2,a=t)),h(t,ae,t=>s(3,r=t)),[i,n,a,r]}class HS extends Pt{constructor(t){super(),Rt(this,t,qS,NS,o,{})}}let WS;const QS=(t,e,s=1,i=1,n=1,a=1,r=0,o=0,l=.5,c=.5)=>{WS.globalAlpha=gi.nameplateShowTransparency?s:1;const h=t.width*i,d=t.height*i,u=Math.round(h*n),m=Math.round(d*a);return 0===u||0===m?u:(WS.drawImage(t,0,0,Math.round(t.width*n),Math.round(t.height*a),Math.round(e[0]-h*l+r*i),Math.round(e[1]-d*c+o*i),u,m),u)},VS=(t,e,s,i,n,a=0,r=0,o=.5,l=.5)=>QS(fC(e,s),t,i,n,1,1,a,r,o,l),GS=(t,e,s=!1)=>(s?(e[0]=t[0],e[1]=t[1]):Ti(e,t,Un.kX),!!(s||e[2]<1&&e[0]>-1&&e[0]<1&&e[1]>-1&&e[1]<1)&&(e[0]=Math.round((.5*e[0]+.5)*Ln.canvas2dElement.width),e[1]=Math.round((-.5*e[1]+.5)*Ln.canvas2dElement.height),e)),YS=(t,e,s)=>{for(let i=s.length-1;i>=0;i--){const n=s[i];(n==e||Ei(e.CR,n.CR)<25)&&(t.push(n),ki(t.CR,t.CR,n.CR),s.splice(i,1))}},XS=new Set,ZS=(t,e)=>{bi(t.hudPos,t.visualPosition||t.CR),GS(t.hudPos,t.hudPos)&&t.hudPos[2]<.997&&e.push(t)},JS=t=>{let e=[];qn.entities.array.forEach(t=>{!t.transform.visible||3!==t.constructor.type||t.quality<gi.itemQualityFilter||ZS(t,e)}),XS.forEach(t=>{t.uiTimeout<qn.time?XS.delete(t):ZS(t,e)}),e=e.sort((t,e)=>e.id-t.id);const s=new Set;for(;e.length;){const t=e[0],i=[];i.CR=[0,0,0],YS(i,t,e),Si(i.CR,i.CR,1/i.length),i.CR[0]=Math.round(i.CR[0]),i.CR[1]=Math.round(i.CR[1]),i.CR[2]=Math.round(i.CR[2]),GS(i.CR,i.CR)?s.add(i.sort((t,e)=>t.hudPos[2]-e.hudPos[2])):s.delete(i)}let i=0;Array.from(s).sort((t,e)=>e.CR[2]-t.CR[2]).forEach(t=>{const e=t.length/5*100;let s=0,n=0;t.forEach((a,r)=>{a.hudTextImg||(a.hudTextImg=fC(a.name,pC[a.color]));const o=a.hudTextImg.width,l=Math.round(t.CR[0]+n-.5*e)-2,c=Math.round(t.CR[1]-20*s)-8;if(0===a.uiTimeout){const t=a.canBePickedUpBy(qn.player),e=a.partyTimeoutCheck(qn.player);t&&!(no[0]>l+o||no[1]>c+20||no[0]<l||no[1]<c)?(i=a.id,WS.globalAlpha=1):WS.globalAlpha=t?.4:.1,WS.fillStyle="#000000",WS.beginPath(),WS.rect(l,c,o,20),WS.fill(),VS(Rn(Kn,l+2,c+8),a.name,e?pC[a.color]:mC.itemgrey,t?1:.8,1,0,0,0)}(n+=o+3)>e&&(s++,n=0)})}),i!==Vf&&Kf(i)},KS=(t,e)=>{let s=t.transform&&t.transform.cDist;if(s>gi.nameplateViewRange)return;s?s/=70:s=0;const i=t.party>0&&t.party===qn.player.party,n=t.id===qn.player.target,a=void 0!==t.faction?qn.player.hostility(t):0,r=t.id===Vf;if(3!==t.constructor.type&&t.stats&&t.stats.alive){if(!gi.nameplateShowMonsers&&1===t.constructor.type)return;const e=n?1:.7*Math.max(.1,Math.min(1,1-s)),o=n||i?1:Math.min(.8,r?.9:.75*e+.2),l=Math.round(10*e),c=eC[l-1],h=void 0!==t.skills.timedSkill;if(t!==qn.player&&n&&QS(h?iC:sC,t.hudPos,.8,1,1,h?2:1,0,h?4:0),h){const e=c[0].height-3,s=ia(t.skills.timedCast.fraction(qn.smoothtime),0,1);QS(c[0],t.hudPos,o,1,1,1,0,e),s>0&&QS(c[6],t.hudPos,o,1,s,1,0,e)}if(t!==qn.player&&(QS(c[0],t.hudPos,o,1,1,h?2:1),QS(i?c[3]:0===a?c[1]:a>1?t.canCombatInteract(qn.player)?c[4]:c[5]:c[2],t.hudPos,o,1,t.stats.getResource(6)/t.stats.getStat(6),1),t.clan&&VS(Rn(Kn,t.hudPos[0]-c[0].width/2+2,t.hudPos[1]),t.clan,t.clan==qn.player.clan?mC.clan:0===t.faction?mC.faction0:mC.faction1,o,1,0,0,1),t.level)){let e=mC.lev1;a>0&&(t.level-qn.player.level>4?e=mC.lev3:t.level-qn.player.level>1?e=mC.lev2:t.level-qn.player.level<-5&&(e=mC.lev0)),VS(Rn(Kn,t.hudPos[0]+c[0].width/2+3,t.hudPos[1]),t.level,e,o,1,0,0,0)}}if(t===qn.player||n||t.faction<2||r){const e=3===t.constructor.type&&r&&!t.canBePickedUpBy(qn.player)?.5:n||3===t.constructor.type?1:r?.9:.7*Math.max(.1,Math.min(1,1-s));let i;3===t.constructor.type?i=t.partyTimeoutCheck(qn.player)?pC[t.color]:mC.itemgrey:0===a?i=n?mC.name:mC.nameSmall:1===a?i=n?mC.enemy:mC.enemySmall:2===a&&(i=n?mC.pvp:mC.pvpSmall);const o=n?-18:-13,l=VS(t.hudPos,t.name,i,e,1,t==qn.player&&t.clan?5*t.clan.length:0,o);t.clan&&t==qn.player&&VS(Rn(Kn,t.hudPos[0]-l/2+2,t.hudPos[1]),t.clan,0===t.faction?n?mC.faction0:mC.faction0Small:n?mC.faction1:mC.faction1Small,e,1,5*t.clan.length,o,1)}t.speechText&&VS(t.hudPos,t.speechText,t.speechStyle,1,1,0,n?-30:-20,.5,1)},tC=t=>{XS.clear();let e=(()=>{const t=[];return qn.entities.array.forEach((e,s)=>{e.stats&&!e.stats.alive||!e.transform.visible||e.id!==qn.player.target&&e.transform.cDist&&e.transform.cDist>60||3===e.constructor.type&&e.id!==Vf||(bi(e.hudPos,e.visualPosition||e.CR),e.hudPos[1]+=.7+(e.transform.getTopAbsolute?e.transform.getTopAbsolute():0),GS(e.hudPos,e.hudPos)&&(e===qn.player&&(e.hudPos[0]=Math.round(.5*Ln.canvas2dElement.width),e.hudPos[1]=Math.round(.5*Ln.canvas2dElement.height)),t.push(e)))}),t.sort((t,e)=>e.hudPos[2]-t.hudPos[2])})();ig(e),e=e.sort((t,e)=>t.id===qn.player.target||t.id===Vf?1:e.id===qn.player.target||e.id===Vf?-1:e.hudPos[2]-t.hudPos[2]),xi(Jn,0,0,0),e.forEach(KS)},eC=[];let sC,iC;const nC=()=>{for(let t=1;t<=10;++t){const e=[],s=(t+3)/13,i=Math.ceil(90*s),n=Math.max(10,Math.ceil(12*s)),a=Math.max(1,Math.ceil(3*s)),r=i-6,o=n-6;e.push(aC(null,yS("panel"),i,n,0,0,a)),aC(e[0],yS("grey"),r,o,3,3,1),e.push(aC(null,yS("health"),r,o,0,0,1)),e.push(aC(null,yS("enemy"),r,o,0,0,1)),e.push(aC(null,yS("party"),r,o,0,0,1)),e.push(aC(null,yS("pvp"),r,o,0,0,1)),e.push(aC(null,"#555555",r,o,0,0,1)),e.push(aC(null,yS("spell"),r,o,0,0,1)),eC.push(e)}sC=aC(null,"#ffffff",94,16,0,0,4),iC=aC(null,"#ffffff",94,25,0,0,4)},aC=(t,e,s,i,n,a,r)=>{t||((t=document.createElement("canvas")).width=s,t.height=i);const o=t.getContext("2d");return o.fillStyle=e,o.beginPath(),o.moveTo(n+r,a),o.arcTo(n+s,a,n+s,a+i,r),o.arcTo(n+s,a+i,n,a+i,r),o.arcTo(n,a+i,n,a,r),o.arcTo(n,a,n+s,a,r),o.closePath(),o.fill(),t},rC=[],oC={},lC=(t,e,s,i,n=!1)=>{n||(t[1]+=3.5,t[0]+=Ar(-1.5,1.5),t[2]+=Ar(-1.5,1.5)),rC.push({CR:t,flat:n,float:n||3!==s,text:0===s?"Miss":e+(1===s?"🛡️":""),style:n?mC.pdmg:1===i?mC.spell:mC.phys,time:-.3,crit:3===s})},cC=(t,e,s,i=!1)=>{i||(t[1]+=3,t[0]+=Ar(-1.5,1.5),t[2]+=Ar(-1.5,1.5)),rC.push({CR:t,flat:i,crit:3===s,float:i||3!==s,text:e,style:i?mC.pheal:mC.heal,time:0})},hC=(t,e,s,i=!1)=>{i||(t[1]+=2,t[0]+=Ar(-1.5,1.5),t[2]+=Ar(-1.5,1.5)),rC.push({CR:t,flat:i,crit:3===s,float:i||3!==s,text:e,style:mC.mana,time:0})},dC=(t,e)=>{t[1]+=4,t[0]+=Ar(-1,1),t[2]+=Ar(-1,1),rC.push({CR:t,float:!0,text:`+${e} EXP`,style:mC.exp,time:-.5})},uC=(t,e)=>{t[1]+=5.5,t[0]+=Ar(-.5,.5),t[2]+=Ar(-.5,.5),rC.push({CR:t,float:!0,text:`+${e} Fame`,style:mC.fame,time:-.5})},mC={name:{fill:yS("name"),size:18},enemy:{fill:yS("enemy"),size:18},pvp:{fill:yS("pvp"),size:18},nameSmall:{fill:yS("name"),size:14},enemySmall:{fill:yS("enemy"),size:14},pvpSmall:{fill:yS("pvp"),size:14},chatGlobal:{fill:yS("global"),size:14,wrap:150},chatClan:{fill:yS("clan"),size:14,wrap:150},chatParty:{fill:yS("party"),size:14,wrap:150},lev0:{fill:"#919191",size:18},lev1:{fill:yS("name"),size:18},lev2:{fill:"#EEA303",size:18},lev3:{fill:yS("enemy"),size:18},clan:{fill:yS("clan"),size:18},faction0:{fill:yS("f0"),size:18},faction1:{fill:yS("f1"),size:18},faction0Small:{fill:yS("f0"),size:14},faction1Small:{fill:yS("f1"),size:14},phys:{fill:yS("name"),size:28},spell:{fill:yS("spell"),size:35},heal:{fill:yS("health"),size:28},mana:{fill:yS("mana"),size:22},exp:{fill:yS("exp"),size:28},fame:{fill:yS("fame"),size:28},gold:{fill:"#EEDDA3",size:16},misc:{fill:"#A6EBFA",size:16},book:{fill:"#749DEF",size:20},rune:{fill:"#DC9A4D",size:20},itemgrey:{fill:"#747474",size:16},pheal:{fill:yS("health"),size:22},pdmg:{fill:yS("enemy"),size:22}},pC={gold:mC.gold,misc:mC.misc,rune:mC.rune,book:mC.book,common:{fill:"#dddddd",size:20},uncommon:{fill:yS("green"),size:20},rare:{fill:yS("blue"),size:20},epic:{fill:yS("purp"),size:20}},fC=(t,{fill:e,size:s,wrap:i=0})=>{const n=t+e+s;if(oC[n])return oC[n];const a=document.createElement("canvas"),r=a.getContext("2d");return r.font="bold "+s+"px hordes",i>0?gC(a,r,t,0,0,i,s,e):(a.width=Math.max(1,Math.ceil(r.measureText(t).width))+5,a.height=Math.ceil(1.2*s+5),vC(r,s,e),r.fillText(t,0,a.height-6)),oC[n]=a,a},gC=(t,e,s,i,n,a,r,o)=>{const l=s.split(" "),c=[];let h=0,d="";for(let t=0;t<l.length;++t){const s=d+l[t]+" ",i=e.measureText(s);i.width>a?(c.push(d),d=l[t]+" "):(h=Math.max(h,i.width),d=s)}c.push(d),t.width=Math.ceil(h+5),t.height=Math.ceil(c.length*r+10),aC(t,"#00000099",t.width,t.height,0,0,5),vC(e,r,o);for(let t=0;t<c.length;++t)e.fillText(c[t],i+5,(t+1)*r+3)},vC=(t,e,s)=>{t.font="bold "+e+"px hordes",t.shadowColor="#000",t.shadowOffsetX=2,t.shadowOffsetY=-1,t.fillStyle=s},yC=[Object.freeze({__proto__:null,init:()=>{(WS=Ln.canvas2dContext).font="bold 18px hordes",WS.fillText("Hordes",0,0),nC()},postTick:t=>{ro.shift.down?JS():tC();for(let e=0;e<rC.length;e++){const s=rC[e];if(s.time+=t,s.time>2)rC.splice(e--,1);else if(s.time>0){s.float&&(s.CR[1]+=s.flat?.15*t:t);const e=GS(s.CR,Qn,s.flat);e&&VS(e,s.text,s.style,Math.min(1,6-s.time*(s.crit?2:3)),s.crit?1.8+6*Math.max(0,.5-3*s.time):1)}}},uiTimeoutDrops:XS,generateHudElements:nC,add:lC,addHeal:cC,addMana:hC,addExp:dC,addFame:uC,styles:mC}),ng,cb,IS,cf,ad];new class extends Pt{constructor(t){super(),Rt(this,t,qS,NS,o,{})}}({target:document.querySelector("body")});let bC=!1;const xC=t=>{yC.forEach(e=>{e.onWorldEnter&&e.onWorldEnter(t)}),bC=!0},wC=t=>{bC&&yC.forEach(e=>{e.onWorldDestroy&&e.onWorldDestroy(t)}),bC=!1},kC={};let $C;hma.graphics.models=kC;const SC=t=>{$C=t};let CC;const MC=t=>{CC=t},EC=(t,e,s)=>{(e=e||{}).invisible=e.invisible||!1,e.receiveShadow=void 0===e.receiveShadow||e.receiveShadow,e.throwShadow=void 0===e.throwShadow||e.throwShadow;const i=(e=>{let s=0;for(let e=0,i=t.length;e<i;e++)s=Math.imul(31,s)+t.charCodeAt(e);return 2147483647&s})();kC[i]={name:t,geometry:CC+"/"+(s||t+".ho"),texture:$C,meta:e}};SC("atlas1"),MC("city_vg"),EC("city_vg_column",{coll:[Cm,3.59,8.08,3.59]}),EC("city_vg_gate01"),EC("city_vg_house01",{coll:[Cm,12,15.6,10.8]}),EC("city_vg_house_stone_red_roof",{coll:[Cm,12,15.6,10.8]}),EC("city_vg_house_small",{coll:[Cm,12.2,12.2,10.7]}),EC("city_vg_house_barn_small",{coll:[Cm,12.2,12.2,10.7]}),EC("city_vg_house_extra_overhang_01",{coll:[Cm,3.5,5,3.5]}),EC("city_vg_house_tower_01"),EC("city_vg_house_extra_connection_01",{coll:[Cm,8.5,5,3.5]}),EC("city_vg_plaza_round"),EC("city_vg_plaza_square"),EC("city_vg_plaza_star"),EC("city_vg_tower01",{coll:[Cm,9.34,26.06,9.34]}),EC("city_vg_tower02"),EC("city_vg_tower04",{coll:[Sm,1.7,6]}),EC("city_vg_tower_round_base01",{coll:[Sm,4,5]}),EC("city_vg_tower_round_top01",{coll:[Sm,3,2]}),EC("city_vg_wall01",{coll:[Cm,13.2,7.78,2.45]}),EC("city_vg_wall_01_broken",{coll:[Cm,2.2,2.2,1]}),EC("city_vg_door"),EC("city_vg_bridge_01",{coll:[Cm,8,3,17]}),EC("vg_cart_01",{coll:[Cm,11.5,10.5,6.5]}),MC("city_bloodlust"),EC("city_bloodlust_wall_01"),EC("city_bloodlust_building_main_house",{coll:[Sm,14.5,10]}),MC("city_vg/deco"),EC("city_vg_deco_bench_01",{coll:[Cm,1,.05,.5]}),EC("city_vg_deco_bush_double_01",{coll:[Cm,1,1,2]}),EC("city_vg_deco_fence_stone_01",{coll:[Cm,2.5,1.3,.4]}),EC("city_vg_deco_fountain_01",{coll:[Sm,6.3,9]}),EC("city_vg_deco_tree_medium_01",{coll:[Cm,.2,1.5,.2]}),EC("city_vg_deco_well_square_roof_01",{coll:[Cm,1,1.5,1]}),EC("city_vg_deco_lamp"),MC("foliage"),EC("foliage_fern_01"),EC("foliage_palm_tree_01",{coll:[Sm,.3,5]}),MC("misc"),EC("misc_barrel_01",{coll:[Sm,.3,.6]}),EC("misc_crate_01",{coll:[Cm,.7,.7,.7]}),EC("misc_campfire_1",{coll:[Sm,.6,1]}),EC("misc_fence_01",{coll:[Cm,3,1.8,.5]}),EC("misc_anvil",{coll:[Cm,2.15,1.18,1]}),EC("misc_boat_small_01",{coll:[Cm,5.5,2,2.5]}),EC("misc_mine_entrance",{coll:[Cm,4,7,4]}),EC("misc_pier_01",{coll:[Cm,3.1,.8,3.1]}),EC("misc_tent_01",{coll:[Cm,5,4.5,3.8]}),EC("misc_platform",{coll:[Cm,8.9,6.45,8.3]}),EC("misc_lookout",{coll:[Cm,4,6,4]}),EC("misc_bridge_big",{coll:[Cm,15,40,8]}),EC("misc_cart_01",{coll:[Cm,8.8,5.3,5.3]}),EC("misc_stone_rock_slab_quarry_01",{coll:[Cm,8.8,8.8,8.8]}),EC("misc_quarry_crane_01",{coll:[Cm,6.14,16.5,19.5]}),EC("misc_ladder_wood",{coll:[Cm,1.8,5.2,1.8]}),EC("misc_foliage_tree_dead",{coll:[Sm,2.6,7.7]}),EC("misc_market_stand"),EC("misc_house_wood_01",{coll:[Cm,5,5.5,5.2]}),EC("misc_building_desert_house_hut_adobe_tall",{coll:[Cm,8.35,11.55,8.35]}),EC("misc_building_desert_house_hut_adobe_small",{coll:[Cm,8.35,6.35,10.85]}),EC("misc_foliage_desert_cactus_big",{coll:[Sm,.8,2.75]}),EC("misc_foliage_desert_cactus_small",{coll:[Sm,1.35,1.25]}),EC("misc_fortification_wood_details_01",{coll:[Cm,2.75,1.55,1]}),EC("misc_fortification_wood_wall_01",{coll:[Cm,12.5,6.8,6.6]}),EC("misc_fortification_wood_tower_01",{coll:[Cm,8,10.7,8]}),EC("misc_fortification_wood_bridge_01",{coll:[Cm,8.7,1,4.4]}),EC("misc_flag_vg_01",{double:!0,coll:[Cm,.6,1.6,.15]}),EC("misc_flag_vg_02",{double:!0}),EC("misc_flag_bl_01",{double:!0,coll:[Cm,.6,1.6,.15]}),EC("misc_flag_bl_02",{double:!0}),EC("misc_palisade_01",{coll:[Cm,7.8,7,1.5]}),EC("misc_palisade_solo",{coll:[Cm,1.2,6.4,1.2]}),EC("misc_wood_wall_01",{coll:[Cm,6.4,5.5,2.5]}),EC("misc_grave_stone_01",{coll:[Cm,.5,1.2,.8]}),EC("misc_grave_stone_02",{coll:[Cm,.5,1.2,.8]}),EC("misc_grave_wood_01",{coll:[Cm,.5,1.2,.8]}),EC("misc_graveyard_coffin_01",{coll:[Cm,2.13,1.63,3.5]}),EC("misc_graveyard_coffin_open_01",{coll:[Cm,2.13,1.63,3.5]}),EC("misc_statue_cyclops",{coll:[Sm,5,20]}),EC("misc_cage_01",{coll:[Cm,2.6,4,2.6]}),EC("misc_sign",{coll:[Cm,1.8,1.5,.5]}),EC("misc_ruins_big_dome_01",{coll:[Sm,20.5,8.39]}),EC("misc_ruins_big_dome_01_broken",{coll:[Sm,20.5,11.9]}),EC("misc_ruins_big_tower_01",{coll:[Cm,8.77,18.08,8.77]}),EC("misc_ruins_big_tower_broken_01",{coll:[Cm,8.77,13.1,8.77]}),EC("misc_ruins_big_wall_01",{coll:[Cm,15.46,13.64,4.68]}),EC("misc_ruins_big_wall_broken_01",{coll:[Cm,13.79,13.64,4.68]}),EC("misc_ruins_column_01",{coll:[Cm,1.5,5.3,1.5]}),EC("misc_ruins_column_broken_01",{coll:[Cm,1.5,2.25,1.5]}),EC("misc_ruins_slab_01",{coll:[Cm,5.7,2.1,1.9]}),EC("misc_ruins_slab_small_01",{coll:[Cm,1.51,1.1,1.5]}),EC("misc_ruins_stone_01",{coll:[Cm,8.77,18.08,8.77]}),EC("misc_tool_pickaxe"),EC("misc_tool_axe"),EC("misc_tool_axe_double"),EC("misc_tool_hammer"),EC("misc_tool_hoe"),EC("misc_tool_shovel"),EC("misc_hay_bale",{coll:[Cm,4.2,3.7,3.7]}),EC("misc_hay_pile",{coll:[Sm,2,2]}),EC("misc_hay_bundle",{coll:[Sm,2,3]}),EC("misc_bones_big",{coll:[Sm,.7,3]}),EC("misc_bones_skull"),EC("misc_artifacts_monolith_dek_01",{effect:{...hu.mystical01,offset:[0,0,0]},coll:[Cm,3.74,5.28,3.6]}),EC("misc_campfire_lit",{throwShadow:!1,effect:{...hu.campfire,offset:[0,.4,0]},coll:[Sm,.7,.5]},"misc_campfire_1.ho"),EC("misc_lantern",{throwShadow:!1}),SC("rocks1"),MC("rocks"),EC("rock_01",{Pw:10,coll:[Sm,.8,.7]}),EC("rock_02",{Pw:10,coll:[Sm,.4,.5]}),EC("rock_stone_boulder_small_01",{Pw:50,coll:[Sm,4,8]}),EC("rock_stone_boulder_medium_01",{Pw:50,coll:[Sm,6,13]}),EC("rock_stone_tall_medium_01",{Pw:50,coll:[Sm,5.2,21.66]}),SC("props/bush01.png"),MC("foliage"),EC("foliage_bush_01"),SC("props/tree1.png"),MC("foliage"),EC("foliage_tree_huge",{receiveShadow:!1,coll:[Sm,9.64,60]}),EC("foliage_tree_01",{receiveShadow:!1,coll:[Sm,4.1,30]}),EC("foliage_tree_02",{receiveShadow:!1,coll:[Sm,1,10]}),EC("foliage_tree_06",{receiveShadow:!1,coll:[Sm,2,18]}),SC("props/pine_tree.png"),MC("foliage"),EC("foliage_pine_tree",{double:!0,receiveShadow:!0,coll:[Sm,2,40]}),SC("atlas1"),MC("foliage"),EC("foliage_tree_stump",{coll:[Sm,.7,1.5]}),EC("foliage_tree_trunk_01",{coll:[Cm,6,1,1]}),SC("atlas1"),MC("primitives"),EC("primitive_cube_1"),EC("environmental_ocean",{invisible:!0,throwShadow:!1,effect:{...hu.oceanAmbience}},"primitive_cube_1.ho"),EC("environmental_city",{invisible:!0,throwShadow:!1,effect:{...hu.cityAmbience}},"primitive_cube_1.ho"),EC("environmental_mystic",{invisible:!0,throwShadow:!1,effect:{...hu.mysticAmbience}},"primitive_cube_1.ho"),EC("environmental_evil",{invisible:!0,throwShadow:!1,effect:{...hu.evilAmbience}},"primitive_cube_1.ho"),kC.error={geometry:"hordes.io/engine/error.ho",texture:"hordes.io/engine/error.jpg",meta:{}};class _C{constructor(t){this.id=0,this.CR=[0,0,0],this.rot=new hn,this.scale=1}onUpdate(t,e,s){this.shape&&(t.remove(this.shape),this.shape.onRemove());const i=kC[this.id]&&kC[this.id].meta.coll;i&&(this.shape=new i[0](this,s,this.rot[1],ki([0,0,0],e,this.CR),i[1]?i[1]*this.scale:0,i[2]?i[2]*this.scale:0,i[3]?i[3]*this.scale:0),t.add(this.shape))}onRemove(t){this.shape&&(t&&t.remove(this.shape),this.shape.onRemove())}}class RC extends _C{constructor(t){super(t||{})}onUpdate(t,e,s){super.onUpdate(t,e,s);const i=kC[this.id]||kC.error;this.mesh||(this.mesh=ic({geo:i.geometry,tex:i.texture,program:i.meta.Pw?gl.multimeshTileable:gl.multimeshTextured,ts:i.meta.throwShadow,rs:i.meta.receiveShadow,cull:i.meta.double?0:void 0,visible:!i.meta.invisible}),i.meta.Pw&&(this.mesh.data.Pw=this.scale*i.meta.Pw)),ki(this.mesh.position,e,this.CR),this.mesh.rotation.set(this.rot[0],this.rot[1],this.rot[2]),wi(this.mesh.scale,this.scale),this.mesh.updateMatrix(),this.mesh.updateMatrixWorld(!0),this.mesh.data.multi.needsUpdate=!0,i.meta.effect&&void 0===this.effect&&(this.effect=lc(i.meta.effect,this.effect),this.effect.data.origin=[0,0,0],void 0!==i.meta.effect.offset&&bi(this.effect.data.origin,i.meta.effect.offset),bi(this.effect.position,this.effect.data.origin),this.effect.setParent(this.mesh),this.effect.updateMatrix(),this.effect.updateMatrixWorld(!0))}onRemove(t){super.onRemove(t),this.effect&&(this.effect.setParent(null),this.effect.data.remove=!0),this.mesh&&(this.mesh.data.multi.remove(this.mesh),this.mesh=void 0)}onHide(){this.effect&&(this.effect.data.remove=!0,this.effect=void 0)}}class PC{constructor(t){this.id=t.id,this.origin=[64*t.x,0,64*t.z],this.center=ki([0,0,0],this.origin,[32,0,32]),this.deserialized=!1,this.props={},this.intHeights=[],this.normals=[],this.steepness=[],this.left=void 0,this.right=void 0,this.front=void 0,this.back=void 0,this.frontRight=void 0,this.backLeft=void 0}tickDelta(){}tickFixed(){}deserialize(t){this.parse(tr.chunk.decode(t))}parse(t){if(this.data=t,0==this.normals.length)for(let t=0,e=8192;t<e;++t)this.normals[t]=[0,0,0];this.unpackIntHeights(),this.unpackProps(),this.deserialized=!0}getIndex(t,e,s){return t+(s?64:65)*e}getIndexFromWorld(t,e,s){return t-=this.origin[0],e-=this.origin[2],this.getIndex(t,e,s)}getHeight(t,e){const s=t%1,i=e%1;if(0===s&&0===i)return.030517578125*this.intHeights[t+65*e];{const n=Math.floor(t),a=Math.floor(e),r=s+i<1,o=r?-(s-1+i):-(i-1),l=r?i:-(s-1);return.030517578125*(o*this.intHeights[n+65*a+(r?0:1)]+l*this.intHeights[n+65*(a+1)]+(1-o-l)*this.intHeights[n+1+65*(a+(r?0:1))])}}getHeightFromWorld(t,e){return t-=this.origin[0],e-=this.origin[2],this.getHeight(t,e)}getTriangleIndex(t,e){let s=2*Math.floor(t)+64*Math.floor(e)*2;return t%1+e%1>1&&s++,s}getNormal(t,e){return this.normals[this.getTriangleIndex(t,e)]}getSteepness(t,e){return this.steepness[this.getTriangleIndex(t,e)]}updateTriangles(t=!1){for(let e=0;e<64;++e)for(let s=0;s<64;++s){if(t&&s>1&&e>1&&e<63&&s<63)continue;const i=2*s+64*e*2;let n=this.normals[i];xi(Yn,s,this.getHeight(s,e),e),xi(Xn,s,this.getHeight(s,e+1),e+1),xi(Zn,s+1,this.getHeight(s+1,e),e),la(n,Yn,Xn,Zn),this.steepness[i]=1-Ri(n,Hn),n=this.normals[i+1],xi(Yn,s+1,this.getHeight(s+1,e),e),xi(Zn,s+1,this.getHeight(s+1,e+1),e+1),la(n,Yn,Xn,Zn),this.steepness[i+1]=1-Ri(n,Hn)}}unpackIntHeights(){for(let t=0;t<65;++t)for(let e=0;e<65;++e){const s=e+65*t;if(64==e||64==t){const i=this.getNeighborChunk(e,t);i&&i.deserialized?this.intHeights[s]=i.intHeights[e%64+t%64*65]:this.intHeights[s]=this.intHeights[64==e?s-1:e+65*(t-1)]}else this.intHeights[s]=0==e?this.data.terrain.readUInt16BE(65*t):this.intHeights[s-1]+(this.data.terrain.readUInt8(65*t+1+e)-127)}this.updateTriangles()}getNeighborChunk(t,e){return t<64?this.front:e<64?this.right:this.frontRight}getWorldFromLocal(t){return[t[0]+this.origin[0],t[1],t[2]+this.origin[2]]}unpackProps(){const t={};for(let e=0,s=this.data.props.length;e<s;++e){const s=this.data.props[e];null==this.props[s.id]&&(this.props[s.id]=[]),void 0===t[s.id]&&(t[s.id]=0);const i=Xc(this,this.props[s.id][t[s.id]]||new RC,s);i.onUpdate(qn.grids.props,this.origin,qn.bounds),this.props[s.id][t[s.id]]=i,t[s.id]++}for(const e in this.props){const s=t[e]||0;if(this.props[e]&&s<this.props[e].length){for(let t=s;t<this.props[e].length;++t)this.props[e][t].onRemove(qn.grids.props);this.props[e].splice(s)}}}destroy(){this.left=void 0,this.right=void 0,this.front=void 0,this.back=void 0,this.frontRight=void 0,this.backLeft=void 0;for(const t in this.props)this.props[t].forEach(t=>t.onRemove())}}const TC=0,IC=t=>(t+1>>>1)-1,DC=t=>1+(t<<1),AC=t=>t+1<<1,FC=new class{constructor(t=((t,e)=>t>e)){this._heap=[],this._comparator=t}size(){return this._heap.length}isEmpty(){return 0==this.size()}peek(){return this._heap[TC]}push(...t){return t.forEach(t=>{this._heap.push(t),this._siftUp()}),this.size()}pop(){const t=this.peek(),e=this.size()-1;return e>TC&&this._swap(TC,e),this._heap.pop(),this._siftDown(),t}replace(t){const e=this.peek();return this._heap[TC]=t,this._siftDown(),e}_greater(t,e){return this._comparator(this._heap[t],this._heap[e])}_swap(t,e){[this._heap[t],this._heap[e]]=[this._heap[e],this._heap[t]]}_siftUp(){let t=this.size()-1;for(;t>TC&&this._greater(t,IC(t));)this._swap(t,IC(t)),t=IC(t)}_siftDown(){let t=TC;for(;DC(t)<this.size()&&this._greater(DC(t),t)||AC(t)<this.size()&&this._greater(AC(t),t);){const e=AC(t)<this.size()&&this._greater(AC(t),DC(t))?AC(t):DC(t);this._swap(t,e),t=e}}}((t,e)=>t.id>e.id);class zC extends PC{constructor(t){super(t),this.geometry={},this.meshes={},this.state=0}load(){this.state>0||(FC.push(this),this.state=1,fetch(`worlddata/${qn.id}/${this.id}`+"?v=3406973",{cache:"default"}).then(t=>{t.arrayBuffer().then(t=>{this.loaded=Ua(t),FC.peek().queueLoad()})}))}queueLoad(){if(this.loaded){this.state=2,this.deserialize(this.loaded),this.meshes.terrain.updateMatrix(),this.meshes.terrain.updateMatrixWorld(),this.loaded=void 0,FC.pop();const t=FC.peek();t?t.queueLoad():qn.unsetLoading&&(qt.set(!1),qn.unsetLoading=!1,Ut.set({type:"Pp",text:qn.id.replace("_"," "),time:5e3}),xC(qn))}}isInRange(t){return!(t.player&&Mi(t.player.CR,this.center)-32>Ah)}tickDelta(t,e,s){if(super.tickDelta(t,e,s),this.isInRange(s)){if(this.state<1)this.load();else if(this.state>=2&&null==this.meshes.terrain.parent){for(const t in this.props)this.props[t].forEach(t=>t.onUpdate(s.grids.props,this.origin,s.bounds));this.meshes.terrain.setParent(Ih)}}else if(this.state>=2&&null!==this.meshes.terrain.parent){for(const t in this.props)this.props[t].forEach(t=>t.onHide());this.meshes.terrain.setParent(null)}}parse(t){gi.detailprops||(t.props=t.props.filter(t=>kC[t.id].meta.coll)),super.parse(t,gi.detailprops),this.rebuild({heightmap:!0,texture:!0,foliage:!0,props:!0,water:!0});const e={heightmap:!0,triangles:!0,texture:!0,foliage:!1,water:!0,seams:!0,props:!1};this.left&&this.left.state>1&&this.left.rebuild(e),this.back&&this.back.state>1&&this.back.rebuild(e),this.backLeft&&this.backLeft.state>1&&this.backLeft.rebuild(e)}rebuild(t={heightmap:!0,texture:!0,foliage:!0,intHeights:!1,props:!0,water:!0}){t.intHeights?this.unpackIntHeights():(t.heightmap||t.triangles)&&(t.seams&&this.updateHeightmapSeam(),this.updateTriangles(t.seams)),t.unpackprops&&this.unpackProps(),Lh(this,t)}updateHeightmapSeam(){for(let t=0;t<65;++t)for(let e=64==t?0:64;e<65;++e){const s=this.getNeighborChunk(e,t),i=e+65*t;s&&s.deserialized&&(this.intHeights[i]=s.intHeights[e%64+t%64*65])}}destroy(){super.destroy(),Nh(this)}sendToServer(){storeChunk(this.id,qn.id,this.serializedData)}}class BC{constructor(t,e){this.size=t,this.div=e,this.cellCount=e*e,this.cellSize=t/e,this.cells=[];for(let t=0;t<this.cellCount;++t)this.cells.push([])}localize(t){let e=!1;return e=t.gl!=(t.gl=Math.floor(t.l/this.cellSize))||e,e=t.gr!=(t.gr=Math.ceil(t.r/this.cellSize))||e,e=t.gu!=(t.gu=Math.floor(t.u/this.cellSize))||e,t.gd!=(t.gd=Math.ceil(t.d/this.cellSize))||e}add(t){this.localize(t);for(let e=t.gu;e<t.gd;++e)for(let s=t.gl;s<t.gr;++s)this.cells[e*this.div+s].push(t)}update(t){const e=t.gl,s=t.gr,i=t.gu,n=t.gd;if(this.localize(t))for(let a=Math.min(i,t.gu);a<Math.max(n,t.gd);++a)for(let i=Math.min(e,t.gl);i<Math.max(s,t.gr);++i){const e=a>=t.gu&&a<t.gd&&i>=t.gl&&i<t.gr,s=this.cells[a*this.div+i],n=s.indexOf(t);!e&&n>=0?s.splice(n,1):e&&n<0&&s.push(t)}}remove(t){for(let e=t.gu;e<t.gd;++e)for(let s=t.gl;s<t.gr;++s){const i=e*this.div+s,n=this.cells[i].indexOf(t);n>=0&&this.cells[i].splice(n,1)}}query(t){const e=Math.floor(t.l/this.cellSize),s=Math.ceil(t.r/this.cellSize),i=Math.floor(t.u/this.cellSize),n=Math.ceil(t.d/this.cellSize),a=[];for(let r=i;r<n;++r)for(let i=e;i<s;++i){const e=this.cells[r*this.div+i];for(let s=0,i=e.length;s<i;++s){const i=e[s];i!=t&&qp(t,i)&&a.indexOf(i)<0&&a.push(i)}}return a}}class UC extends Mu{constructor(t){super({Jm:ru.blacksteel,colEyes:ru.fireorange,...t}),this.eyes.position[1]+=.1,this.kilt=this.mesh(this.chest,null,ru.leather),xi(this.kilt.scale,1.1,.6,.4),this.kilt.position[1]=-.5,this.kilt.position[2]=.35,this.hammer=this.mesh(this.hands[0],null,ru.woodbrown),xi(this.hammer.scale,.25,.25,1.2),this.hammerhead=this.mesh(this.hammer,null,ru.darksteel),this.setShoulders(ru.greysteel)}tickParts(t,e,s){super.tickParts(t,e,s),this.hands[0].position[2]-=.1,this.hands[0].rotation[1]-=.4,this.hands[0].rotation[0]+=.9,this.hands[0].rotation.onChange()}}class OC extends Gp{constructor(t){super({size:1.2,name:"Blacksmith",...t})}static get type(){return 6}}class jC extends OC{constructor(t){super({...t,...qh.npcs.blacksmith})}remakeTransform(){super.remakeTransform(),this.transform=new UC({entity:this})}}class LC extends Mu{constructor(t){super({Jm:ru.paleskin,...t}),this.robe=this.mesh(this.chest,"character/robe.ho",ru.magicblue),xi(this.robe.scale,1.2,1.2,1.2),this.robe.rotation.set(0,0,0),xi(this.robe.position,0,-.9,.05)}tickFixed(){}tickParts(t,e,s){super.tickParts(t,e,s),this.hands.forEach((t,e)=>{if(!t.visible)return;const s=this.cycle(1.3);t.rotation.set(.78,0,e?.2*s:.2*-s),xi(t.position,e?.2:-.2,-.4,.6)})}}class NC extends Gp{constructor(t){super({size:1.2,name:"Conjurer",...t})}static get type(){return 2}}class qC extends NC{constructor(t){super({...t,...qh.npcs.conjurer})}interact(t){const e=Ua.from(t.splice(1)).toString().split("#");""!==e[0]?this.setDialogue(this.interactions[0].text,Array.from(e,t=>{const e=t.split("~");return this.interactions[0].choices[0].replace("$1",e[0])+(e[1]>0?` (Lv. ${e[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(t)}remakeTransform(){super.remakeTransform(),this.transform=new LC({entity:this})}}class HC extends Tm{constructor(t){super(t),this.partytimeout=0,this.party=0,this.type="",this.tier=0,this.quality=0}async init(t){await super.init(t)}static get type(){return 3}partyTimeoutCheck(t){return 0===this.party||t.id===this.party||t.party===this.party||qn.time>this.partytimeout}canBePickedUpBy(t){return this.partyTimeoutCheck(t)&&t.squaredDistance(this.CR)<30}}class WC extends HC{constructor(t){super(t),this.transform=ic({geo:"drop/drop.ho",tex:"items.png",program:gl.drop,ts:!1,rs:!1,dynamic:!1}),this.transform.rotation.reorder("ZXY"),this.transform.data.multi.needsUpdate=!1,this.size=.7,this.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(t,e,s){if(this.transform.visible&&this.dirty&&s.getChunkFromWorld(this.CR[0],this.CR[2]).deserialized){this.CR[1]=this.getWorldYBody(s,this.CR[0],this.CR[2])+.1*Math.random()+.1,this.transform.position[0]=this.CR[0],this.transform.position[1]=this.CR[1],this.transform.position[2]=this.CR[2],xi(Qn,0,1,0);const t=s.getNormal(this.CR[0],this.CR[2]);ea.fromVectors(Qn,t),this.transform.rotation.fromQuaternion(ea),this.transform.rotation[1]=this.rot,this.transform.rotation.onChange(),this.transform.matrixAutoUpdate=!0,this.transform.updateMatrixWorld(!0),this.transform.data.multi.needsUpdate=!0,this.dirty=!1}}setXZPos(t){this.hasPos||(this.hasPos=!0,super.setXZPos(t),this.dirty=!0)}setRot(t){this.hasRot||(this.hasRot=!0,super.setRot(t),this.dirty=!0)}setDropInfo(t,e,s,i,n){let a,r;this.hasInfo=!0,this.party=i,this.partytimeout=n,this.type=jr[t],this.tier=e,this.quality=s,"gold"==this.type?(this.name=this.tier+"c",this.size=.4,a="gold",this.color="gold",this.quality=100):(a=this.type+this.tier,(r=Kp[a])&&(this.name=Wh(this.type,this.tier)),"misc"!==this.type&&"rune"!==this.type&&"book"!==this.type?(this.color=lu(s)[1],gi.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.type,this.quality=100));const o=r&&r.art||a;this.transform.data.DJ=Cr[o],xi(this.transform.scale,20*Cr[o][0],1,20*Cr[o][1]),this.transform.data.ZV=[6.1*Math.random(),0,0,0],this.dirty=!0,this.transform.visible=!0}onRemove(){this.transform.data.multi.remove(this.transform),this.transform.setParent(null),ro.shift.down&&(XS.add(this),this.uiTimeout=5*Math.round(qn.time/5)+10)}}const QC={0:{size:3,name:"King",stationary:!0,nodespawn:!0,exp:2,aggroRange:35,statfactor:{0:20,10:20,11:20,1:200,15:4},skills:[0,3]},1:{size:2,name:"Warden",stationary:!0,nodespawn:!0,exp:2,aggroRange:35,statfactor:{10:20,11:20,0:20,1:100,15:5},skills:[0,2,3,33]},2:{size:.9,name:"Grub",height:.8,skills:[0]},3:{size:1.1,exp:1,name:"Skeleton",skills:[0]},4:{size:1.2,exp:1,name:"Zombie",skills:[0]},5:{size:1,exp:1,name:"Crawler",height:.8,skills:[0]},6:{size:1,exp:1,name:"Skeleton Archer",statfactor:{10:.35,11:.35},skills:[5]},7:{size:1,exp:2,name:"Golem",height:2.8,statfactor:{10:2,11:2,6:1.5,15:.6},skills:[0]},8:{size:1,exp:1.5,name:"Warrior",statfactor:{6:1.5,15:1.2},skills:[0]},9:{size:1,exp:1,name:"Archer",statfactor:{6:.8,11:.35,10:.35,15:1.2},skills:[5]},10:{size:1.3,exp:2,name:"Warrior",statfactor:{6:3,15:1.3},skills:[0]},11:{size:1,exp:0,height:2.7,statfactor:{6:100,8:100}}};class VC extends Qp{constructor(t){super({size:1,name:"Training Dummy",...t}),this.static=!0,this.class=5,this.behavior=QC[11],this.height=this.behavior.height}static get type(){return 7}}class GC extends Su{constructor(t){super(t),this.block=this.mesh(this,null,ru.woodbrown),xi(this.block.scale,.3,3,.3),xi(this.block.position,0,-.5,0),this.chest=this.mesh(this,null,ru.woodbrown2),xi(this.chest.scale,1,2,1),xi(this.chest.position,0,.9,0),this.arms=this.mesh(this,null,ru.woodbrown),xi(this.arms.scale,3,.3,.3),xi(this.arms.position,0,1.1,0)}tickFixed(t,e,s){this.tickPushBack(t,e,s)}tickParts(t,e,s){this.rotation.set(2*-this.pushBack[1],this.entity.rot,2*this.pushBack[0])}}class YC extends VC{constructor(t){super({...t}),this.remakeTransform()}remakeTransform(){super.remakeTransform(),this.transform=new GC({entity:this})}}class XC{constructor(t){this.entity=t,this.slots=new Map,this.gold=0,this.setSize(0)}tickFixed(t,e,s){}setSize(t){this.size=t}setGold(t){this.gold=t}setItem(t,e){const s=new Pw(e);return this.slots.set(t,s),s}removeItem(t){const e=this.slots.get(t);return this.slots.delete(t),e}async hydrateItems(){const t=[],e=[];if(this.slots.forEach((s,i)=>{s.dirty&&(s.dirty=!1,t.push(s.dbid),e.push(i))}),t.length){const s=await this.fetchData(t);this.compareData(s,e,0),this.postHydrate(e)}}hydrate(t){this.slots.has(t.slot)?this.slots.get(t.slot).hydrate(t):console.error("received hydration of unknown item")}postHydrate(t){}compareData(t,e,s){t.forEach(t=>{null!==t.slot&&(this.hydrate(t),e=e.filter(e=>e!==t.slot))}),e.forEach(t=>this.removeItem(t,s))}findFirstItemOfType(t,e){for(const s of this.slots)if(s[1].type==t&&s[1].tier==e)return s[1]}findFirstSlotOfType(t,e){for(const s of this.slots)if(s[1].type==t&&s[1].tier==e)return s[0]}findByDbid(t){for(const e of this.slots)if(e[1]&&e[1].dbid===t)return e;throw"Item not found"}}let ZC=void 0;class JC extends XC{constructor(t){super(t),this.dirty=!1}tickFixed(t,e,s){super.tickFixed(t,e,s),this.dirty&&(this.hydrateItems(),this.dirty=!1)}setGold(t,e,s){super.setGold(t),Rw(t,e,s),Xt.set(t)}setItem(t,e,s){super.setItem(t,e).reason=s,this.dirty=!0}removeItem(t,e){_w(super.removeItem(t),e),ZC[t].set(void 0),this.dirty=!0,this.updateInventoryCounts()}hydrate(t){t.store=ZC[t.slot],super.hydrate(t)}postHydrate(t){super.postHydrate(t),this.updateInventoryCounts()}updateInventoryCounts(){const t={};this.slots.forEach(e=>{const s=e.type+e.tier;t[s]=(t[s]||0)+(e.stacks?e.stacks:1)}),Kt.set(t)}async fetchData(t){const e=await fetch("/api/item/get",{method:"POST",body:JSON.stringify({ids:t})}),s=await e.json();if(!s.fail)return s;console.error(s)}setSize(t){super.setSize(t),Jt.update(t=>{for(let e=109;e>=0;--e)e>=101?t[e]||(t[e]=It(void 0)):e>=this.size?t[e]&&delete t[e]:t[e]||(t[e]=It(void 0));return ZC=t,t})}}class KC extends Mu{constructor(t){super({Jm:t.colPrim||ru.archergreen,colEyes:t.colPrim&&ru.fireorange,...t}),!1!==t.quiver&&(this.quiver=this.mesh(this.chest,null,t.colPrim||ru.leather),xi(this.quiver.scale,.27,.5,.27),xi(this.quiver.position,0,-.15,-.7),this.quiver.rotation.set(-.15,0,-.4),this.quiverTop=this.mesh(this.quiver,null,t.colSec||ru.linen),xi(this.quiverTop.scale,1.2,.8,1.2),xi(this.quiverTop.position,0,.8,0)),this.bow=this.mesh(this.hands[1],"character/bow.ho",t.colSec||ru.woodbrown),this.bow.rotation.set(0),this.bow.position[2]=-.1,this.setShoulders(t.colSec||ru.woodbrown,.8),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colPrim||ru.leather)),this.capeswing=!1}tickParts(t,e,s){if(super.tickParts(t,e,s),this.hands[1].visible&&(this.hands[1].rotation.set(.2,1.7+.15*this.cycleSin,.4),xi(this.hands[1].position,.1+.2*this.cycleSin,-.3,.9),this.entity.target>0&&(this.hands[1].position[0]=.2,this.hands[1].position[1]+=.15,this.hands[1].position[2]+=.1,this.hands[1].rotation[0]+=.2,this.hands[1].rotation[1]=1.8,this.hands[1].rotation[2]-=.2,this.hands[1].rotation.onChange()),this.currentAnim))switch(this.currentAnim.id){case 5:{this.sheathe(!1);const t=oa.easeOutQuad(ia(2*this.currentAnim.time,0,1));this.hands[1].rotation.set(1,2,.3),xi(this.hands[1].position,.2,0,.8+.8*t),xi(this.hands[0].position,-.1-.6*Math.sin(2*t),.1*t,.8-.8*t),xi(this.chest.position,0,.6-.2*t,0),this.chest.rotation.set(.2-.2*t,.3*t-.4,0);break}case 7:{this.sheathe(!1);const t=oa.easeOutFlick(ia(2*(this.currentAnim.fract-.5),0,1));this.hands[1].rotation.set(1,2,.3+.1*t),xi(this.hands[1].position,.2,.3*t,1.6),xi(this.hands[0].position,-.7,.1,.7*-t),xi(this.chest.position,0,.4,0),this.chest.rotation.set(0,-.1,0);break}case 8:{this.sheathe(!1);const t=oa.easeOutQuad(ia(2*this.currentAnim.fract,0,1));xi(this.hands[0].position,-.5-.3*t,.3*t-.3,.6*Math.sin(6.28*t)),this.hands[1].rotation.set(.2+.5*t,2,.3),xi(this.hands[1].position,.2,.3*t-.4,.8+.8*t),this.chest.rotation[1]=0,this.chest.rotation[0]=.2*t-.2,this.chest.rotation.onChange()}}!this.walking&&this.legs[0].visible&&(this.legs[0].position[2]-=.3,this.legs[1].position[2]+=.1)}}class tM extends Qp{constructor(t){super({size:.9,...t}),this.exp=0,this.party=0,this.partyRole=0,this.fame=0,this.fameRank=0,this.clan=void 0,this.clanRole=0,this.latencyPositionHistory=new Map}static get type(){return 0}tickFixed(t,e,s){this.tickVerticalMovement(t),this.tickTerrainMovement(t),super.tickFixed(t,e,s),this.tickPropCollisions(),this.clampWorldPos(),this.updateShape()}tickVerticalMovement(t){this.onGround?(this.stats.alive&&this.jump&&this.speed>0?(this.vel[1]<=0&&(this.vel[1]=9),this.onGround=!1):this.vel[1]=-27*t,this.horizontalSteer(1)):this.vel[1]=Math.max(-20,this.vel[1]-27*t)}tickTerrainMovement(t){const e=qn.clampV3(Ci(Qn,this.CR,this.vel,t));let s=qn.getNormal(e[0],e[2]);const i=qn.getSteepness(e[0],e[2]),n=this.getWorldYBody(qn,e[0],e[2]);if(n>=e[1]||this.onGround&&i<.35&&e[1]-n<.05){e[1]=n;let a=this.onGround;if(this.onGround=i<.35,a=!this.onGround&&a,!this.onGround){a&&((s=bi(Qn,s))[1]=0,_i(s,s));const i=Ri(this.vel,s),n=Si(Qn,s,i);$i(this.vel,this.vel,n),Ci(e,this.CR,this.vel,t)}}else this.onGround=!1,Math.abs(this.vel[0])<1&&Math.abs(this.vel[2])<1&&this.horizontalSteer(.5);bi(this.CR,e)}tickPropCollisions(){const t=qn.grids.props.query(this.shape);for(let e=0,s=!0;s&&e<3;++e){s=!1;for(let e=0;e<t.length;++e){const i=Hp(this.shape,t[e],!1);if(0!=i[0]||i[1]!=[0]||0!=i[2]){ki(this.CR,this.CR,i),i[1]>0&&(this.onGround=!0,this.onProp=!0),_i(i,i);const t=Ri(this.vel,i),e=Si(Qn,i,t);$i(this.vel,this.vel,e),this.shape.aabb(),s=!0}}}}setExp(t){this.exp=t}setParty(t,e){this.party=t,this.partyRole=e}setFame(t){return t!==this.fame&&(this.fame=t,this.fameRank=Hw(t),!0)}setClan(t,e=0){this.clan=t,this.clanRole=e}getNearbyPartyMembers(t){const e=[];return this.stats.alive&&e.push(this),this.party>0&&qn.entities.type[0].forEach(s=>{s.party==this.party&&s!=this&&s.stats.alive&&Ei(t,s.CR)<1e3&&e.push(s)}),e}calculatePartyItemFind(t){let e=0;return t.forEach(t=>{e+=t.stats.getStat(18)}),e/Math.max(1,t.length)/100}canCombatInteract(t){return!qn.mode.pvpprotect||this.hostility(t)<2||0!==t.constructor.type||Math.abs(this.level-t.level)<=5+Math.max(this.skills.pvpBoundModifier,t.skills.pvpBoundModifier)}recordLatencyPosition(t){let e;this.latencyPositionHistory.forEach((s,i)=>{i<t-100&&(e=s,this.latencyPositionHistory.delete(i))}),ga(e=e||[-0,-0],this.CR),this.latencyPositionHistory.set(t,e)}getClosestLatencyPosition(t){let e,s=1/0;return this.latencyPositionHistory.forEach((i,n)=>{const a=function(t,e){const s=e[0]-t[0],i=e[1]-t[1];return s*s+i*i}(t,i);a<s&&(s=a,e=i)}),e}reconciliateLatencyPosition(t){const e=this.getClosestLatencyPosition(t);if(void 0!==e){const s=Pn(Kn,e,t),i=Dn(s);i>.5*this.speed&&i<10&&(s[0]*=.3,s[1]*=.3,this.latencyPositionHistory.forEach(t=>{t[0]-=s[0],t[1]-=s[1]}),this.CR[0]-=s[0],this.CR[2]-=s[1])}return e}}class eM extends Mu{constructor(t){super({Jm:ru.mageblue,...t}),this.staff=this.mesh(this.chest,null,ru.woodbrown),xi(this.staff.scale,.2,2,.2),xi(this.staff.position,0,0,-.6),this.staff.rotation.set(0,0,.4),this.staffhead=this.mesh(this.staff,null,ru.linen),xi(this.staffhead.scale,1.2,.6,1.2),xi(this.staffhead.position,0,0,0),this.staffhead.data.lod=.7,this.brochure=this.mesh(this.chest,null,ru.bone),xi(this.brochure.position,0,.4,.54),this.brochure.rotation.set(0,0,.78),xi(this.brochure.scale,.3,.3,.05),this.staffhead.data.lod=.5,this.setShoulders(ru.leather),this.capeswing=!1}}class sM extends Mu{constructor(t){super({Jm:ru.shamanblue,...t}),this.back=this.mesh(this.chest,null,ru.bone),xi(this.back.scale,1,1,.2),xi(this.back.position,0,.1,-.6),this.back.rotation.set(0,0,.25*Math.PI),this.kilt=this.mesh(this.chest,null,ru.bone),xi(this.kilt.scale,.5,.7,.1),this.kilt.position[1]=-.65,this.kilt.position[2]=.5,this.weapon=this.mesh(this.hands[0],null,ru.woodbrown),xi(this.weapon.scale,.25,1,.25),this.hammerhead=this.mesh(this.weapon,null,ru.darksteel),xi(this.hammerhead.scale,1.6,.5,2.6),xi(this.hammerhead.position,0,.6,0),this.sheathedWeaponPos=[0,0,-.7],this.unsheathedWeaponPos=[0,0,0],this.sheathe(!1),this.setShoulders(ru.leather)}setCape(t,e){super.setCape(t,e),void 0!==this.cape&&!1!==t&&xi(this.cape.position,0,.2,-.75)}}class iM extends Mu{constructor(t){super({Jm:t.Jm||t.colPrim||ru.warbrown,colEyes:t.colPrim&&ru.fireorange,...t}),this.weapon=this.mesh(this.hands[0],"character/sword.ho",t.colSec||ru.tealsteel),this.shield=this.mesh(this.hands[1],"character/shield.ho",t.colSec||ru.darksteel),this.setShoulders(t.colSec||ru.greysteel),this.sheathedWeaponPos=[0,0,-.5],this.unsheathedWeaponPos=[0,.8,0],this.sheathe(!1)}}const nM=[iM,class extends Mu{constructor(t){super({Jm:ru.mageblue,...t}),this.staff=this.mesh(this.chest,null,ru.woodbrown),xi(this.staff.scale,.2,2,.2),xi(this.staff.position,0,0,-.6),this.staff.rotation.set(0,0,.4),this.staffhead=this.mesh(this.staff,null,ru.linen),xi(this.staffhead.scale,1.2,.6,1.2),xi(this.staffhead.position,0,0,0),this.staffhead.data.lod=.7,this.brochure=this.mesh(this.chest,null,ru.bone),xi(this.brochure.position,0,.4,.54),this.brochure.rotation.set(0,0,.78),xi(this.brochure.scale,.3,.3,.05),this.staffhead.data.lod=.5,this.setShoulders(ru.leather),this.capeswing=!1}},KC,class extends Mu{constructor(t){super({Jm:ru.shamanblue,...t}),this.back=this.mesh(this.chest,null,ru.bone),xi(this.back.scale,1,1,.2),xi(this.back.position,0,.1,-.6),this.back.rotation.set(0,0,.25*Math.PI),this.kilt=this.mesh(this.chest,null,ru.bone),xi(this.kilt.scale,.5,.7,.1),this.kilt.position[1]=-.65,this.kilt.position[2]=.5,this.weapon=this.mesh(this.hands[0],null,ru.woodbrown),xi(this.weapon.scale,.25,1,.25),this.hammerhead=this.mesh(this.weapon,null,ru.darksteel),xi(this.hammerhead.scale,1.6,.5,2.6),xi(this.hammerhead.position,0,.6,0),this.sheathedWeaponPos=[0,0,-.7],this.unsheathedWeaponPos=[0,0,0],this.sheathe(!1),this.setShoulders(ru.leather)}setCape(t,e){super.setCape(t,e),void 0!==this.cape&&!1!==t&&xi(this.cape.position,0,.2,-.75)}}];class aM extends tM{constructor(t){super(t)}setClass(t){t!==this.class&&(super.setClass(t),this.remakeTransform())}remakeTransform(t){super.remakeTransform(),this.transform=new(t||nM[this.class])({entity:this}),this.fame>0&&this.setFame(this.fame,!0),this.level>=10&&this.setLevel(this.level)}setFame(t,e){if(super.setFame(t)||e){if(!this.transform)return;this.fameRank<1?(this.transform.setCrown(!1),this.transform.setHeadgear(!1)):(this.transform.setHeadgear(ou[Math.min(4,this.fameRank)]),this.fameRank>=5?this.transform.setCrown(ou[this.fameRank%5]):this.transform.setCrown(!1))}}setLevel(t){super.setLevel(t),this.transform&&(t>=15?this.transform.setCape(0===this.faction?ru.vanguard:ru.bloodlust,t>=25?1:.5):this.transform.setCape(!1))}}const rM=t=>1+.21*(t-1);class oM extends aM{constructor(t){super(t),qn.setPlayer(this),this.input=new Map,this.inputLast=new Map,this.parsedFirstInput=!1,this.skills.isPlayer=!0,this.skills.clearSkillInfo(),this.inventory=new JC(this),this.netSendTimer=new Dl(0,.4),this.partyInfoUpdateTimer=new Dl(0,1),this.heartBeatTimer=new Dl(0,1),this.lastNetRot=0,this.torch=!1}tickFixed(t,e,s){super.tickFixed(t,e,s),this.inventory.tickFixed(t,e,s),this.serverInputTick++}preFixed(t,e,s){this.buffs.movementOverride.size||(this.setSteer([ro.left.down?1:ro.right.down?-1:0,ro.fwd.down||ro.lmb.down&&ro.rmb.down?1:ro.back.down?-1:0]),this.setJump(ro.jump.down?1:0),(ro.turnright.down||ro.turnleft.down)&&(ao[0]=da(ao[0]+3*gi.mouseSensitivity*t*((ro.turnleft.down?1:0)-(ro.turnright.down?1:0)))),(gi.lockedcamera&&ro.lmb.down||ro.rmb.down||ro.turnleft.down||ro.turnright.down)&&this.setRot(ao[0]))}postFixed(t,e,s){super.postFixed(t,e,s),this.recordLatencyPosition(s.tickId)}sendInput(t){if(this.input.set("steer",qc([this.steer[0]+1,this.steer[1]+1])),this.input.set("jump",this.jump),this.netSendTimer.done(t)&&this.input.set("rot",jc(this.rot,ca)),this.parsedFirstInput&&this.compareDelta(this.input,this.inputLast,!1)||this.netSendTimer.passed(t)>.05&&Math.abs(this.rot-this.lastNetRot)>.05||this.netSendTimer.done(t)){const e=hma.handle.data.clientPlayerInput.packData({steer:this.input.get("steer"),jump:this.input.get("jump"),rot:jc(this.rot,ca),CR:Wc([this.CR[0],this.CR[2]],768),tickId:qn.tickId});fd(e),this.lastNetRot=this.rot,this.netSendTimer.reset(t)}}updateCharPanel(){(gi.charpanelOpen||gi.skillmenuOpen)&&this.statsDirty&&(this.statsDirty=!1,xe.update(t=>(Array.from(this.stats.stat).forEach(e=>t[e[0]]=e[1]),t)))}updatePartyInfo(t){if(this.partyInfoUpdateTimer.done(t)){this.partyInfoUpdateTimer.reset(t);const e=this.getNearbyPartyMembers(this.CR),s=rM(e.length);At.update(t=>(t.nearby=e.length,t.exprate=Math.round(100*s),t.itemfind=Math.round(100*s+100*this.calculatePartyItemFind(e)),t))}}handleCamera(t){if(On.rotation[0]=ia(.7*ao[1],-1.5,1.5),!ro.lmb.down&&(0!==this.steer[0]||0!==this.steer[1])){let e=pa(this.rot,ao[0])*t*2;0!==e&&(Math.abs(e)>.03*t?(e=e>0?Math.max(e,.6*t):Math.min(e,-.6*t),ao[0]-=e):ao[0]=this.rot)}On.rotation[1]=ao[0],On.rotation.onChange(),On.updateMatrixWorld(),xi(Un.position,0,1,-gi.cameraZoom),Un.updateMatrixWorld(),On.position[1]+=Math.max(0,qn.getHeight(ia(Un.worldPosition[0],0,qn.bounds),ia(Un.worldPosition[2],0,qn.bounds))-Un.worldPosition[1])+2*Math.tan(Un.fov*Math.PI/180/2)*Un.near}handleHeartbeat(t){let e=this.stats.getResource(6)/(.5*this.stats.getStat(6));this.heartBeatTimer.done(t)&&e>0&&e<1&&(e=(Math.max(0,Math.min(1,e))+.5)/1.5,Yr({id:"ui/lowhpheart"}),this.heartBeatTimer.reset(t,e))}handleTorch(t){qn.daytime>.75&&qn.daytime<.95&&this.stats.alive?this.torch||(this.torch=lc(hu.torch),this.torch.setParent(On),xi(this.torch.position,0,1,0)):this.torch&&(this.torch.data.remove=!0,this.torch.setParent(null),this.torch=void 0)}postDelta(t,e,s){this.sendInput(e),this.updateCharPanel(),this.updatePartyInfo(e),super.postDelta(t,e,s),bi(On.position,this.mount?this.mount.position:this.transform.position),this.handleCamera(t),this.handleHeartbeat(e),this.handleTorch(e)}parseDelta(t,e,s){if(this.buffs.movementOverride.size)return super.parseDelta(t,e,s);switch(t){case Em.posXZ:{const i=Qc(e,768);this.reconciliateLatencyPosition(i),this.serverInputAccepted=1,super.parseDelta(t,e,s)}break;case Em.rot:this.parsedFirstInput||(super.parseDelta(t,e,s),ao[0]=this.rot,this.parsedFirstInput=!0);break;case Em.steer:break;default:super.parseDelta(t,e,s)}}updateTransformRotation(t){this.stats.alive&&(this.buffs.movementOverride.size||!ro.rmb.down?this.transform.rotation[1]=this.rot:this.transform.rotation[1]=ao[0],this.mount&&this.updateMountRotation(t),this.transform.rotation.onChange())}setLevel(t){super.setLevel(t),this.uiFrameDirty=!0}onRemove(){super.onRemove(),qn.removePlayer(this)}setExp(t){super.setExp(t),se.update(e=>(e.current=t,e.max=eu(this.level),e))}setClan(t,e=0){super.setClan(t,e),ke.set(t)}}class lM extends Gp{constructor(t){super({size:1.2,name:"Merchant",...t})}static get type(){return 4}}class cM extends Mu{constructor(t){super({Jm:ru.darkskin,...t}),this.robe=this.mesh(this.chest,"character/robe.ho",ru.linen),xi(this.robe.scale,1.2,1.2,1.2),this.robe.rotation.set(0,0,0),xi(this.robe.position,0,-.9,.05),this.hat=this.mesh(this.chest,null,ru.emerald),xi(this.hat.position,0,.6,0),xi(this.hat.scale,1.2,.6,1.2),this.brochure=this.mesh(this.chest,null,ru.gold),xi(this.brochure.position,0,.55,.6),this.brochure.rotation.set(0,0,.78),xi(this.brochure.scale,.3,.3,.2),this.scroll=this.mesh(this.hands[0],null,ru.paper),xi(this.scroll.position,0,0,0),xi(this.scroll.scale,.25,.25,1.2)}tickFixed(){}tickParts(t,e,s){super.tickParts(t,e,s),xi(this.hands[0].position,-.8,-.2,.7),this.hands[0].rotation.set(1.8+.1*this.cycleSin,0,0)}}class hM extends lM{constructor(t){super({...t,...qh.npcs.merchant})}remakeTransform(){super.remakeTransform(),this.transform=new cM({entity:this})}}class dM extends Qp{constructor(t){const e=QC[t.spawn.meta[0]||0];super({name:e.name,size:(t.spawn.meta[5]||100)/100*e.size,...t}),this.behavior=e,this.stationary=this.behavior.stationary||!1,this.yReach=1e3,this.behavior.height&&(this.height=this.behavior.height)}static get type(){return 1}tickFixed(t,e,s){this.horizontalSteer(1),super.tickFixed(t,e,s),this.stats.alive&&Ci(this.CR,this.CR,this.vel,t),this.CR[1]=this.getWorldYBody(s,this.CR[0],this.CR[2])}}class uM extends Mu{constructor(t){t.colPrim=t.colPrim||ru.emerald,t.colSec=t.colSec||ru.bone2,t.sounds=Eu,super({Jm:t.colPrim,colEyes:ru.evilred,...t}),this.head=this.chest,this.changeMeshBaseColor(this.head,t.colSec),this.chest=this.mesh(this,null,t.colSec,null,t.shader),this.chest.data.lod=3,xi(this.chest.scale,3,3,1.5),this.head.setParent(this.chest),xi(this.head.scale,.4,.2,.6),xi(this.head.position,0,.6,0),this.hands.forEach(t=>{t.setParent(this.chest)}),this.legs.forEach(e=>{xi(e.scale,.7,.7,.7),this.changeMeshBaseColor(e,t.colPrim)})}tickParts(t,e,s){super.tickParts(t,e,s),this.hands.forEach(t=>{t.position[1]*=.8,t.position[2]*=.8,t.position[1]+=.5}),this.legs.forEach((t,e)=>{t.position[1]-=1,t.position[0]+=e?.4:-.4}),xi(this.chest.scale,1.8,2,1.8)}getTop(){return 4}}class mM extends iM{constructor(t){super({Jm:t.colPrim||ru.warden,...t}),this.setCrown(t.colSec||ru.gold),this.setShoulders(t.colSec||ru.gold,1.1),this.setCape(t.colSec||ru.gold,.7)}}const pM={death:{id:"skeleton/death",rnd:2},hurt:{id:"skeleton/hurt",rnd:2},melee:{delay:.3,distance:5,rnd:3,id:"melee/sword"},aggro:{id:"skeleton/aggro",rnd:1},idle:{id:"skeleton/idle",rnd:2}};class fM extends iM{constructor(t){t.colPrim=t.colPrim||ru.bone,t.colSec=t.colSec||ru.bone2,t.sounds=pM,super({Jm:t.colPrim,colEyes:ru.evilred,...t}),this.setShoulders(t.colSec,.5),this.legs.forEach(e=>{xi(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,t.colSec)}),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colSec)),this.removeMesh(this.shield,!0),this.shield=void 0}tickParts(t,e,s){super.tickParts(t,e,s),this.chest.rotation[0]+=.1*(Math.sin(1.8*e)*Math.cos(12*e)*.3+.3*Math.sin(1.4*e))-.2,this.chest.rotation[1]+=.15*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),this.chest.rotation[2]+=.2*(Math.sin(.2*e)+.5*Math.sin(1.9*e)),this.chest.rotation.onChange(),this.hands.forEach(t=>{t.rotation[0]+=.2*(Math.sin(2*e)*Math.cos(9*e)+Math.sin(1.3*e)),t.rotation[1]+=.3*(Math.sin(2*e-2)*Math.cos(7*e)+Math.sin(.8*e)),t.rotation.onChange()}),this.legs.forEach((t,s)=>{t.rotation[1]+=.3*Math.sin(.2*e-s),t.rotation.onChange(),t.position[0]+=s?.15:-.15})}}class gM extends KC{constructor(t){t.colPrim=t.colPrim||ru.bone,t.colSec=t.colSec||ru.bone2,t.sounds=pM,super({Jm:t.colPrim,colEyes:ru.evilred,quiver:!1,...t}),this.setShoulders(t.colSec,.5),this.legs.forEach(e=>{xi(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,t.colSec)}),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colSec))}tickParts(t,e,s){super.tickParts(t,e,s),this.chest.rotation[0]+=.1*(Math.sin(1.8*e)*Math.cos(12*e)*.3+.3*Math.sin(1.4*e))-.2,this.chest.rotation[1]+=.15*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),this.chest.rotation[2]+=.2*(Math.sin(.2*e)+.5*Math.sin(1.9*e)),this.chest.rotation.onChange(),this.hands.forEach(t=>{t.visible&&(t.rotation[0]+=.2*(Math.sin(2*e)*Math.cos(9*e)+Math.sin(1.3*e)),t.rotation[1]+=.3*(Math.sin(2*e-2)*Math.cos(7*e)+Math.sin(.8*e)),t.rotation.onChange())}),this.legs.forEach((t,s)=>{t.visible&&(t.rotation[1]+=.3*Math.sin(.2*e-s),t.rotation.onChange(),t.position[0]+=s?.15:-.15)})}}class vM extends iM{constructor(t){super({Jm:ru.warden,...t}),this.setHeadgear(ru.gold),this.setShoulders(ru.gold,1.1),this.setCape(ru.darksteel,.5)}}const yM=[mM,class extends iM{constructor(t){super({Jm:ru.warden,...t}),this.setHeadgear(ru.gold),this.setShoulders(ru.gold,1.1),this.setCape(ru.darksteel,.5)}},zu,class extends iM{constructor(t){t.colPrim=t.colPrim||ru.bone,t.colSec=t.colSec||ru.bone2,t.sounds=pM,super({Jm:t.colPrim,colEyes:ru.evilred,...t}),this.setShoulders(t.colSec,.5),this.legs.forEach(e=>{xi(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,t.colSec)}),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colSec)),this.removeMesh(this.shield,!0),this.shield=void 0}tickParts(t,e,s){super.tickParts(t,e,s),this.chest.rotation[0]+=.1*(Math.sin(1.8*e)*Math.cos(12*e)*.3+.3*Math.sin(1.4*e))-.2,this.chest.rotation[1]+=.15*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),this.chest.rotation[2]+=.2*(Math.sin(.2*e)+.5*Math.sin(1.9*e)),this.chest.rotation.onChange(),this.hands.forEach(t=>{t.rotation[0]+=.2*(Math.sin(2*e)*Math.cos(9*e)+Math.sin(1.3*e)),t.rotation[1]+=.3*(Math.sin(2*e-2)*Math.cos(7*e)+Math.sin(.8*e)),t.rotation.onChange()}),this.legs.forEach((t,s)=>{t.rotation[1]+=.3*Math.sin(.2*e-s),t.rotation.onChange(),t.position[0]+=s?.15:-.15})}},_u,om,class extends KC{constructor(t){t.colPrim=t.colPrim||ru.bone,t.colSec=t.colSec||ru.bone2,t.sounds=pM,super({Jm:t.colPrim,colEyes:ru.evilred,quiver:!1,...t}),this.setShoulders(t.colSec,.5),this.legs.forEach(e=>{xi(e.scale,.4,.4,.4),this.changeMeshBaseColor(e,t.colSec)}),this.hands.forEach(e=>this.changeMeshBaseColor(e,t.colSec))}tickParts(t,e,s){super.tickParts(t,e,s),this.chest.rotation[0]+=.1*(Math.sin(1.8*e)*Math.cos(12*e)*.3+.3*Math.sin(1.4*e))-.2,this.chest.rotation[1]+=.15*(Math.sin(1.3*e)+.6*Math.sin(2.4*e)),this.chest.rotation[2]+=.2*(Math.sin(.2*e)+.5*Math.sin(1.9*e)),this.chest.rotation.onChange(),this.hands.forEach(t=>{t.visible&&(t.rotation[0]+=.2*(Math.sin(2*e)*Math.cos(9*e)+Math.sin(1.3*e)),t.rotation[1]+=.3*(Math.sin(2*e-2)*Math.cos(7*e)+Math.sin(.8*e)),t.rotation.onChange())}),this.legs.forEach((t,s)=>{t.visible&&(t.rotation[1]+=.3*Math.sin(.2*e-s),t.rotation.onChange(),t.position[0]+=s?.15:-.15)})}},class extends Mu{constructor(t){t.colPrim=t.colPrim||ru.emerald,t.colSec=t.colSec||ru.bone2,t.sounds=Eu,super({Jm:t.colPrim,colEyes:ru.evilred,...t}),this.head=this.chest,this.changeMeshBaseColor(this.head,t.colSec),this.chest=this.mesh(this,null,t.colSec,null,t.shader),this.chest.data.lod=3,xi(this.chest.scale,3,3,1.5),this.head.setParent(this.chest),xi(this.head.scale,.4,.2,.6),xi(this.head.position,0,.6,0),this.hands.forEach(t=>{t.setParent(this.chest)}),this.legs.forEach(e=>{xi(e.scale,.7,.7,.7),this.changeMeshBaseColor(e,t.colPrim)})}tickParts(t,e,s){super.tickParts(t,e,s),this.hands.forEach(t=>{t.position[1]*=.8,t.position[2]*=.8,t.position[1]+=.5}),this.legs.forEach((t,e)=>{t.position[1]-=1,t.position[0]+=e?.4:-.4}),xi(this.chest.scale,1.8,2,1.8)}getTop(){return 4}},iM,KC,mM];class bM extends dM{constructor(t){super(t),this.spawn=t.spawn,this.remakeTransform()}remakeTransform(t,e){super.remakeTransform(),this.transform=t?new t({...e,entity:this}):new(yM[this.spawn.meta[0]||0]||yM[0])({entity:this,level:this.spawn.meta[1]||0,colPrim:this.spawn.meta[2]&&ra(this.spawn.meta[2],0),colSec:this.spawn.meta[3]&&ra(this.spawn.meta[3],0)})}}class xM extends aM{constructor(t){super(t)}}class wM extends Gp{constructor(t){super({size:1.2,name:"Sage",...t})}static get type(){return 9}}class kM extends Mu{constructor(t){super({Jm:ru.paleskin,colEyes:ru.teal,...t}),this.robe=this.mesh(this.chest,"character/robe.ho",ru.leather),xi(this.robe.scale,1.2,1.2,1.2),this.robe.rotation.set(0,0,0),xi(this.robe.position,0,-.9,.05),this.scroll=this.mesh(this.hands[1],null,ru.woodbrown),xi(this.scroll.position,0,0,0),xi(this.scroll.scale,.2,.2,3),this.orb=this.mesh(this.scroll,null,ru.teal),xi(this.orb.position,0,0,-.5),xi(this.orb.scale,2,2,.1)}tickFixed(){}tickParts(t,e,s){super.tickParts(t,e,s),this.orb.rotation.set(0,0,.3*e),xi(this.hands[1].position,.8,-.2,.7),this.hands[1].rotation.set(1.8,0,0)}}class $M extends wM{constructor(t){super({...t,...qh.npcs.sage})}interact(t){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",200*qn.player.level),super.interact(t)}remakeTransform(){super.remakeTransform(),this.transform=new kM({entity:this})}}class SM extends Gp{constructor(t){super({size:1.5,name:"Stash",...t}),this.height=.6}static get type(){return 5}}class CM extends Su{constructor(t){super(t),this.chest=this.mesh(this,null,ru.woodbrown),xi(this.chest.scale,2,1,1),xi(this.chest.position,0,0,0),this.brochure=this.mesh(this,null,ru.gold),xi(this.brochure.position,0,0,.5),this.brochure.rotation.set(0,0,.78),xi(this.brochure.scale,.3,.3,.2)}tickParts(t,e,s){}}class MM extends SM{constructor(t){super({...t,...qh.npcs.stash})}remakeTransform(){super.remakeTransform(),this.transform=new CM({entity:this})}}class EM extends Mu{constructor(t){super({Jm:ru.richpurple,...t}),this.backpack=this.mesh(this.chest,null,ru.leather),xi(this.backpack.scale,1.1,.8,.6),xi(this.backpack.position,0,.2,-.7),this.scroll=this.mesh(this.hands[0],null,ru.paper),xi(this.scroll.position,-.4,0,0),xi(this.scroll.scale,.8,.25,1)}tickParts(t,e,s){super.tickParts(t,e,s),this.hands[0].position[2]+=.6,this.hands[0].rotation[1]+=2,this.hands[0].rotation[0]+=-1.9,this.hands[0].rotation.onChange()}}class _M extends sf{constructor(t){super({...t,...qh.npcs.trader}),this.hydratedItems=[],this.itemStores=this.items.map((t,e)=>{const s=new Pw,i=It();return s.hydrate({type:t.item.type,tier:t.item.tier,stacks:t.stacks,store:i}),s.traderslot=e,this.hydratedItems.push(s),i})}remakeTransform(){super.remakeTransform(),this.transform=new EM({entity:this})}}const RM={Monster:class extends dM{constructor(t){super(t),this.spawn=t.spawn,this.remakeTransform()}remakeTransform(t,e){super.remakeTransform(),this.transform=t?new t({...e,entity:this}):new(yM[this.spawn.meta[0]||0]||yM[0])({entity:this,level:this.spawn.meta[1]||0,colPrim:this.spawn.meta[2]&&ra(this.spawn.meta[2],0),colSec:this.spawn.meta[3]&&ra(this.spawn.meta[3],0)})}},Player:aM,Conjurer:class extends NC{constructor(t){super({...t,...qh.npcs.conjurer})}interact(t){const e=Ua.from(t.splice(1)).toString().split("#");""!==e[0]?this.setDialogue(this.interactions[0].text,Array.from(e,t=>{const e=t.split("~");return this.interactions[0].choices[0].replace("$1",e[0])+(e[1]>0?` (Lv. ${e[1]}+)`:"")})):this.setDialogue(this.interactions[0].text,[]),super.interact(t)}remakeTransform(){super.remakeTransform(),this.transform=new LC({entity:this})}},Drop:class extends HC{constructor(t){super(t),this.transform=ic({geo:"drop/drop.ho",tex:"items.png",program:gl.drop,ts:!1,rs:!1,dynamic:!1}),this.transform.rotation.reorder("ZXY"),this.transform.data.multi.needsUpdate=!1,this.size=.7,this.transform.visible=!1,this.uiTimeout=0,this.dirty=!1,this.hasInfo=!1,this.hasPos=!1,this.hasRot=!1,this.color="misc"}postDelta(t,e,s){if(this.transform.visible&&this.dirty&&s.getChunkFromWorld(this.CR[0],this.CR[2]).deserialized){this.CR[1]=this.getWorldYBody(s,this.CR[0],this.CR[2])+.1*Math.random()+.1,this.transform.position[0]=this.CR[0],this.transform.position[1]=this.CR[1],this.transform.position[2]=this.CR[2],xi(Qn,0,1,0);const t=s.getNormal(this.CR[0],this.CR[2]);ea.fromVectors(Qn,t),this.transform.rotation.fromQuaternion(ea),this.transform.rotation[1]=this.rot,this.transform.rotation.onChange(),this.transform.matrixAutoUpdate=!0,this.transform.updateMatrixWorld(!0),this.transform.data.multi.needsUpdate=!0,this.dirty=!1}}setXZPos(t){this.hasPos||(this.hasPos=!0,super.setXZPos(t),this.dirty=!0)}setRot(t){this.hasRot||(this.hasRot=!0,super.setRot(t),this.dirty=!0)}setDropInfo(t,e,s,i,n){let a,r;this.hasInfo=!0,this.party=i,this.partytimeout=n,this.type=jr[t],this.tier=e,this.quality=s,"gold"==this.type?(this.name=this.tier+"c",this.size=.4,a="gold",this.color="gold",this.quality=100):(a=this.type+this.tier,(r=Kp[a])&&(this.name=Wh(this.type,this.tier)),"misc"!==this.type&&"rune"!==this.type&&"book"!==this.type?(this.color=lu(s)[1],gi.itemQualityPercent&&(this.name+=` ${this.quality}%`)):(this.color=this.type,this.quality=100));const o=r&&r.art||a;this.transform.data.DJ=Cr[o],xi(this.transform.scale,20*Cr[o][0],1,20*Cr[o][1]),this.transform.data.ZV=[6.1*Math.random(),0,0,0],this.dirty=!0,this.transform.visible=!0}onRemove(){this.transform.data.multi.remove(this.transform),this.transform.setParent(null),ro.shift.down&&(XS.add(this),this.uiTimeout=5*Math.round(qn.time/5)+10)}},Merchant:class extends lM{constructor(t){super({...t,...qh.npcs.merchant})}remakeTransform(){super.remakeTransform(),this.transform=new cM({entity:this})}},Stash:class extends SM{constructor(t){super({...t,...qh.npcs.stash})}remakeTransform(){super.remakeTransform(),this.transform=new CM({entity:this})}},Blacksmith:class extends OC{constructor(t){super({...t,...qh.npcs.blacksmith})}remakeTransform(){super.remakeTransform(),this.transform=new UC({entity:this})}},Trader:class extends sf{constructor(t){super({...t,...qh.npcs.trader}),this.hydratedItems=[],this.itemStores=this.items.map((t,e)=>{const s=new Pw,i=It();return s.hydrate({type:t.item.type,tier:t.item.tier,stacks:t.stacks,store:i}),s.traderslot=e,this.hydratedItems.push(s),i})}remakeTransform(){super.remakeTransform(),this.transform=new EM({entity:this})}},Dummy:class extends VC{constructor(t){super({...t}),this.remakeTransform()}remakeTransform(){super.remakeTransform(),this.transform=new GC({entity:this})}},Sage:class extends wM{constructor(t){super({...t,...qh.npcs.sage})}interact(t){this.interactions[0].choices[0]=this.interactions[0].choices[0].replace("$1",200*qn.player.level),super.interact(t)}remakeTransform(){super.remakeTransform(),this.transform=new kM({entity:this})}}},PM={};hma.entity.types=RM;for(const t in RM)PM[RM[t].type]=RM[t];const TM=(t,e)=>t==aM.type?e==qn.playerId?oM:xM:PM[t],IM=[-0,-1,-0];class DM{constructor(t){this.entities={array:[],map:new Map,type:{}};for(const t in RM)this.entities.type[RM[t].type]=[];this.chunks=[],this.time=1e-7,this.accum=1e-6,this.timestep=1/60,this.daytime=0,this.tickId=0,this.spawns={array:[],map:new Map,types:new Map},this.grids={},this.settingsCache=new Map}load(t){this.id=t}setTime(t){this.tickId=t,this.time=this.tickId*this.timestep}tick(t){t=Math.min(t,1),this.accum+=t;let e=0;for(;this.accum>this.timestep;)this.accum-=this.timestep,++e,this.setTime(this.tickId+1),this.tickFixed(this.timestep);1!==e&&Math.abs(this.accum)<.1*this.timestep&&(this.accum=0),this.tickDelta(t,this.accum)}tickDelta(t,e){const s=this.time+e;for(let e=0,i=this.chunks.length;e<i;++e)this.chunks[e].tickDelta(t,s,this);for(let e=this.entities.array.length-1;e>=0;--e)this.entities.array[e].preDelta(t,s,this),this.entities.array[e].tickDelta(t,s,this),this.entities.array[e].postDelta(t,s,this)}tickFixed(t){this.daytime=(this.time/600+.9)%1;for(let e=0,s=this.chunks.length;e<s;++e)this.chunks[e].tickFixed(t,this.time);for(let e=this.entities.array.length-1;e>=0;--e)this.entities.array[e].preFixed(t,this.time,this),this.entities.array[e].tickFixed(t,this.time,this),this.entities.array[e].postFixed(t,this.time,this)}createEntity(t,e,s){(s=s||{}).spawn=this.spawns.map.get(e),s.id=e;const i=new(TM(t,e))(s);return void 0!==e&&(i.id=e),this.addEntity(i)}addEntity(t){if(void 0!==t&&void 0!==t.constructor.type)if(this.entities.array.length>=32766)console.log("Error: tried addint entity but we already are at the maximum");else{if(void 0===t.id)for(;void 0===t.id||!this.isEntityIdAllowed(t.id)||this.isEntityIdTaken(t.id);)t.id=Fr(1,32766);if(!this.isEntityInWorld(t)&&!this.isEntityIdTaken(t.id))return this.entities.array.push(t),this.entities.map.set(t.id,t),this.entities.type[t.constructor.type].push(t),t;console.log("Error: Entity in world or entity id taken")}else console.log("Error: tried adding an entity of unknown type to the world")}removeEntity(t){if(void 0===t)return!1;this.entities.map.delete(t.id);let e=this.entities.array.indexOf(t);return e>-1&&this.entities.array.splice(e,1),(e=this.entities.type[t.constructor.type].indexOf(t))>-1&&this.entities.type[t.constructor.type].splice(e,1),t.onRemove(),t}isEntityIdTaken(t){return this.entities.map.has(t)}isEntityIdAllowed(t){return!0}isEntityInWorld(t){return this.entities.array.indexOf(t)>=0}entity(t){return this.entities.map.get(t)}getEntityById(t){return this.entities.map.get(t)}setNetAreaAABB(t,e,s){e-=e%64,s-=s%64,t.l=e-64,t.r=e+128,t.u=s-64,t.d=s+128}serialize(){return this.serializedData=tr.world.encode(this.data),this.serializedData}getHeight(t,e){const s=this.getChunkFromWorld(t,e);return s.deserialized?s.getHeight(t%64,e%64):-0}getNormal(t,e){const s=this.getChunkFromWorld(t,e);return s.deserialized?s.getNormal(t%64,e%64):IM}getSteepness(t,e){const s=this.getChunkFromWorld(t,e);return s.deserialized?s.getSteepness(t%64,e%64):-0}clampV3(t){return t[0]=ia(t[0],.01,this.bounds-.01),t[2]=ia(t[2],.01,this.bounds-.01),t}deserialize({serialized:t,isUpdate:e}){this.parse({deserialized:tr.world.decode(t),isUpdate:e})}getChunkFromWorld(t,e){return t=ia(t,0,this.bounds),e=ia(e,0,this.bounds),t=Math.min(Math.floor(t/64),this.chunkAmount-1),e=Math.min(Math.floor(e/64),this.chunkAmount-1),this.chunks[t+e*this.chunkAmount]}getChunk(t,e){return t=ia(t,0,this.chunkAmount),e=ia(e,0,this.chunkAmount),this.chunks[t+e*this.chunkAmount]}setMode(t){this.mode=ag[t||"jQ"]}parse({deserialized:t,isUpdate:e}){if(e||this.destroy(),this.data=t,this.deserialized=!0,this.settingsCache.clear(),this.setMode(this.getSetting("mode")),!e){this.chunkAmount=this.data.chunkAmount,this.bounds=64*this.chunkAmount,this.grids.props=new BC(this.bounds,16),this.grids.entities=new BC(this.bounds,32*this.chunkAmount),this.chunks=[];for(let t=0;t<this.chunkAmount;++t)for(let e=0;e<this.chunkAmount;++e)this.chunks.push(new zC({id:e+t*this.chunkAmount,x:e,z:t,world:this}));for(let t=0;t<this.chunkAmount;++t)for(let e=0;e<this.chunkAmount;++e){const s=this.getChunk(e,t);s.left=this.getChunk(e-1,t),s.right=this.getChunk(e+1,t),s.front=this.getChunk(e,t+1),s.back=this.getChunk(e,t-1),s.frontRight=this.getChunk(e+1,t+1),s.backLeft=this.getChunk(e-1,t-1)}}this.spawns.array.forEach(t=>{t.entity>0&&this.removeEntity(this.getEntityById(t.entity))}),this.spawns.types.forEach(t=>t.clear()),this.spawns.array.length=0,this.spawns.map.clear(),this.spawns.types.set(2,new Map),this.data.spawns.forEach((t,e)=>{const s={entity:0};Zc(s,t),this.spawns.map.has(s.id)?console.error(`Duplicate spawn id ${s.id} - spawns must have unique id`):(this.spawns.map.set(s.id,s),this.spawns.types.has(s.class)||this.spawns.types.set(s.class,new Map),this.spawns.types.get(s.class).set(s.id,s)),this.spawns.array[e]=s})}getSetting(t){if(!this.settingsCache.has(t)){const e=this.data.settings.find(e=>e.id===t);this.settingsCache.set(t,e?e.value:void 0)}return this.settingsCache.get(t)}destroy(){this.deserialized&&console.log("destroying world"),this.deserialized=!1,this.chunks.forEach(t=>{t.destroy()}),this.chunks=[];for(let t=this.entities.array.length-1;t>=0;t--)this.removeEntity(this.entities.array[t]);this.grids.entities=void 0,this.grids.props=void 0,this.spawns.array.length=0,this.spawns.map.clear(),this.spawns.types.clear(),this.data=void 0}getPlayerByName(t){const e=t.toLowerCase();return this.entities.type[0].find(t=>t.name&&t.name.toLowerCase()===e)}getEntitiesInGrid(t,e,s=100){return this.circle.update(t,e,s).aabb(),this.grids.entities.query(this.circle)}}const AM=(t,e,s)=>{Bt.update(i=>(i.push({title:t,text:e,choices:s}),i))},FM={1:"You have been disconnected from the server.",2:"On cooldown.",3:"Can only be cast on enemy.",4:"Can only be cast on ally.",5:"Not enough mana.",6:"Out of range.",10:"Target is dead.",7:"Can't do that during movement.",8:"Can't cast while busy.",9:"You are incapacitated.",11:"Can't do that in combat.",12:"Can't cast this right now.",13:"Level Ul is too big."},zM=new Map;hma.graphics.ui.alert=Ut.set,hma.graphics.ui.messages=FM,zM.set(15,t=>{if(jx("system",`You have learned ${qh.items.book[t[0]].name} Lv. ${t[1]+1}`,!0),lf(24,100),0===t[1]&&zp.get(t[0]).autoSkillbar){const e=gi.skillbarsettings[qn.player.name].findIndex(t=>-1===t.id);e>=0&&Ce[e].update(e=>(e.id=t[0],e))}}).set(14,t=>{qn.player.skills.add(t[0],Nc(t[2],21600),Nc(t[3],21600),t[1])}).set(16,t=>{qn.player.skills.remove(t[0])}).set(1,t=>{Ut.set({type:"error",text:FM[t[0]]})}).set(17,t=>{qn.player.setExp(t[1]);const e=qn.entity(t[2]);e&&dC(bi([0,0,0],e.visualPosition),t[0]),gi.chat[0]&&jx("exp",`You gained ${t[0]} experience ${e?"from "+e.name:""}.\n      ${qn.player.exp}/${eu(qn.player.level)}`,!0)}).set(18,t=>{qn.player.setExp(t[1]),jx("error",`You have lost ${t[0]} experience. ${qn.player.exp}/${eu(qn.player.level)}`,!0)}).set(19,t=>{qn.player.setExp(t[0])}).set(41,t=>{const e=qn.entity(t[1]);Yr({id:"ui/fame",pitch:-1}),e&&uC(bi([0,0,0],e.visualPosition),t[0]),gi.chat[11]&&jx("fame",`You gained ${t[0]} fame ${e?"from "+e.name:""}`,!0)}).set(42,t=>{gi.chat[11]&&jx("fame",`You have lost ${t[0]} fame.`,!0)}).set(20,t=>{const e=qn.getEntityById(t[0]);e&&e.interact(t)}).set(21,t=>{Ot.set(void 0)}).set(22,t=>{const e=Ua.from(t).toString();jx("system",e,!0)}).set(23,t=>{const e=Ua.from(t).toString();jx("error",e,!0)}).set(44,t=>{const e=Ua.from(t.slice(1)).toString();AM(qh.ui.party.summon,qh.ui.party.onSummon.replace("$1",e),[{text:qh.ui.accept,nocombat:!0,fun:()=>{hma.chat.commands.pack("summonaccept",e)}},{text:qh.ui.decline,fun:()=>{}}])}).set(24,t=>{const e=Ua.from(t.slice(1)).toString();AM(qh.ui.party.invite,qh.ui.party.onInvite.replace("$1",e),[{text:qh.ui.accept,fun:()=>{hma.chat.commands.pack("partyaccept",t[0]+"")}},{text:qh.ui.decline,fun:()=>{hma.chat.commands.pack("partydecline",t[0]+"")}}])}).set(25,t=>{const e=Ua.from(t).toString();AM(qh.ui.party.link,qh.ui.party.onLink+`<p><input readonly type="text" id='partylink' value='${e}'></p>`,[{text:qh.ui.party.copyLink,fun:()=>{document.getElementById("partylink").select(),document.execCommand("copy")}},{text:qh.ui.close}])}).set(26,t=>{qn.player.inventory.setItem(t[0],t[1],t[2])}).set(27,t=>{qn.player.inventory.removeItem(t[0],t[1])}).set(28,t=>{qn.player.inventory.setGold(t[0],t[1],t[2])}).set(29,t=>{Zt.set(t[0]),Rw(t[0],t[1],12)}).set(30,t=>{ie.set(0==t[0]?void 0:t[0]-1)}).set(43,t=>{ne.set(0==t[0]?void 0:t[0]-1)}).set(31,t=>{ce.set(t[0])}).set(32,t=>{BM(t,he)}).set(33,t=>{ue.update(t=>!t),jx("inv",qh.ui.merchant.auctioncancel,!0)}).set(34,t=>{BM(t.slice(1),fe),pe.set({gold:t[0]})}).set(35,t=>{pe.set({gold:t[0]})}).set(36,t=>{pe.set(!1)}).set(37,t=>{ge.set(!0),lf(22,100)}).set(38,t=>{ge.set(!1)}).set(39,t=>{ve.set(!0)}).set(40,t=>{ve.set(!1)}).set(46,t=>{const e=qn.entity(t[0]);void 0!==e&&(e.party=1)}).set(45,t=>{const e=t[0];e<1e3&&e>0&&Ut.set({type:"error",timer:500,text:e}),e<=5&&e>0?Yr({id:"ui/countdown",pitch:-1}):0===e?Yr({id:"ui/battlestart",pitch:-1}):1e3===e?Yr({id:"ui/victory",pitch:-1}):2e3===e&&Yr({id:"ui/loss",pitch:-1})}).set(47,t=>{Jh(t[0])});const BM=(t,e)=>{e.update(e=>(e.length=0,t.forEach(t=>{e.push(new Pw(t))}),e))},UM=(t,e)=>{qn.player&&zM.get(t)(e)},OM=new Map;OM.set(0,(t,e,s)=>{qn.removeEntity(t)}).set(24,(t,e,s)=>{const i=Qc(2*e[1],768);t&&(Np([i[0],1,i[1]],qn.netArea)?t.forceNetPosition(i):qn.removeEntity(t))}).set(1,(t,e,s)=>{e[1]>0&&e[1]!==t.target&&t.transform&&t.transform.onAggro(),t===qn.player&&t.target!==e[1]&&(qn.entity(e[1])?(4===gi.tutprogress&&2===qn.entity(e[1]).faction&&lf(4,100),Yr({id:"ui/target",pitch:-1})):0===e[1]&&Yr({id:"ui/detarget",pitch:-1})),t.setTarget(e[1])&&gi.chat[1]&&jx("combat",`${LM(e[0])} changed target to ${LM(e[1])}.`)}).set(2,(t,e,s)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(5,(t,e,s)=>{for(let s=1;s<e.length;s+=2)t.stats.setResource(e[s],e[s+1])}).set(3,(t,e,s)=>{for(let s=1;s<e.length;s+=2)t.stats.setStat(e[s],e[s+1])}).set(4,(t,e,s)=>{if(t==qn.player&&(lf(6,100),t.skills.cd(e[1],qn.time,Nc(e[2],21600)),e[5]>0&&t.skills.globalCd(Nc(e[4],21600),Nc(e[5],21600))),!s&&t.transform){const s=zp.get(e[1]);s.castLen&&t.transform.currentAnim||!s.fx.animCast||t.transform.anim(s.fx.animCast),s.fx.weaponRibbon&&t.transform.weapon&&Bl({parent:t.transform.weapon,...s.fx.weaponRibbon}),s.fx.effectCast&&s.fx.effectCast.forEach(e=>{lc(e,void 0,t.transform).data.creature=t}),t.transform.onEffort()}}).set(20,(t,e,s)=>{t.skills.startTimedCast(zp.get(e[1]),Nc(e[2],21600),e[3],Nc(e[4],21600)),e[5]>0&&t.skills.globalCd(Nc(e[2],21600),Nc(e[5],21600))}).set(21,(t,e,s)=>{t.skills.interruptTimedCast(!0)}).set(22,(t,e,s)=>{t.skills.finishTimedCast(Nc(e[1],21600))}).set(6,(t,e,s)=>{const i=qn.getEntityById(e[3]),n=e[4];void 0!==i&&lb(i,e[1]),t===qn.player?gi.showIncomingDamage&&lC([-.2,-.2,.5],e[1],n,e[5],!0):i===qn.player&&lC(bi([0,0,0],t.visualPosition),e[1],n,e[5]),n>0&&t.stats.changeResource(6,-e[1]),e[6]>0&&(t.stats.refreshCombatTimer(qn.time,e[6]),i&&i.stats.refreshCombatTimer(qn.time,e[6]));const a=zp.get(e[2]);if(!s&&n>0)if(1!==n)i&&i.transform&&t.transform&&(a.fx.impactSound&&Yr({...Im(a.fx.impactSound,i),transform:t.transform,pitch:a.fx.impactSoundPitchCaster?i.transform.getScaleFactor():1}),a.fx.effectDirImpact&&a.fx.effectDirImpact.forEach(e=>{const s=lc(e);s.data.creature=t,$i(s.data.dir=[0,0,0],i.transform.position,t.transform.position),_i(s.data.dir,s.data.dir),Ci(s.position,t.transform.position,s.data.dir,t.shape.radius),s.updateMatrix(),s.updateMatrixWorld(!0)}),a.fx.effectTarget&&a.fx.effectTarget.forEach(e=>{lc(e,void 0,t.transform).data.creature=t}),t.transform.onHurt(e[1]/t.stats.getStat(6),n));else if(i&&i.transform&&t.transform){const e=lc(hu.physBlock);e.data.creature=t,$i(e.data.dir=[0,0,0],i.transform.position,t.transform.position),_i(e.data.dir,e.data.dir),Ci(e.position,t.transform.position,e.data.dir,t.shape.radius),e.updateMatrix(),e.updateMatrixWorld(!0)}}).set(7,(t,e,s)=>{const i=qn.getEntityById(e[3]);i&&e[5]&&i.stats.refreshCombatTimer(qn.time,e[5]),t===qn.player?gi.showIncomingHeal&&cC([.2,-.2,.5],e[1],e[4],!0):i===qn.player&&cC(bi([0,0,0],t.visualPosition),e[1],e[4]),t.stats.changeResource(6,e[1]);const n=zp.get(e[2]);!s&&i&&i.transform&&t.transform&&(n.fx.effectDirImpact&&n.fx.effectDirImpact.forEach(e=>{const s=lc(e);s.data.creature=t,i&&($i(s.data.dir=[0,0,0],i.transform.position,t.transform.position),_i(s.data.dir,s.data.dir),Ci(s.position,t.transform.position,s.data.dir,t.shape.radius),s.updateMatrix(),s.updateMatrixWorld(!0))}),n.fx.effectTarget&&n.fx.effectTarget.forEach(e=>{lc(e,void 0,t.transform).data.creature=t}))}).set(8,(t,e,s)=>{t.stats.changeResource(7,e[1]),t===qn.player&&gi.showIncomingHeal&&hC([.25,-.2,.5],e[1],e[4],!0),t.transform&&(lc(hu.gainMana,void 0,t.transform).data.creature=t)}).set(9,(t,e,s)=>{0==e[1]?t.stats.alive&&(gi.chat[5]&&jx("combat",`${LM(e[0])} died.`),t.stats.die(),t==qn.player&&qn.mode.allowRespawn?AM(qh.ui.death.death,qh.ui.death.deathmsg,[{text:qh.ui.death.respawn,fun:()=>{hma.chat.commands.pack("respawn","")}}]):t.id==qn.player.target&&lf(7,100)):t.stats.alive||t.stats.respawn()}).set(10,(t,e,s)=>{t.setFaction(e[1])}).set(13,(t,e,s)=>{t.setLevel(e[1])}).set(15,(t,e,s)=>{t.setClass(e[1])}).set(11,(t,e,s)=>{t.setName(Ua.from(e.slice(1)).toString())}).set(12,(t,e,s)=>{t.setClan(e.length>2?Ua.from(e.slice(2)).toString():void 0,e[1])}).set(14,(t,e,s)=>{if(t.setLevel(e[1]),gi.chat[6]){const s=`${t==qn.player?"You":LM(e[0])} leveled up to ${e[1]}!`;jx("lvlup",s),t==qn.player&&(lf(16,100),zp.forEach(t=>{t.class===qn.player.class&&t.minlevel===e[1]&&(lf(19,100),((t,e,s="")=>{Dt.update(i=>(i.push({text:t,icon:e,css:s}),i))})(`<span class=textprimary><b class=textgreen>${qh.items.book[t.id].name}</b><br>Skill book available at the Trader!</span>`,`skills/${t.id}.${kr}`,"border primary"))}))}t.transform&&lc(hu.levelUp,void 0,t.transform)}).set(16,(t,e,s)=>{t.buffs.setBuff(e[1],e[2],e[3],Nc(e[4],21600),Nc(e[5],21600),e[6],e[7],e.length>8?e.slice(8):void 0)}).set(17,(t,e,s)=>{t.buffs.removeBuff(e[1],e[2])}).set(18,(t,e,s)=>{const i=zp.get(e[1]),n=new Dl(qn.time,Nc(e[3],21600)-qn.time+.2);eh(e[0],e[2],i,n)}).set(19,(t,e,s)=>{const i=zp.get(e[1]),n=new Dl(qn.time,Nc(e[8],21600)-qn.time);sh([Lc(e[2],768),Lc(e[3],768),Lc(e[4],768)],Ai([0,0,0],[0,e[5]*e[6]],Oc(e[7],ca)),i,n)}).set(23,(t,e,s)=>{t.setParty(e[1],e[2])}).set(25,(t,e,s)=>{!1===t.hasInfo&&t.setDropInfo(e[1],e[2],e[3],e[4],e[5])}).set(26,(t,e,s)=>{t.setPosLock(e[1],e[2],e[3])});const jM=(t,e,s)=>{const i=qn.getEntityById(e[0]);void 0===i||OM.get(t)(i,e,s)},LM=t=>{const e=qn.getEntityById(t);return`${t>0?e?e.name:"unknown":"nobody"}`},NM=[Ot,ce,pe,ve,ge],qM=[Ft,he,Bt],HM=[Qt,Vt],WM=()=>{HM.forEach(t=>t.update(t=>(t.visible=!1,t))),At.update(t=>(t.membercount=0,t.role=0,gi.partyinfo=t,t)),NM.forEach(t=>t.set()),qM.forEach(t=>t.set([]))};class QM extends DM{constructor(t){super(t),this.smoothtime=0,this.unsetLoading=!1,this.removePlayer(),this.netTimeoutTimer=new Dl,this.netArea={l:0,r:0,d:0,u:0},this.party=new Map,this.uiTimer=new Dl(0,1/30),pd("close",()=>{console.log("on disconnect"),this.onDisconnect()}),this.netData=[],pd(hma.handle.data.serverEntityDelta.header,t=>{this.netData.push(hma.handle.data.serverEntityDelta.decode(t))}),this.personalLog=[],pd(hma.handle.data.serverPersonalLog.header,t=>{(t=hma.handle.data.serverPersonalLog.decode(t)).log.forEach(t=>this.personalLog.push(t))}),this.chatData=[],pd(hma.handle.data.serverChat.header,async t=>{this.chatData.push(t)}),this.systemMessageData=[],pd(hma.handle.data.serverSystemMessage.header,async t=>{this.systemMessageData.push(t)}),this.partyData=void 0,pd(hma.handle.data.serverPartyUpdate.header,async t=>{this.partyData=t}),pd(hma.handle.data.serverPartyPositions.header,async t=>{t=hma.handle.data.serverPartyPositions.decode(t).members,this.party.forEach(e=>{const s=t.find(t=>t.entityid===e.id);s&&(e.CR=Qc(s.CR,768))})})}handlePartyData(t){let e;this.party.forEach(t=>{t.found=!1}),(t=hma.handle.data.serverPartyUpdate.decode(t)).members.forEach(t=>{if(this.party.has(t.name)){const e=this.party.get(t.name);t.entityid!==this.player.id&&e.store.update(e=>(e.id=t.entityid,e.name=t.name,e.level=t.level,e.class=t.class,e.world=t.world,e.faction=this.player.faction,e.role=t.role,e)),e.found=!0}else this.party.set(t.name,{id:t.entityid,found:!0,name:t.name,store:t.entityid==this.player.id?Qt:It({id:t.entityid,name:t.name,level:t.level,class:t.class,world:t.world,role:t.role,faction:this.player.faction,type:0,visible:!0,alive:!0,powertype:!1,range:!1,buffs:[]})});t.entityid==this.player.id&&(e=t)}),this.party.forEach((t,e)=>{t.found||this.party.delete(e)}),Ft.set(Array.from(this.party.values()).filter(t=>gi.showSelfInParty||t.id!=this.player.id)),e?At.update(s=>(s.membercount=t.members.length,s.role=e.role,s.queues=t.queues,gi.partyinfo=s,s)):At.update(t=>(t.membercount=0,t.role=0,t.queues=[],gi.partyinfo=t,t))}handleChatData(t){t.forEach(t=>{(t=hma.handle.data.serverChat.decode(t)).messages.forEach(t=>{if(""==t.from){const e=t.message.split(" ");qh&&qh.ui.messages[e[0]]&&(t.message=qh.ui.messages[e[0]],e.splice(1).forEach((e,s)=>{t.message=t.message.replace("$"+(s+1),e)})),t.channel="notice"}else if(gi.chatbubbles){const e=this.getPlayerByName(t.from);if(e){let s;switch(t.channel){case"clan":s=mC.chatClan;break;case"party":s=mC.chatParty;break;default:case"global":s=mC.chatGlobal}e.speech(t.from+": "+t.message,s)}}"whisper"==t.channel&&(t.from=t.to==this.player.name?`from ${t.from}`:`to ${t.to}`),"GM"===t.clan&&"global"===t.channel&&(t.channel="GM"),jx(t.channel,t.message,["system","notice"].includes(t.channel),t.from,t.faction,t.class,t.level,t.subscribed)})})}handleSystemMessageData(t){t.forEach(t=>{(t=hma.handle.data.serverSystemMessage.decode(t)).messages.forEach(t=>{jx(t.type,t.message,!0)})})}handleEntityDelta(t){if(this.netData.length>0){const e=this.netData.shift();this.setTime(e.tickId);const s=e.data[0],i=e.ids[0];for(let t=0;t<s.length;++t){if(this.getEntityById(i[t]))continue;const e=s[t];for(let s=0;s<e.length;s+=2)e[s]==Em.entityType&&this.createEntity(e[s+1],i[t],{world:this})}for(let s=0,i=e.log.length;s<i;++s)jM(e.log[s].type,e.log[s].data,t-this.time>3);for(let t=0;t<e.data.length;++t){const s=e.data[t],i=e.ids[t];for(let t=0;t<s.length;++t){const e=this.getEntityById(i[t]),n=s[t];for(let t=0;t<n.length;t+=2)e&&e.parseDelta(n[t],n[t+1],this)}}}if(this.personalLog.length>0){for(let t=0,e=this.personalLog.length;t<e;++t)UM(this.personalLog[t].type,this.personalLog[t].data);this.personalLog.length=0}}tick(t){if(this.netData.length>0){let t=~~Math.max(1,this.netData.length/2);const e=Nc(this.netData[this.netData.length-1].time,10800);for(;this.deserialized&&t--;)this.handleEntityDelta(e)}if(this.player){if(super.tick(t),this.smoothtime+=t,Math.abs(this.smoothtime-this.time)>.1&&(this.smoothtime=this.time),this.uiTimer.done(this.smoothtime)&&(Se.set(this.smoothtime),this.uiTimer.reset(this.smoothtime)),this.player&&this.netTimeoutTimer.done(this.time)||this.time<this.netTimeoutTimer.start){this.netTimeoutTimer.reset(this.time-.5,2),this.setNetAreaAABB(this.netArea,this.player.CR[0],this.player.CR[2]);for(let t=this.entities.array.length-1;t>=0;t--){const e=this.entities.array[t];e!=this.player&&(Np(e.CR,this.netArea)?e.netDeletion.reset(0,0):0===e.netDeletion.end&&e.netDeletion.reset(this.time,2+2*Math.random()))}}for(let t=this.entities.array.length-1;t>=0;t--){const e=this.entities.array[t];e!=this.player&&e.netDeletion.end>0&&e.netDeletion.done(this.time)&&(this.removeEntity(e),e.id==this.player.target&&this.player.setTarget(0))}this.player&&(this.partyData&&(this.handlePartyData(this.partyData),this.partyData=void 0),this.chatData.length&&(this.handleChatData(this.chatData),this.chatData.length=0),this.systemMessageData.length&&(this.handleSystemMessageData(this.systemMessageData),this.systemMessageData.length=0))}}removeEntity(t){const e=super.removeEntity(t);return e&&this.party.has(e.name)&&this.party.get(e.name).store.update(t=>(t.buffs.length=0,t.timedSkill=void 0,t.timedCast=void 0,t.alive=!0,t.range=!1,t.mp=t.hp=t.hpMax=t.mpMax=0,t)),e}load(t,e){super.load(t),this.deserialized=!1,this.playerId=e,qt.set(!0),this.unsetLoading=!0,fetch("/worlddata/"+this.id+"/world?v=3406973",{cache:"default"}).then(t=>{t.ok&&t.arrayBuffer().then(t=>{this.deserialize({serialized:Ua(t)})})})}parse({deserialized:t,isUpdate:e,sendToServer:s}){t&&super.parse({deserialized:t,isUpdate:e}),Oh({world:this,first:!e}),s&&(this.serialize(),this.sendToServer())}onDisconnect(){this.netData.length=0,this.personalLog.length=0,this.partyData=void 0,this.party.clear()}destroy(){super.destroy(),jh({world:this}),this.uiTimer.reset(0),wC(this)}setPlayer(t){this.player=t,ae.set(!0),WM()}removePlayer(t){this.player==t&&(this.player=void 0,ae.set(!1))}}hma.world=QM,hma.net=qt;const VM={guardstone:{port:5002},headless:{port:5003},faivel:{port:5004},arena_ruins:{port:5005},arena_ruins2:{port:5006}};hma.ports=VM;let GM=0;var YM=Object.freeze({__proto__:null,init:()=>{pd(hma.handle.data.serverOnClientConnect.header,t=>{const e=hma.handle.data.serverOnClientConnect.decode(t);qn.load(e.world,e.playerId),document.cookie="party=",jx("log",`Entering ${e.world.charAt(0).toUpperCase()+e.world.slice(1)}`)}),pd("close",t=>{switch(qn.destroy(),t.code){default:case 1006:case 4e3:qt.set("autoReconnect");break;case 4001:hma.graphics.ui.alert({type:"error",text:hma.graphics.ui.messages[0]}),qt.set("askReconnect");break;case 4002:window.location.href="/"}})},enter:t=>{qn.deserialized||qt.set(!0),void 0!==rd?(rd.close(),rd=void 0):console.log("tried ws disconnect, but ws undefined"),(t=>{void 0===rd?((rd=new WebSocket("wss://"+t+"/play")).binaryType="arraybuffer",rd.onerror=hd,rd.onopen=dd,rd.onclose=ud,rd.onmessage=md,console.log("connecting to game server: "+t)):console.error("tried ws connect, but ws already created")})(t.target)},tick:t=>{if(qn&&qn.deserialized&&qn.player){(t=>{yC.forEach(e=>{e.preTick&&e.preTick(t)})})(t),qn.tick(t),(t=>{bC&&yC.forEach(e=>{e.tick&&e.tick(t)})})(t),((t,e)=>{const s={dt:t,world:qn,camera:Ph,cameraPivot:Th,viewRange:Ah,renderer:_h,viewRangeSquared:Fh};zh.forEach(t=>{t.tick&&t.tick(s)})})(t),Ih.needsFullUpdate=!0,gi.shadows&&el&&(yl(Rh),hma.graphics.Canvas.render({scene:Ih,camera:al.water,shadowTarget:sl.water}),xl(),vl(Rh),hma.graphics.Canvas.render({scene:Ih,camera:al.LG,shadowTarget:sl.shadowStatic}),bl(),rl(!1)),gi.shadows&&(Rh.bindFramebuffer(Rh.READ_FRAMEBUFFER,sl.shadowStatic.buffer),Rh.bindFramebuffer(Rh.DRAW_FRAMEBUFFER,sl.LG.buffer),Rh.blitFramebuffer(0,0,1024,1024,0,0,1024,1024,Rh.DEPTH_BUFFER_BIT,Rh.NEAREST),hma.graphics.Canvas.render({scene:Ih,clear:!1,camera:al.LG,sceneCamera:Ph,shadowTarget:sl.LG})),gi.postProcessing?Dh.render({scene:Ih,camera:Ph,update:!gi.shadows}):hma.graphics.Canvas.render({scene:Ih,camera:Ph,update:!gi.shadows}),(t=>{bC&&yC.forEach(e=>{e.postTick&&e.postTick(t)})})(t);const e=Hl();td(e-GM),GM=e}else qn&&qn.tick(t)}});const XM={};let ZM,JM;window.client.world=new hma.world({}),Client.prototype.data=gi,window.onload=(()=>{ho(gi.kbForward,ro.fwd={}),ho(gi.kbLeft,ro.left={}),ho(gi.kbBack,ro.back={}),ho(gi.kbRight,ro.right={}),ho(gi.kbNextTarget,ro.nextTarget={}),ho(gi.kbUntarget,ro.untarget={}),ho(" ",ro.jump={}),ho(gi.kbAltForward,ro.fwd),ho(gi.kbAltBack,ro.back),ho(gi.kbTurnRight,ro.turnright={}),ho(gi.kbTurnLeft,ro.turnleft={}),ho("shift",ro.shift={}),ho("m0",ro.lmb={}),ho("m2",ro.rmb={}),ho("control",ro.ctrl={}),ho("alt",ro.alt={}),ho(gi.kbMap,ro.map={}),ho(gi.kbSkills,ro.skills={}).onPress(()=>{Qe.update(t=>!t),Yr({id:"page",loop:!1})}),ho(gi.kbCharacter,ro.char={}).onPress(()=>{Je.update(t=>!t),Yr({id:"page",loop:!1})}),ho(gi.kbInventory,ro.inventory={}).onPress(()=>{He.update(t=>!t),Yr({id:"inventory",loop:!1})}),ho(gi.kbClan,ro.clan={}).onPress(()=>{Xe.update(t=>!t),Yr({id:"inventory",loop:!1})}),document.addEventListener("wheel",yo,{passive:!0}),document.addEventListener("keydown",wo,!1),document.addEventListener("keyup",ko,!1),document.addEventListener("contextmenu",bo,!1),document.addEventListener("mousedown",go,!1),document.addEventListener("mouseup",vo,!1),document.addEventListener("mousemove",mo,!1),Bh(),yC.forEach(t=>{t.init&&t.init()}),(t=>{qn=t})(window.client.world),console.log(`Hordes ${hma.game_version} Live`),((t,e)=>{XM.play=e,e.init&&e.init()})(0,YM),Me.subscribe(t=>{t?((t,e)=>{XM[ZM]&&XM[ZM].exit&&XM[ZM].exit(),ZM=t,Ht.set(t),XM[ZM].enter&&(console.log("Entering state: "+t),XM[ZM].enter(e))})("play",{target:`${hma.server}:${hma.ports[t].port}`}):qt.set("autoReconnect")}),sE()});let KM=0,tE=!1;const eE=new Dl(0,2e4),sE=()=>{const t=Hl(),e=(t-(JM||1e3/60))/1e3;JM=t,(t=>{ZM&&XM[ZM].tick&&XM[ZM].tick(t)})(e),requestAnimationFrame(sE),eE.done(t)&&(t>1e5&&!tE&&t-KM>18e4?(tE=!0,KM=t,me.set(!0)):tE&&(tE=!1,me.set(!1)),Kd("session","minutetick","sec",Math.round(t/1e3)),eE.reset(t))}}();

// ==UserScript==
// @name         Coordinates [HMA Example Mod]
// @namespace    *://*.hordes.io/play
// @version      0.1
// @description  Show your coordinates in the top-left of your screen
// @author       Team XHordes
// @match        *://*.hordes.io/play
// @grant        none
// ==/UserScript==

(function() { // Execute code in an anonymous function (you don't need to use this if you're not going to be publishing your mod)
    'use strict';

    window.client.on("open", () => {
			let text = window.hma.graphics.ui.createElement("div"); // Create a new element with the "div" tag
			window.hma.graphics.ui.setAttributes(text, "class", "textyellow"); // Set text's class to "textyellow" (this will change the text's color to yellow)
			// CSS Text Color: https://www.w3schools.com/CSSref/pr_text_color.asp
			// You can also achieve that ^ by typing: text.style.color = "#E7D510";
			document.getElementsByClassName("l-corner-ul uiscaled")[0].appendChild(text); // Put the text in the top-left corner (below the party button bar)
			window.posInt = setInterval(() => { // Create a new interval that will update the position text every 0 milliseconds
				if (window.client.connected) {
					text.innerText = `X: ${Math.round(window.client.world.player.CR[0])} Y: ${Math.round(window.client.world.player.CR[1])} Z: ${Math.round(window.client.world.player.CR[2])}`; // Set the text's text to "X: [XPosition] Y: [YPosition] Z: [ZPosition]"
				}
			}, 0);
	});
	window.client.on("close", () => {
		clearInterval(window.posInt);
	});
})();
